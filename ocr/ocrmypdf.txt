ddddddddddd dads 353533333

FRFRRFFREFRFFFEF 353333535

FRPP RRRFRPR PEE $35555553

FRE 335

FFF 333

FRE 333

FFF

FFF

FFF

FrEERRRRRRPE

FRFRFRFRFRFE

FRERREFRPRPE

FRE

FRE

FRF

Fre 333

FRE 333

FRE 385

FR 343535333

FFF 353335353
$S3538553

LPTSPL VERSION ©(344) RUNNING ON LPTE

WSTART® USER HITS (600,600) JUB FS SEQ, 42 DATE 10-SEP=75 8424832 MONITOR ALBUQUERQUE SCHOOLS 5@7B *START®
REQUEST CREATEDS 10-SEP-75 @531 6

FILES DSK50:F3f6000,6000) CREATED? 10*SEPe7s vs
QUEUE SWITCHES? /FILESASCII /CUPLES82e /SPACING
FILE wILL 3& VELETED AFTER PRINTING

1 PRINTED? 1@-SEP-75 @8852843
1 /LIMIV$1505 /FORMSSNORMAL

BASIC MLS 6986 GATES/ALLEN/DAVIDUFF MACRO 47(115) O5822 1GeSEPe/S PAGE 1
c beSEFRb4 05208 COMMON FILE

0108 SEARCH MCS8O8 TTHE UNIVERSAL FILE

90200 SUBTTL COMMON FILE

e058 = SALL

0400 LENGTHse2 7 @ MEANS 4K, 1 MEANS 8K, 2 MEANS 12K
500 =REALIOSe4

4608 —CASSwese FCASSETTE SwITCh (CSAVE,CLOAD)

20700 PURESSG TON FOR PURE CODE

avsee

20900 FON TO REAO/WRITE

e1900

o1evo i TMAKE COMMA COLUMNS FOURTEEN CHARACTERS
1300 RAMBOTs"O2eQ000 7BOTTOM LOCATION OF RAM FOR PURE SWITCH
1400  CUNTRvset FALLOW *0

@15va—sTFE

1608 LPTows2g FSIMULATOR DEFAULTS

81700 CASSweeg

01600 CONSSwasQ

01908 OSKFUNS=0

eo) CONTRW=20>

aeave LENGTH, <

02300 EXTFNCas FON MEANS EXTENDED FUNCTIONS

o2400 MULOIMes@ TON MEANS MULTIPLE DIMENSIONED ARRAYS ALLOWED
a25u08 STRING=8@ JON MEANS STRINGS ALLOWED

be2600 CASSW=20

aero LPTSH

weaue OSFFUNS=0

aera CONSSweed

asevo CONTRWEsQ>

93200 LENGTH=1,<
05300 EXTFNC==1
23400 MULOIM==1
03500 STRINGS=1>

03700 LENGTH=2,<
03800 EXTFNCest
os9ue MULOIMset
34008 STRING=S1>

24200 DEFINE SYNCHK(A),<RST 1
A>

DEFINE CHRGET,<RST
DEFINE OUTCHR, <RST
DEFINE COMPAR, <RST
DEFINE FSIGN,<KST
DEFINE PUSHM,<RST
DEFINE PUSHFM, <PUSHM
PUSHM>
DEFINE ACRLF,<
“013
05300 = IFN STRING, <"D10>>

@
e

BASIC

c

54

Se
57
58
59
ee
1
62
65
64
65
66
67

69
70
1

le
73
74
75
To
1
78
19

BASIC

FS

mcs saae

beSEP=04 05308

MCS 8980
mac

ooaeeet

GATES/ALLEN/OAVLOUFF

GaTES/ALLEN/DAVIOOFF
orSEPe64 03311

o00ee
ovnues

ovary
oeoiie
evo118
aeoues
avovas
avoves
aes
aeaeis
wooel?
avveed
2eaveL
BUBEOL
avowed
2eavo0
ovavar

ovoues

MACK

COMMON FILE

e54ave
95508
o5eue
25700
95800
95900
a6000
ao1e
gee0o
96500
geueo
6500
aoove

96800
ae9ee
a7aeo
ariee
greeo
a7see
o7400
@7500
a7eue
91700
@7800
97900

MACKO 47(413)
VERSIUN 3,0 =

eevee
aenae
avd
20080
ao100
ouiee

aviee
aviee
aeeve

rE)
av26o

aeseo
ousae
avsee

ae4eo
ovaee
oo4aae
ee4en
aease
9050
aeseo
aus4o
paseo
aeseo
aeoeo
aeeeo
ave4a
au66e
Q6680
20708
a0reo
oeT4e
eu7ee
0780
re)
poser
aesao
ou8ee
avasa
80900
aesee
ae9eo
aia0e
oiae0
g1940
91060
a1e8o
i120

ATCA1S) @5212 LOSER ATS PAGE tod

DEFINE PUSHR, <
Push oD

PUSH Be
POPR,<

Por 8

Por o>
MOVRI(8,C,0,E),<
xno *u1900,70001 og
exp c

Exp 8

xwO *o1aee,"a9a1
exe €

exe o>

DEFINE

EF INE
"LxI Bn

47 LxT om

LENGTH, <PRINTX
LENGTHet y <PRINTX
LENGTii=2, <PRINTX,
REALIO, <PRINTX
REALIO, <PRINTX
CASSW, <PRINTX
PURE, <PRINTX
LPTSW, <PRINTX
OSKFUN, <PRINTX
CONSSH, <PRINTX

/SMALL/>
*MEDLUM/>
/B1G/>

/SIMULATE/>

7ON MACHINES >

/CASSETTE/>

/PURE/>

ALPT/>

/DISK/>

/CONSOLE/>>

1U-SEP*75 PAGE 1
ORE FEATURES TO GO

SUBTTL
TITLE
IF NDEF

VERSION 3,0 ==
BASIC NCS 898u
LENGTH, <PRENTS
END>

MESSI (START)

COMMENT *

HORE FEATURES TO GO
GATES/ALLEN/DAV LOOFF
HE] MUST HAVE COM J!)

COPYRIGHT 1975 BY BILL

GATES AND PAUL ALLEN

ORIGINALLY WRITTEN ON
FEBRUARY 9 TO APRIL 9

THE POPe1¢ FROM

BILL GATES WROTE THE RUNTIME STUFF,
PAUL ALLEN WROTE THE NON®RUNTIME STUFF,
MONTE OAVIDOFF WROTE THE MATH PACKAGE

THINGS 10 003
GOSUB / INPUT BUG (BUF SMASH)

PRINT PUNCTUATION MANDATORY

MULTIPLE LET

RESTART AT @ SHOULD GO THROUGH STKINE

USER DEFINED FUNCTIONS (MULTI*ARG,MULTI*LINE, STRINGS)
MAKE STACK BOUNUARY STUFF EXACT

PUNCH, RENUMBER, ,
INLINE CONSTANT
RADIX 10 TTHROUGHOUT THE NONeMATH PACKAGE ROUTINES

CONVERSIONe*MAKE IT WORK

+PaEG
NUMLEVSS17#LENGTH2

LPTLENs=72
LINLENS=72
BUFLENS=72

4
LENGTH=2, <STRSIZ==3>

LENGTH=2, <NUMTMP#S>
CkEE13

CONTW=I5

ODONE==128

1
TIOCHNS=4
TTICHNs
LISTEN==0
FUNCTS2=1
IFN REALIO,<
LISTENs=1>

IFE LENGTH, <
FUNCTS==0>

FOR SIMULATOR FIXUPS

FNUMBER OF STACK LEVELS RESERVED
PWITH AN EXPLICIT CALL TO GETSTK
PWIDTH OF LINE*PRINTER

HTELETYPE LINE LENGTH

FINPUT BUFFER SIZE

FNUMBER OF STRING TEMPORARTES

JCHARACTER TO SUPRESS OUTPUT
#BIT FOR OUTPUT DONE

781T FOR INPUT DONE

FTELETYPE OUTPUT CHANNEL

FTELETYPE INPUT CHANNEL

FON MEANS LISTEN FOR “C

FON MEANS USER FUNCTIONS ALLOWED

¥{ CANNOT BE ON WITH LENGTH=@ (SUBFLG)

BASIC MCS Bo8u

Fs

BASIC

FS

17e
173
174
175
176
m7
178
179
180
161
162
163
164
185
166
167
188
169
190
191
192
193
194
195
196
197
196
199
ave

Mac

Nes an8y
Mac

GATES/ALLEN/DAVLOUFF
6eSEP=54 OSt11

GATES/ALLEN/DAV DOF F
beSEPeed OSt11

MACRO
VERST

01200
o12e0
@1a4e
1268
a1280
a1seo
a1se0
1340
21500
01360
a14ve
1420
1440
01460
@1402
21464
21466
01468
01480
a1see
e15e0
a1s4e
@1568
a158e
a1600
a16e0
aie4e
01660
91680
a1700
e172
01730
1740
1760
01780
91800
1820

macro
SOME

1840
21880
a1920
01960
eave

geo4a
vevow
ae08o
oe10@
geieo

ae1ee
e160
@eevo
aeeee
weean
weeeo
aease
aeseo
e23e0
wes4e
@e300
a2see
e400
Be4e0

a2400
aeaee
22500
veseo
wesao
a2560
peseo
deove
Beoee
aeo4e
ae60e
aee8e
vere
vere
veraa
92760

aeaee
eeseo
aesde
deser

4145) 95

ie

1UeSEP=75 PAGE tot

UN 5,0 -* MORE FEATURES TO 60

INTERNAL
INTERNAL

EXTERNAL
EXTERNAL
EXTERNAL
EXTERNAL
INTERNAL
EXTERNAL
INTERNAL.
INTERNAL,
IFN
INTERNAL,
INTERNAL
IFN
INTERNA!
INTERNAL,
EXTERNAL
INTERNAL
IFN

TFN

IFE
INTERNAL
EXTERNAL
IFN
INTERNAL
IFN

IFE
EXTERNAL
EXTERNAL
EXTERNAL
EXTERNAL
INTERNAL,
PAGE

47115) o
EXPLANATION

SUBTTL

COMMENT

C1, BUF, READY, REASON, SNERR, OMERK, REPINT
STREND, CURLIN, DVGERR, ERROV

REALIO,<

EXTFNG, <INTERNAL

CNLCAL, CNLCA2,CNLCAS>
ATNF IX» COSFIX,SINFIX, TANF IX

FPWR EXP

GINT, ZERO, MOVE, FOUT) FIN, FCONP, FADD, PUSHF, INT, INIT
MOVFR, MUVRF ,MOYRM, INPRT,LINPRT

MOVFM) MOVMF) TSTACK»FLOATRI,FAUDS

ILLFUN, FAC, FACLO,TXTTAB, STROUT, SCRTCH
INRART/ NEG» FLOAT

OUTOO, STRUT

STKTOP, ERROR, FCERR

STRING, <

VALTYP, TEMPPT

MENSIZ,FRETOP
SIGNS>
FOUFF Ry NINUTK, PLUSTK»CRDO,LINGET, INTXT,GINLIN

MULDIM, INTERNAL BSERR>
MULOIN, <EXTERNAL UMULT>

LENGTH, <INTERNAL

RNOF IX, SQRFIX,SINFIX>
SIGN
SIGNC,POPHRT

CONTRW,<

CNTWFL>

LPTSW)<
INTERNAL LPTPOS, PRTFLG>
LENGTHe2,<

2

CONSIH, VNOVF A, VMOVAF, ISIGN, FPWRG, CONIA, GETBCD, VSIGN

VMOVMF » VMOVFM, FRCINT» FRCSNG, FRCUBL , NEG, PUFOUT , OCXBRT, LADD
TSB, IMULT, LD1V, ICOMP, INEG,DADD, DSUB,DMULT, DIV, DCOMP, VINT
THERRy VHOVE, VALINT, VALSNG, FRCSTR»CHKSTR, MAKINT

DFACLO, ARG, ARGLO,VALTYP,ERRTM, TEMP2, TEMPS, GETYPE>

1G"SEP@75 PAGE 2

SONE EXPLANATION

*

ALTAIR BASIC CONFIGURES MEMORY AS FOLLOWS:

Low Locations

RST

SUBROUTINES

STARTUP
INITIALLY A JMP TO THE INITIALIZATION CUDE
BUT CHANGED TO A JMP TO READY,

RESTARTING THE MACHINE AT @ OURING PROGRAM
EXECUTION CAN LEAVE THINGS MESSED UP,

SYNCHK
A CHECK IS MADE TO MAKE SURE THE

CHARACTER POINTER POINTS AT A SPECIFIC

CHARACTER, IF NOT THE "SYNTAX ERROR™

ROUTINE IS CALLEO, IF SO,

THE CHRGET KST 18 OROPPED INTO SO

ThE CHARACTER AFTER THE MATCHED

ONE WILL BE PUT IN (A) AND

THE CONDITION CODES WILL REFLECT THIS

EXAMPLES SYNCHK THENTK (THE HATCH CHARACTER IS
GIVEN IN THE LOCATION AFTER THE RST)

WOULD CHECK TO FAKE SURE (HyL] POINTED TO A THENTK
AND IF SO FETCH THE NEXT CHARACTER INTO (AJ,

Tf NOT, A "SYNTAX ERROR" WOULD BE GIVEN,

CHRGET
USING (HyL) AS THE TEXT POINTER

THE TEXT POINTER IS INCREMENTED

AND THE NEXT CHARACTER 18 FETCHED INTO (A

IF THE CHARACTER IS A" " IT 1S SKIPPED

OVER AND THE NEXT CHARACTER IS FETCHED,

THE STATEMENT TERMINATORS "3" AND @

LEAVE THE ZERO FLAG SET,

THE NUMERICS "@" THROUGH "9" LEAVE THE CARRY
FLAG SET, THE CURRENT CRARACTER CAN BE
REFETCHED INTO [A] BY DOING A MOV AyMy

IF THE CONDITION CODES MUST BE SET UP AGAIN
OCX Hy CHRGET WILL WORK, IT 1S VERY DIFFICULT
TO REEXAMINE THE CHARACTER BEFORE THE CURRENT
ONE SINCE SPACES MAY BE IN=bETHEEN,

OCX H/DCX H,CHRGET WILL NOT ALWAYS WORK,

OUTCHR
THE CHARACTER IN [A] IS PRINTED ON
THE USER?S TERMINAL, [A] ANU THE
CONDITION CODES ARE PRESERVED,

BASIC MCS BABY GATES/ALLEN/DAVLOOFF MACRO 47(113) 25212 10-SEP=75 PAGE 2a1
Fs Mac OrSEPeo4 BSE14 SOME EXPLANATION

e900 COMPAR
ered (DyE) AND (HyL] ARE COMPARED AS UNSIGNED
e940 OOUBLE-6YTE INTEGERS, CARRY IS SET IF

22960 (Hob) 1S LESS THAN (D,E), ZERO IS SET IF THEY
02980 ARE EQUAL, [A] 1S SHASHED, THE ONLY DEFINITE
aspoa THING TrAT CAN BE SAID ABOUT [A) ON RETURN
95020 Is THAT IF THE ZERO FLAG IS SET, (A) WILL
@soaa EQUAL @.

03080 FSIGN
as100 THE FAC (FLOATING ACCUMULATOR)

osteo WHICH IS USED To STORE NUMERIC RESULTS
aside IS CHECKED TO SEE WHAT SIGN ITS

asie VALUE HAS,

es2ve PUSH
oseeo & DOUBLE BYTE QUANTITY POINTED

sea To BY [hyL) IS PUSHED ONTO THE

as260 STACK, (8,C) 18 SET EQUAL TO THE

95200 VALUE PUSHED, [H)L] IS INCREMENTED BY THO,

3320 IN THE 4K VERSION RST 7 IS UNUSED ANO THE LOCATIONS
o3340 ASSOCIATED WITH IT ARE USED TO CONTINUE

05368 THE CODE FOR RST 6, IN THE 6K A JMP IS MADE

93380 AROUND THE FIRST THREE RST 7 LOCATIONS

asaee OURING RST 6 EXECUTION, RST 7 INITIALLY

as4ao CONTAINS A RET, BUT THE USER CAN CHANGE IT TO
asaaa A JMP TO AN INTERRUPT SERVICE ROUTINE,

460 FUNCTION DISPATCH ADDRESSES

63500 FUNOSP CONTAINS THE ADDRESSES OF THE

es5eo FUNCTION ROUTINES IN THE ORDER OF THE

3540 FUNCTION NAMES IN THE CRUNCH LIST,

28500 THE FUNCTIONS THAT TAKE MORE THAN ONE ARGUMENT
as5ee ARE AT THE END, SEE THE EXPLANATION AT ISFUN,

95620 THE OPERATOR TAGLE

ase40 ThE OPTAB TABLE CONTAINS AN OPERATORS PRECEDENCE

asooe FOLLOWED BY THE ADORESS OF THE KOUTINE TO PERFORM

23680 THE OPERATION, THE INDEX INTO ThE

as7ee OPERATOR TABLE IS MADE BY SUBTRACTING OFF THE CRUNCH VALUE
as7eo OF THE LOWEST NUMBERED OPERATOR, THE ORDER

a3742 OF OPERATORS IN THE CRUNCH LIST AND IN OPTAB IS IDENTICAL,
43760 ThE PRECEDENCES ARE ARBITRARY,EXCEPT FOR THEIR

0378@ COMPARATIVE SIZES, NOTE THAT THt PRECEDENCE FOR

03800 UNARY OPERATORS SUCH AS NOT AND NEGATION ARE

asbeo SETUP SPECIALLY WITHOUT USING A TABLE,

03860 THE RESERVED WORD OK CRUNCH LIST

03880 WHEN A COMMAND OR PROGRAM LINE IS TYPED IN
03900 IT 18 STOREO IN BUF, AS SOON AS THE WHOLE LINE
93920 WAS BEEN TYPED IN CINLIN RETURNS) CRUNCH IS
93940 CALLED TO CONVERT ALL RESERVED KORDS TO THEIR

BASIC MCS Ba8e GATES/ALLEN/DAV100FF MACRO 4/(113) O3312 10rSEP=75 PAGE ane
FS Mac brSEPeed OS311 SOME EXPLANATION

76 03960 CRUNCH VALUES, IMIS REOUCES THE SIZE OF THE
279 as98e PROGRAM AND SPEEDS UP EXECUTION BY ALLOWING
280 e4aue TABLE DISPATCHES TO PERFOKM FUNCTIONS, STATEMENTS,
281 aaneo AND OPERATIONS, THIS IS BECAUSE ALL THE STATEMENT
ebe e4040 NAMES ARE STORED CONSECUTIVELY IN THE CRUNCH LIST,
263 o4gee WHEN A HATCH IS FOUND BETWEEN A STRING
284 a4980 OF CHARACTERS AND A WORD IN THE CRUNCH LIST
e285 e4iee THE ENTIRE TEXT OF THE MATCHED WORD IS TAKEN QUT OF
266 a4ieo ThE INPUT LINE AND A RESERVED WORD TOKEN IS PUT
287 a4149 IN ITS PLACE, A RESERVED WORD TOKEN IS ALWAYS EQUAL
268 a4ioo TU OCTAL 20@ PLUS THE PUSITION OF ThE MATCHED WORD
269 94180 IN THE CRUNCH LIST,
290
em a4eee STATEMENT DISPATCH ADDRESSES
eve a4ada WHEN A STATEMENT IS TO BE EXECUTED, THE FIRST
293 o42ea CHARACTER OF THE STATEMENT IS EXAMINED
294 e4260 TO SEE iF IT IS LESS THAN ThE RESERVED
295 e4a3eo WORD TOKEN FOR THE LOWEST NUMBERED STATEMENT NAME,
296 aasee If SQ, THE "LET" CODE Is CALLED TO
297 a4sae TREAT THE STATEMENT AS AN ASSIGNMENT STATEMENT,
298 #4360 OTHERWISE A CHECK IS MADE TO MAKE SURE THE
a43ee RESERVED WORD NUMBER IS NOT TOO LARGE TU BE A
o4aee STATEMENT TYPE NUMBER, IF NOT THE ADDRESS
3e1 aqaeo TO DISPATCH TO 18 FETCHED FROM STMOSP (THE STATEMENT
eaaae DISPATCH TABLE) USING THE RESERVED WORD
04460 NUMBER FOR THE STATENENT TO CALCULATE AN INDEX INTO
304 a44eo THE TABLE,

306 o4seo ERROR MESSAGES
307 oasae WHEN AN ERROR CONDITION IS DETECTED
3e8 04560 tE] MUST BE SET UP TO INDICATE WHICH ERROR
94580 MESSAGE IS APPROPRIATE ANU A BRANCH MUST BE MADE
a4eu0 TO ERROR, ThE STACK WILL BE RESET AND ALL
e462 PROGRAM CONTEXT WILL BE LOST, VARIABLES
a4eag VALUES AND THE ACTUAL PROGRAM REMAIN INTACT,
24660 ONLY THE VALUE OF [E] IS IMPORTANT WHEN.
o468u ThE BRANCH IS NADE TO ERROR, (€) 13 USED AS AN
04700 INDEX INTO ERRTAB WHICH GIVES ThE THO
eure CHARACTER ERROR MESSAGE THAT WILL BE PRINTED ON THE
a474e USER*S TERMINAL,

aa7eo IMPURE STORAGE
ousee ALL TEMPORARIES, FLAGS, POINTERS, THE BUFFER AREA,
04820 THE FLOATING ACCUMULATOR, AND ANYTHING ELSE THAT

a4e4e IS USED TO STORE A CHANGING VALLE SHOULD BE LOCATED
a4860 IN THIS AREA, CARE MUST BE MADE IN MOVING LOCATIONS
a4aeo IN THIS AREA SINCE THE JUXTAPOSITION OF THO LOCATIONS
a49ve IS OFTEN DEPENOED UPON,

a4949 TEXTUAL MESSAGES
24960 CONSTANT MESSAGES ARE STORED HERE, UNLESS
04980 THE CODE TO CHECK IF A STRING MUST BE COPIED
95000 IS CHANGED THESE STRINGS MUST BE STORED ABOVE

BASIC MCS 6260 GATES/ALLEN/DAVIOUFF MACRO 47(113) B5312 10-SEPRTS PAGE 293
Fs Mac beStPeed OSt11 SOME EXPLANATION.

331 os020 DOCTMP, OR ELSE THEY WILL BE COPIED BEFORE
332 5040 THEY ARE PRINTED,
333
334 o5080 FINDFOR
335 95100 MOST SMALL ROUTINES ARE FAIRLY SIMPLE
336 asiee AND ARE DOCUMENTED IN PLACE, FNOFUR IS
337 a5140 USED FOX FINDING "FOR" ENTRIES ON
338 a5160 ThE STACK, WHENEVER A "FOR" IS EXECUTED AN
339 5162 16 BYTE ENTRY IS PUSHED ONTO THE STACK,
Sag es2e0 BEFORE THIS IS DONE, HOWEVER, & CHECK
341 aseeo MUST BE MADE TO SEE IF THERE
Sue ese4o ARE ANY "FOR" ENTRIES ALREADY ON THE STACK
$43 25200 FOR THE SAME LOUP VARIABLE, IF SO, THAT "FOR" ENTRY
erry oseee AND ALL OTHER "FOR" ENTRIES THAT hERE MADE AFTER 1T
345 95300 ARE ELIMINATED FROM ThE STACK, THIS IS SO &
36 95320 PROGRAM THAT JUMPS OUT OF THE MIDULE
347 5340 OF A "FOR" LOOP AND THEN RESTARTS THE LOOP AGAIN
348 05360 AND AGAIN WON'T USE UP 18 BYTES OF STACK
5300 SPACE EVERY TIME, THE "NEXT" CODE ALSO
05400 CALLS FNOFOR TO SEARCH FOR A "FOR" ENTRY WITH
351 as4eo THE LOOF VARIABLE IN
352 asaag ThE "NEXT, AT WHATEVER POINT A MATCH IS FOUND
353 5400 THE STACK IS RESET, IF NO MATCH IS FOUND A
354 5460 "NEXT MITHOUT FOR" ERROR OCCURS, GOSUB EXECUTION
o5sue ALSO PUTS A 6 BYTE ENTRY ON STACK,
05520 WHEN A RETURN IS EXECUTED FNOFOK IS
357 05540 CALLED WITH A VARIABLE POINTER THAT CAN?T
a5560 BE NATCHED, WHEN "FNOFOR" HAS RUN
05580 THROUGH ALL THE "FOR" ENTRIES ON THE STACK
95600 IT RETURNS AND THE RETURN CODE WAKES
05620 SURE THE ENTRY THAT WAS STOPPED
95640 ON I8 A GOSUB ENTRY, THIS ASSURES THAT
25660 IF YOU GOSUB TO A SECTION OF COLE
95680 IN WHICH A FOR LOOP IS ENTERED BUT NEVER
o5700 EXITEO THE RETURN WILL STILL bE
a57e0 ABLE TO FIND THE MOST RECENT
5740 GOSUB ENTRY, THE "RETURN" CODE ELIMINATES THE
95760 "GOSUB" ENTRY AND ALL "FOR" ENTRIES MADE AFTER
25780 ThE GOSUB ENTRY,

os8ee NONSRUNTINE STUFF
a5e4e THE CODE TO INPUT A LINE,CRUNCH IT,GIVE ERRORS,
aseee FINO A SPECIFIC LINE IN THE PROGRAM,

95880 PERFORM A "NEW", "CLEAR, AND "LIST" ARE

25900 ALL IN THIS AREA, GIVEN ThE EXPLANATION OF
a5920 PROGRAM STORAGE GIVEN BELOW THESE ARE

05940 ALL STRAIGHTFORWARD,

25980 NEWSTT
26200 WHENEVER A STATEMENT FINISHES EXECUTION IT
aeneo DOES A "RET" WHICH TAKES

aease EXECUTION BACK TO NEWSTT, STATEMENTS THAT
aoaee CREATE UR LOOK AT SEMI@PERMANENT STACK ENTRIES

BASIC MCS 580 GATES/ALLEN/DAVIDOFF MACRO 47(113) 1O2SEP=75 PAGE 204
F3 hac brskPeod OSt11 SOME EXPLANATION

384 00080 MUST GET RID GF THE RETURN ADDRESS OF NEWSTT AND
385 96100 JNP TO WEWSTT WHEN DONE, NEWSTT ALWAYS
56 aoree CHRGETS THE FIRST CHARACTER AFTER ThE STATEMENT
$87 Mo14e NAME BEFORE DISPATCHING, WHEN RETURNING
588 @e160 BACK TO NEWSTT THE ONLY THING ThAT
389 26180 MUST BE SET UP 1S ThE TEXT POINTER IN
390 86200 (yl), NEWSTT WILL CHECK TO MAKE SURE
aezeo [pL] IS POINTING TO A STATEMENT TERMINATOR,
eae IF A STATEMENT SHOULON‘T BE PERFORMED UNLESS
393 ae260 IT IS PROPERLY FORMATTED (I,E, "NEW") IT CAN
394 eo2e0 SIMPLY LO A "RNZ" AFTER READING ALL OF
395 be3see ITS ARGUMENTS, SINCE THE ZERO FLAG
@6520 BEING OFF INDICATES THERE IS NOT
ao3aa & STATEMENT TERMINATOR NEWSTT WILL
06560 00 THE JMP_TO ThE "SYNTAX ERROR"
06580 ROUTINE, IF A STATEMENT SHGULO BE STARTED
boave OVER IT CAN DO LHLO TEMP,RET SINCE THE (H,LI
aoueo AT NEWSTT IS ALWAYS STORED IN TEMP, OF COURSE
eeaae CARE MUST BE TAKEN THAT NO ROUTINE
Qo4on THAT SMASHES TEMP HAS BEEN CALLED,
aoaee THE "C CODE STORES TEMP IN OLOTXT AND CURLIN (THE
eosv0 CURRENT LINE NUMBER) IN OLOLIN SINCE THE “C CHECK
ae5e0 IS NADE BEFORE THE STATEMENT POINTED TO IS
90540 EXECUTED, "STOP" ANO "END" STORE THE TEXT POINTER
a6560 IW (HyL) WHICH POINTS AT THEIR TERMINATING
26560 CHARACTER IN OLOTXT,

weoee STATEMENT CODE
eeo4e THE INDIVIDUAL STATEMENT CODE COMES

@ooeo NEXT, THE APPROACH USEO IN EXECUTING EACH
6680 STATEMENT I$ DOCUMENTED IN THE STATEMENT CODE
2700 ITSELF,

ae74a FRMEVL, THE FORMULA EVALUATOR
woe GIVEN AN (H,L} POINTING TO THE STARTING

26780 CHARACTER OF A FORMULA FRMEVL

oesee EVALUATES ThE FORMULA AND LEAVES

aesee THE VALUE IN THE FLOATING ACCUMULATOR (FAC),
o684e (hyd IS RETURNED PUINTING TO THE FIRST CHARACTER
26860 THAT COULD NOT BE INTERPRETED AS PART OF THE
06880 FORMULA, THE ALGORITHM USES THE STACK

a690e TO STORE TEMPORARY RESULTS?

a694e @, PUT A DUMMY PRECEDENCE OF ZEKO ON
06960 THE STACK,

26980 + READ LEXEME (CONSTANT, FUNCTION,

e7900 VARTABLE, FORMULA IN PARENS)

a7ee8 AND TAKE THE LAST PRECEDENCE VALUE
o7o4e QFF THE STACK,

e7060 + SEE IF TRE NEXT CHARACTER IS AN OPERATOR
27080 IF NOT)RETURKN, THIS MAY CAUSE
erie] OPERATOR APPLICATION GR AN ACTUAL
anieo RETURN FROM FRMEVL,

BASIC

FS

437
438
439
440

4a)

ane
443
ag
44s
446
4a7
44s
44g
45¢

451
452
453
494
455
456
457
456
459
4ee

4e1
42
aes
46a
4e5,
4e6
4e7
468
4e9
478
474
ate
473
474
475
476
477
478
479
460
481
age
463
aba
aes

hes 6280
mac

NCS 6980
Mac

GATES/ALLEN/DAVIDUFF
6eSEP}64 03811

GATES/ALLEN/DAV1DUFF
69SEPR64 03511

MACRO 47(113) @
SOME EXPLANATION

oriae
27160
7180
arava
ereeo
a7eqe
a7260
o7 260
97308
e73e0
a7340
07360
07380

a742e
a74ao
07460

27500
7520
27540
27560
07580
27600
a7reee
a7e4e
a7e6e
27680
7709
arte
arrae
27708
o7768
273800
araee
27840
27860
97860
27900
a7920
97940
e7988

vane
esoe
a6o40
a8a00
aeoee
o8108
aeieo
eo14e
a6168
2a1ee

MACKO 47(113) 95
SOME EXPLANATION

aseve
aeeee
aseao
28260
a8e80
2b3ve
o63e0
cert)
06360
96360
osaue
ge4aeo
9844
28460
pe4aea
oesvo
wesee
gas4a
pase
aaseo
28600
deoeo
08640
986en
98680
ra)
ae7ee
ae74y
a876e
98780
aeava
oseee
esaae
28860
08880
assee
gave
pes4e
28960
aavee
29000
asaee
age4e
290600
09080
09100
osteo
e914e
o9160
09180
avene
ageed
ageao

2 10eSEPR7S PAGE 295

IF IT IS, SEE WHAT PRECEDENCE IT HAS
AND COMPARE IT 10 THE PRECEDENCE
OF THE LAST OPERATOR ON THE STACK

IF = OR LESS REMEMBER THE TEXT
POINTER AT THE START OF THIS OPERATOR
AND 00 A RETURN TO CAUSE
APPLICATION OF THE LAST OPERATOR,
EVENTUALLY RETURN TO STEP 2
BY RETURNING TO RETAOP,

IF GREATER PUT THE LAST PRECEDENCE
BACK ON, SAVE THE CURRENT
TEMPORARY RESULT, OPERATOR ADDRESS
AND PRECEDENCE AND RETURN TO STEP 1,

RELATIONAL OPERATORS ARE ALL HANDLED THROUGH
4’ COMMON ROUTINE, SPECIAL
CARE IS TAKEN TO DETECT TYPE MISMATCHES SUCH AS 34"F

THE ROUTINE TO READ A LEXEME

EVAL CHECKS FOR THE DIFFERENT TYPES 0

ENTITIES IT IS SUPPOSED TO DETECT,

LEADING PLUSES ARE IGNORED,

DIGITS AND "," CAUSE FIN (FLOATING INPUT)

TU BE CALLED, FUNCTION NAMES CAUSE THE

FORMULA INSIDE THE PARENTHESES TO BE EVALUATED
AND THE FUNCTION ROUTINE TO BE CALLED, VARIABLE
NAMES CAUSE PTKGET 10 BE CALLED TO GET A POINTER
TU THE VALUE, ANO THEN THE VALUE IS PUT INTO

THE FAC, AN OPEN PARENTHESIS CAUSES FRNEVL

TO BE CALLED (RECURSIVELY), ANO THE ")" TO

BE CHECKED FOR, UNAKY OPERATORS (NOT AND
NEGATION) PUT THEIR PRECEDENCE ON THE STACK

AND ENTER FORMULA EVALUATION AT STEP 1, SO

THAT EVERYTHING UP TO AN OPERATOR GREATER THAN
THEIR PRECEDENCE OR THE ENO OF THE FORMULA

WILL BE EVALUATED, KHEN FRMEVL DOES A RETURN
BECAUSE IT SEES AN OPERATOR OF HIGHER PRECEDENCE
IT DOES NOT PASS THE TEXT POINTER IN (HyL], SO
AFTER THE UNARY OPERATION HAS BEEN PERFORMED

ON THE FAC THE TEXT POINTER MUST BE FETCHED FROM
A TEMPORARY LOCATION THAT FRMEVL USES AND

A RETURN BACK TO FRMEVL UONE,

DIMENSION AND VARIABLE SEARCHING

SPACE IS ALLOCATED FOR VARIABLES AS THEY ARE
ENCOUNTERED, THUS "DIM" STATEMENTS MUST BE

EXECUTED TO HAVE EFFECT, 6 BYTES ARE ALLOCATED

FOR EACH SIMPLE VARIABLE, WHETHER IT IS A STRING,
NUMBER UR USER DEFINED FUNCTION, THE FIRST TnO

BYTES GIVE THE NAME OF THE VARIABLE AND THE LAST FOUR
G1Ve LTS VALUE, {VARTAB) GIVES THE FIRST LOCATION
WHERE A SIMPLE VARIABLE NAME IS FOUND AND [ARYTAB)
GIVES THE LOCATION TO STOP SEARCHING FOR SIMPLE

112 10*SEP*75 PAGE 2-6

STRINGS

VARIABLES, & "FOR" ENTRY HAS A TEXT POINTER
AND A POINTER TO A VARIABLE VALUE SO NEITHER
ThE PROGRAM OK THE SIMPLE VARIABLES CAN BE
MOVED WHILE THERE ARE ACTIVE "FOR" ENTRIES ON THE STACK,
USER OEFINEO FUNCTION VALUES ALSO CONTAIN
POINTERS INTO SIMPLE VARIABLE SPACE SO NO USER-DEFINED
FUNCTION VALUES CAN BE RETAINEO IF SIMPLE VARIABLES
ARE MOVED, ADOING A SIMPLE VARIABLE
ADDING SIX TO ARYTAB AND STRENO, BLOCK TRANSFERING
THE ARRAY VARIABLES UP BY SIX AND MAKING SURE THE
NEW [STREND) IS NOT TO CLOSE TO THE STACK
THIS MOVEMENT OF ARRAY VARIABLES NEANS
THAT NO POINTER TO AN ARRAY WILL STAY VALIO WHEN.
NEW SIMPLE VARIABLES CAN BE ENCOUNTERED, THIS IS
WHY ARRAY VARIABLES ARE NOT ALLOWED "FOR"
LUGP VARIABLES, SETING UP ANEW ARRAY VARIABLE
MERELY INVOLVES BUILDING THE DESCRIPTOR
UPDATING STREND, AND NAKING SURE THERE IS
STILL ENOUGH ROOM BETWEEN STREND AND THE
STACK, MITHOUT MULTIPLE DIMENSIONS THE FORMAT
OF AN ARRAY VARIABLE IS SIMPLY$

SECOND CHARACTER

FIRST CHARACTER

NUMBER OF BYTES USED BY VALUES

VALUES
THE FORMAT WHEN MULTIPLY DIMENSIONED VARIABLES
ARE ALLOWED IS DESCRIBEO IN THE "MULOIM" CODE,
PTRGET, THE ROUTINE WHICH RETURNS A POINTER
TO A VARTABLE VALUE, HAS TWO IMPORTANT FLAGS, ONE IS
"OIMFLG" WHICH INDICATED WHETHER "DIM" CALLED PTRGET
OR NOT. IF SO, NO PRIGR ENTRY FOR THE VARIABLE IN
GUESTION SHOULD BE FOUND, AND THE INDEX INDICATES
HOW MUCH SPACE TO SET ASIDE, SIMPLE VARIABLES CAN
BE "DIMENSIONED", BUT THE ONLY EFFECT WILL BE TO
SET ASILE SPACE FOR THE VARIABLE IF IT HASN*T BEEN
ENCOUNTERED YET, THE OTHER IMPORTANT FLAG IS SUBFLG
WHICH INDICATES WHETHER A SUBSCRIPTED VARIABLE SHOULD BE
ALLOWED IN THE CURRENT CONTEXT, IF SUBFLG IS NON@ZERO
THE OPEN PARENTHESIS FOR A SUBSCRIPTED VARIABLE
WILL NOT BE SCANNEO BY PTRGET, AND PTRGET WILL RETURN
WITH A TEXT POINTER POINTING TO THE "(", IF
THERE WAS ONE,

IN THE VARIABLE TABLE STRINGS ARE STORED JUST LIKE
NUMERIC VARIABLES, SIMPLE STRINGS HAVE FOUR VALUE

BYTES WHICH ARE INITIALIZED TO ALL ZEROS (WHICH
REPRESENTS THE NULL STRING), THE ONLY DIFFERENCE

IN HANDLING IS THAT WHEN PTRGET SEES A "S" AFTER THE
NAME OF A VARIABLE, PTRGET SETS VALTYP TO ONE AND TURNS
ON THE NSB (MOST#SIGNIFIGANT@BIT) OF THE VALUE OF

THE FIRST CHARACTER OF THE VARIABLE NAME,

HAVING THIS BIT ON IN THE NAME OF THE VARIABLE ENSURES
THAT THE SEARCH ROUTINE WILL NOT NATCH

BASIC MCS 8086 GATES/ALLEN/DAVIDOFF MACRO 47 (113) @5212 10-SEP=75 PAGE 297
FS NaC SEP RO4 OS311 SUME EXPLANATION

29260 TAS WITH FAST OR ASF WITH PAP, THE MEANING OF
a9abe THE FOUK VALUE BYTES ARES

29300 Low

a9se0 LENGTH OF THE STRING

0934e UNUSED

29360 Low @ BITS

99380 HIGH 6 BITS OF THE ADDRESS

e940 OF THE CHARACTERS IN THE
avaeo STRING IF LENGTH,NE.Q,
a9aue MEANINGLESS OTHERWISE,
v9400 HIGH

a94ee THE VALUE OF A STRING VARIABLE (THESE 4 BYTES)
29500 IS CALLED THE STRING DESCRIPTOR TO DISTINGUISH
o9seo IT FROM THE ACTUAL STRING DATA, WHENEVER A

o954e STRING CONSTANT IS ENCOUNTERED IN A FORMULA OR aS
69500, PART OF AN INPUT STRING, OR AS PART OF DATA, STRLIT
a9seo IS CALLED, CAUSING A DESCRIPTOR TO BE BUILT FOR
ogee THE STRING, IF THE STRING CONSTANT IS IN BUF (WHICH
o9620 I] WILL BE IF THE STRING IS BEING "INPUT", OR THE
ave4a STRING 18 PART OF SOME FORMULA IN A OIRECT STATEMENT)
29660 THE VALUE IS COPIED INTO STRING SPACE SINCE BUF
29680 IS ALWAYS CHANGING, "STKCPY" IS USED TO COPY

a9700 STRINGS,

as74o STRING FUNCTIONS AND THE ONE STRING OPERATOR "+"
99768 ALWAYS RETURN THEIR VALUES IN STRING SPACE,

29780 ASSIGNING A STRING A CONSTANT VALUE IN A PROGRAM

9980 THROUGH A "READ" OR ASSIGNMENT STATEMENT

e9eee WILL NOT USE ANY STRING SPACE SINCE

aveue THE STRING DESCRIPTOR WILL POINT INTO THE

29660 PROGRAM ITSELF, IN GENERAL, COPYING IS DONE

a988e WHEN A STRING VALUE IS IN BUF, OR IT IS IN STRING
09900 SPACE ANO THERE IS AN ACTIVE POINTER TO IT,

as9eo THUS FS2GS WILL CAUSE COPYING IF GS HAS ITS

29949 STRING DATA IN STRING SPACE, FS=CHRS(7)

29960 WILL USE ONE BYTE OF STRING SPACE TO STORE THE

29980 NEW ONE CHARACTER STRING CREATED BY "CHRS", BUT

10908 THE ASSIGNMENT ITSELF WILL CAUSE NO COPYING SINCE
1voee THE ONLY POINTER AT THE NEW STRING IS A

1ooae TEMPORARY DESCRIPTOR CREATED BY FRMEVL WHICH WILL

19060 GO AWAY AS SOON AS THE ASSIGNNENT IS DONE,

10080 IT_IS THE NATURE OF GARBAGE COLLECTION THAT

10100 DISALLOWS HAVING TWO STRING DESCRIPTORS POINT TO THE SAME
1otee AREA IN STRING SPACE, STRING FUNCTIONS AND OPERATORS
1o1ae MUST PROCEED AS FOLLOWS:

10160 1) FIGURE OUT THE LENGTH OF THEIR RESULT

10160 2) CALL GETSPA 10 FIND SPACE FOR THEIR

19200 RESULT, THE ARGUMENTS TO THE FUNCTION

10220 OR OPERATOR MAY CHANGE SINCE GARBAGE COLLECTION
1w24a MAY BE INVOKED, THE ONLY THING THAT CAN

1u26a BE SAVED DURING THE CALL TO GETSPA IS A POINTER
10260 TO THE DESCRIPTORS OF THE ARGUMENTS,

1e30e 3) CONSTRUCT THE RESULT DESCRIPTOR IN DSCTMP,

BASIC MCS 6980 GATES/ALLEN/DAVIDUFF MACRO 47 (113) O5212 10SEP=75 PAGE 2n6
Fs mac beSePeod OSt11 SOME EXPLANATION

596 1vseo GETSPA RETURNS THE LOCATION OF THE AVAILABLE
997 10340 SPACE,
596 10360 4) CREATE THE NEW VALUE BY COPYING PARTS
599 1038 OF THE ARGUMENTS OR WHATEVER,
eee 1o4ave 5) FREE UP THE ARGUMENTS BY CALLING FRETHP,
6e1 10420 6) JUMP TO PUTNEW TO GET THE DESCRIPTOR IN
ee toaae OSCTMP TRANSFERRED INTO A NEW STRING TEMPORARY,
oes
604 10480 THE REASON FOR STRING TEMPORARIES IS THAT GARBAGE
eos 10500 COLLECTION HAS TO KNOW ABOUT ALL ACTIVE STRING DESCRIPTORS
eve 10520 SO IT KNOWS WHAT IS AND ISN*T IN USE, STRING TEMPORARIES ARE
a7 10549 USED TO STORE THE DESCRIPTORS OF STRING EXPRESSIONS,
608
us 10560 INSTEAD OF MAVING AN ACTUAL VALUE STORED IN THE
e1¢ 10608 FAC, AND HAVING THE VALUE OF A TEMPORARY RESULT
611 16620 BEING SAVED ON THE STACK, AS HAPPENS WITH NUMERIC
ele 19640 VARIABLES, STRINGS HAVE THE POINTER TO A STRING DESCRIPTOR
613 10660 STOKED IN THE FAC, ANO IT IS THIS POINTER
10660 THAT GETS SAVEO ON THE STACK BY FORMULA EVALUATION,
10700 STRING FUNCTIONS CANNOT FREE THEIR ARGUMENTS UP RIGHT
616 1o7ee AWAY SINCE GETSPA MAY FORCE
617 10748 GARBAGE COLLECTION AND THE ARGUMENT STRINGS
618 10768 MAY BE OVERSWRITTEN SINCE GARBAGE COLLECTION
10780 WILL NOT BE ABLE TO FIND AN ACTIVE POINTER TO
10808 THEM, FUNCTION ANO OPERATOR RESULTS ARE BUILT IN
1aseo OSCTMP SINCE STRING TEMPORARIES ARE ALLOCATED
10840 (PUTNEW) AND DEALLOATED (FRETMP) IN A FIFO ORDERING
10860 (Lye, A STACK) SO THE NEW TEMPORARY CANNOT
10860 Be SET UP UNTIL THE OLD ONE(S) ARE FREED, TRYING
10900 TO BUILD A RESULT IN A TEMPORARY AFTER
10920 FREEING UP THE ARGUMENT TEMPORARIES COULD RESULT
10940 IN ONE OF THE ARGUMENT TEMPORARIES BEING OVERWRITTEN
10966 TOO SOUN BY THE NEW RESULT,

11000 STRING SPACE IS ALLOCATED AT THE VERY TOP
11920 OF MENOKY, MEMSIZ POINTS BEYOND THE LAST LOCATION OF
11040 STRING SPACE, STRING ARE STORED IN HIGH LOCATIONS
11960 FIRST, HHENEVER STRING SPACE IS ALLOCATED (GETSPA)
11080 FRETOP, WHICH IS INITIALIZED TO (NEMSIZ), IS UPDATED
11108 TO GIVE THE HIGHEST LOCATION IN STRING SPACE

11120 THAT IS NOT IN USE, THE RESULT 18 THAT

11142 FRETOP GETS SMALLER AND SMALLER, UNTIL SOME

11168 ALLOCATION WOULD MAKE (FRETOP) LESS THAN OR EGUAL TO
11160 {STKTOP), THIS MEANS STRING SPACE HAS RUN INTO THE
11e08 STACK AND THAT GARBAGE COLLECTION MUST BE CALLED,

11240 GARBAGE COLLECTIONS
11260 @, MINPTRe(STKTOP) (FRETOP) =(MEMSIZ)

11260 1, REMMINSD

11308 2, FOR EACH STRING DESCRIPTOR

11520 CTEMPORARIES, SIMPLE STRINGS, STRING ARRAYS)
11340 IF THE STRING IS NOT NULL AND ITS POINTER IS
11360 sGT,MINPTR AND ,LT.FRETOP,

BASIC NCS B98G GATES/ALLEN/DAVIDOFF MACKO 47 (413) 1G2SEP=75 PAGE 299
Fs mac orSePeod S311 SOME EXPLANATION

11360 WINPTRSTHIS STRING DESCRIPTORS POINTER
11400 REMMINSPOINTER AT THIS STRING DESCRIPTOR

11420 ENO

11440 3, IF REMMIN,NE,@ (WE FOUND AN UNCOLLECTED STRING)
11400 BLOCK TRANSFER THE STRING DATA POINTED

11460 TO IN THE STRING DESCRIPTOR POINTED TO BY REMMIN
11500 $0 THAT THE LAST GYTE OF STRING DATA IS AT

11520 (FRETOP], UPOATE FRETOP $0 THAT IT

11540 POINTS TO THE LOCATION JUST BELOW THE ONE

11500 THE STRING DATA WAS MOVED INTO, UPDATE

11580 THE POINTER IN THE DESCRIPTOR SO IT POINTS.

11600 TO THE NEW LOCATION OF THE STRING DATA,

11620 GO TO STEP 1,

11660 AFTER CALLING GARBAGE COLLECTION GETSPA AGAIN CHECKS
11660 TO SEE IF (A) CHARACTERS ARE AVAILABLE BETWEEN
11700 (STRTOP] AND (FRETOP) » IF NOT AN "OUT OF STRING"
ii7ee ERROR IS INVOKED,

11768 MATH PACKAGE

11780 THE NATH PACKAGE CONTAINS FLOATING INPUT (FIN),
11800 FLOATING QUTPUT (FOUT) FLOATING COMPARE (FCOMP)
11820 AND ALL THE NUMERIC OPERATORS AND FUNCTIONS,
11840 THE FORMATS, CONVENTIONS AND ENTRY POINTS ARE ALL
11860 DESCRIBED IN THE NATH PACKAGE ITSELF,

11900 INIT w+ THE INITIALIZATION ROUTINE
11920 INITIALIZATION FIRST LOOKS AT THE SWITCH REGISTER
11940 TO SEE wHAT TYPE OF I/0 SHOULO BE DONE,

11960 ANY NON*STANDARD I/O CAUSES LOCATIONS IN BASIC

11980 TU BE CHANGED, THEN THE AMOUNT OF MEMORY,

120¢0 TERMINAL WIDTH, AND WHICH FUNCTIONS TO BE RETAINED
ieeee ARE ASCERTAINED FROM THE USER, A ZERO IS PUT DOWN
12040 AT THE FIRST LOCATION NOT USED BY THE MATH=PACKAGE
12060 ANO TXTIAB IS SET UP TO POINT AT THE NEXT LOCATION,
renee THIS DETERMINES WHERE PROGRAM STORAGE WILL START, THE
tered HIGHEST MEMORY LOCATION MINUS THE AMOUNT OF DEFAULTED
tei1ee STRING SPACE (SG) GIVES THE FIRST LOCATION USED BY THE
te14a STACK, SPECIAL CHECKS ARE MAQE TO MAKE SURE

telee ALL QUESTIONS IN INIT ARE ANSWERED REASONABLY, SINCE
1e160 ONCE INIT FINISHES THE LOCATIONS IT USES ARE

1e200 USED FOK PROGRAM STORAGE, THE LAST THING INIT DOES IS
1e2ed CHANGE LOCATION ZERO TO BE A JUMP TO READY INSTEAD
1eeaa OF INIT, ONCE THIS 18 DONE THERE IS NO WAY TO RESTART
12200 INIT,

12300 STORAGE
12320 A ZERO,

tesue (TxTT AB) POINTER TO NEXT LINE*S POINTER
12360 LINE # OF THIS LINE (2 BYTES)
12360 CHARACTERS ON THIS LINE

12400 ZERO

eae POINTER AT NEXT LINE*S POINTER

BASIC MCS U8 GATES/ALLEN/OAVIDOFF 4ACKO 47(115) O5312 1UeSEP@75 PAGE 2n10
Fs mac brSEPred USt11 SOME EXPLANATION

1ed4o (POINTED TO BY THE ABOVE POINTER)
tedoo pes UREREATS Vs 5

12469 LAST LINes POINTER AT ZERO POINTER

1e50e LINE # OF THIS LINE

12520 CHARACTERS ON THIS LINE

12540 ZERO

12560 DOUBLE ZERO (POINTED TO BY THE ABOVE POINTER)
12580 (VARTAB) SIMPLE VARIABLES, 6 BYTES PER VALUE,
12608 2 BYTES GIVE THE NAME, 4 BYTES THE VALUE
12620 vee REPEATS oy,

12640 CARYTABD ARRAY VARIABLES, 2 BYTES NAME, 2 BYTE
12660 LENGTH, VALUE (EXTRA IF MULOIM ON)

12680 gee REPEATS .

12706 USTREND) FREE SPACE

12720 REPEATS ,

12740 MOST RECENT STACK ENTRY

te7ea see REPEATS yyy

12780 {9TKTOP) FIRST STACK ENTRY

128600 FREE STRING SPACE

12820 ger REPEATS oa

12840 (FRETOP) STRING SPACE IN USE

1eaea

12680 (HEMS1Z) LOCATION

12900 UNUSED EXCEPT BY THE VAL FUNCTION,

12920 HIGH LOCATIONS

jegee
12980 PAGE

BASIC MCS OyAU GATES/ALLEN/DAV1OUFF MACKU 47 (115) 45312 10-SERA7S Pace 3
FS WAC beSEPeod OSt1t RST ROUTINES

150 15900 SUBTTL RST ROUTINES
731 aogoo? 13920 ~~ RELOC 9
732 ven" eRiEeLeG BvO3e5 1304@ STAR FOISENABLE INTERRUPTS
733 o99va1" Ouloge gLeesos 15060 INIT FINIT 18 THE INTIALIZE ROUTINE
734 eave? aoQvee g0e0G0%
135 ovens? oovuaa ovovar
136 15080 FIT SETS UP CERTAIN
137 15100 HLOCATIONS DELETES FUNCTIONS IF
136 is120 HDESIRED AND
739 15140 FCHANGES THIS TO JMP READY
74¢ 15100 LENGTH=e,<
Tat 15180 ADR (DEINT) STORE HERE THE ROUTINE
142 13200 FTO TURN THE FAC INTO
143 iseeo A TWO-BYTE SIGNED INTEGER
744 13240 ADR (G1VABF)> STORE HERE THE ADDRESS
745 13260 VOF THE ROUTINE TO CONVERT [A,8)
746 15280 110 A FLOATING POINT NUMBER IN THE FAC
a7 15300 LENGTH=2,<
748 beeee4? BoHEa® YonvOD® 15320 AOR (FRCINT) TURN FAC INTO AN INTEGER IN (H,L]
749 080005* Devoe ovavee?
156 eovgae’ vowMee BEEEoL* 15340 ADR (MAKINT) > FTURN (HyL} INTO & VALUE IN THE FAC
751 aev997" daeove owoLca?
152 13300 FSET VALTYP FOR INTEGER
753 avoive 15360 RELOC 8
754 13400
755 1s420 SYNCHR LOUKS AT THE CURRENT CHARACTER TO MAKE SURE IT
756 15440 IS A SPECIFIC THING (CONTAINED IN THE LOCATION AFTER THE CALL)
157 15460 IF NOT IT CALLS THE ‘SYNTAX ERROR? ROUTINE, OTHERWISE IT GOBBLES
758 13480 THE NEXT CHARACTER AND RETURNS, (BY FALLING INTO CHRGET)
159 13500
13520 ALL REGISTERS ARE PRESERVED EXCEPT [A] =NEW CHAR
13540 AND (HyL) ENOS UP POINTING AT THE CHARACTER AFTER THE ONE
13560 WHICH WAS CHECKED,
13560
Mea910" Barove veo1Te 15600 Mov AyM GET THE CURRENT CHARACTER
aavgii? eeiove evasas 15620 XTHL GET CALL ADORESS INTO thyL)
15640 HPUT TEXT POINTER ON STACK
aonv12? weione auoeTe 15660 chp SEE IF (A} CURRENT CHARACTER
15680 VIS THE RIGHT THING,
@2v015* Boer evouas 15700 FIX RETURN ADDRESS,
Onen14? woleve BuoSas 13720 PUT RETURN ADDRESS BACK AND RESTORE
15740 THE TEXT POINTER,
Oaov15* vaines weOsve 13760 si VIF THE CHARACTER WASN*T RIGHT CALL
@e0p16" apovee auavTe?
davo17? Beveve avauae?
15780 FTHE "SYNTAX ERROR? ROUTINE,
13800 JOTHERWISE FALL THROUGH
15820 FAND GET ANOTHER CHARACTER,
13800 ¢
15860 CHRGET, USING (H,L] AS THE CURRENT TEXT POINTER FETCHES
13860 ANEW CHARACTER INTO (A) AFTER INCREMENTING (H)L)
15900 AND SETS CONDITION CODES ACCORDING TO WHATS IN [A]
13920 NUMERIC Ca" THROUGH MON)

BASIC MCS 6986 GATES/ALLEN/DAVIOUFF MACKO 47(115) 45312 10*SEP*75 PAGE Sad
Fs mac brSEPe6d 5911 RST ROUTINES

763 13940 #" OR END*OF*LINE (A @)
784 15960
785 13980 ALL REGISTERS SAVED EXCEPT [A] =NEW CHAR
786 14000 CHL) CHL a
787 14020
788 oavaant 14040
769 14068 LENGTH, <CHRGTRE>
79@ 990920" Boio~e aeovas 14060 INx 4 FUPDATE THE TEXT POINTER
791 eBvael? veins vevi1Te 14108 MoV AyM GET NEW CHARACTER
792 gbupee’ waivoe 200576 14tee cPr LiL TMAKE "3" HAVE ZERO ON AND
793 vovees? vyovae aeovTe
194 ia14e FCARRY OFF
795 14160 FALL ALPHABETICS & RESERVED
796 14180 THOKDS GET ZERO & CARRY OFF
797 waned? oyinue aoosee 14200 1,GT, "3" GO BACK
798 govves? vais ovnsas 14220 CHRCON FNO ROOM FOR WHOLE ROUTINE
799 veaae’ aovaue 943435"
8¢o gvageT? Baeeve aoovIE®
Cray 14eao ot
Bee 14260 } THIS RST ROUTINE OUTPUTS THE CHARACTER IN (A) USING PRTFLG (LPT OR TTY)
8e3 14260} CNTWFL (SUPRESS OUTPUT OR NOT), TTYPOS (PRINT HEAD POSITION),
ana 14300 } TIMING ETC,, NO REGISTERS OR CONDITION CODES ARE CHANGED,
8e5 14320;
806 ouvesu 14349 RELOC a4
807 audasu? @vicod BvOs6S 14360 OUTOO: PUSH  PSW
808 14380 IFN CONTR, <
900031" duiueo gvoevre 14400 Loa CHTWFL GET SUPPRESS FLAG
816 @ve3e Vous v1541°
aov9ss* aces evovert
900034" goin weoee! age OA A> #SEE IF IT 18 SET
813 14449 LENGTHICONTRWILPTSW,<
814 14460 Loa TTYPOS> }USE RST BYTES, (A) =TTYPOS
aeve35* boieen @00s05 14480 IMP QUTCON
800030" woneee eu3sves?
eeee37* woveas avavse?
14500
14520 j COMPAR COMPARES {H,L} WITH (D,E) UNSIGNED
14549
14560 (hyLJ LESS THAN [0,E) SET CARRY
14560 (HL) = (D,E) SET ZERO
14600
14620 THE ONLY REGISTER USED
14648
aveoaut 14660
e90040" Boioue ovo1T4 14680 Mov AyH
@o041" Baiove avoeee 14700 sub Cy
Boan4e? volove - evO3a0 14720 RNZ
890045" Baivve 960175 14740 mov Ayk
@oan4at ooiene evBees 14760 suB E
@onn45s? Belong evasii 14768 RET

wean4e’ bovov9 Board 14820 1 FSTORE HERE THE NUMBER OF NULLS.
14840 10 PRINT AFTER CRLF

BASIC

FS

636
837
836
639
e4e
eat
eae
643,
e4a
B45,
846
847
848
849
650
51
852
853
85a
655
856
857
858
859
860
861
62
bes
864
65
66
ber
868
869
870
e741
b7e
873
874
675
876
877
878
679
ee
661
abe
erry
884
685
886
887
688

BASIC

F3

Mes ao8u
MAC

ooouar?

eeeose?
eoonse?
ponosi?
govose?
gonass?
aoagsa?
000059"
wooase?
oonosit

eovoeer
avoueot
eovger?
eoegee?
wangest
@ovoea?

vonges?
eonese’
aeaoer?

evon7e*
eeen70"

oovorit
oeante?
eeaoTs?
aono74?
weavers?
avav7e*
aeaerr?

mcs 6980
Mac

oeoi90*
eeoier?
oooroe?

GATES/ALLEN/DAV 1DOF F

beSEProd StL

eo1vee
eovone
eaoeae
oe iew!
eeiveo
oaeeee
eeaoea
eeievo

boi1vve
@e1900
aeovoe
@eovn0
oa1eeo

eeioe0
eovene
oeno0e

201000

91000
001000
wolene

201000
001000
ao1000
o1eea

GATES/ALLEN/DAVLOUFF

ovvere
aer1ede?
wonese?
weoee?s
aeosce
wvavaes
oooesi*
awasiy

euesas
avovae
geoior?
aenuss?
avosat

ouosas
evan7s?
evovee?

owesii

evovaw
eveveo
eeelte
avovas
eoo1ee
aeovas
auese5

brSEPe64 OS311

ee1900
oveeeo
aooved

aveses
ovniee?
avovee’

MACRO 47(113)

O5312 10-SEPR75 PAGE 3n2

RST ROUTINES

14860
14880
14900
14920
14940
14968
14986
15000
15028
15040
15050
15060
15080
15100

15128
15140

15160
1516¢
1s200
15220
15240
15260
15260
15300
15320
15540
15360
15380
15400
isaeo
15440

15460
15460
15500

15520
15540
15560
15580
15600
15620
15640
15660
15660
15700
15720

MACKO 47(115)

i

i
:
D

Ri
8

TYPOS: BLOCK 1 FSTORE TERMINAL POSITION HERE
THE FSIGN RST RETURNS Azel IF FAC IS LESS THAN o
Aza IF FACRG
Az IF FAC GREATER THAN ZER’
THE CONDITION CODES REFLECT THE VALUE OF {AJ
AND NO OTHER REGISTERS ARE MODIFIED,
THIS WORKS ONLY WHEN THE FAC IS A SINGLE OR DOUBLE PRECISION
THE *VSIGN® ROUTINE IS MORE GENERAL SINCE
IT WILL TAKE THE SIGN OF INTEGERS AS WELL
AND GIVES "TMERR" ON STRINGS,

LOC 40

IGN? LDA Fac

ry
SIGNC

RET

THIS IS THE PUSHM RST
EFFECT 18
Mov
INx

”

INK
Push

c
1

Mov 8,4
4

8

DIFFICULTY COMES IN BECAUSE OF THE
RETURN ADDRESS,

ELOC 48
XTHL
SHLD

HSWITCH CHL} AND RETURN ADDRESS

PUSHMASL }PIXUP JUMP TO PLACE TO GO

PoP ti)
LENGTH, <
IMP

PREGAIN CHyL)

SCODE+59 FIN BK ALLOW USER TO HAVE RST 7

FOR INTERRUPT TRAPPING
56
RET FINITIALLY NO INTERRUPT
PROUTINE
Nor
NoP>
mov cy
INx i
Mov bem
INK 4
PUSH 8B

FGRAB FROM NEMOKY

FPUSH [B,C] ONTO THE STACK

M3212 10-SEP-75 PAGE Se

RST ROUTINES

15740
15760

15808

Pi

P

SINCE
TRETURN

IT CONTAINS UM)

USHMAE JNP PUSHMA ADORESS STURED HERE

AGE

NUMBER

BASIC MCS 8780 GATES/ALLEN/DAVIDUFF MACKO 47 (115) O5412 10"SEPR75 PAGE 4
FS mac brSEPeo4 OSt11 DASPAICH TABLES, RESERVED WORDS, ERROR TEXTys, ALL CONSTANT

15620  SUBTTL DISPATCH TABLES, KESERVED WORDS, ERROR TEXT,., ALL CONSTANT

wer1es? aoweve vvovers 15860  FUNDSP: ADR (SGN)
00104" Boao evarer?

15880 IFN LENGTHe2,<

15980 ADR CINT) >

15920 IFE LENGTH=2,<
000195" eapone gveover 15940 ADR (VINT) >
@ev1e6" Beoeen ovO1D3*
een101? wetove avevvex 15960 ADR (ABS)
aav11e? eooee aeores?
ooaii1? wapeda o1a7r7e? 19980 USRLOC ADR (ILLFUN) FINITIALLY NO USER ROUTINE
wwo11e? Beveee aveia7?
one11s* denna av7537¢ 16200 IFN LENGTH, <ADR (FRED
ee114* epee Bvoiit?
ewo11>? wageen atarie? 16020 AR CFNINP)
@a0116" Beeove oee11S*

16040 IFN LPTSh, <AOK(LPOS) >
@ov117" BaveGe e7406° 16060 ADR (PUS)>
dooizet epeeer vuviis?
dearer? eoeeve dvevevs 16080  SURFIX: ADR(SQR)
eee1ee? aoveaa geori7?
vies? eneeen deoveus 1610@ — RNDFIX: ADR(RND)
wowia4*? eavee geerei?

1e120 IFN EXTFNC,<
a0125" weaene ovaveds 1e14a ADR (LOG)
evi26’ eoeend avoies?
eoele’? aooees seavees 1e160 ADR (EXP)
90130 Booeay Gueres?
ve131 eaoeee svevere 16180 COSFIx: ADR(COS)>
vv1se? eoeoea eeoieT?
eor135¢ eoge2e gvAvaLs 16200 SINFIXt ADR(SIN)
000134" Boveve aoo13i°

1ez20 IFN EXTFNC,<
00135" wovede ovaveus 16240 TANFIX: ADR(TAN)
000136" Aeeooe av01ss*
e137? wownee secvaus 16260 ATNFIXt ADR(ATN)>
goe1aet epeene Beu135°

16280 IFN LENGTH, <«
Bee14i? apanoe o11514¢ 16300 ADR (PEER) >
deoidet Basnve 300137"

16520 IFN DSKFUN, <ADR(DSK1S)>

16340 IFN STRING, <
000145" apvere e10sait 16360 ADR (LEN)
eviaa’ eawooo veaiait
aew1as? avaese eo7So4a¢ 16360 ADR (STRS)
Bo0140" wreeve Bvo14s"
e9e147t Bedvve o11¥4e* 16400 ADR (VAL)
@ou150" eeoaeo va145*
@a0151° Geode B10515° reaeo ADR (ASC)
@o15e? Bevede ovar47?
000153" Beane g1a>3e" 16440 ADR (CHRS)
@oe154* weevos gvo1Si°

BASIC MCS BYBU GATES/ALLEN/OAVIDUFF MACRO 47(115) 95212 10eSEP*75 PAGE det
FS mac brSEPe64 S311 DISPATCH TABLES, RESERVEU WORDS, ERROR TEXT,,, ALL CONSTANT

900155° Beovee a1055e° 164eo ADR (LEFTS)
920156" Bpevoa o00153°
#00157? weaeua 10631" 16460 ADR (RIGHTS)
Ovn160" BeeevE ove155°
eee1el? Baeean e@1e6e4st 16500 ADK (N1DS)>
eer16e? ood euo157*

16540 DEFINE ADKP(X),<ADR(X)>
16560 IFE LENGTH=2,<
16580 DEFINE AOKP (x), <>>
O60165" eoeeoe BvO1T71 16600 OPTABS 121 OPERATOR TABLE CONTAINS
16620 FPRECEDENCE FOLLOWED BY
16640 THE ROUTINE ADURESS
16660 ADRP(FADDT)
Be0164" SeoGee BbO171 16680 det
10706 ADRP (FSUBT)
BO0105*° wAveAe BbB17S 16720 les
16740 ADRP (FMULTT)
006166" eeevue BHLITS 16760 1e3
16780 ADRP (FOIVT)
BeO167" EEbEBH BHO1TT 16800 EXTFNC,<1e7
16820 ADRP(FPHRT) >
16340 LENGTH, <
900170" B0000e Beo1ew 16860 8o
16880 AURP CAND)
OOV1TIS BHOEBE BLA106 16900 10
16920 AORP(OR)>

16960;
16969 7 TOKENS FOR RESERVED WORDS ALWAYS HAVE ThE MOST
17000 7 SIGNIFIGANT BIT ON
17020} THE LIST OF RESERVED WORDS
17oqe ft
avoiy7 17068 = Gs 128e1
17068 DEFINE OCI(A),<Geaet
17090 XLIST
17100 OCA)
17110 LIsT>
ooveen 17140 ENDTK#=Q
oevees 17180 FORTK#3u
aupeos 17240 DATATKs5@
weeere 17560 GOTOTK=20
eeeele 17420 IFTK==0
oevei4 17480 GOSUTKsa
avaero 17540 REMTKaQ
17660 LENGTH#2,<
ovveeo 17700 ELSETKa=q
17760 OSKFUN, <OCI"OSKUSM>
17800 LPTSW, <DCILPRINTM>
17820 LENGTH, <
oeoesi 17880 PRINTK==0
17940 REALIU,<
17960 DeIMDDTN>

BASIC MCS Bo8H

FR

1001
1ov2
1003
1904
1005
1006
1007
1006
1009
1010
1014
ere
1013
eid
1015
1016
1017
1018
1019
eee
ve
eee
1923
toed
1025
1026
1027
1028
1629
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1044
1042
1043
1044
1045
1006
1047
1048
1849
1058
1051
1052
1053

MAC

oves7it
oeas7e?
oa037s?
eavs7ae

oo0377"
eooaoe?
eeo4ai?
aavgne?

oeo4sT?

eoeaaie

BASIC MCS By80

FS

1054
1055
1056
1057
1058
1059
1060
1064
1062
1063
1064
1065
1066
1067
1468
1069
1678
1071
1072
1073
1074
1075
1076
1077
1078
1079
1960
1061
1062
1063
1064
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1103
1102
1103
1104
1105
1106

mac

aoeses?

ooeseat
noses?
@ouseo*
@avsor?
eeos7o*
eeos7i?
egestet
2oos7s*
ooosTat
9o0575°
o00576*
eousrit
eoaeae’
eoo6a1"
ooveoet
wenees?
eoven4?
aa0605¢
ouneeet
oven?
oeveiur
eooe1it
voveret
ooe615¢
awoera?
evers?
@on616"
ooverl?
wedeeu’
eevee’?
a0062e"
vonees?

aooeaat
eeeees?
weveeet
eaveat?
00063!

@00631°
aeeese*
060035"
eunes4?
@00635¢
@evo3e"
COC
parent
eavedit
anode?
enneds?

GATES /ALLEN/DAV1LUUFF

OrSEPeO4 O511

anovee
aon0eo
eovero
200000

20000
ogeooe
ao0e00
eooese

aoaaoe

eovese

GATES/ALLEN/DAVIDOFF

ovees7

eoeied
eveio1
ooiee
aveese
eevede
avoede
oveeds

avoias
ovoiee
ovnies
eovese
aedede
aevede
aooeds
eevead
awoeds

eeoede
geeea?
eoeese
aeees1
avave?
eaoe76
oeoes?
aeoes?
avreoe
eeoer4
aveeot
geeeel

evnece

evvers

oensav

6rSEP=64 03311

oo0eve

anvove
eveeoe
eaeeso
Baaeae
egeeco
aaevao
eovree
egavne
evoeeo
eeeoee
eoovee
eoavee
eneeea
eeoen0
enveus
Cn
aeoeoe
aeavao
aeecou
aeovee
@oooee
eeooua
evoves
eevee
Bedeu0
eovnee
@evoea
eevonn
@eavee
oovove
aa0000
eoov00

2ov0v0
avoaa
onoove
eooeve
envoee
@ovove
eonove
onecee
vonage
eooove
oonove
eoaene
evocee
Boov20
eon0v0
2oo0ve

avasee
avoves

ousarar
poorer?
aesisa?
aeasea
auseast
Beoseo!
voauret
avos7er
aoariy?
evos7et
avoseo’
avas7ar
o4reot
eyas7e?
ov4isit
oeacuut
ovaviet
ovooee’
wos7sat
avoeoat
ouases?
aoaene’
oosuaet
aoveior
ous77e°
auoete’?
evao4ar
ouoo14?
oea7ar
aoge1e?
aesa7et
ouae2u"

evau7ae
eveeeet
aeseo4?
oeaeea?
eu3seus*
euaezer
geovees
@avesu?
o1eres?
eoeese?
ee4eri?
auoesar
eu sseo’
000656"
a107ss?
ovaeane

NACKO 47
DISPATCH

18000
18060
16080
18100
18140
16160
16160
18200
18220
16240
16260
18260
18320
16340
18560
16360
18400
16420
18440
18460
16500
18540
16560
16600
16640
16660
18720
16760
16862
16900
18920
16940
18980
19000
19020
19040
19060
19080
19100
19120
19148
19160
19180
19190
192008
19240
19360
19420
19460
19600
19620
19668
19660

MACRO 47
DISPATCH

19800
19820
19900
19940
19960
19960
20000
2va20
20040
20060
20080
20108
2e1ee
2e14e
av16o
20160
20200
2eeeo
ew24e

2u260
2e2eo

20300
20see
20340
20300
20360
2e4oe

avseo

(113) 95312 10eSEP%75 PAGE Gna
TABLES, RESERVED WORDS,

IFN LPTSW,<OCL"LLIST>

IFN CASSW, <UCICLOAD™
OCI*CSAVEN>

IFN CONSSh, <DCI"CONSOLE">
SCRATKEQ

+ END OF COMMAND LIST

+128
Graet
TABTK=Q
TOTKEag
LENGTH, «<
ng

pn

non

USINTK==Q>
THENTK2Q

IFN LENGTH, <
NOTTKa=u>
STEPTK3G
PLUSTK=0
MINUTKEQ
LSTOPK #2041 =PLUSTK

FMACRO DOESNT LIKE

ERROR TEXTs¢, ALL CONSTANT

(7S IN ARGUMENTS

FCRUNCH # OF HIGHEST OP+1=PLUSTK

190 TA GREATER THAN SIGN

Gaaet
GREATK#U
EQULTKEQ
168
QeGe1
LESSTKaa

TA LESS THAN SIGN

NOTE DANGER OF UNE RESERVED WORD BEING A PART

OF ANUTHER
Te , , IF 2 GREATER THAN F OR TaS
WILL NOT WORKI2] SINCE "FOR" WILL
IN ANY CASE MAKE SURE THE SMALLER
SECOND IN THE RESERVED WORD TABLE.
ANOTHER EXAPMLES IF T

ONEFUNSQ
IFN LPTSW, <DCIMLPOS">
SGRTK==0
IFN EXTFNC,<
ATNTK=EQ>
LENGTH, <
IFN OSKFUN, <OC1"DSKIS">
STRING, <

(113) 95212 102SEP 675 PAGE 405
TABLES, RESERVED WORDS,

LASNUMs5@

OR O THEN oe,

ERROR TEXT soy

THENe es

BE CRUNCHEDI}

WORD APPEARS

CHINP® AND MINPUT")
"TO" 18 CRUNCHED

ALL CONSTANT

TNUMBER OF LAST FUNCTION

TTHAT TAKES ONE ARG
@ FWARKS END OF RESERVED WORD LIST

STMOSP? ADR (END)
ADR (FOR)
ADR (NEXT)
ADR (DATA)
ADR (INPUT)
ADR (01M)
ADR (READ)
AOR (LET)
ADR (GOTO)
ADR (RUN)
AOR CIF)

ADR (RESTORE)
ADR (GOSUB)
ADR (RETURN)
ADR (REM)
ADR (STOP)

LENGTH=2,<
AOR (ELSE)

ADR (TON)
ADR (TOFF)

AOR (EDIT) >

LENGTH, <ADR(FNOUT)
ADR (ONGOTO)

AOR (NULL)

ADR (FNWAIT)>

BASIC MCS 6980 GATES/ALLEN/DAYIOOFF MACKO 47(115) O5312 10*SEPR75 PAGE Geng
FS mac beSEProd OSt11 OISPATCH TABLES,RESERVEO WORDS, ERROR TEXT, ., ALL CONSTANT

20440 IFN DSKFUN, <ADR (OSKOS) >
20460 — IFN LPTSW, <ADR(LPRINT) >
20480 IFN LENGTH, <

Mebe44? woevoa o115e5° 20500 ADR (POKE) >

080645" BuavB0 BvaeGe?

ov064e* Boone ov4a4iit 20seo ADR (PRINT)

eo0e4/* Yoaeao avaeaat

gove59 Bavove Bv7411° 20suo FUNCTS, <ADR(OEF)>

09651 Beadea gBeBEde?

eewese? anogen avssae? 20560 LENGTH, <ADR (CONT) >
@vv65ss* Caveee enee5o*
2veo0 REALIO, <ADR (DOT) >
ge9054* wavgne w1107e? 20620 ADR (LIST)
980655" 970000 eeoese?
2ne4e LPTSW, <ADR(LLIST) >
00656" aeeee ailedst evooe LENGTH~2, <ADR (DELETE) >
@ee657* OooB00 BuaE54?
Oebe6v’ aeoeaa ovs7es? auceee ADR (CLEAR)
e091" Beveva BwDESe?
2e7ee CASSW, <ADR(CLOAD)
20720 ADR (CSAVE) >
20740 CONSSW, <AUR (CONSOLE) >
wae662? oovoe0 ewadai? 2e7ee AOR (SCRATH)
900665? Buonee eoveeLt

20800 IFE LENGTHea2,<
@a2664" voveee eaves 20820 FRCTBLt AOR(FRCDBL)
260665" Beau weoece?
Bee666" CoBBee BoaLUde eveae ADR (FRCINT)
@ev667" Bovave BuRbE4*
280670" aroey Beveaes 20800 ADR (FRCSNG)
veverl’ Bev2e0 BveE66*

2vsso
20900 7 THESE TABLES ARE USED AFTER THE DECISION HAS BEEN MADE
20920 j TO APPLY AN OPERATOR AND ALL THE NECESSARY CONVERSION HAS
20949 j ‘BEEN DONE TO MATCH THE TWO ARGUMENT TYPES (APPLOP)
20900 +
aove7e? eovare vooveus 2e960
@eeo73? agagae ouoe7uE
evver4? o aeouges 21000 ADR (SUB)
@@0675° avoere?
@e0676* weoove avavous 21020 ADK (DMULT)
800677" Geeoee voeT4*
e207" evevea eeavEos 21900 ADR (ODIV)
200701" agave aLaeTe?
Qee7ee? ouweee svoveos 219600 ADR (DCOMP)
@00703" weeead avo7eo?
090794" Beeede ouovaes 21080 SNGDSP: ADR(FADD) FSINGLE PRECISION ROUTINES
ave7as? eoaeaa ove7ae?
eev706" dove evaveLs 21100 AOR (F SUB)
@ea707" aoveve averad?
900710" dodoae aeavode 21120 ADR (FULT)

BLUSP: ADR(DADD) HDOUBLE PRECISION ROUTINES

BASIC MCS 68 GATES/ALLEN/DAVIOUFF MACRO 4/(113) Q5312 1GeSEP75 PAGE de5
FS mac beSEPeod OST DISPATCH TABLES, RESERVED WORDS, ERROR TEXT,,, ALL CONSTANT

000711* @evo00 woeTee?
eae71e? oo avovaes aide AOR (FOIV)

820715" aoe e710"

¥ev714" apes geovurs 211628 ADR (FCOMP)

@av715* envoaa evo7ie’

@ee716" Bove00 ewovuEs 2116@ — INTUSP? ADR(1ADD) FINTEGER ROUTINES
@@0717% Bndee2 BeOT714"

020720" evo eeavner 21208 ADR (18U8)

Bee721* enoeG aveTIES

weer2e’ sooo suovuer 21220 ADR CIMULT)

oge723s* eneoee eve7en?

ea724" eovoes vaveus 21240 ADR (IOIV)

overs? ovonee aeoTee?

900726" eeaeve BvoveUs 21200 ADR (ICOMP)>

a0e727* Beavee evoTed?

777777177776 Ganz
DEFINE DCL (x), <>
DEFINE OCE(X),<@eave
XLIST
OC (x)
LIst>

oversee ERRTABE
IFE —— LENGTH=2,<
000730" e000 aeowoe r)
avowoe aso

DEFINE OCE(K),<>
DEFINE DCL(X),«
GsQet
OC(x)
o>>
OCE"NFN

200731" BOBEMe BYB11O OCL"NEXT WITHOUT FOR”

e2732" voaved vores

000735" Hobn0H Bb0130

BOOTS4" Beewee BbO124

000735* woeves avevao

aun7se* Bowe avereT

v0737* eevee vei11

puo7ae? Boevos veered

ObO7T41* BOVOLe ObO110

ObOT4e* BEbABe BHA11T

00743" Bowed wavered

aun744* eeaved wowed

000745" BOvEAe BoOLv4E

0u740" Gevsee euie®

wOOT4T® BRBBBH Bba1IT

eoe7Se* Geowve wvaree

900750" veeoOG BbOS2e

Bow7TS1" OBboHa BHavoH

avowor ERRNFe=O

BASIC MCS 8980 GATES/ALLEN/DAVIDUFF MACK 47(113) A312 10—SEPe75 PAGE 4x6
F3 mac 6rSEPm64 03311 DISPATCH TABLES, RESERVEO WORDS, ERROR TEXT», ALL CONSTANT

1213 21660 OCE"SN"
1214 @ve75e* aaane@ ver1es 21660 OCL"SYNTAX ERROR"
1215 980753" eos 940131

1216 9ve754* dove ove11e

1217 @88755* eeaona vea1ed

1218 0e@75e* Seoeee verdes

1219 80757" dovo4e ooe13v

1220 eve76ev? dove ovav4

tee @ve761" aeonue voo10d

1222 ev@76e" vovouo Bve1ee

1223 990763" Boa00 vua1ee

1224 900764* @eneae gva117

1225 900765* @eeedo ovoree

1226 0vo76d* eavanD gvosee

1227 00760" ogoave evecer

eee avovge ERRSNE=g
12e9 OCE"RG"
1230 900767" eov9v0 gnoree OCL"RETURN WITHOUT GOsUB"
1251 000770" @ovove vve105

1232 000771" govene avered

1235 owo77e? aooven avored

1234 680775" @peove Boo12e

1235 @s0774" woenve uveiio

1236 980775" doege Boov4y

1237 90776" Beovve eeaiaT

1238 80777" aoepee Bva111

1239 @vioee" aeoove ovored

1240 ov1pe1" enovee voo11e

1241 oviaae’ aevove ova1iT

1242 91995" d9va00 vores

1243 ge1ee4? apvove aveied

1244 oleas? vooved gvov4e

1245 @slage’ ane avoieT

1246 ovtoa7? eoeeve vali?

1247 @alo1e? aooees vores

1248 d1911" epvove Bye1ed

1249 vlale? eoeoae ouoive

1256 velnier vos svosee

1251 991013" eov098 eevee

tase evoves ERRRGE2Q
1253 Oce™op"
1254 981014" go0800 0117 OCL"OUT OF DATA"
1255 01015" vogdee ooB12d

1256 01016" pevvee veered

1257 oe1ai7’ eoveee ovavao

1258 91920" Yoovee ovel17

1259 oo1gai? eoeeve avoiee

1260 Golgeet aevove avavay

1261 Go1ees? Beeene sooied

teoz e124? vooove vveier

1263 ov1ged’ envove neored

1264 126 Beveve wearer

1265 @algee’ aavenn av0se1

BASIC MCS BV8U GATES/ALLEN/DAVIDOFF MACRO 4/(115) @3312 10eSEPH75 PAGE 4n7
FS Mac brSEPe64d OS311 DISPATCH TABLES,;RESERVED WORDS, ERROR TEXT,,, ALL CONSTANT

1266 ge1e27* epee voovow
1267 awovos 21820 ERROD==
1268 21840 OCE"Fc
1269 olo3u’ oaveen ovaris 21660 OCL"ILLEGAL FUNCTION CALL"
1278 801031" Gada ova114d

1271 Gete3et epevee ovo114

1272 201033" aeee9e oeo10s

1273 071034" oneove aveio7

1274 001035" epecee nveie1

1275 41030" vovoue ooe114

1276 vo1s37? weoeee svevae

1277 oe104e" eeevse vooI_e

1278 evin4i’ envese ooered

1279 ooio4e? eneone verte

1260 oe1o45" eevene avo10s

1281 oo1o44" eovana ovared

1262 061945" BeeDOe BemLIL

1263 ov194e" epepn0 ovoitT

1264 01847" eovene aveLIe

1265 @vigser eeeoue ovowae

1286 061051" eovaee aoo10s

1287 wviase’ eavpee aveiui

1268 001055" @eeane guBits

1269 981054" vaveee soo114d

1296 001054" aoen0e ovos14

1291 001055 epesee avoveo

1e9e aeoves ERRFCSu
1293 DcE"ov"
1294 61956" eooveo vari 2 OCL"OVERFLOW"
1295 8195/7" aean00 ova12e

1296 041960 Beuoey Bee1ed

1297 91961" Gou9e oevlee

1298 ov1g6e? Bove ove106

1299 v196s* aov00e ovo114

1300 901964 vodn0e ooo117

1301 Oa1065* oaeeoe oue1aT

152 981963" eoupe9 4eose7

1303 921966" veusee voavan

13e4 avavee ERROVESU
1305 Oce"onn
13¢6 01967" Beeuve Bow11T OCL™OUT OF MEMORY"
1307 ov197e* BpLveoe vores

1508 001071" en9000 wBuoLed

1509 ov1a7e? eovoon svovay

1510 961073" @oveu0 avartT

1311 e1074* @oeono ao01e6

1512 01975" eovone  evoo4D

1513 e1e7e’ wavove ova11s

1514 01077" UeovaD ouB1OS

1515 @o1106" BeveBe BooI1d

1516 ov11e1? eoepd0 avaLIT

1317 wo110e" voovee euoree

1518 061105" @p000 0W0131

BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(115) @5312 10SEP=75 PAGE 4=8
FS Mac brSEPeO4 SILL DISPATCH TABLES,RESERVED WORDS, ERROR TEXT,,, ALL CONSTANT

1519 961103" d0000 @ea531
1520 001194" voeoe woven

1321 eeoeas ERROM
1322 Oce"us"
1323 ov1105" eove0e overed OCL"UNDEFINED STATEMENT"
1324 @011a6" aepeva gue1io

1325 ov1107" aoeene avoied

1526 01110" an9000 900105

1327 o@1111" weveee evo1e6

1326 ovliie’ eavene evarit

1529 81115" Bpve00 Bua1IE

133@ 001114" gnodee eve1es

1531 @1115* eave oveles

1532 1116" enoase ovov4e

1333 61117" Ga0002 avores

1334 01120" @e0000 avored

1535 ol121" eovooe avoier

1336 @@112e" GeeveD guo1ed

1337 we112s? vecove ava1es

1336 0o1124" woven aua1tS

1339 001125" Bo0ee0 avo10d

1540 01120" Bavvo0 guoite

1541 el1e7? epeeod avored

1342 001127" @n9pee goused

1343 @01130" @penne ovovoe

1344 avovie ERRUS#Q
1545 DcE"Bs"
1346 01131" Go0000 voles OCL"SUBSCRIPT OUT OF RANGE”
1347 @61132" B00000 woutes

1548 001133" on0900 evo1oe

1349 861134 deecan BooLeS

135@ 81135" eave voo1es

1351 @v1136" weeene ovalee

1352 001137" @avvaM ovarit

1353 @01140" eeeone seorew

1354 001141" gagave poorer

1355 01142" eaove voov4n

1556 941145" eaanae e117

1357 gv1144? weeooe avored

1358 av1145* egopee overed

1359 @vl14e" ovevoe ovoeaL

1560 061147" Boveae ovartT

1361 Go115e* eavoee avoiee

1362 001151" doves woovay

1563 001152? Boeed0 auo1ee

1564 981155" @voee eoa101

1365 081154" Be0uGe ovai1e

1366 061155" opouse ooo1e7

1367 901150 9a0040 ava1es

1566 941156 aa0000 evo3sed

1569 001157" Beeose svavoe

1370 eeoess ERRBS:
1371 Oce"ou"

BASIC MCS 88V GATES/ALLEN/DAVIOUFF MACRO 47(11$) 05312 107SEPe75 PAGE 4n9
FS mac GrSEPeed S211 DISPATCH TABLES, RESERVED WORDS, ERROR TEXTye, ALL CONSTANT

1372 @v1160" aeeeee vevree 22160 OCL"REDIMENSIONED ARRAY"
1373 001161" dee evo105

1374 @el16e? @eeeoe gvei—d

1375 901165" eeeoae vuaiii

1376 001164" apodeme ave115

1377 @e116>° eageee gvei—s

1378 081166" @eeevo verte

1579 081167" @Q0000 Beoles

138¢ ov117e" egDeve BwwIIL

1581 01171" @evee0 BeaIIT

1382 ov1172" Beevad Bvolio

1583 001175" Baev0 ova105

1564 81174" @eooue BuB1e4

1585 981175" @poo0e guo04e

1586 wv1176" eoveve gvo1e1

1387 @v1177" aaveee eoniee

1388 av1e0v" apeoee Bueiee

1589 wo1ed1’ eposee eve1e1

1590 blame" epouee e131

1591 @a1age’ aponee 200531

1592 201295" oaveed guovee

1593 ooowre ERROD==0
1394 Oce"son
1595 av1e94? aeeero ovaies OCL"OIVISION BY ZERO”
1396 dvia9s* apoave verti

1397 @v1eae’ eeeovn aeaies

1598 vtee7? weoese aooitt

1399 oule1or epveee suoies

1400 ooteii’ eeeeae ewoiti

1401 diate? @oeove oveliT

14¢2 odleis* eeeeee Buo1ie

1403 ov1e14* aeesee Bvevad

1404 61215" epeo00 ave1—e

1405 @ele1e’ eoevan vais.

1486 61217" Bnvean coow4e

1407 901220" ap000 ovo13e

1408 weleel? Baveno evo10S

1469 oteee’ eaveoe veeiee

1410 @etees? aovene evai17

1411 oe1225" epovee 4vesiT

1412 ao1224" vevese evaver

1413 evours ERROVOZ2g
1414 OcE"I0"
1415 wo1eed? eoaeve op0111 OCLYILLEGAL DIRECT"
1416 @vi2e6" epaeve ovai1a

1417 @vleeT? Gevave vua114

1418 ov1230" apveee gua105

1419 go1231" eoe00e ave1eT

1420 oolese" Goovse Gvoier

1421 @o1e33* aoeoeo gve114

1422 oo1e34* epvero auovad

1425 @e1235" @eevue ovo1es

1424 o1ese’ woouoe Buo11t

BASIC MLS Be80

F3

Ba
F3

145
1426
14e7
1428
1429
1430
1434
1432
1433
1434
1435
1436
1437
1438
1439
144g
1444
sage
1443
1444
1445
1446
1447
1448
1449
1450
1454
1452
1453
1454
1455
1456
1457
1458
1459
1a6e
14e1
1ae2
1463
1464
1465
1466
1467
ides
1469
14a7e
4474
sa7e
1473
1474
1475
1476
1477

1c

1478
1479
1480
1464
1482
1483
1464
1485
1466
1467
1488
1489
1496
1494
1492
1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1565
1506
1507
1508
1509
1516
1d11
1542
1513
1514
1515
iste
1517
1516
1519
1520
1524
1922
1523
1524
1525
1526
1927
1528
1529
1538

mac

aorasit
woredue
oeraaie
eoleder
woreder
words?

oolaaar
welaase
eoieaer
welaare
eoraset
ee1esi?
ooraset
oo1e5s?
worasa?
oo1eso’
aoraser
oo1es7t
oore6o?
eor260"
wor26r?

werace?
e263"
oe1264"
wei126s¢
Belacet
wores7t
ovreret
evrerit
ovraret
wore7s?
vorarar
oo1e7s?
ow1a7e?
oo1e7it
#01300"
we1301¢
eo130e"
we13ase
be13sedr
eoisoae
#1305"

wo1306°
eo1sa7?
eeisi0"
woi3iit

S Bp8e
MAC

oo1sie?
@e131s¢
oe13i4e
@@1315°
001310"
go13i7?
@e1320"
eisai"
wulseer
wei3as?
wiser
ovrsear
oe13e5°

werseer
oe1327"
01330"
01331
901332"
001335"
ou1s34e
001335"
00133

0a133/¢
ovi134ne
@eisaie
@er3aer
0134s"
evisaar
oo1 345°
oe1saer
oo1sas?

eei3s7*
oe1357°
001360"

wei3e1"
01362"
oo1ses"
oa1364"
0v1365¢
001360"
wo1367*

GATES/ALLEN/DAVIDOFF

brSEPeed OS311

eoonve
eoveve
eooene
eovevo
eaceno
evecve

aoonee
eovvee
eaveua
eevee
eoogve
ooove
eneved
eave
gouo0e
aeeuvo
aaveve
eoeveo
eeaone
eevee
eoveve

eovoee
eoveee
eaeven
soeove
eoanee
weeeoe
eeeove
aeeooo
eovoad
eeveoe
weeose
eoevo
eoonae
eevee
aeooae
vowed
aoven0
Peeooo
ao00u0
eoveve
oevoen

vovove
eavvee
eovevo
oooeve

GATES/ALLEN/DAVIDOFF

ovaree
ewes
eeoies
eeeied
ovases
aeowne
ovous4

geered
peeisi
eeoieo
aveias
evevge
aveii5
oeeiia
aeeres
oeoiis
eeeies
weoted
aveies
averse
avosie
evevee
ewouls

oee117
eea1ed
ovoied
eeoedo
aeoii7
eweide
avovge
evares
@eeied
eeeiee
weit
georie
@eeie7
veawan
genres
ova1ee
oeo1e1
oeoies
aee1e5
evases
evevew
aveeie

oeoies
eeoied
oveiee
owoiit

6rSEPwod OSt14

aeeoee
aeevve
eeovve
eoeevo
eeveve
eevee
enovea
eooeue
epovoo
apovee
aooo00
eoavee
aoeooe

ooovoe
eoovee
eoaeee
eeovee
eoneee
eeeeee
aevene
aeocoo
eaves
evooue
eoovee
aoavae
eoveve
eevee
eevee
eeoene
eeeeue
aevoee
aevvun
eeovee
agooue
eoevoe
envove
aaeovo
eeoone
aovede
avenge
aeovae

a00e00
eovoe0
ouoeae
epoca
eoveey
eevee
eoaaee

ooo116
goa1e7
ooneae
ooo1ed
00117
ave117
ovewae
eve114
000117
e116
eeaies
ooese7
avovee
eves?

oooies
eoo1ad
evoiee
ovaiii
evo116
evoie?
ewovan
oveiae
ewoiiy
oeoiee
@vei15
ovpies
eeoiid
ovoiel
ovouay
weoted
owoii7
ewoii7
evovae
oveles
ovo117
ooaiis
everew
ovoid
ova185
900130
avesse
ovouge
evoweo

ava1es
eooies
aveiie
evous7
overe4
evevao
owvaias

MACKO 47(115) U5312 1@eSEPRTS PAGE 4=10
DISPATCH TABLES,RESERVED WORDS, ERROR TEXT». ALL CONSTANT

22300 EKRIDesg
2e320 STRING, <

22540 OCE"TH

22300 OCL"TYPE MISMATCH

22360 ERRTME8G
2eauo Oceros"
2egeo OCL"OUT OF STRING SPACE"

ERRSOzaQ
OCE"Ls"
OCL"STRING TOO LONG"

MACRO 4/ (4115) 05312 10mSEPe75 PAGE dott
DISPATCH TABLES,RESERVED WORDS, ERROR TEXTs., ALL CONSTANT

ERRLS= 36
OceNst"
DCL"STRING FORMULA TOO COMPLEX"

EXRST==q>
LENGTH, <
OcE"cN"
OCL"CAN*T CONTINUE"

BASIC MLS 8G80 GATES/ALLEN/DAVIDUFF MACKO 47(115) @5412 1d9SEPe75 PAGE 4nt2
FB mac. OeSEPRO4 OSt11 DISPATCH TABLES,RESERVED WORDS, ERROR TEXTy,, ALL CONSTANT

1531 901370" apovoe oeoIIT
1932 01371 Booove gealLE

1535 001372" veoveD wuored

1934 961373 avon @vo111

1555 001374" vov09e uote

1536 001375* gone eared

1537 001370" goovee ooeied

1536 81376" goo Hvesed

1539 @01377" Goved, vvowge

1540 evower ERRCN:
1541 FUNCTS,<
1542 OCE"uF”
1543 oo1age? onv000 ovared OCL"UNDEFINED USER FUNCTION"
1544 1401" ooeo90 vii

1545 avlage? aeveoe ava1e4s

1546 01495" Bpeoue 800125

1547 91404" BoeQeB ooB106

1548 81405" oneoeo BvO111

1549 @81496" @ovoV2 vevI16

1550 vel4a7’ eaooed ova105

1951 o01410" vooveD ovo1ed

1552 081411" eageon svav4e

1555 oo1aie? Bedoed Bvu1ed

1554 921415" Boone ve1es

1555 001414" weopes Bvo1eS

1556 #1415" opoevo gveize

15997 21416" deoave evavan

1958 81417" eea— ove1e6®

15959 981420" Boog ve1e5S

1568 @14a1" oegoe ove116

1561 @@1dae? doaoae ebo10s

1562 v1aes? woeovs ovoLed

1563 weiaed? eaveen ave1iti

1964 ev14e5* egovOD wve1IT

1565 001420" BaveeD sou116

1566 olg2e? vooevn ovas16

1567 viae7’ voveon ovovo

1568 avovee 2ere0 ERRUF#2G>
1569

1570 22760 © PAGE

BASIC MCS 8980 GATES/ALLEN/DAVIDOFF MACRO 47 (113) O5312 10%SEPm75 PAGE 5
FS Mac 6rSEPeod SE11 LOW SEGMENT = KAM e» IE THIS STUFF IS NOT CONSTANT

1971 22760 © SUBTTL LOW SEGHENT *= KAM #= IE THIS STUFF IS NOT CONSTANT
1572 22800;

1575 THIS 18 THE "VOLATILE" STORAGE AREA AND NONE OF 1T

1574 CAN BE KEPT IN KOM, ANY CONSTANTS IN THIS AREA CANNOT

1575 BE KEPT IN A ROM, BUT MUST BE LOADED IN BY THE

1576 PROGRAM INSTRUCTIONS IN ROM,

1577 i

1578

1579 91430° Booeve avousa BUF MING 1A COMMA (PRELOAD OR ROM)

1560 FUSED BY INPUT STATEMENT SINCE THE

1561 DATA POINTER ALWAYS STARTS ON A

1582 COMMA OR TERMINATOR

1563 v1031° E BLOCK  BUFLEN HTYPE IN STORED HERE

1564 Q DIRECT STATEMENTS EXECUTE OUT OF

1585 THERE, REMEMBER INPUT SMASHES BUF,

1586 JHUST'BE AT A LOWER ADDRESS

1567 }THAN DSCTMP OR ASSIGMENT OF STRING
1568 2 IVALUES IN DIRECT STATEMENTS WONfT COPY
1589 FINTO STRING SPACE =» WHICH IT MUST
1590 IFN LPTSH,<

1591 LPTPOS: BLOCK 1 #POSITION OF LPT PRINT HEAD

1592 PRTFLGE BLOCK {> WHETHER OUTPUT GOES TO LPT

1593 2322 TNON*ZERO MEANS SENO OUTPUT TO LPT

1594 IFN CONTR, <

1595 oe1sait CNTWFLE BLOCK © 1> FSUPRESS OUTPUT FLAG

1596 9e1suer DIMFLG: BLOCK 1 FIN GETTING A POINTER TO & VARIABLE
1597 2 JIT IS IMPORTANT TO REMEMBER WHETHER IT
1596 FIS BEING DONE FOR "DIM" OR NOT

1599 JDIMPLG ANO VALTYP MUST BE

Lovo HCONSECUTIVE LOCATIONS

1eu1 IFN STRING, <

teve soisase 2 VALTYP: BLOCK 1 HTHE TYPE INOICATOR

1ev3 FIN THE 8K GBNUMERIC 1eSTRING

1604 eisaar OPRTYPS JUSED TO STORE OPERATOR NUNBER

1605 FIN THE EXTENDED MOMENTARILY BEFORE
tov 2 FOPERATOR APPLICATION

1007 weisaa? DORES? WHETHER CAN GR CANFT CRUNCH RES*D WORDS
1608 TURNED ON IN THE 8K WHEN "DATAM

1009 FBEING SCANNED BY CRUNCH SO UNGUOTED.
1610 STRINGS KON*T BE CRUNCHED,

1611 av1sa5¢ MEMSIZ$ BLOCK 2 HIGHEST LOCATION IN MEMORY

tole goisar? TEMPPTS BLOCK 2 HPOINTER AT FIRST FREE TEMP DESCRIPTOR
1613 HINITIALIZED TO POINT TO TEMPST

1614 ov1551° TEMPST? BLOCK  STRSIZ*NUMTHP —FSTORAGE FOR NUMTMP TEMP DESCRIPTORS
1615 90157? OSCTMPs BLOCK  STRSIZ FSTRING FUNCTIONS BUILD ANSWER DESCRIPTOR HERE
1616 gu1s7S¢ FRETOP? BLOCK a> ATOP OF STRING FREE SPACE

117 IFN LENGTHISTRING, <

1618 ov1575° TEMP3: BLOCK a> FUSED TO HOLD VAR # OF HIGH LOC FOUND
1619 2 FIN GARBAGE COLLECTION

1620 JAND USED MOMENTARILY 8Y FRMEVL.
162d USED IN EXTENDED BY FOUT

teee FARKAY VARIABLE HANOLING TEMPORARY
1623 LENGTH, <

BASIC MCS 89BE  GATES/ALLEN/DAVIDUFF MACKO 47(113) @3312 16-SEPe75 PAGE Sel
Fs mac beSEProd OSt11 LOW SEGMENT = KAM e= Ie THIS STUFF IS NOT CONSTANT

1o2a ewis77° 2378 DATLIN: BLOCK 2 FDATA LINE # e REMEMBER FOR ERRORS
1625 e160)" 23802 ~SUBFLG? BLOCK 1 FLAG WHETHER SUBSCRIPTED VARIABLE ALLOWED
1626 25820 TFOR" AND USER®DEFINED FUNCTION

1627 25840 WPOINTER FETCHING TURN

1628 23860 THIS ON BEFORE CALLING PTRGET

1629 23880 180 ARRAYS WON'T BE DETECTED,

1630 25900 FSTRINL AND PTRGET CLEAR IT,

1631 we1eue? 23920  FLGINP? BLOCK JFLAGS WHETHER KE ARE DOING INPUT

1632 25940 FOR A READ

1633 ov16e0s* 23960 «TEMP: «= BLOCK FTEMPORARY FOR STATEMENT CODE

1634 23980 FNEWSTT SAVES (HyLJ HERE FOR INPUT AND “C
1635 24900 PULET" SAVES NUNBERIC VARIABLE

1636 2agee JPOINTERS HERE FOR "FOR"

1637 24940 FNEXT" SAVES ITS TEXT POINTER HERE
1638 24a60 FCLEAKC SAVE [H,L) HERE

1639 @01605° 24080 TEMPas TFORMULA EVALUATOR TEMP

1649 24100 FMUST BE PRESERVED BY OPERATORS

1o41 2aieo 7USED IN EXTENDED BY FOUT

lege 241aa FARRAY VARIABLE HANDLER TEMPORARY

1643 ov1607" 241600 Block 2 HCURRENT LINE #

1644 24160 FSET TO 65535 WHEN DIRECT STATEMENTS EXECUTE
1645 24200 LENGTH, <

1646 1611" 24220 Block 2 FOLO LINE NUMBER

1647 01613" 24240 OLDTXT?: BLOCK a> FOLD TEXT POINTER

1648 2uzen HPOINTS AT STATEMENT TO BE EXECUTED NEXT
1649 oo1615¢ 24280 STKTOP? BLOCK 2 ;TOP LOCATION TO USE FOR THE STACK
1650 24300 VINITIALLY SET UP BY INIT

1651 24320 TACCORDING TO MEMORY SIZE

1652 24340 1TO ALLOW FOR 50 BYTES OF STRING SPACE,
1653 24360 CHANGED BY A CLEAR COMMAND WITH

1654 24360 FAN ARGUMENT,

1655 @o161/" 24402 —TXTTAB? BLOCK }POINTER TO BEGINNING OF TEXT

1656 eageo HDOESN?T CHANGE AFTER BEING

1657 augue FSETUP BY INIT,

1656 162i? 24468 VARTAB? BLOCK POINTER TO START OF SIMPLE

1659 24480 VARIABLE SPACE

too 24500 JUPDATED WHENEVER THE SIZE OF THE

1661 245ee TPROGRAM CHANGES, SET TO (TXTTAB)
1662 2454e HBY SCRATCH ("NEW"),

1663 ov1625" 24560 ARYTABE JPOINTER TO BEGINNING OF ARRAY

1664 245ee TABLE

1665 24000 FINCREMENTED BY 6 WHENEVER

1666 24620 TA NEW SIMPLE VARIABLE IS FOUND, ANU
1667 24040 SET TO [VARTAB] BY CLEARC,

1668 ov1e25° 24660 © STREND? JENO OF STORAGE IN USE

1669 2ueee TINCREASED WHENEVER A NEW ARRAY

1670 24700 FOR SIMPLE VARTAGLE IS ENCOUNTERED
1671 aurea FSET TO {VARTAB) BY CLEARC,

1e7e e1627° 24740 «DATPTR: BLOCK «2 WPOINTER TO DATA, INITIALIZED TO POINT
1673 24760 VAT THE ZERO IN FRONT OF (TXTTAB)

1674 24780 IFE LENGTH=2,<

1675 ov1631" 24800 TRCFLG: BLOCK 14> 10 MEANS NO TRACE IN PROGRESS

1676

BASIC MCS BBBO GATES/ALLEN/DAVIDUFF MACKO 47 (113) @3312 10SEP*75 PAGE See
FS hac brSEPeod4 GSE11 LOW SEGMENT = KAM e= Ie THIS STUFF IS NOT CONSTANT

24840 © $THE FLOATING ACCUMULATOR,
2used FE LENGTH=2,<
Oo163e" 24860 BLOCK 1 T(TEMPORARY LEAST SIGNIFICANT BYTE)
001635" 24900 DFACLU? BLOCK 4> 1 (FOUR LOWEST ORDERS FOR DOUBLE PRECISION)
auiesi* 24920 «= FACLO? BLOCK 3 F{LOW ORDER OF MANTISSA)
2494p T(M10DLE OROER OF MANTISSA}
24960 } (HIGH ORDER OF MANTISSA)
wolede? 24960 FACE BLOCK 2 1 (EXPONENT)
25000 TV CTEMPORARY COMPLEMENT OF SIGN IN MSB)
25020 LENGTH=2,<
Por16a4e 25030 BLOCK 1 T{TEMPORARY LEAST SIGNIFICANT BYTE)
ee164s? 25oau 5 BLOCK 7 T{LOCATION OF SECOND ARGUMENT FOR DOUBLE
oe1654° 25060 5 BLOCK 1> 1 PRECISION)
001655 25060 BLOCK 13 }BUFFER FOR FOUT
oo1e7e? 25100 LENGTH=2,<BLOCK 35=13>
25120

BASIC MUS 8986 GATES/ALLEN/DAVIDUFF MACRO 47(113) 25t12 10—SEPH75 PAGE 6
F3 Mac. beSEProd OSt11 TEXT CONSTANTS FOR PRINT GUT

1093 25140 SUBTTL TEXT CONSTANTS FOR PRINT OUT
1694 25100 7

1695 asiee
1696 25200
1697 aseee
1698 as2ue
1099 aseou
1700 25260
1701 25300 LENGTHe2,<
1702 25320 Oc” ERROR”
1703 25340 o>

1704 01720" Go9eda soowan 25300 pc" IN *
17@5 @o1721" apepee aoaILL

17¥6 @8172e" veo oe116

1767 o1723* OBeeEE soenae

1768 ov1725" opeoeD goueaD

1709 1724" ByaveB eLaLeE @

1719 @e1725" GoeoaG BoBe15 ACRLF

1711 81726" Bevo oowEIe

1712 1727" opeoes evor17 pc"ox"
1715 OB173H" Bovoee BvELLS

1714 001730" BeeQDe ovOS1S

1715 081731" Geeene avov1d ACRLF

1716 01732" Opevy aooLv1e

1117 81735" eoeeLe BoaKoD )

17168 IFN LENGTH, <
1719 @01734" eovoBD BvBv15 BRATXT? ACRLF

1720 * eeeene ovewre

ret weeove Buorve OCMBREAK"
17ee @aeeno avoree

17es @eavne gve10s

rea weeeae ovaier

17e5 @eeven avers

1126 Beeees uvesis

1727 @01745" epvaeo owovee assaua

1728

1729 assee

NEEDED FOK MESSAGES IW ALL VERSIONS
MUST BE STORED ABOVE DSCTMP OR ELSE STRLIT

WILL COPY THEM BEFORE STRPRT PRINTS THEM, THIS IS BAD, SINCE 1F THE

USER I8 OUT OF STRING SPACE BASIC WILL LOOP GETTING "QUT OF STRING SPACE"
ERRORS,

BASIC MCS 6980 GATES/ALLEN/DAVIDUFF MACKO 47(113) @3812 10SERR75 PAGE 7
FS MAC bRSEPmod OSt1L GENERAL STORAGE MANAGEMENT ROUTINES

1730 25600 SUBTTL GENERAL STORAGE MANAGEMENT ROUTINES
1731 aneeo

1732 25640 FIND A FOR ENTRY ON THE STACK WITH THE VARIABLE PUINTER
1733 25660 j ~PASSED IN [D,E}y
1734 25060;

1735 ve17a4? epteon voooas as7ooF
1736 801745" aodove aoeves?

1737 081746" eoooue avareo?

1738 asree VAND THE RETURN ADDRESS OF THIS

1739 001747 Bo1oee geovTd 2574 oad SP JSUBROUTINE, SET (HyL) #SP

1740 G@175e¢ Ooied Bva17e 25760 LOUPER: MOV AM SEE WHAT TYPE OF THING IS ON THE STACK

1741 81751" Giese BvELaS 25780 INx 4

1742 081752" eave BeeS76 25800 cer FORTK FIS THIS STACK ENTRY A FOR?

1745 we1753s* eoovde wveeet

1744 981754" onied@ ovosee asee0 RNZ #NO $0 OK

1745 25eue LENGTH, <

1746 25860 Pushin GET VARIABLE NAME

1747 25860 XTHL>

1748 25900 LENGTH, <«

1749 @81755° Boieee veite 25920 mov cy

175@ @81756* eoleon avavas 25ou0 INx 4 #00 EQUIVALENT OF PUSHM / XTHL

1751 081757" Balvwe gve1ee 25960 Nov 8,4

1752 @ei7eur @oiove veces 25980 INX H

1753 @@1761" e100 eves4s 20000 PUSH oH #PUT HON

1754 vi7ee’ @ateoe ova1Si owes nov Lc #PUSH B / XTHL IS SLOWER

1755 Ge1765° Boloaa averae 20040 Nov HB

1756 001764" Oalees ovaiTe 20000 Mov 4rd FOR THE "NEXT" STATMENT WITHOUT AN ARGUMENT
1757 @21765¢ eniedo ovae6Es 26080 ORA E WE MATCH ON ANYTHING

1758 81766" Onie90 wvasss 2o108 XCKG IMAKE SURE KE RETURN (0,€)

1759 981767" Gateee Bus1e ore uz POPGOF #POINTING TO THE VARIABLE

1760 Ov1770* Oneee BeITT4F

17e1 gwi771? egeode aortas?

1762 ov1772" Gaiees eves5S ae1ae XCHG>

1763 #01775* eotase gvasa7 26160 COMPAR

1764 ¥e1774* Boleed oveve 26180 POPGOFE LXI 8, SCODE+13 410 WIPE OUT A FOR ENTRY

1765 081775 anaevo vous?

1766 #1776" Ogeeee we1T7O?

1767 081777 Ooieee ovesa1 Pur 4

1768 weenoo? eoteve ovesie RZ 71F FOR MATCHES GOOD

1769 e901" eoteee veoi Dad 8

1770 @ee2ene? eaivae eeeses IMP LooreK HTRY THE NEXT ONE

1771 @e2005" Cooeee BL175E*
1772 ovens? enoeea Bw1TTS®
A173

1774

AT75

17176

4777

1778

4779

1786

1781

1762

NOFORE LXI Hy 4#SCOLE FIGNORING EVERYONES "NEWSTT*

THIS 18 THE BLOCK TRANSFER ROUTINE
IT MAKES SPACE BY SHOVING EVERYTHING FORWARD

{HyL) = DESTINATION OF HIGH ADDRESS
(D,£) © LOW ADDRESS TO BE TRANSFERRED
(8,C) = HIGH ADORESS TO BE TRANSFERRED

A CHECK IS MADE TO MAKE SURE A REASONAGLE AMOUNT
OF SPACE REMAINS BETWEEN THE TOP OF THE STACK AND THE HIGHEST LOCATION

BASIC MCS 8986 GATES/ALLEN/DAVIDUFF MACRO 47(113) @5312 10"SEPR75 PAGE (a1
FS mac 6eSEPeod 05211 GENERAL STORAGE MANAGEMENT ROUTINES

264K TRANSFERRED INTO
26500 7

26520 7 ON EXIT [H)L]®(LyE) LOW [B,C] ®LOCATION LOW WAS MOVED INTO
26540

ee2eas’ Goin ovesis 20580 CALL REASON FCHECK DESTINATION TO MAKE
@ven@e’ vveava avavdst
eeene7? noouno wvaves?

26680 FSURE THE STACK WON?T BE OVERRUN
oe2e10" Boive0 vases 2eeed BLTUC; PUSH FVEXCHANGE [6,C) AND (HyL)
ee2n11* gaieva evesas 26640 XTHL
oe2v1e ooieeo ovo3se1 26660 PoP
ee215* botea9 00347 26660 . BLTLUP: COMPAR TSEE IF WE ARE DONE
weeni4? daigva evei7e 20700 MOV 4GET THE WORD TO TRANSFER
@v2015" Caiove voce 260720 STAX TTRANSFER IT
Beeeie’ eaiaos evasive 20748 RZ
weze1/* cove vais 26760 ocx
Qe2920" vain aveess 26780 ocx BACKUP FOR NEXT GUY
@ee2e2i? sooo eoeses 26800 IMP BLTLOP
eeen2e* O000 oeewis?
eeeaas? vaves weve’

26820

20840 THIS KOUTINE I$ USED TO MAKE SURE A CERTAIN NUMBER

26860 OF LOCATIONS REMAIN AVAILABLE FOR THE

26880 STACK, THE CALL IS

26908 CALL -GETSTK

26920 NUMBER OF 2 BYTE ENTRIES NECESSARY

20940

20960 THIS ROUTINE MUST BE CALLED BY ANY ROUTINE WHICH PUTS

26980 AN ARBITRARY AMOUNT OF STUFF ON THE STACK

27000 (1,€, ANY RECURSIVE ROUTINE LIKE FRMEVL)

27020 IT 1S ALSO CALLED BY ROUTINES SUCH AS GOSUB AND FOR

27040 WHICH MAKE PERMANENT ENTRIES ON ThE STACK

27060

27060

27100 7 ROUTINES WHICH MERELY USE AND FREE UP THE GUARANTEED

27120 7 NUMLEV STACK LOCATIONS NEED NOT CALL THIS

27140
oeeee4? oinve avesas 27160 «© GETSTK: XTHL
@eep25* piv ave116 27180 Mov GET ARGUMENT INTO (C)

ge2e26" goiovo evovas ereeo Nx
@e2e2T* eulowe woasas 27e4e TAL PUT BACK RETURN ADDRESS
weeese’ Coivoe eves4d 2Teee PUSH FSAVE (HyL}

@02031° Gaines evoLse 27260 LALO = STREND

@eeese’ veogee avie2s?

0e2035" Bo0ovo avewee’

ew2n34" eainoe eevee 27300 MI 8,0

@@2035* avoee avever

ea2036" aoiveo veoull 27320 bao 8

we2037* @oinvo evavii 27340 oan 8 VSEE IF WE CAN HAVE THIS MANY
@eee4o’ aaiove wvasid 27560 CALL REASON

e@2041* aaneo Boewas?

e
e

BASIC MCS 6980 GATES/ALLEN/DAVIOOFF MACRO 47(143) @3412 10-SEPRTS PAGE Toe
F3 mac 6eSEPmod OSt11 GENERAL STORAGE MANAGEMENT ROUTINES

1636 wveode? eogvee wveuse?

1837 goee4s? aeiuoe guesas Pop PRESTORE (HyL)

1838 ge2044? eoiove avast RET

1839

1840

1641 (Hy) = SOME AUOKESS

1642 (H)L) IS EXAMINED TO MAKE SURE AT LEAST NUMLEV

1645 LOCATIONS REMAIN BETWEEN IT AND THE TOP OF THE STACK

1844

1645

1646 weeas? eoiveo ovesed REASONS PUSH =O. FSAVE (0,6)

1847 vedo? apiova ovesss XCHG PUT (H,U) IN (0,6)

1648 eed?’ woieae eoeeai uxt Hy SCODE+655S6~2*NUMLEV SETUP OFFSET OF GUARANTEED
1849 oveoso’ anveeD 177726°

185e ow2e51" Coven Bvevait

1851 LOCATIONS

1852 e252? eo1ove wvouTI bao sP FH »LISSTACK POINTER + OFFSET
1653 ow2055" eaves ovasa7 COMPAR JSEE IF THIS 18 ,GT, ENTERING (H,L)
1654 vvevss? Ooloee eob353 XCHG FRESTORE (H,L) FROM (D,E)
1855 oe2a55’ eoia%e aoeser POP o 1GET (D,€) BACK

1656 902050" eieoe avosee RNC TWAS OK?

1657 we2asT’ eoigee Booose OMERRS = MVI £,ERROM "OUT OF MEMORY"

1858 evesev’ eovove aoavar

1659 IFE LENGTH, <«

1860 XWO “01000, 1> FLXT By" OVER THE NEXT 2
1661 IFN LENGTH, <«

1862 weeselt aloes aveses InP ERROR>

1863 Bu2062" wreeee cueiee?

1864 sveves? doeuee ouavse’

1665

BASIC MCS 6960 GATES/ALLEN/DAVIDOFF MACRO 47 (115) 05412 1@nSEPe7S PAGE 8
Fs mac 6rSEPeO4 OSt11 ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN

1866 27860  SUBTTL ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
1867 27880 IFN LENGTH, «

1866 002904" eoieon auouse 27900 © DATSNES LHLO = DATLIN JGET DATA LINE

1869 65% eowave eeis77?

1870 Bee2e6e0* enRELe wee2voe*

1871 Qe2d6r" eutove oeov4e a7ga0 SHLD CURLIN> TMAKE IT CURRENT LINE
1872 de2070* oavede aeiea7?

1873 oe2a71? BoBDeH BweLEd?

1874 Be2e72? CuIode BvOvse 27949 © SNERRS NVI E,ERRSN A"SYNTAX ERROR"

1875 gaen75* eeeeee veaoue

1876 ween7a? Cuicoe Beaver 27960 xWO 7010001 I"LXI 8," OVER THE NEXT 2
1877 @e2a7S* oo1ave vea~3e 27980 OVBERR? MVI RROVO DIVISION BY ZERO

1676 Ge2a7e* ovevee Beavis

1879 26000 TFN LENGTH, «

1880 ov2v77* opine aeewaL 26020 xwD 7010001 SKIP_NEXT THO

1881 veeipv? Catode weovse 2604@ NFERRS VI E,ERRNF> "NEXT WITHOUT FOR" ERROR
1eb2 Gez2191" eovEGe aueveL

1863 verve? Molec wLvasis 26060 ERROR? CALL — STKINI RESET THE STACK AND FLAGS
1664 Gee105* eaveve aveaTer

1885 Be2104" Bvoeds wwev7e"

1666 20080 IFN CONTRA, <

1867 ge2105¢ Ovieow oueest 28100 XRA A

1868 Oeeivet OoIAve weavee 2e1ee STA CNTHFL> FFORCE OUTPUT

1869 wee2io7? agaoes eisai?

1898 Be2116" Bov0e0 eueI05"

1891 oe2111" aeivee 900315 26140 CALL = cROO JCRLF

1892 everle? wnvede ov4adest

1693 gve11s? eoveve owerer?

1694 ge2118" oeiaee seowat av2eo uxt Hy ERRTAB JGET START OF ERROR TABLE
1695 gve115? eo9eae veers0t

1696 oveile’ dawns belie?

1697 2e2ae FE LENGTH=2,<

1698 de8i17? voiced ov0si5 26260 LEPSKP: CALL OREM HSKIP AN ERROR MESSAGE
1699 @vet2e’ Beaedo weae7ar

19¢@ @ve212i* eeerve wveri5®

1981 ov212e? epieve sevess e280 ocr e JDEGREMENT ERROR COUNT
1992 @oe125* eelees aoowas 26262 Thx 4 HSKIP OVER THIS ERROR MESSAGE
1903 Beet24’ avian guesce 28300 INZ LePsxe> HSKIP SOME MORE

1964 gee125? eoaeed Bee117°

1905 oee12e’ vowere aveieo?

1906 26320 LENGTHe2, <

1907 263e2 Wov DA HGET ZERO INTO D

1908 2bseq ies Ayan FSTART OF ERROR MESSAGE
1909 26326 OUTCHR ITYPE LT

1916 26340 Dad ° FADD IN ERROR CODE

194 26300 Nov AyM JGET FIRST ERROK CHARACTER
1912 26380 OUTCHR FTYPE IT

1913 26400 CHRGET 1GET 2ND CHARACTER OF ERROR CODE
1914 26420 OUTCHR TYPE TT

1915 26440 LxI Hy ERR> 1GET POINTER TO " EKROR™
1916 2127? valves ovus15 28460 ERRFINS CALL — STROUT TYPE IT

1917 02130" @a0e00 avTT45°

1916 @e2131? eoeeue aozied*

BASIL MCS BOBE GATES/ALLEN/DAVIDUFF MACKO 47(115) @5412 10eSEP=75 PAGE 8m1
FS Mac OrSEPeo4 GSt11 ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN

1919 oez1Se" eo1ee0 eeouse 264ne brio CURLIN FCURRENT LINE #
1920 082135" Oneeee weleaT’

1921 982134" BooeeD verse"

1922 082135" eoleve eoL1T4 20soe Nov Ay VSEE IF IN DIRECT MODE

1925 ow2136° doiee0 eeDedd 285e0 ANA (i

1924 982137 onteee evavra 28540 INR A ZERO SAYS DIRECT MODE

1925 ov2140" Oeiowe ovasoa 26560 nz INPRT PRINT LINE NUMBER IN CH,L)

1926 e141" Boovee evoueer

1927 ge2ide? aoevce owerss

1928 26560 IFE LENGTH, <

1929 28600 Xn TuLoe,1 YLXI B," OVER THE NEXT 2

1930 26620 ENDS

1931 26640 «STOP =~ -RNZ MAKE SURE HE TERMINATED IT

1932 28600 STPEND? POP 8 GET RIO OF "NEWSTT" RETURN ADDRESS.
1933 28680  ENDCONS>

1934 2beb2 FE LENGTH#a,<

1935 28684

1936 28686} FOR "LIST" COMMAND STOPPING

1937 28008 ij

1938 we2145" aoieva evav7e 28690 xnD *01000,7076 FSKIP THE NEXT BYTE

1939 ge2144* eoleoe aveser 26692  STPRDY: POP >

1940 26700 READY: IFN LPTSH,<

194) 2e7eo CALL = FINUPT> PRINT ANY LEFT OVERS

1942 28740 FN CONTRA, <

1943 oe2145° Bolo0e BoeesT 28760 XRA a

1944 ge2140e" eoieae guovee 26780 STA CNTHFL> FORCE OUTPUT

1945 2147? doevae ovis4i°

1946 o0215e* woeeoe Geelai?

1947 @v2151° woieve seed 26800 LxI H, SCODE+65535

1948 ooe215e? BoeBe 177777"

1949 @42153" dooove wee2laT®

1950 wee2154* woIeoH Buov4e 2ese0 CURLIN SETUP CURLIN FOR OIRECT MODE

1951 oe2155? aodeed ov16uTt

1952 we2156" anveeD oveiset

1953 o62157? woiove eoowas xr Hy REODY JYREADY" CRLF CRLF

1954 @e216v" aoveMe Be1725°

1955 weel61? eaoeee evelss*

1956 be2162" aaieee ovOs15 26860 REPINI: CALL INIT PRINT IT, REPLACED BY CALL STROUT
1957 @d2165* doovee BLvoeoes

1958 02164" Govowe Be2iEu"

1959 26860 BY THE INIT CODE, THIS IS HERE SO AFTER
1960 26900 FERRORS DURING INIT, INIT IS RESTARTED
1961 82165" eoleee weusis 26920 CALL = INLIN GET A LINE FROM TTY

1962 Bee2166" eao~ee BveTTOS

1963 @v2167" BooDve ovals?

1964 oee170* voIveR wBeuseT 26940 CHRGET GET THE FIRST

1965 weei71* eoleee  eeeu74a 26960 INR A SEE IF @ SAVING THE CARRY FLAG
1966 oue2i72? Caivee BvoLTd 26980 DcR A

1967 we1Ts? eaiveo wvosi2 29000 wz MAIN HIF SQ, A BLANK LINE WAS INPUT
1968 go2174* BooovH Gw2l65?

1969 e175? vooeDe Bverob*

1970 ave17ef Bo1ve 4eeSeS 29ae0 PUSH PSH SAVE STATUS INDICATOR FOR 1ST CHARACTER
1971 @B2177* viedo Beos1S 29040 CALL = LINGET FREAD IN A LINE #

BASIC NCS 8960 GATES/ALLEN/DAVLOOFF MACRO 47(113) @5312 10-SEPe7S PAGE Be2
Fs MAC 6rSEPro4 OSt1L ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN

1972 @822a¥" Boowma woso4et
1973 gweeai? aneaow oweiTa?

1974 @ezanet Balove vases PUSH > SAVE LINE #

1975 @e2205* doleoe 40os15 CALL = CRUNCH FCRUNCH THE LINE DOWN

1976 gv2204* vodous av2533"

1977 weeens? oearoe oveenvt

1978 gv220e" eo1veo gerd? nov 8,4 AEC AFTER CRUNCH, (6,C)®CHAR COUNT FOR NODEL
1979 gw2207" @o1eas aoo321 POP 0 RESTORE LINE #

1960 @e221e? evlods oves61 PoP PSH TWAS THERE A LINE #2

1961 eve2at1? aoiove svesee INC GONE IF NOT ITS A DIRECT STATEMENT

1982 @veate? acorn av3370"

1963 ooenve aveeest

1964 * Goieve evosed PUSH oO

1985 ovieo oease5 PUSH B HSAVE LINE # AND CHARACTER COUNT

1966 Gives geese7 CHRGET PREMEMBER IF THIS LINE IS

1987 @oieve gvoses PUSH PSH JBLANK SO WE DON?T INSERT IT

1988 Gez2e220" do1ede avesid CALL FNOLIN GET A POINTER TO THE LINE

1989 weee2i? veouso oves7it

1998 @veeee? eovnoy vvzeret

1991 @e2aes? Boleoe Enso PUSH 8 FSAVE THE POINTER

1992 LENGTH=2, <

1993 geeea4? aoivoo ovoss4 cc DEL> FOELETE THE LINE

1994 @v2ees? doweae o11e71°

1995 veeze’ onenve puaeat?

1996 LENGTHea,<

1997 dnc NODEL NO MATCH SO DON?T DELETE

1998 XCHG 4(D,£) NOW HAS THE POINTER TO THE LINE

1999 }BEYOND THIS ONE

2000 LHLD = VARTAB HCOMPACTIFYING 10 VARTAB

2001 toax 0
2002 StAX B
2008 INx 8
20a INx Dy)
2005 COMPAR
vee ING NLOoP HDONE COMPACTIFYING?

2007 Mov HB

2008 mov ure

2009 INK i NEW VARTAB

2010 SHLD VARTABD>

2011 ove22T? eoivoe evoser NOVEL’ POP. 0 }POP POINTER AT PLACE TO INSERT
2012 weeaso’ deicoo eveser PoP PSW FSEE IF THIS LINE HAD

2013 FANYTHING ON IT

214 @eaesi? deiowa wvosie vz FINI IF NOT DONFT INSERT

2015 eeee3e" vowoan aveeTe’

2016 vv2e3s? vevowe vueees?

2e17 eaees4? voivne evouse VARTAB CURRENT END

2018 veess? oeove Bv1E21¢

2019 902236" aaevee aveese?

even etees/? Bolen Bvos43 F(HyL) CHARACTER COUNT, VARTAB
eoe1 ONTO THE STACK

avee eveeaet evi100e avosa1 418, C) SOLD VARTA

2023 veeedit voivoe ovoe11

2024 eoeadet ovivoa ovos4s SAVE NEW VARTAB

FSHOVING DOWN TO ELIMINATE A LINE

BASIC NCS 698e GATES/ALLEN/DAVIDOFF MACRO 47 (115) 95312 109SEPR7S PAGE BmS
Ac

F3 erSEPRod O3t11 EKRUR HANOLER, REAOY, COMPACTIFICATION, NEW, CLEAR, MAIN
2v25 weeds? velove evasis 29e40 CALL = BLTU

2026 e244? vavarw avewes?

2027 waeeds? Beevne aveess?

aves wveede’ vaiove avos4d 29800 Pur POP OFF VARTAB

2629 veeed7? Belvas avavde 29860 SHLO FUPDATE VARTAB

2030 Yeease? vonage aviezi?

2031 weeesit vnoous aveeaae

2052 veeeset oeluva ovesss 29900 XCHG

2033 vveess? epio ove1ed 29920 nov FFOOL CHEAQ WITH NON@ZERO LINK
2034 weees4? opiowe gvovas 29940 INx 180 IT DOESNfT THINK
2035 29960 HTHIS LINK IS THE

2036 29980 END OF THE PROGRAM

2037 woe25s* voieoe venues 30000 INx

2038 edeese’ oviuae 00521 3a020 PoP GET LINE # OFF STACK
2039 weees7? eoicne evo1es 30040 Mov

2042 woe2ev" duinve evav4s 30060 INK TPUT DOWN LINE #

2041 02261" ve1nde euaee 30080 Mov

2e42 weease’ volnoo ovaeas 30100 INX

24s

2044 aveees? aplove avovat 30140 uxt }MOVE LINE FROM BUF TO PROGRAM AREA
2045 Bv2264" aoeoee ev14si¢

2046 wee26d’ onoous oveeset

2047 ove2b6? weluoe ovuLse 30160 © MLOOPR LDAX SNOW TRANSFERING LINE
2048 3u18@ FIN FROM BUF

2049 woe267? Go1000 avo167 se20a Mov

2050 e227o? boieva evoLas su2eo INK

2051 vee7i’ dv1o00 veoves 30240 INx

2052 evee7e? niove avees7 3v20e ORA ZERO MARKS THE ENO
2053 evee7s' vuicue avesee 30260 INZ

2054 eve274* eoenee aveeoo*

2055 eveaTs? wnoeve wveeod?

2056 wweaTe’ doieee eLosis $300 FINITE © CALL D0 CLEAR & SET UP STACK
2057 veeeT7l? oveane GwedsTt

2058 ve3sou? weavnd oveeTat

2059 30320 ALSO SETS (HyL) TO CTXTTABI “1
2060 eea3sei’ va1vee guavas 30340 INx 4

aver 30360

2uce 30380 CHEAD GOES THROUGH PROGRAM STORAGE AND FIXES

2063 30400 UP ALL THE LINKS, THE ENO OF EACH

264 suuee LINE 18 FOUND BY SEARCHING FOR THE ZERO AT THE END,
2065 30440 THE DOUBLE ZERO LINK 1S USED TO DETECT THE END OF THE PROGRAM
2ve6 So4ee

2067 ebesaet Oeiuoe aumred 30480 OyH #00, E) 5H) L)

2068 02395" Buide Av0155 30500 Mov EyL

2069 v23A4* vo1v0® vEaITE 30520 Mov AM SEE 1F ENO OF CHAIN
2079 o0ases? geile svoe4s 30540 INx x FBUMP POINTER

2071 O8a3vo" deiove ovoeE® 30560 ORA 4 yeND BYTE

2072 owese7’ Ae1000 avOsie 30560 er MAIN 1D0NE

2073 o0e31e? eva Bveies?

2074 oves11* Beeaea eveeTT?

2v75 Bbesie? Bolum BvoL4S 30600 INx FIX H TO START OF TEXT
2076 42515" Belov gvowds 30620 INx

2077 one314" velo ovoe4s 3ve40 INx

BASIC MCS 6086 GATES/ALLEN/DAVIDOFF MACRO 47(115) 93312 10-SEP*75 PAGE B=4
FS Mac 6rSEP@64 S311 EKROR HANDLER, READY, COMPACTIFICATION, NEM, CLEAR, MAIN

2078 002315" Ovioee oveesT $0660 XRA SEARCHING FOR A ZERO IN MENORY
2079 v2316" Meiove gueeTe 3e66e CZLOOP: CHP. 110 MARK THE ENO OF THIS LINE
2060 ovesi7? Or1nes BvoL4s 30700 INK BUMP POINTER

2081 gvesavt oaiuoo wvosve 30720 INE FEND OF LINE

2062 owasei? onveWe Bv2516°

2083 vees2e’ epenve ovasiv?

2064 boeses* YO1vOD 9LOSSS 30740 XCHG SWITCH TEMP

2065 oves24* Oni10ve gvo16s 30760 Mov 300 FIRST BYTE OF FIXUP
2086 oveses’ Bulave weou4s 30780 INX ADVANCE POINTER

2087 gve326" welone avaree 308K0 Mov co) #2ND BYTE OF FIXUP

2068 vwes2/¢ ae10e0 0003553 30820 XCHG AND BACK AGAIN

2069 902330" Baloee aveses sv840 INP ChEAD TKEEP CHAINING TIL DONE
2094 ove331" Opvoee avescer

2091 ovesset eeouee eveseit

2092 30860 IFE LENGTH=2,<

2093 30880

2094 30900 7 SCNLIN SCANS A LINE RANGE OF

2095 30920} THE FORM #-# OK # OR #» OR ## OR BLANK

2096 3094@ + AND THEN FINDS THE FIRST LINE IN THE RANGE

2097 30960 i

2098 002335 we1e0a avever 3096@ © SCNLING LXI 0, SCOvE FASSUNE START LIST AT ZERO
2099 ev2334¢ eeceva avovgee

2100 002535¢ po2eeD ovessi”

2101 002336" oven vases 31000 PusH VSAVE INITIAL ASSUMPTION
216e eees37? Belov gveste S1020 Jz HIF FINISHED, LIST IT ALL
2105 ovas4u? aevnwe gvessat

2104 oeesai? weowed avessar

2105 eees4et Oeiase ovosal 31040 PoP o WE ARE GOING TO GRAB A #
216 ave34s? eeiooe avAs15 31060 CALL LINGET GET A LINE #, IF NONE, RETURNS ZERO
2107 982344" geoaee Bv3642"

2108 G8es45? doavee eLvesau’

2109 ewes4er Bo1oe gvoses 31080 PusH =D SAVE FIRST

2110 Bee347" BeieMe gvaste 31100 sz ONELIN TIF ONLY # THEN DONE,
2111 vvessu’ soovee evesos?

2112 02551 waneee ovesaar

2113 vsesse? ovio0e 0vasi7 3iteo SYNCHK MINUTK JHUST BE A DASH,

2114 e355" Beevow vwesi

2115 evessa? gu1d0a evouer S114@  ALLLSTS LxI D,/SCOLE*+"065529 FASSUNE MAX END OF RANGE
2116 862555? Breede 177771"

2117 @02356" eacaee avesse?

2118 eessT? vice vosed 31160 cnz LINGET GET THE END OF RANGE
2119 ewasev" Beovoe wvsede?

2120 eease1* aedows evesss?

2121 eeesee’ voicoe ovosae 31160 NZ SNERR JMUST BE TERMINATOR

2122 02365 vena dveuTe?

2123 waeseat aeevae ovesout

2124 eases? veiove avosss 31200 © ONELINS XCHG FUH)L) & FINAL

2125 ev2seo" we1oe0 00521 31220 PoP o HGET INITIAL IN (b,E)
2126 vader? aeiove woesas 31240 XTHL #PUT MAX ON STACK, RETURN ADDR TO (H,U}
2127 e9237e* ae1a00 auesas 31260 PUSH HD SAVE RETURN ADDRESS BACK
2126 312800;

2129 31300} FNOLIN SEARCHES THE PROGRAM TEXT FOR THE LINE

2130 31320 } WHOSE LINE # 18 PASSEU IN (D,E), (0,£) 13 PRESERVED,

BASIC MCS 8980 GATES/ALLEN/DAVIDUFF MACRO 47 (113) 05312 108SEP=75 PAGE 8-5
FS Mac brSEPeod 3211 ERROR HANDLER, KEADY, COMPACTIFICATION, NEW, CLEAR, MAIN

2134 31340} THERE ARE THREE POSSIGLE RETURNS?
aise sizeof

2133 313600 3 1) ZERO FLAG SET, CARRY NOT SET, LINE NOT FOUND,
2134 314005 NO LINE IN PROGRAM GREATER THAN ONE SOUGHT,

2135 i420 (B,C) POINTS TO TWO ZERO BYTES AT END OF PROGRAM,
2136 31440 (HL) = (8,0)

2137 31dee

2138 31480 ZERO, CARRY SET,

2139 31500 (8,C) POINTS TO THE LINK FIELO IN THE LINE

2140 31520 WHICH IS THE LINE SEARCHED FOR,

aies 31540 (HyL] POINTS TO THE LINK FIELO IN THE NEXT LINE,
aise 31560

2143 31580 NON@ZERO, CARRY NOT SET,

2144 316Ke LINE NUT FOUND, [B,C] POINTS TO LINE IN PROGRAM
2145 31620 GREATER THAN ONE SEARCHED FOR,

2146 31640 (HL) POINTS TO THE LINK FIELD IN THE NEXT LINE,
2147 3166¢

2148 ov2371" Belen evouse 31680 LHLO TXTTAB 1GET POINTER TO START OF TEXT
2149 @ees7e? Beegny avie17?

2150 902575" eee av2363*

2151 002374" wo1cn9 evain4 31700 mov FIF EXITING BECAUSE OF END OF PROGRAM,
aise 31720 FSET (B,C) TO POINT TO DOUBLE ZEROES,
2155 wves7s? oeieve ave1is 31740 mov

2154 02376" Baivoe wea1Te 31760 ov GET WORD POINTER TO

2155 eee377" velove svew4s 31780 INx FBUMP POINTER

2156 eveage? oelone gaaese 31800 ORA HGET 2ND BYTE

2157 ave4gi* vaiooa oveuss 31820 ocx 160 BACK

2158 eeeaner oaigoo evusie 31800 RZ FIF ZERQ THEN OONE

2159 evades? auidve B00505 31860

2160 veaa4? Bo1000 evo3e7 31880 #PUSH LINK

2161 de4a5? weld 4vOs67 31900 PUSH BINARY LINE #

2162 ee24n6’ welove oveSa1 31920 POP HERE

2163 eaean7? weiovs ovosa7 31940 FCOMPARE (D,E) TO (HyL)

2164 eeeaivt Bolo g00541 31960 IGET LINK

2165 gee4i1? valor gvesed $1980 #GET POINTER TO THIS LINE IN (B,C)
2166 eeeaie? voice ovoETT 32000 C TTURN CARRY ON

2167 42415" velove avBsie 32020 EQUAL RETURN

2168 oee4i4? velo gvovTT 32040 TMAKE CARRY ZERO

2169 aveais? eviews vvnseL 32060 NO MATCH RETURN (GREATER)
2178 Beato? Oo10%e evoses $2080 KEEP LOOPING

2171 Beeai7? Boaeea oves7at

2172 weeaavt vovove vaste?

2373 $2100

ai7a Sseteo THE "NEW" COMMAND CLEARS THE PROGRAM TEXT AS WELL

2175 seiao AS VARIABLE SPACE

2176 e168

2177 owe4a1? Be1000  evosen 32180 SCRATH? RNZ MAKE SURE THERE 1S A TERMINATOR
2178 @eg2e* Boleod avevSe $2200 © SCRTCHS LHLD = TXTTAB

2179 eee4as’ wavowD BBIe1T?

2180 weeaed? Boone gvediT?

2161 Seeeo FN LENGTH#2,<

aibe Seeao RA A>

2183 32200 IFE LENGTHe2,<

BASIC MLS BaBy

FS

2164
2165
2186
2167
2168
2169
2190
2191
2192
2193
2194
2195
2196
2197
2198
2199
2e0n
2201
eeve
2203
e204
2205
2206
2207
2208
2209
eee
eet
eee
213
2e14
2eis
2216
2e17
2e18
2e19
2ee0
eer
2222
2ee3
2ee4
2ees
2226
2227
2228
2229
2e30

Mac

oeegast
woegac?
woeaer?
woeasur
veeasi?
@oeaser
oveuss?
eoeasae
eveasst
Oveasor

eeeasr?
oeeaau?
weeaait
eeeuder

oveuase
ooeagar
ooagase

ev2quer
eeeuay?
eveaser
owe4si?
weeaset
oweass?
eweqsar
eeeuss?
@oeuser
aeeas7?
weeqev?
ooedei?
ew2deet
weedes?
eveaea?
@aaaes?
waedeo?
aoeuer*

BASIC MCS By8

F3

2e37
2238
2839
2e4e
2e4)
2eu2
2e43
2e4g
2e45
2e46
2e47
2e4e
2249
ease
2e51
2ase
2253
2254
2255
2256
2e57
2e58
2259
2ee0
2261
2202
2263
2204
2e65
2266
2267
2208
2209
2e7e
2e7t
eee
2e73
aera
2275
2e76
2e77
2278
2279
2e8o
228)
2ebe
2203
2ee4
2285
2266
2287
2268
2289

Mac

voaa7e?
wvear

woeuTe?
ewe47st
woed7a?

oeea7s?
wearer
ooea77*
eoesaet
eoesai’
ove5aer
ovesas?
eeesaar
eveses?
eaeseo?
woesert
weesiet
ou2511°

oeasier
oge5is¢
woesiat

oeesis?
ooesiet
eeesi/t
weeseot
waesait

wweseer
ogesas?
owesear
ovesas?
eoeser*
woesert

eoessot
ove5si*
oeesser

eoessse

GATES/ALLEN/DAVIDUFF

6rSEPeod OSt11

801000
enouve
epeceo
aeioua
@o1009
ee1poo
veivoe
eetooe
Beveue
egovas

@o1000
e9oev0
eeooog
woioo0

Be1909
eevee
apoove

eeioue
egoven
weovee
201000
200000
eovoee
901000
eveean
ovouse
eo1eee
290000
eoovee
ea1eeo
Corr)
eoveoo
eo1ned
aooove
epee

GATES/ALLEN/DAV DUFF

@e0315
weseas?
evades?
awoier
woovas
oeei6r
avneas
eoovae
oeroai?
ewauee?

ovouse
ourei7?
oveass?
oveuss

geovae
av1eds?
oveaaor

guovse
ge1sas?
oveugat
woovde

ov157s¢
ooeaare
ev0315

aesager
weeuset
aveese

eo1eei?
eveusse
weavde

avrees?
awesoo"
@uvvde

werees?
evades?

OeSEProd OSt11

av1009
@e19e0
wevoee
eeevee
boleeo

oeieee
eeonee
eeovee
eeieoe
eeoeae
egvoae
ee1ee0
eeeeao
aoover
@e1v00
@o1000
aooove
eevee

ae1000
evene
eveooe

@o1coe
agoooa
apoov8
eo1eoe
woieoe

Po10K8
ooecoe
ao1000
eo1eee
aoonae
Bo1ve¢

ee1000
aavone
eaeeva

a¢03e1
avovse
ae1615?
awedoot
owes7i

oooeas
@vissit
avaarer
evovae
@oisare
oveare?
avovas
avouovt?
ovesei?
ooes4s
ovovde
avreis?
avesoar

ooouse
ov1eos?
ooediet

ooevee
eviewi?
ovedist
avese>
ooos11

ovov7e
900077
ev0337
eeaure
weowae
000337

avoses
aeer7e?
awasie?

MaCKO
ERROR

32280

32300
Se3e0
32340
32360
32580

3240
3e4eu
$2440

se400
32480
32500
se5e0
32540
32560
32580
$2600
seeeo

32040
se600

32680

32700

saree

3er4o

se7e0

se7ee
seaue
sese0
$2840
32800
52860
32900
32920

MACKO
ERROR

32940
$2960

32980
33000
33020

33040

33060

33060
33160

33120
33140
35160

33180
33200
33220

47413) asti2
HANDLER, READY

CALL

Mov
INK
Mov
Nx
SHLO

LENG
RNZ>
LHLO

ocx

1OeSEP*75 PAGE Bn6
» COMPACTIFICATION,

TOFF>

MA
4
Mya
4

VARTAB

THy<

TXTTAB

4

NEW, CLEAR, MAIN

TURN OFF TRACE, SET (A) =O

HSAVE AT END OFF TEXT
}BUNP POINTER

FSAVE ZERO

}BUMP POINTER

INEW START OF VARIABLE

FCHECK FOR A TERMINATOR
WPOINT AT THE START OF TEX.

T

CLEARG 18 A SUBROUTINE WHICH INITIALIZES THE VARIABLE AND
ARRAY SPACE BY RESETING ARYTAB (THE END OF SINPLE VARIAULE SPACE.
(THE END OF ARRAY STORAGE), IT FALLS INTO STKINI

AND STREND
WHICH RESE

i

IFE

CLEARCS SHLD

IFN STRI

LrLD

SHLD

CALL

LKLO

SHLD

SHLO

STKINI
Gosua & FO
UP, SUBFLG

OF THE STA

47 (413) ost1e
HANDLER, READY

STKINI: POP

LALD

SPHL

TS THE STACK, (H)L:

STRING, <CLEART>

TENP

NGy<
MEMSIZ

FRETOP>

RESTORE

VARTAB

ARYTAB

STREND

R CONTEXT,

1S RESET,

CK, (A]#@ AND (0,6)

1O2SEP=75 PAGE 6-7
» COMPACTIFICATION,

8
STKTOP

STRING, <

xr

SHLO

UxI

PUSH
LENG

LPTs!
CALL.
LHLO

LENG

Hy TEMPST

TEMPPT>

H, SCOVE

4

TH, <SHLD — OLDTXT>

Wee
FINLPT>
TEMP

THr<

CONTRW, <xRA A>

STA
Push
RET

GINLING HVT

SUBFLG>

Aya"

OUTCHR

MI

OUTCHKR

STRING, <CALL

INK

STRING, <JMP

ALL "RESER:
BYTES WITH

INLIN

He
INLIN>

veo"
THE NSB ON,

IS PRESERVED,

SAVE CHyL) IN TEMP

FFREE UP STRING SPACE

FRESTORE DATA

FGET START OF VARIABLE SPA!

FSAVE IN START OF ARRAY SP.

VAND ENO OF VARIABLE STORAI

RESETS THE STACK POINTER ELIMINATING
STRING TEMPORARIES ARE FREED
CONTINUING IS DISALLOWED,

AND & DUMMY ENTRY IS PUT ON THE STACK,
FNOFOR WILL ALWAYS FINO A NON@"FOR™

THIS IS SO
ENTRY AT THE BOTTOM
IS PRESERVED,

NEW) CLEAR, MAIN

GET RETURN ADDRESS HERE
{yb} POINTER TO ENO OF MI

FINITIALIZE STACK

FINITIALIZE STRING TEMPORA!

}PUT ZERO (NON NEXT, FOR,

FON STACK
FMAKE CONTINUING ILLEGAL

HGET SAVED [HyL}

FALLOW SUBSCRIPTS

}PUT RETURN ADDRESS BACK 0}
#60 BACK

GET A GMARK

TYPE 11
SPACE

TYPE It TOO

FIN THE NON@STRING VERSION:
FINPUT I$ CRUNCHED

GET A LINE OF INPUT FROM
HNO CRUNCHING IN THIS CASE

WORDS ARE TRANSLATED INTO SINGLE
THIS SAVES SPACE AND TINE

BY ALLOWING FOR TABLE DISPATCH DURING EXECUTION,
THEREFORE ALL STATEMENTS APPEAR TOGETHER IN THE

RESERVED WORD LIST IN THE SAME

ORDER THEY APPEAR IN IN STMDSP,

RUNCH? IFN

STRING, <

ce

ACE

Ge

EMORY

RIES

GOSUB TOKEN)

N

8 ALL

1Ty

Ba
FS

Ba:
FS

sic

sic

asus
e344
2345
2546
2347
2348
2349
235e
2351
2sse
2353
2354
2355
2356
2357
2358
2359
23seu
2501
2302
2363
2564
2365
2566
2567
2368
2369
23570
2571
ase
2373
2374
2375
2376
2377
25768
2379
ase
2381
asee
2563
2564
2365
2366
e367
2388
2369
2590
2391
asse
2393
2394
2395

NCS 6080
mac

owesss*
ooassar
eeessot
woessor
ovassrt
avesaut
woesait
ovesuet
ovesast
evesaat
ovasast
guesdet
owesart
wwesset
wvessit
owesset

evessst
owessat
@ee5sst
oeesset
evess7¢
ave5eo"
ooese

ovesce?
eeases?

aveseae
aeeses*
woeseot
wveser?
ooesTor
oees7it
oeestet
eues7se
woes74e

ooes75"
ovesrer
oees7i*
ove2eau?
oveoni?
eoeege?
weeons?
ea2enae
oveeas?
aveegor
oveoas?
ooeeiet
woeeiit
oveore?
oeois?

MCS 8980
mac

woe2o14?
eeeeis?
ooe616°
oveotit
oveoiie

oaeeeut
oveoait
oveseet
weeoes?
ovesaat
woeoes?
oe2o2et
oeeoal?
eo2oser
oveesit
wueeser
ee2e3st
oveesa?
o42635°
ow26se"
weee37¢
@aeo4ut
weeedi?
wweedet
weeeas?
aveogae
eeeease
o62640"
woeoart
eve6sut
eweesit
oveeset
oveess?
eveosat
@v2655°

wveese’
oveesi*
oweeoet

ou2oe1"
oveseet
wueses?
oneeeat
wweees*

weecee?
weesort
wez67a"
eueerit

GATES/ALLEN/DAVIDOFF
6mSEPe64 OSt11

@e1000
eo1000
aoovee
eeeuee
ee1eae
eevouw
be1vee
eevooo
eovour
aeieae
Be1e09
aeeane
e109
eaveoo
eeoeao
eei1o0e

ovees?
owavee
@eis4at
apessit
aveele
aveuns
eoovel
oo1asit
aeessst
eoni7e
900376
avooae
owosie
ae2ce7?
avedaet
wveier

@a10v0
aeevuo
eeieoe
aeovne
eeeevo
ieee
eaio0e
eeevae
eoeeue

ewos7e
eoovge
ooosie
owerer?
owesse?
eueeo?
gvasie
owarss?
evesser

ea1aee
evereo
eeovve
eaieve
Bei1e0o
ee 1090
eeiove
eoeove
enae0o

eooere
geis4ae
oversee?
oevee?
geoie7
ova176
euasee
ew2ce7?
ew2ses?

01000
epe000
eo1eee
evevve
eo1pe0
eoeove
eoevve
ve1eoo
@01000
aveveo
Be1vee
avecan
eoavee

1008
eaveoe

000376
evae7?
eeevTe
gveesi
eeosie
ae2cer?
eves7s*
ewoi7e
avasTe
aeoeee
@vesse
eveoire
av2ove’
avesTe
eeou74

GATES/ALLEN/DAVIDOFF
brSEP64 OSt11

@o1000
eoonve
eoonee

evasse
ew2ce7*
aeeoiue

@e1eve gvesas

opi10ee
aevaeo
oeevue
@o1e00
eeieoo
@e1e00
@oi900
@01000
voieeo
eevee
eoievo
Boeove
aevove
91000
oo1eve
aoone0
oovoee
91000
eo1eve
ao1eve
eoovea
aovvoe
ao1e00
eviceo
eeivae
eeeneo
@e1000
aioe
eei1co0
Goleve

evover
oeei7ie
woe2ois?
aeosas
900076
eeoser
euoves
nevese
ovesue
000177
gvasie
ovee5st
oveeai’
gove7e
evesee
owe7se*
ee2esst
oeaese
geaee?
ovesee
ow2ves?
eweo3r?
00361
@ovi70
wveseo
euoeou
wwesee
ovesa1
owei7e
weasel

oei1eee
voreoo
eeeeeo

awnsss
aeesTe
auvees

aei0e0
eeeovo
eeieeo
aevoun
vevovn

@eavee
eove7e
avesia
genvevs
aveoau?

@o1eoo
@o1000
801000
oe1000

ovasss
euauas
ooovee
auoves

MACRO 47(115) 05112 10-SEP*75 PAGE Bb

ERROR

33720
33740

35700

$3780

33800
33820

33840

33800
$3880
33900

33920

$3940
53908

33980
34900

s4oe0
Sana0
34000
34080

34100
34120
s4140

34160

34180

34200
34ee0

saeua

34260

MACKO
ERROR

34280

34300
34520
34340
34360
34360

34580
34600
$4620

34040
34660
34680

$4700
34720
3a74e
$4760
34780
34a00
34820

34840
34860

34880

34900

s49e0
34940
34960
34980

HANDLER,

IFN

47(443) 0
HANDLER,

MUSTCR?

IFE

NXTRES?

RESER?

TABEND?

IFE

STUFFH?

READY, COMPACTIFICATION,
XRA A
STA DORES>

MVE c,5

LxI 0, BUF

AyM

wz STUFF

Mov ByA

crr 34

rd

RA A
rd CROONE

STRING, <

Loa DORES

ora
Mov
Moy
INZ

LENGTH, <
CPL Lt)

MI A, PRINTK

wz STUFFH

AyM
non

MUSTCR

St12 1USEPH75 PAGE 5-9
READY, COMPACTIFICATION,

yc STUFFH

>
PUSH oD
STRING, <
MVI
xr

ByO>
D,RESLST=1

PUSH oH
xHO *01000,7076
CHRGET

INX 0

Loax 0

ANI 1e7

rd TABEND

cHP
JNZ

Loax >
ORA ry
uP NXTRES.

PoP
MOV
ORT

PSW
Ane
128

XwD
PoP
Moy Aum
POP 0

LENGTHe2,<
XCHG
crr

*01000,70562
4

ELSETK

MI

cz INKHRT ER

NEW, CLEAR, MAIN

FALLOW CRUNCHING

HCOUNT OF CHARS AT LEAST 5.
}SETUP DESTINATION POINTER
GET CHARACTER FROM BUF

HIS IT A

HYES,

GET A CHARACTER FROM THE LINE
QUOTE IF IT IS A STRING

}SETUP B WITH A
HQUOTE SIGN?

TYES,

END OF LINE?
FYES, DONE CRUNCHING

HIN DATA STATEMENT AND NO CRUNCH?

FINITIALIZE RESERVED WORD COUNT

WGET THE CHARACTER AGAIN
VIF NO CRUNCHING JUST STORE

TTHE CHARACTER
NOT FOR GK VERSION
TA GMARK?

TTHEN USE A "PRINT" TOKEN

HSKIP NUMERICS

FSINCE CRUNCHING 1S SLOW

ALSO PUT IN QUICKLY

NEW, CLEAR, MALN

HSAVE STORE POINTER

FINLT RESERVED WORD COUNT
FINIT TO RESERVED WORD LIST

FSAVE IN BUF POINTER
VHVI" ARGUND CHRGET
GET CHAR FROM LINE
FBUMP OEPOSIT POINTER

GET A BYTE FROM RESERVED WORD LIST

}GET RID OF SIGN BIT

FEND OF RESERVED WORD TABLE

TWO
INO,

CHARS THE SAME?
OIFFERENT

FGET RESERVED WORD BYTE
HSET CONDITION CODES
VIF SIGN SET,

TAKE OFF GARBAGE ORIG POINTER

GET RESERVED WORD #

FSET HSB TO FLAG AS RESERVED WORD

auee
GET BACK ORIG POINTER
}GET BACK ORIG CHAR

}GET STUFF POINTER BACK

(Hy L)SSTUFF POINTER
HHAVE TO PUT A HIDDEN

HCOLON IN FRONT OF
FSTORE IT

MELSENS

TADVANCE POINTER ON "ELSE

480 ONLY ON "ELSE"

4 (0) E) 8STUFF POINTER
ENTRY TO BUMP [H,L

SAVE CHARACTER IN CRUNGHED LINE

FBUMP SAVE POINTER

SPACE WE WANT TO SAVE

STUFF IN DESTINATION LINE,

GO 10 SPECIAL STRING HANDLING

RESERVED WORD FOUND

AROUND THE POP H AND MOV AyM

THE COLON 1S NOT OVERWRITTEN
BASIC MCS 8080 GATES/ALLEN/DAVLDUFF MACRO 4/(115) 05312 1UmSEP=75 PAGE 8-10
F3 MAC OrSEPRod 05:11 ERROR HANDLER, READY, CUMPACTIFICATION, NEW, CLEAR, MAIN

2596 ovaeTe? Beleve vuou14 35000 INR c FBUNP CRUNCHED CHARACTER COUNT
2397 35020 FN STRING, <

2398 ov2e75¢ oalewe avaSe6 35040 Sul " WSEE IF IT IS A COLON
2399 ove674? aaveea ovguTe

2400 Bo267d? BeleeD veESIe 35060 4 VIF SO ALLOW CRUNCHING AGAIN
2401 ovee7o? oneena gvarast

2402 gv2677" BeavPY ovebbae

2405 wsergo’ eaipee oves7e cpr

2404 wee701" Gove B~O111

2405 verde? 1000 Buesae JN NoDaTT #SEE IF IT 18 A DATA TOKEN
2406 02705" eevee eerie?

2407 ou2704? dooowe aveo7e?

2406 902705¢ aioe eoLee COLIS: STA bores FSETUP FLAG

2409 eve7d0? oon Bu1544?

2410 wveTa7? eeeoee gweTos’

2411 eve710" evinee euasee NODATT? SUI RENTK="3 ">

2u12 wveri1i* eaovve avoied

2413 Ire STRING, <SUL REMTK> JWAS IT A REM STATEMENT
2414 oe2712? Belews wwOsee JNZ KLOOP KEEP LOOPING

2415 eve71s? peeve gvadaar

2416 oee714" weeeME aveToe*

2417 wveri1d? waiovs evaier mov BA JREM DOESN‘T STOP ON "3", ONLY ON A ZERO
2418 e271 Boleve avA17e Mov Ay GET A CHAR

2419 v2717? voiove eeazer ORA ry }SET CONDITION CODES

2420 wveTev? vivo 90512 rd CRDONE VIF END OF LINE THEN DONE
2421 092721 vowove evarss?

2422 eveTae? oowove aveT1s*

242s ees? vpivve eeveTo cmp 8 END OF GOBBLE

2dea geaTad? Oo1eeo avesie JZ HIF YES, DONE WITH STRING
2ues woeven avebor?

2426 @oveve wverai®

2ue7 7 Beieoe avov4s STRNGS FINCREMENT TEXT POINTER
2428 Beiene evevee STORE CHAR

2429 @ei1v98 evowrs #BUNP COUNT

243@ oveT3et Bolewe avoves TAND POINTER

2431 002735" oaieeo geases SKEEP LOOPING

2432 02734" wveev0 abeTie®

2433 vv273>" Bevead owveTart

2434

2435 voe2736" Holove avasa1 NTHISE FRESTORE TEXT STRING

2436 ve73/" Belav0 goasad FAND SAVE IT BACK

2437 oveTao? Boieue auovos FINCREMENT RESERVED WORD #
2438 ove741" waives 940555 FRESLST POINTER INTO [H,L}
2439 ave74e? Bpleae eeoece NTHISA HTEST BITS IN RESERVED WORD LIST
2440 82745" epivee BeBL4S

2441 ove744* veined aBLvesce SKIP MORE

24a2 ee74s? ecovoe weerdet

2443 gwe74e" vovews wwe734*

2444 euve74r? dolowe Bve35S PRESLST POINTER INTO (0,6)
2445 TEXT POINTER INTO (H,L)
2446 av2750" oles avOses HDONE, MOVE TO NEXT RESERVED WORD
2447 vee751* Bveeve oveoa2T?

2448 wweTse? eevove vueTad?

BASIC MCS 898 GATES/ALLEN/DAVIOOFF MACRO 47(113) @5212 10-SEPe75 PAGE Beit
F3 Mac brSEPmod S511 EKRUR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN

249 082755" volooe evoLuaL 35640 © CROONES LxI 4) BUFMIN LEAVE WITH (HyL) POINTER TO START OF LINE
2450 eve2754* Goeere v14s0"

2451 92755" gevave ave7si?

2452 ave7se* saivoo ovooze 35600 STAX NEED THREE Q*S ON THE END
2453 02757" Belove aveves $5660 INK FONE FOR END=OF*LINE

2454 av276v" oaicon voeze 35700 STAX VAND 2 FOR A ZERO LINK

2455 Bee761" voleo avoves 35720 INx SINCE IF THIS 1S A DIRECT STATEMENT
2456 wweree’ velaue avovee 35740 STAX FITS END MUST LOOK LIKE THE ENO OF A PROGRAM
2457 eee765* BaleeD Gvesi1 35760 RET END OF CRUNCHING

2456 35780

2459 35800 THIS IS THE LINE INPUT ROUTINE

2460 35820 11 READS CHARACTERS INTO BUF USING , AS THE

2461 35840 CHARACTER DELETE CHARACTER AND @ AS THE LINE DELETE CHARACTER
2462 35860 IF MORE THAN BUFLEN CHARACTER ARE TYPED, NO ECHOING

2405 35860 IS DONE UNTIL A, @ OR CARRIAGE*RETURN IS TYPED,

2464 35900 CONTROL*G WILL BE TYPED FOR EACH EXTRA CHARACTER,

2465 35920 THE ROUTINE IS ENTERED AT INLIN

2466 35940

2467 GweTe4? we1dH AveweS 35960 LINLIN? DCR 8 BACK ARROW SO DECREMENT COUNT
2468 wve7es? veieve 00055 35980 Dex H BACK UP POINTER

2469 3eao0 IFN REALIO,<

2470 wweTe®? we10ve ovoS37 3e0e0 OUTCHR>

2471 gve767" Belowe ovosee 3e0ua INZ INLINC #NOT TOO MANY SO CONTINUE

2472 902770" GeoeeH ev3vOS*

2473 eve771" auevee eve7sa"

2474 ovarre? 5606@ — INLINNE IFN REALIO,<

2475 ova7Tet voiove 04537 So080 OUTCHR> PRINT THE @, OR A SECOND , IF THERE
2476 36100 AWERE TOO MANY

2477 992775" Geieoo ev0515 Soieo CALL = CROO TYPE A CRLF

2478 wwve774t aodoae ao4ses?

2479 weeT7s* Baveoe weerror

2480 weeTTe* eoloee Lover Se14@ INLINE XI 4 BUF

2461 eve777" Booeed e1431°

2482 eesaov' wooee everTat

2483 3001" Baiewe Bvovo So160 WI byt #CHARACTER COUNT

2484 eo3ae2" vevooe evover

2485 e505" Bo1vve weasis 3e18d — INLINC? CALL INCHR FGET A CHARACTER

2486 eesoa4* oaveee 65126"

2487 @esoas* auaove weerz7*

2468 Se182 ‘ LENGTH, <

2489 eoSoaet ovi000 evaSTe Se1ed cer 7 F1S 17 BOB AL@RECHT RINGING THE BELL.
2490 3007" aeecve aveveT

2491 3010" opiove weosie 36186 Pra GooocH> FOR SCHOOL KIDS?

2492 05011" oeowe evsuaat

2493 vvsoiet ovaen0 wwsvedt

2494 05015" Bv1nve BvOSTE crL 13 IS 1 A CARRIAGE RETURN?

2495 eesa1ae vegove  aveu15

2496 083015* Ov1000 avasie Je FININL HIF SO FINISH UP

2497 GoSa16" ewonG Bvasie?

2498 e317? Beeove avseii?

2499 evse20" ovieve Bv0S76 cr 32 FCHECK FOR FUNNY CHARACTERS
2500 we3e2i" eevovn ovoe4e

2561 03022" wolves avasse ae INLANC

BASIC NCS 8960 GATES/ALLEN/DAVIDOUFF MACKO 47(115) 05412 1@=SEP=75 PAGE Om12
FS mac 6rSEProd USE11 ERRUR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN

be3925* oovewn vesvast
wose24* enaeve ovsuie*
@e3e25* voile evasTe Se280 4 125
oe3eae* enon e175
eesver* oigou avasee 30300 INLING #bIG ONES BAD TOO
e03030" evo oUvsuOs*
#03031" acvo ovsves?
@usa3e" Cnieue BuesTo 36520 c nen HLINE DELETE?
003035" onooee eeoiee
003034" doles eeosie So340 INLINN
@03035* oovoee gveT7er
@2330" BoupeE B3v30"
803037" aoivo8 Beas?o $6500 ae TCHARACTER DELETE?
@@5a4v' epevee 9ve137
023041" ep1e09 evesie 30360 LINLIN
wesade? Goooeo avered?
@e5e45* Booed Bu3e35°
wese4a4? aoiua wort! 36400 GOOCH: cya
@@3045* Go1gea weoiTe Soded Ay8
@83046" ovine BeLsTe 3ea4g BUFLEN
205047" oouen wweiie
885050" Golone aueLTe Sedo ay? GET A BELL IN CASE LINE TOO LONG,
e351" Booed avave7
oesset ooiess wevsee 3e480 FLINE TOO LONG, RING BELL,
be3053" wove vesvort
@a5054" Bovves wesvder
083055? Buiged va171 36500
ee39S5e" deioge Be0161 30520 Mov FSTORE THIS CHARACTER
903057" ool evov4s 36540 INK
@@3960" woiove evoved 50560 INR
@e3061° 36560
30600 REALIO,<
883061" waived 9vO537 30620 OUTCHR>
8e396e" olvee wLepsas See4e JMR INLING
Be3n65? Onda ae3va5"
ba39e4" apvveo aesusst
oasoes* $666 OUTCONt
$6680 IFN CONTRK<
Be3965¢ Bole avasvE 36700 NZ PPSWRT> #NO, DO OUTPUT
besee? apogee e19ved"
903067? BeanGe ab3sue5°
3e720 REALIO,< WMITS 170
30740 LPTSW,<
30760 Loa PRTFLG #SEE IF WE WANT TO TALK TO LPT
50780 OKA a HTEST BITS
36800 JZ TTYCHK VIF ZERO THEN NOT
Se8ee Psw GET CHARACTER WE WANT TO PRINT
$6840 Pw
36860 13 FIS IT CARRIAGE RETURN?
56860 PRINTH }PORCE OUT A LINE
36900 PPSWRT HIF FUNNY CONTROL CHARACTER (LF) DO NOTHING
30920 LPTPOS TWHERE ARE WE?
30940 LPTLEN AT THE END?

BASIC MCS 8980 GATES/ALLEN/OAVIDOFF MACRO 47 (113) 03412 10=SEP%75 PAGE 8-13
F3 NAC ORSEPRO4 OS314 ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN

2555 36960 Nc PRINTW YES, START OVER
2556 36980 INR A
2557 37000 STA LPTPOs

2558 37020 LPTWAT? IN 2

2559 37040 2

2sep 37060 JZ LPTRAT

2561 37080 POP PW

2562 37100 out 3 FSEND OUT CHAR

2565 37120 RET FRETURN

2564 37140 PATLPT? BLOCK 20

2505 37460 FINLPT? XKA ry PRESET PRINT FLAG SO OUTPUT

2566 37180 STA PRTFLG #GOES TO THE TERMINAL

2567 37200 Loa LeTRos SEE IF ANY LEFTOVERS MUST GE
2506 37220 Ona ry FORCED OUT

2509 37240 RZ }BY LOOKING AT LPTPOS

as7e 37260 © PRINTW: IN 2 {MAKE SURE LAST PRINT

2571 37280 ANI 2 FINISHED 8Y TESTING DONE

eo72 37300 Je PRINTH 46IT

e573 373e0 7 SEE If BUFFER MUST BE EMPTIED

2574 37348 Loa LeTPos

2575 37300 ORA ry FCHARACTERS IN THE BUFFER?

2576 37380 NZ PRINTR VIF SO OON*T CLEAR THE BUFFER
2o77 37400 MI And FOTHERWISE BUFFER MUST BE EMPTIED
2578 37420 our 2 FCLEAR THE BUFFER

2579 37440 7TO PRINT A BLANK LINE

ase 37460 PRINTK? MVI Ant FTELL LPT TO PRINT

2561 37480 our 2 STATUS REG

2562 37500 ocr ry FAD SO

2563 37520 STA LPTPOS FRESET LINE PRINT POSITION

2564 37540 RET>

2585 wasa7ue 37500 TTYCHRE>

2586 37580 IFN STRING, <

2567 b030Tv" woleve vuoS61 37600 Pur Pow GET THE CHARACTER

2588 Be3071" eeleoe wvosed 37620 PUSH PSH JAND SAVE IT AGAIN

2589 BvSe7e? Mvluee BveSTS $7640 CPI 3e HIS THIS A MEANINGFUL CHARACTER?
2590 005075" eeeove voovae

2591 ousu7a* wolaee wuusse $7660 we TRYOUT> IF IT?S A NON*PRINTING CHARACTER
2592 wosu7S* BoneDe Ovsi15°

2593 3076" wuooee wusvEb"

2594 37680 WOON*T INCLUDE IT IN TTYPOS

2595 37700 LENGTHICONTRWILPTSH,<

2596 e35077" Buiowe avoLTE 377ee toa TryPas> SEE IF PRINT HEAD IS AT THE END OF THE LINE
2597 05100" aoooue eoudT?

2598 so3iv1" eoevee ousu75t

2599 37740 crr LINLEN PMODIFIED BY "TERMINAL WIDTH?" QUESTION IN INIT
2608 ovsi9e" Yo1voe oLOSTo

2661 405105" Baveor  ove110

2002 ou3i0s" oy

2603 B03104" Boluve wuosia FTYPE CKLF AND SET TTYPOS AND (Al=0 IF SO
2004 03105" oadoou

2605 003106" Boone

2686 03107" Boives wone74 FINCREMENT TTYPOS SINCE WE*RE
2007 FGOING TO PRINT A CHARACTER,

BASIC MLS 8980 GATES/ALLEN/DAVIOUFF MACRO 47(113) O5812 10*SER@75 PAGE Ba14
FS mac brsePeod 3311 ERRUR HANDLER, KEADY, COMPACTIFICATION, NEW, CLEAR, MAIN

983110¢ ovivee eoovee $7840 STA TTyPOS FSTORE NEW PRINT HEAD POSITION
003111 Begone geovaT?
@asi1e* woovea si05°
wesi1s¢ 37860 TRYOUT?
37880 IFN REALIO,<

003115 Ooivee aeesss 37900 NOPRIN IN a #GET STATUS
005114" Coe aeover

oesisae 37920 }CONSOLE COMMAND CHANGE
003115 Gvies evesde $7940 OvONE 70K TO SEND CHAR
be3116" eooeae avaedw
083117" Goivee wveasce 37900 NOPRIN> FKEEP LOOPING
@e3120" eovoee 3115°
@e3i21° aouee esili*
evsi2e" opines ease1 37980 Pow }GET CHARACTER BACK
603125" dole eveSse5 38000 out TTOCHN VSEND OUT THE CHAR
O03124¢ Beene svov~L

wesiedt Se020  CNLCB1=2,01 FCONSOLE COMMAND CHANGE
gesias* Ouiaoo evasil 36040 RET FRETURN FROM OUTCHR

besiaoe 38100 INCHR: IFN REALIO,<
we5120% auioue 60s35 38120 TRYIN: IN e
oesi27* Boone evaeod

owsiert se14a oc FCONSOLE COMMAND CHANGE
003130" weasae 36160 IDONE Fest BIT
oa3si3i¢ ovovel
eo313e" O avvsee 38180 TRYIND 760 BACK & DO IT AGAIN
603135" eovave oeS126°
003134" Beovre Besievt
005135" Beige B9as3s 38200 TTICHN GET A CHAR
@e313e* donee Buavel

ae5136° seaeo HCONSOLE COMMAND CHANGE
083137" Oeivue eLvas4e se24e ANI 1e7 1GET RID OF PARITY BIT
093140 aaoooe eeaiT?

GET STATUS

Se26e CONTR, <
003141" Beiveo douse 36260 CPI CONTW 118 IT SUPRESS OUTPUT?
003142" Bevove veovi7
803145" watooe ovaseo 38300 RNZ
903144" eoiede ovgeTe 36320 pa CNTWFL
03145" apedve veiDdait
Qv3140" Bovend ovs135°
05147" we1ova avevs? 38340 cna }COMPLEMENT ITS STATE
03158" Bo1000 weovoe 38360 STA CNTWFL> TSAVE BACK
903151 Bovev0 oe1d4i?
@o315e" veveve 00514
©5155" Be1aee vosi1 $6380 RET
38400

MCS 8080 GATES/ALLEN/DAVIOUFF MACRO 47(113) @5312 10SEP@7S PAGE 9
hac 6eSEPeod SELL THE "LIST™ COMMAND

38420 © SUBTTL THE "LIST" COMMAND.

38460 IFN LENGTH=2,<
$8480 IFN LPTSW,<

$8500 =LLISTs MVI At GET NON ZERO VALUE

3e520 SIA PRTFLG> TSAVE IN 1/0 FLAG

3e54@ LIST: CALL = LANGET HGET LINE NUMBER INTO [0,E)

38560 RNZ FNUST BE A TERMINATOR OR ERROR
38560 PoP 8 FGET RID OF NEWSTT RETURN ADDR
38600 CALL = FNDLIN FIND LINE GREATER THAN OR EQUAL TO
36620 PUSH 8B FSAVE START POINTER

38640 ror 4 GET POINTER TO LINE

586600 PUSH 7PUSH LINK

58680 Por cy TTAKE OFF FOR A SECOND

3870e Mov Aye EE IF ENO OF CHAIN

seree ORA c

36740 rd READY

58760 LISTEN <

38760 CALL oISCNTC> TCHECK FOR CONTROL=C

38800 PUSH B 7PUT BACK ON

38820 CALL = CRDO #00 CRLF TO START guT

36840 PUsHM }PUSH LINE #

36860 XTHL GET LINE # INTO (H,L)

36888 FAND WE WANT (HyL) ON THE STACK
38900 CALL LINPRT FPRINT AS INT WITOUT LEADING SPACE
38920 MVE Yi

38940 PoP 4 JRESTORE POINTER TO START OF TEXT
38960 OUTCHR FALWAYS A SPACE AFTER THE LINE #
38980 Mov 4M GET A CHARACTER FROM LINE,

s9000 ORA A HIS IT A RESERVED WORD

9020 INK 4 FINCREMENT POINTER INTO TEXT
39048 vz Lista FZERO, END OF LINE, GET NEXT LINE
39060 JP PLOOP FREGULAR CHAR, JUST PRINT IT
39060 sur 1e7 HGET RIO OF SIGN BIT AND ADD ONE
39100 MOV ary GET RESERVEO WORD # IN C

39120 PUSH oH FSAVE CURRRENT POSIT

59140 xT D,RESLS1 HGET RESLST POINTER,

39160 RESKCH: PUSH =O SAVE

39180

39200 © RESCR1: LDAX HGET CHARACTER FROM RESLST

s92e0 INK FBUMP RESLST POINTER

39240 ORA TEST BITS

39268 Jp ESCRI INOT AT ENO OF RESERVED WORD YET
39260 ocr }DECREMENT CHAR

39300 PoP JPOP START POINTER HERE

39320 INEZ RESRCH }NOT AT END OF RESLST YET,

$9340 HERE WHEN FOUND RIGHT RESERVED WORD

39360 © PRIT3: MOV AyM GET A CHARACTER FROM RESERVED WORD
39380 ORA ry SET CONDITION CODES

39400 aM PRITG

39420 OUTCHR

39440 INx 4 FBUMP RESLST POINTER

39460 MP PRITS> PRINT THE REST

BASIC MLS V8 GATES/ALLEN/DAVIDUFF MACRO 47 (113) 03312 10°SEP®75 PAGE Ont
FS mac OrSEPmod OSE THE "LIST" COMMAND.

2708
2709
a7ie 39520 © PAGE

BASIC NUS 6980 GATES/ALLEN/DAVIDUFF MACKO 47(113) 05312 109SEPR75 PAGE 10
F3 mac brSEPeod OSt11 "POR® STATEMENT

271 39540 SUBTTL "FOR" STATEMENT
erie 59568

2713 39580 NOTES

ena 39600

271s 39620 A FOR ENTRY ON THE STACK HAS THE FOLLOWING FORMATE

e716 39640

anny 39680

2716 39700 LOW ALORESS

2719 39720 TOKEN (FORTK IN HIGH BYTE) 1 BYTE

2720 39740 A POINTER TO THE LOOP VARIABLE 2 BYTES

azar 39760 A BYTE REFLECTING THE SIGN OF THE INCREMENT 1 BYTE

aree 39780 THE STEP 4 BYTES.

27es 39800 THE UPPER VALUE 4 BYTES

27e4 39820 THE LINE # OF THE "FOR" STATEMENT 2 BYTES

ares s9a4e & TEXT POINTER INTO THE "FOR™ STATEMENT 2 BYTES

2726 39860 HIGH ADDRESS

27e7 39880

2728 39900 TOTAL 16 BYTES

27e9 39920

2730

2731 g03154° 39960 FORE IFN LENGTH, <

2732 05154" va1eee avov7e 39980 MVE Ay100

2733 003155* easooe vooia4

2734 003156" Bp100e svavEE 4vov0 STA SUBFLG> HDONT RECOGNIZE SUBSCRIPTED VARIABLES
2735 03157" oveowe Boleait

2736 03160" Bveoee gu5151°

2737 05161" wpivee gb0515 4eoeo Let FREAD THE VARIABLE AND ASSIGN IT
2738 903162" Bagove eo4isi*

2739 905165" wooeee ob5157"°

27ap 4oa4e HTHE CORRECT INTIAL VALUE

2741 40060 VAND STORE A POINTER

ar4e 40080 1TO THE VARTABLE IN (TEMP)

2743 005164" Boieee ovOS4s 40109 HSAVE TEXT PTR ON THE STACK

2744 003165" weleee Bue515 aeiee FNOFOR PMUST HAVE VARIABLE POINTER IN (0,E)
2745 003166" @oaeen avisas?

2746 oos167" vaeere ovsibet

2747 g03170" woleue ovoseL ae1ae 0 F(D,E)#TEXT POINTER

2748 B03171" Bpieee Bvas0e apiee NoTOL VIF NO MATCHING ENTRY, DON?T
2749 wo3172" @-vnEe Gv3176°

275@ 005175" wovuve Bo31b6°

2751 aa1ee FELIMINATE ANYTHING

2752 405174" wolveD ovevIL 4e209 TIN THE CASE OF "FOR

2753 4o2eo HWE ELIMINATE THE MATCHING ENTRY
2754 aveaa FAS WELL AS EVERYTHING AFTER IT
2755 B0517d¢ apieee BvasTL 4o260 100 THE ELIMINATION

2756 4ee8o HSINCE A MATCHING ENTRY WAS FOUND
2757 003176" woigve gevs5s 4e3e@ = NOTOL: FU) LI STEXT POINTER

2758 003177" Beleee ove515 ao3ee

2759 ovsen0" epeove Bveved*

2760 Bosemit Cowper awsiTer

2761 vesave’ epeuee Boovie 40340 FAKE SURE 16 BYTES ARE AVAILABLE
a7ee 40560 FOFF OF THE STACK

2763 ou3e05* Onlewe Govs4s 40380 TREALLY SAVE THE TEXT POINTER

BASIC MCS B96U GATES/ALLEN/DAV1DOFF MACKO 47(113) 95312 10SEP=75 PAGE 1091
FS Mac GrSEPeod OSt11 "FOR" STATEMENT

2764 wosav4? de1o0e avesi5 4vavo CALL DATA FGET AN ChyL} THAT POINTS
2765 903205" wavavn ge4uTe?

2766 Gosane* devove v3z0v"

2167 4oaae FJUST BEYOND THE TERMINATOR
2768 e03207" wplume gwosas 4gaaa XTHL HPUT [HL] POINTER 10 TERMINATOR ON THE STACK
2769 4g4eu TAND RESTORE (HyL] AS TEXT POINTER AT
2770 4o4ea IVARTABLE NAME

2771 ov3aiv' Bleed oves4as 4osve PUSH PUSH THE TEXT POINTER ONTO THE STACK
2772 evsaii? vives avavse 40see LHLD = CURLIN FtM)/L) GET THE CURRENT LINE #
2173 gu3ei2t Goooed Bo16R7"

2774 eo3215* eeavad ov3e0S"

2175 03214" Goines ovosas 4osue XTHL NOW THE CURRENT LINE # IS ON THE STACK AND
2776 40560 FIH)L) IS THE TEXT POINTER
2777 40580 LENGTH=2,<

2776 4e600 STRING, <CALL — CHKNUM>>

2779 eos215 oeioee 900517 40620 SYNCHK TOTK ITO" 18 NECESSARY

278@ avSe16" dovoee aveed1

2781 4veae LENGTHe2,<

2162 40600 CALL FRMNUM> FREAD FINAL VALUE

2763 4go8e LENGTH=2,<

2784 av3e17* Be1cHe oves15 49700 CALL FRMEVL>

2785 003220" Oavvee AuSS3e°

2766 eeSe21" BedveY Buse1e"

2787 veseee’ voiove evas4as 4ereo PusH oH }SAVE THE TEXT POINTER

2788 4or4e LENGTH=2, <

2789 003225" ao1p0e 90515 40760 CALL FRCSNG>

2790 evseed? vaveoe goae7es

2791 e@v3ee5* oavece avse2ot

2792 woseee? eoinoe 00515 4e780 CALL © -MOVRE IGET THE STUFF

2793 903227" wovede Bv200e%

2794 wesese? Ge@owe Bvseeu*

2795 oeses1* Ooioee ovesai 4geeo PoP JREGAIN TEXT POINTER

2796 besese Go10aG BvaS05 40820 PUSH OPPOSITE OF PUSHR

2797 23235" Oei1900 evoses 4oaae PusH ISAVE THE SIGN OF THE INCREMENT
2798 woses4t eoloee aeovei 40860 uxt +SCOVE+*0201 #256

2799 003235" oeAeve 1v040u"

2bey wesese* vnevee weseeT*

2801 603237" velvve overer mov DC

2002 wosadu’ volvae oveise Mov E,0 HGET 1,0 IN THE REGISTERS
2803 005241" Boloed ovaiTe Mov Ay 1GE1 TERMINATING CHARACTER
2604 3242" oivue uvus7e CPL STEPTK 400 WE HAVE "STEP" 2

2605 we5245" vpevod oveeaT

2be6 vvse44* Belves vEELTe hE at SETUP DEFAULT SIGN

2807 ev3aas’ dpevesd avaver

2608 d3ad0" velooe avesve JNz ONEON FPUSH SOME CONSTANTS ON IF NOT
2609 05247" donor use65"

2610 eosese* aooove avsess*

2ei1 LENGTH=2,<

2eie STRING, <

2613 CHRGET

2614 CALL FRMNUM>> FREAD THE STEP

2615 <LENGTH=2>8STRING, <

2616 w05a51% weled avesis CALL FRMCHK> DON?T NEEO TO CHECK THE TYPE

BASIC MCS 980 GATES/ALLEN/DAVIDUFF MACKO 47(115) 05412 1@=SEPe75 PAGE
F3 AC

m OrSEPRO4 OSz11 "FOR" STATEMENT
2817 oe325et seoves ov533/"

2618 e525" vooooe euseaT’

2819 ge3254* ea1000 gveS4s PUSH oH

2820 : LENGTHe2,<

2821 03255 Bole 000515 CALL FRCSNG>

2622 05256" oodeee geseede

2823 wuses7? wodove ausese?

2824 veseev' ea1ved 4vOs15 CALL © NOVRF SET UP THE REGISTERS

2625 83261" eoowee wLseeTs

2626 weSabe* CowAde ause5e*

2827 845265" Bo1eee Bv0341 PoP x

2825 003264" Guiooe 00557 FSIGN 1GET THE SIGN OF THE INCREMENT

2629 05265* vaicve aveses ONEON? PUSH 8 JPUT VALUE ON BACKWARDS

2630 5266" eviade euoses PUSH oD JOPPOSITE OF PUSHR

2831 3267" ao1008 vveses IFORON? PUSH PSH }SAVE THE SIGN OF THE INCREMENT

a8se 03270" eoi1oee Beovos INx sP JA ONE BYTE ENTRY ONLY

2633 3271" daieoe weos4s PUSH oH

2634 aa3a72t Belov aoouse LHL TEMP 1GET THE POINTER TO THE VARIABLE BACK
2835 003275" vovowe wvieds*

2636 vs274" wove evse61°

2837 weSe7S* valve veosas XTHL PUT THE POINTER TO THE VARIABLE
2636 VONTO THE STACK ANO RESTORE THE TEXT POINTER
2839 ov3e7et doi0ve eaves NXTCONS 8, FORTK 7PUT A fFOR® TOKEN ONTO THE STACK
2640 903277" Gaeoea aveedr

2641 293390" Brleee aveses 8

2642 005301" Boiave avoveS SP THE "TOKEN" ONLY TAKES ONE BYTE OF
2643 ISTACK SPACE

2844 NEWSTT. FALL DONE

2845

BASIC MCS BGBH GATES/ALLEN/DAVIDOFF MACKO 47 (115) 05312 10SEP*75 PAGE 11
F3 mac 6rSEPeO4 OSt11 NEW STATEMENT FETCHER

2646 41520  SUBTTL NEW STATEMENT FETCHER
2647 4154

2648 41560 7 BACK HERE FOR NEW STATEMENT, CHARACTER POINTED TO BY

2849 4iseo OK END*OFeLINE, THE ADDRESS OF THIS LOCATION 18

2650 416@@ = LEFT ON THE STACK WHEN A STATEMENT IS EXECUTED SO

2851 41620 7 IT CAN MERELY DU A RETURN WHEN IT IS DONE,

2652 aieqa

2853 oessne" 41600 = NEWSTT?

2854 41680 IFN LISTEN, <

2855 41700 FN LENGTH, <

2856 vessae’ oo1vae veus3s aire IN ® HCHECK FOR A CHARACTER WITHOUT
2857 903305¢ Bawave ovaver

2658 ai74e JDOING A "CALL" FOR SPEED

2659 ovssest 41760 :

2860 vos3a4* aeieoD avas4e 41780 ANT DONE VCHARACTER THERE?

2861 993305" eeonve gvoved

2862 003306" Be1000 900314 41800 cz CNTCCN> FSEE IF IT?S CONTROLRC

2663 093307" aee900 Bus4ed?

2804 03310" apvave BuseT7st

2665 41820 LENGTH, <

2866 41840 CALL ISCNTC>>

2807 41860 LENGTH, <

2868 003311" Brive ovoo4e 41880 SHLD TEMP> FUSED BY CONTINUE AND INPUT AND CLEAR
2869 905312" aeeov0 BoLoas*

2872 005315" agen09 au3sseT*

2a7y 41900 770 REMEMBER HOW TO RESTART THIS
2e7e 41920 TSTATEMENT

2873 41940 LPTSW, <xRA HFORCE PRINT TO GO TO TTY AFTER LPRINT
2674 41960 STA PRTFLG>

2875 003314" Bateve ovaiTe 41968 mov Aum 1GET CURRENT CHARACTER

2876 4eove FWHICH TERMINATED THE LAST STATEMENT
2677 93315" waiove wees7e 42020 cPr VIS 1} A COLON?

2678 03316" opeaee gvanTe

2879 005317" apioee gvasie 42o4o rd

2880 005320" onveve 93370

2861 903321" opeeee 905512"

2882 03322" Oolead ovoeeT

2683 993325" valven evasae FMUST BE & ZERO

2664 883324 Bpeove avev7e?

2665 903325" saeoae a03320"

2886 003326" Belvae Buae4s

2687 003327 opio00 aee1Ts HCHECK POINTER 10 SEE IF

2865 FIT 18 ZERO, IF SO WE ARE AT THE
2ee9 TEND OF THE PROGRAM

289¢ 003330" @e1en0 ovovas

2891 003331" Bpinoe gvaees FOR IN HIGH PART

2892 003332" eolnoe Boovas

2893 005355" wolney avosie RAN OFF THE END == OK

2894 003334" @po0aa au35ui"

2895 003335" aneono Bv3s24t

2896 405330" Beleoe ova1s6

2897 003337" oBiewe eeov4as

2898 003340" ealewe wue126 HGET LINE # IN [0,E)

BASIC MCS 8980 GATES/ALLEN/DAVIDOFF MACRO 47(113) 05812 109SEP*75 PAGE i191
FS Mac GeSEPeed OSi11 NEW STATEMENT FETCHER

2899 003341" Bp1ee0 gve355 4esee KCHG T(MpLIBLINE #
2900 003sae" oalope ovavae aesao SHLD © CURLIN FSETUP CURLIN WITH THE CURRENT LINE #
2901 003345" ovenee gvied7?

2902 003344" agnege 3b3534"

2903 4eseo LENGTHe2,< FTRACE FEATURE

2904 93345" waieee evouTe 42580 Loa TRCFLG VSEE IF TRACE IS ON

2985 003346" waneee vetesit

2906 003347" wawove ovs345°

2907 003350" valece g0eee7 4eaoo ORA TNONWZERO MEANS YES

2908 003351" @oloee ovusie 4e4eo rd FSKIP THIS PRINTING

2909 903352" apa0ee av3367°

2910 003355" BeepeO BvS340°

2911 003354" apinve pueses a2aao PusH =D SAVE THE TEXT POINTER
2912 003355" ooiowe aeev7e 42400 MV Anon TFORMAT THE LINE NUMBER
2913 803356" apev00 gva135

2914 903357" opiove 200537 42480 OUTCHR FOUTPUT IT

2915 03360" Goio0e ev0315 4esoo CALL © LENPRT PPRINT THE LINE # IN (HyL)
2916 003361" Be2000 avoveor

2917 003362" wovave 90355e*

2918 005363" Maioee avav7e 4e5eo cree OME MORE FORMATING

2919 603364" waeene 200135

2920 003365¢ eaiene 900537 4es4o OUTCHR

2921 vvSs66" weleee gvoser 4e5ee Por 1 (0, E)8TEXT POINTER

2922 405367° 42580 NOTTRCr>

2923 83367" Gui Bvas55 4ee0e PRESTORE THE TEXT POINTER
2924 093370" aioe aeoseT 42620 GONEt GET THE STATEMENT TYPE
2925 005371" @vioeo BvueeL 42649 I D, NEWSTT TPUSH ON A RETURN ADDRESS OF NEWSTT
2920 003372" oovnve Be3S0e"

2927 03375? vpevee 203561°

2928 903374" Boieue aeased 42600 PSTATEMENT

2929 003375" Baioow Basie 42689 © GONES: VIF A TERMINATOR TRY AGAIN
2930 42700 WF" COMES HERE

2931 83376" wsivae Bvos26 42720 GONEat TON 444 GOTO" AND "ON 44, GOSUB" COME HERE
2932 093377" opoo00 avoeou

2933 e@349u" Boiove 20532 42740 Ler MUST BE A LET

2934 03491" wowpee oe4i31°

2935 903ane" aoeoea anss7e*

2936 averse 42760 — NUMCMD=SCRATK*ENDTKeL

2937 005495" Ba1o00 0376 42780 cri NUMCMD

2938 93404" wovene veov4ae

2939 03405" Balove ouasee 42800 Ine SNERR FSOME RESERVED WORD, BUT NOT
2940 003496" oeneae avewret

2941 Ge3aa7? Boeeea ae34n1"

2o4e aeeeo JA STATEMENT RESERVED WORD
2943 93410" Boteoe ovava7 42840 PMULTIPLY BY 2

2944 O05a11" Onieve evaiiT 42860

2945 eoSaiet waieoe ovevee 42880

2946 903415" Baeeoe 2eev—0

2947 003414" Beioad 200353 42900

2948 vosai5? voleea geaeal 42920 H,STMDSP PSTATEMENT DISPATCH TABLE
2949 03416" BpwoeE Bve564"

2950 9e3417° BeaD0y 4os406"

2951 we34a0" daieoa eoavii aeo4e FADD ON OFFSET

BASIC NCS 898 GATES/ALLEN/DAVIOUFE MACRO 4/(113) @5312 10eSEP*75 PAGE 11-2
F3 Mac OrSEPR64 GS311 NEW STATEMENT FETCHER

2952 03421? Bvieve ova11e 42960 Mov CoM 1PUSH THE ADDRESS TO GO TO ONTO
2953 wes4ae? Baipve ouav4as 42980 INK H THE STACK

2954 003425" Ooieee gea1n6 43000 Moy Bem }PUSHM SAVES BYTES BUT NOT SPEED
2955 wasae4? Boivae gvos05 43020 PUSH 8

2956 wasaas? ooivee 200355 43040 XCHG PRESTORE THE TEXT POINTER

2957 43000 FE LENGTH, <

2958 43060 CHRGET FEAT THE FIRST CHARACTER

2959 43100 RET> 4GO DO THE STATEMENT

2ven 43120 IFN LENGTH, <

2961 03426" Boone g00v45 43140 CHRGTR: INX H TOUPLICATION OF CHRGET RST FOR SPEED
2962 was42T? aioBe ouA1Te 43160 Nov SEE CHRGET RST FOR EXPLANATION
2963 403430" Gnieeo gves76 43180 crr

2964 003431" epvovD woowTe

2965 wususet Beieae oeuseo 4seo0 RNC>

2966 as2zeo +
2967 aseqo 7
2968 as2o0
2969 403435" Golge0 gvesTo 43ea0
2976 0¥3434* GoveDe BuoLav

2971 005435* Opi9ae avasie 43300 ra CHRGTR }GET ANOTHER CHARACTER

2972 0v5430" Cveuee Bu34e6r

2973 005437? wavavD Bvsator

2974 034a0" Bo1o90 900376 43320 crr non TALL CHARACTERS GREATER THAN

2975 093441" Goveey veaveo

2976 43340 "9" HAVE RETURNED, SO SEE IF NUMERIC
2977 buSage? Oo1owe BuouTT 43360 JMAKE NUMERICS HAVE CARRY ON

2978 295445? Baiove BoaGTS 43380 HSET ZERO IF (Also

2979 003444" apieve geev75 43400

2962 esas? BBleoG weOsIL 43420

2981 4s4a0

CHRCON 18 THE CONTINUATION UF THE CHRGET RST

HRCON? CPL La) TNUST SKIP SPACES

BASIC MLS 8080 GATES/ALLEN/DAVIOOFF MACRO 4/(115) 45312 10°SEPe7S PAGE 12
Ps mac brSEP=64 OSt11 RESTORE, STOP, END, LINGET,CHRCON

2982 43400 SUBTTL RESTORE, STOP, END,LINGET,CHRCON
2963

2964 83446" Coieve ovas55 43500 RESTOR? XCHG FSAVE ChyL) IN (0,6)

2985 003447" avigee aeause 43520 LHLD — TXTTAB

2986 @25a5e? prod eo1617"

2987 03451" Mavene avs436°

2988 03452" oaieoe gvee53 43540 ocx 4 FINETIALIZE DATPTR TO (TXTTAB)=1

2989 803455" valeae evoede 43560 RESFINS SHLD —DATPTR FREAD FINISHES COME TO RESFIN

2990 H3454" Brouee BoLEAT*

2991 003455¢ Goeone aesuse?

2992 03456 ariuee av0353 43580 XCHG HGET THE TEXT POINTER BACK

2993 03457" ori1oae Bees11 45600 ReT

2994

2995 43040 IFN LISTEN, <

2996 eusaee’ doieve 000333 45660 ISCNTCs o)

2997 943461¢ waenee gvoved

2958 av 3461 43680 © CNLCAS CONSOLE COMMAND CHANGE Loc

2999 vasuee? aringa avasds 43700 IDONE

3000 083405" Opdve8 aoeeaL

3001 283404" Bo1n0e guesae 45720 JIF NO CHARACTERS THEN NO

3ou2 Gv35465% OuIeee L515 43740 CNTCCN? CALL INCH

3003 43460" GaoAve Bv3126°

3004 803407" Banoe® ges4sar

3av5 903470" ealane B6osTe 43760 rr #STOP CHARACTER IS °C

3006 003471" wavane wooLEs

3007 43780 LENGTH, <

3008 43800 IMP STOP>>

3009 43820 LENGTH, <

3010 oa3472* aol1ase BoasaL 43840 RNZ RETURN IF NOT CONTKOL*C AND MAKE

3oi1 45860 FSUKE "STOP" STATEMENTS HAVE A TERMINATOR
312 003475" Bolaoe awasee 43860 WO "01000,70366  FSETUP (A) AS A FLAG WHETHER

3013 43900 TO TYPE THE BREAK MESSAGE

Sia Gasa74* Baivae goased 45920 MAKE SURE "END" STATEMENTS HAVE A TERMINATOR
3015 we3475* Go1048 geovae 43949 TEMP HSAVE FOR "CONTINUE"

3U16 03476 Bovoee geleast

3017 03477" Beve%G 903460"

3416 003500" Balo0e ovesat 43960 8 8 POP OFF NEWSTT ADORESS

3019 Bo3501° @p10900 Bvese9 43980 PSH SAVE THE MESSAGE FLAG

sve 4a0e0 FZERO MEANS DON?T PRINT "BREAK"

3021 oasseet geinwa woaLse 4aa20 CURLIN FSAVE CURLIN

3u22 403503 devon Bo1607*

3023 205504" Bovgsa Bus47t

3024 003505" @olave woe17S yk

$025 ae3sa6° valve ovBeds H SE IF IT KAS DIRECT
326 Bv3507? @eivee avev7a A

3027 93510" veicve avosie DIRS HIF NOT SET UP FOR CONTINUE
3028 003511" Beowe Busser

3029 ovs5ie? Boo! 003503"

3030 063513" Boles seoude OLOLIN FSAVE OLD LINE #

3031 003514" @pua00 avie11¢

3032 005515" aoo0e ‘Bu3511°

3033 003516" Yipee oveese TEMP JGET POINTER TO START OF STATEMENT
3034 003511" vobove dv10E05°

BASIC NCS 8060 GATES/ALLEN/DAVIDOFF MACRO 47(113) 03412 1OeSEPe75 PAGE Lent
FS mac OrSEProd BSE1h RESTORE, STOP, END ,LINGET,CHRCON

3035 oussa0 eoveva av3514°

3036 03521" volena guaode 4atea SHLO OLDTXT HSAVE IT

3037 ov3522? wooo gu1613°

3038 403525¢ aooeaa go351T"

3059 ou35e4t 44160 DIRIS#

sae 4g2ua IFN CONTRA, <

3041 Ba35e4* aoteu9 veaes7 4azeo ARA A

3042 903529¢ euleso avdvee ayaa STA CNTHFL> ;FORCE OUTPUT

3043 03520" Bavev0 ovis4it

$044 93527" aageve Be352et

3045 983530" autores evoser 4a2e0 Por Pow }GET BACK *C FLAG

3046 903531" eateve seoedd 44300 UxI Hy BRKTXT "BREAK"

3047 943532" Booed Be1T34e

3048 903533" anav00 Bv3ssa6t

3049 903534" oatnve avosee 4a3e0 INZ ERRFIN FCALL STROUT AND FALL INTO READY
3050 005535" eaveed woereT?

3051 O63530f deoene v353e"

3052 083537" Oaiava Ba3s03 4a34o ane READY> TTYPE "READY"

3053 03540? Boveva ovai4s?

3054 03541" dvoune 003535"

3055 44300 REALIO,<

$056 44380 PoP 8 JGET RID OF NEMSTT RETURN
3057 44400 WRRZ 14, JOBDOT eR.

3058 444e0 SRST aC14)>

3059

3060 4aaca LENGTH, <

3061 ov354e? valove vevsou 4aasaC RNZ MAKE SURE THERE IS A TERMINATOR
3002 003545" Gnioea veoes6 44500 vt E,ERRCN

3¥63 083544" vopave veoweL

ved 903545" dolgue ABaese 44520 LHLD — oLoTxT JA STORED TEXT POINTER OF
3465 403540" dadnve v1e1s"

3066 423547" Bane Buss4or

3067 4asug TZERO I$ SETUP BY STKINI
3066 44500 FAND INDICATES THERE IS NOTHING
3069 44560 170 CONTINUE

3070 903550" @ateva ova174 44600 mov I"STOP", "END", TYPING CRLF
3071 803551" daieve evee6s 4a6e0 OKA #10 "INPUT" AND *C SETUP OLDTXT
3072 803552" welove avesi2 44640 wz

3073 03553" deere wuelee?

3074 203554" Aaavoo 9u354a6F

3075 903555* Avivo avo3sss 44660 XCHG FSAVE CHyLI

3076 003550" aaieae avause 44660 LHLD — OLDLIN

3077 803557" GooedH o01611°

3078 903560" A90000 903553"

3079 003561" Belvoe avov4e 44700 SHLD CURLIN FSET UP OLD LINE # AS CURRENT LINE #
3080 843562" Bo02G BvIE7"

308) 003563" aadooy v355T*

3062 083564" Ba1020 a80353 4a72e XCHG FRESTORE (H)L)

3063 003565? doloeo 900511 44740 ReT>

3284 44760 LENGTH, <

3085 903566" ae1ne0 90315 44780 CALL | «GETBYT

3066 @3567" aave0 a11020"

3087 03570" Bn0L22 w356e"

BASIC MCS 8980 GATES/ALLEN/DAVIDUFF MACRO 47(113) 03312 10°SEP=75 PAGE L2n2
FS mac beSEPeod @S811 RESTORE, STOP,END,LINGET, CHRCON

3088 003571? @z1000 neas00 44800 RNZ JMAKE SURE THERE IS A TERMINATOR
3089 Be3s7e? Baieae Beav7d 44820 INR

3099 003575" Yo1o~e GvasTo 4ae40 CPI JMAKE SURE THE NUMBER IS REASONABLE
3091 083574" apaoe0 Bve110

3092 44860 FCROO WONT WORK IF IT ISN°T
3093 ovss74e 44860 LINPT2s=3 TERMINAL WIOTH CHANGE LOCATION
3094 03575? Golda HoaSsee 44900 FCERR P/FUNCTION CALL" ERROR

3095 943576" aongAa BITTE

5096 005577" MoHove guS567?

3097 aos6au' Bala avBvoe 4age0 NULENT HCHANGE NUMBER OF NULLS
3098 GA3e01" ereove woovaot

3099 B05692" eye BOs5STOS

3100 03605* Brine acesit 44940 RET>

3101 44960 LENGTH=2,<«

31e2 o03en4" vo1ece awaeTe 44980 XWD *01000,7076 PMVI A," NON@ZERO QUANTITY
3103 003605" Bo1ove owes? 45000 XRA A TMAKE [A] 9 FOR NO TRACE
3104 G0360" Aoidee avavee 45020 STA TRCFLG UPDATE THE TRACE FLAG

5105 043607" OoBvee Yo1esit

3106 003610" wedave 203001"

S127 083611" AaI1veH east 45040 RET>

31068 45060

3109 45080 FOR A LETTER / CARRY ONSNOT A LETTER

3110 45100 CARRY OFF#A LETTER

Bait 45120

3112 oo3e12* do1ev@ BvaITe 45140 Mov aM

3113 003615" @o10ae ava376 45168 cri man

3114 003014" vovove veolel

3115 @03615° do1ave 900330 45180 RC RETURN EARLY
$116 025610" Belave Beo57e 45200 crT or

3117 beSe17? ooeed Beai3ss

3118 003620? valove aoeu7T 4seeo cnc

3119 veSeait Ooiave Beos11 45240 ReT

3120 45260

311 45260 INTIDX READS A FORMULA FROM THE CURRENT POSITION AND

3iee 45300 TURNS IT INTO A POSITIVE INTEGER

3123 45320 LEAVING THE RESULT IN (0,6), NEGATIVE ARGUMENTS

Bieq 45340 ARE NOT ALLOWED, (H,L) POINTS TO THE TERMINATING

3125 45560 CHARACTER OF THE FORMULA ON RETURN,

3126 45380

3127 45400 LENGTH=2,<

3126 45420 CHRGET

3129 45490 CALL FRMNUM

3130 45400

3131 45480 FCERR HIF NEGATIVE BLOW HIM OUT
3132 45500 © DEINT# FAC SEE IF ARG GREATER THAN 32767
3133 45520 144

3134 45540 7 GINT

3135 45560 LENGTH, <

3136 45580 MOVRI 144, 128,0,0 REGISTERS © FLUATING =32768
3137 45600 CALL © FCOMP FSEE IF FACRREGISTERS

3136 45620 Mov 0,c SETUP D200 Ee0 FOR =32768
3139 45640 Rz> WAS 32768, (0,£] 1S SET UP
3140 45660

BASIC MCS 6980 GATES/ALLEN/OAVIDUFF MACKO 47(113) 95312 1eSEP=75 PAGE
Fs Mac OmSEProd S311 RESTORE, STOP, END,LINGET, CHRCON

3144 45680 FCERR: MVI E,ERRFC #100 1G, FUNCTION CALL ERROR
3142 45700 IMP ERROR>

3143 45720 IFE LENGTH=2,<

3144 @vS22" Baiede veoseT 45740 INTIOX: CHRGET

5145 a03e2s¢ 90 @VOS15 45760 INTIDe: CALL FRMEVL. TEVALUATE A FORMULA

3146 905624" DoeDve v5550¢

3147 G63625" aneove ov5607"

3148 03626" eaioue goasas 45780 Push oH }SAVE THE TEXT POINTER

3149 onSne7* evasis 45800 CALL = FRCINT FCONVERT THE FAC TO AN INTEGER
3150 003630" Nedaae avdebex

$151 403631" agende Bb3e24°

3152 v0363e" waiene oeaiTs 49820 nov AnH FSEE If THE RESULT 18 NEGATIVE
3153 003633? eoleve pvoee7 45840 Oka A HBY LOOKING AT (HI °S MSB
3154 03634" agioed avasTe 45860 an FOERR DON?T ALLOW NEGATIVE NUMBERS
3155 003635" anane0 010776"

3156 03630" e900 oUso30F

3157 93687" Boiove Gvosss 45880 XCHG FRETURN THE INTEGER IN (0,E)
3158 o03e4e* Boieas ovesar 45900 PoP JRESTORE THE TEXT POINTER
3159 0Se41* Batove veasi1 45920 RET>

5160

3161 45960

See 45960 LINGET READS A LINE # FROM THE CURRENT TEXT POSITION

3163 46000

S164 46ne0 LINE NUMBERS RANGE FROM @ TO 65529

3165 4oada

3166 4edee (D,E) 18 SMASHED,

3167 4onee

3168 46100 ANSWER RETURNED IN [D,E),

3169 gored (H,L) IS UPOATED TO POINT TO THE TERMINATING CHARACTER
3170 erage AND (A) CONTAINS THE TERMINATING CHARACTER WITH CONDITION
S171 4etoo CODES SET UP 10 REFLECT ITS VALUE,

3172 gereo

3173 e342 Beineo aeouss 46200 LINGET? DCX #

3174 903645* voiove bower 4e220  LINGT2t LXI 0, SCOLE FZERO ACCUMULATED LINE #
3175 ed3e44? Ovoove aeaueu?

3176 e@03ea5* deooo av3635*

3177 003040" voieay oveseT 46240  MORLINS CHRGET

3178 803647" Belene ovosa0 4o260 RNC #WAS LT A DIGIT

3179 003650? Yolove ovasa5 46280 PUSH oH

3180 @03051* Goleve auases 46300 PUSH PSH

3181 03052" dolvde BuBvAI 4520 uxt Hy SCODE*+6SS2 SEE IF THE LINE # 1S TOO 816
3182 003055" dovev0 014630"

3183 003654? Gove OvSe4a*

3164 93659" Bplond oves47 40300 COMPAR

3185 @vSe50" Aoluda avnsse 46300 vc HYES, SYNTAX ERROR

3186 903657" egev00 aveeTe?

5187 903600" @ne000 403055"

3188 003661" Ontos avo14e mov FSAVE (0,61

3189 dd3e6e" epics weuIss mov ‘

3196 @03e65* Baloge B0031 DAD

3191 003664" wotovs oeBest OAD

3192 093665" dolcve ovoust Dad

3193 UeS660" aoloue avousi DAD PUTTING (0,E)#1@ INTO (H,L)

BASIC MCS 808 GATES/ALLEN/DAVIDOFF MACRO 47 (113) 5412 10=SEP=75 PAGE 1294
FS Mac 6rSEPmOd S311 RESTORE, STOP,END,LINGET, CHRCON

3194 0367? Bo1p20 900561 4e5o0 Por Psw
3195 u3e7a? acing gvoseo 4o5e0 sul nom

3196 03071" eavaee Beaver

3197 @aSe72? daivun E0137 40540 ov E,A

3198 003675" aotoag avovee 46560 WI 08

3199 93074" eaveae aeavae

3200 03675" Bolove avevst 46580 oad 0 PADD THE NEW DIGIT

3201 @03e76" Bo1ove BvasSS 4oove XCHG

Save 903677" Balun oves4ar 4o6e0 POP ct iGET BACK TEXT POINTER
3203 oa37a0" Ouiowe en0305 4eoue NP

3ev4 83701" Boe~va wvse4er

3205 u379e" anveuD 93657"

3206 40660 IFN LENGTH, <

3207 005795" aoiowo avosie 46680 CLEAR? JZ CLEARC HIF NO FORMULA JUST CLEAR
3208 B03704° vnevae Buedast

3209 903705" Bodowe B03TAI*

3210 o03790% Yaioae Aves1S 46700 CALL «= INTIDe GET AN INTEGER INTO (0,E)
3211 903707" evoovg Bos6es¢

3ai2 ed371v*? eoBove vesTa4?

3213 903711" Op1ese Bve05S 4oreo Dex

3214 g03712* ep1000 gveseT 46740 CHRGET SEE IF ITS THE ENO

3215 03713" anieeo oveseo 46760 RNZ SHOULD FINISH THERE
3216 u3714" dolove Bvasas 46780 PUSH oH SAVE TXTPTR

3217 003715" eoteas wguvavse 40800 LHLD — MENSIZ GET HIGHEST ADDRESS
3218 403716" wnagee Bv1545°

3219 @03717¢ envove ov3707t

3eev ous720¢ eo1vae Bv017S 4o820 Nov Ayk FSUBTRACT CH,L)=C0,£) INTO (Dy
3221 003721" Opivse oveees 4eade suB E

Se2e gusree? arivve 90137 40860 MOV E,A

3223 003725" Oviava avaiTs 40882 mov Aydt

3eea wo3s7ad? aolene weaese 46900 $68 0

3225 905729" Yolooe oveleT 40920 Mov DyA

3226 03726" Wolgoe BvEsse 46948 ve SNERR FWANTED MORE THAN TOTALS
3227 eo3s7a7? wooone veewre?

Bees 003730" Boaove Av3716°

3229 u3731" @o1o00 BvdLSe LHLD © VARTAB STOP LOCATION IN USE
3230 003732" dooeun ovieai?

$231 003735 eecvo avs7eT?

3232 003734" Boio09 gvaveL 46980 xr 8, SCODE+4a LEAVE BREATHING ROOM
3233 005735" aogvee ovevsot

3234 03730" Banana av373e"

$235 903737¢ @o1oa9 aeov11 47000 8

$e3o 003740" Golaoy 900547 47020 ROOM?

3237 003741" avivve ovosee 47049 J ONERR #NO, DON?T EVEN CLEAR
3236 03742" wove owaLsi’

3239 Ge37as? ayaavo o63735°

3e4y 03744" volves auosss NEW STACK LOCATION [Hy L}
3241 003745" @oieeo ovov4e STKTOP FSET UP NEW STACK LOCATION
$242 003740" Bodove av161S°

3243 oo3747? ovagve av374et

3e44 903750" onions ovos41 H FREGAIN THE TEXT POINTER
3245 03751¢ aleve Bves05 CLEARC> 4G0 CLEAR

3246 Bu3752e* devowe Buedast

BASIC MLS 8980 GETES/ALLEN/DAVIDUFF MACRO 47(113) 03442 10eSEP=75 PAGE 12-5
FS mac rSEP=o4 05311 RESTORE, STOP, END, LINGET , CHRCON

$247 003755" aooane 4vsT4e*
3248 47140 PAGE

BASIC MES BQ8H GATES/ALLEN/DAVIUOFF MACRO 47(113) 05312 1O=SEP=75 PAGE 13
Fs Mac brSEPeod S311 RUN, GOTO, GOSUB, RETURN

3249 47160  SUBTTL RUN, GOTO, GOSUB, RETURN

3250 47169 IFN LENGTH, <

3251 003754" eolovH ovosie 47200 RUNS Je RUNG NO LINE # ARGUMENT

3252 003755" aoeeee aveas7?

3253 @v375e" avaooy av375e°

3254 a7eeo FCLEAN UP,SET (H,L]=(TXTTAB) #1 AND
$255 47a4o FRETURN TO NEWSTT

3256 40575/* @alv0v 9v0s1d 47260 CLEARC HCLEAN UP e» RESET THE STACK

3257 05760" Bove00 Buea4s?

3258 003761" Bp@oun av37S5¢

3259 47280 IDATPTR, VARIABLES yoy

3260 47300 HUH)L] IS THE ONLY THING PRESERVED
3261 803762" Oo10%0 guavel 47320 By NEWSTT

3262 903763" dneovo wv3seet

3263 903764" apeona aus7ev"

3264 903765" Gaius evos05 47340 RUNC2> #PUT "NEWSTT" ON ANO FALL INTO "GoTo"
3265 403760" ap0e00 ao4aver?

$266 003767" BoveMa 9b3765°

3e67 47360

3268 47380 B ENTRY ON THE STACK HAS THE FOLLOWING FORMAT

3269 47400

3270 47420 Low avoRess

3am 47440

3272 47460 A TOKEN EQUAL TO GOSUTK 1 BYTE

3273 47480 THE LINE # OF THE THE GOSUB STATEMENT 2 BYTES

3e74 47500 A POINTER INTO THE TEXT OF THE GOSU6 2 BYTES

3275 47520

5276 4754 HIGH ADDRESS

3e77 47560

3278 47580 TOTAL 5 BYTES

3279 47600

3280 003770" Bp19ve gvas1d 47620 GOSUB: CALL  GETSTK FMAKE SURE THERE IS ROOM

3281 Gu3771" aoeoon gwewedt

3282 ous772* DvOdL0 4uS76*

3283 003773" Boveve aouwes 47640

3284 003774" a1090 avosei 47660 8 JPOP OFF RETURN ADDRESS OF "NEWSTT"
3285 03775" Wolove vuasad 47680 H FREALLY PUSH THE TEXT POINTER
3286 G83776" Boleoe B00345 47700 H VSAVE TEXT POINTER

3287 0377/7" aolove ovuvSe 47720 CURLIN 1GET THE CURRENT LINE #

3288 Go4naet ap0e0a aui16ea7?

3269 p4no1f oaveee 903771"

3290 Bp4aae" B21990 9v0s4s 47740 WPUT CURLIN ON THE STACK AND [H,LJ=TEXT PTR
3291 oudaes? aeione auaves 47760 0,GOsUTK TLEAVE A GOSUB TOKEN

3292 9404" vaowoe owverd

3293 47780 FON THE STACK

3294 uodeast voiave ouosed 47800

3295 veaga6* woivee avaves 47820 FTHE GOSUB TOKEN TAKES ONLY ONE BYTE
3296 o0a001* BoioaD voases 47840 " FRESTORE RETURN ADDRESS

3297 47860 FOF "NEWSTT®

3298 47880

3299 47900 In THE GK VERSION WE START AT THE BEGINNING

3300 47920 AND SEARCH, IN THE 8K WE START WHERE WE

3301 47940 7 ARE IF WE ARE GOING TO A FORWARD LOCATION,

BASIC MCS 8980 GATES/ALLEN/DAVIDUFF MACKO 4/ (115) 95412 10@SEPe7S PAGE 1391
FS mac brSEP Rod 1 RUN, GOTO, GOSUB, RETURN

3502 41968
3303 gv4yier eaiase 9ves15 47980 CALL © LINGET PICK UP THE LINE #

3304 904911" Boerne Bose4e*

3585 vodaie? ecovea ovavev!

3306 4800 TAND PUT IT IN [0,E)

3307 4aae0 LENGTH, <RNZ FSHOULD END WITH A LINE

3308 40040 TTERMINATOR == BLOW HIM UP

3309 48060 HIF IT DOESN*T

3310 48080 7(ON GOTO MAKES THIS WRONG

3311 48100 FIN OTHER VERSONS)

3512 4e1e0 CALL FNOLIND

3313 4eiao LENGTH, <

3314 oe4015* Baipoa ove515 48160 CALL” REM SKIP TO THE END OF THIS LINE

3315 goda14? vadova aoao7ar

3316 g04u15* enoe9m weauri?

3317 we4o1e* do1eve evos4s 48180 Push SAVE THE POINTER

3318 Q0de17* agiova ovaese 48200 LHLO = CURLIN 1GET THE CURRENT LINE #

3319 c4ga0* agonnn ger6eeT?

3320 Ovd4aal? aovcad veaetat

3321 dodge? ooioue evo3sdT 4e220 COMPAR 1(D/E) CONTAINS WHERE WE ARE GOING
3328 4e2a0 7(H,L] CONTAINS THE CURRENT LINE#
3323 46200 #80 COMPARING THEM TELL US WHETHER TO
3320 46260 ISTART SEARCHING FROM WHERE WE ARE OR
3325 48300 #70 START SEARCHING FROM THE BEGINNING
3526 46320 JOR TXTTAB

3327 ovdgas? eo1ove veosai 48340 x 4 {H)L) CURRENT POINTER

3328 vo4g24 opigea veoeas 46360 4 }POINT AT THE LINK BEYONO IT

3329 gud4uas? enlace ova33a 48380 C oor SEARCH FROM THIS POINT

3330 dodger doves avesTat

3331 Ge4pa7? vaagne avavest

3332 o9dn30? eaiove aadsed 46400 NOLIN FSEARCH FROM THE BEGINNING == ACTUALLY
3333 04031" Oeove ovasTit

3334 ovdu3et onveve avaeas?

3335 4e4ea SEARCH AGAIN IF ABOVE SEARCH FAILED
3336 0v4035" aolaue veo1ae 4640 HB

3337 04934 @pieve geo151 48460 Lc

3338 dvdy35? oniove ovoess 48480 4

3339 oans6? agiave aves3o 48500 FIF A MATCH WE ARE OONE

3540 904037" delede ave0s6 46520 USERRE £,ERRUS

3541 wo4oav? aovave evov1e

$342 adoa1* Getoae aeases 4esuo ERROR FCENATCH,SO IF NO MATCH WE

3543 godo4e? apov2s waive?

3344 ao4p43* Bodden Go4u3si?

3345 48500 FGIVE A "US" ERROR

3346 48560

3347 48600 SEE "GOSUB" FOR THE FORMAT OF THE STACK ENTRY

3548 48620 RETURN" RESTORES THE LINE NUMBER ANO TEXT POINTER ON THE STACK
3349 48640 AFTER ELIMINATING ALL THE "FOR" ENTRIES IN FRONT OF THE "GOSUBM
3550 48600 ENTRY

3551 48000 jf

3352 ovaga4r vse 48700 RETURNS RNZ FSLOW HIM UP IF THERE ISNT A TERMINATOR
3353 eo4a45* agiedo guaveo 487e0 mvt HWAKE SURE THIS VARIABLE POINTER

3354 @o4g4e* Boards 9v0577

BASIC MCS 88 GATES/ALLEN/DAVIOUFF MACRO 47(113) 93412 108SEP=75 PAGE 1392
FS Mac GrSEPe6d O53! RUN, GUTO,GOSUB, RETURN

3555 48740 FIN (D/E) NEVER GETS HATCHED
3356 g04ga7* aoieve vosis 48760 CALL FNDFOR GO PAST ALL THE "FOR" ENTRIES

3557 eoaeset eeveoe oe1saat

3358 904051" onvoae gu4avaet

3359 4odgse? aniev aeas7i 48760 SPHL UPDATE THE STACK

3360 oo4e53" Boivea oos76 48800 rr GOSUTK

3301 vadess? aoeave ovoera

3362 a04955* aolvee venese 48820 E,ERRRG FERROR ERRRG IS "RETURN WITHOUT GOSUBY
3363 94956" oroene weaves

3364 ov4as7* eoione neasoe 48840 ERROR

3565 “edgeu’ onvued wee2ive?

3366 wadgol? voege0 wvavse’

3367 evduee? Oainva wvosai 48860 4 GET LINE # "GOSUB" WAS FROM

3568 vaanes? anivne ovevse 48880 CURLIN yPUT IT INTO CURLIN

3369 @oage4? aovove avre0T?

3370 904965" aoveD0 se4vert

3571 ovdaoo? aoiave aeeeat 48900 Hy NEWSTT

3372 o4p67? Byo009 ae330e"

3373 aadg70? Weave avavoat

$374 wade71* Colona weosas 4a9e0 FPUT RETURN ADDRESS OF "NEWSTT"

3375 48940 BACK ONTO THE STACK, GET TEXT POINTER
3376 48960 FROM "GOSUB"

3377 48980 HSKIP OVER SOME CHARACTERS

3378 49900 SINCE WHEN "GOSUB" STUCK THE TEXT POINTER
3379 49020 FONTO THE STACK THE LINE # ARGUMENT HADN?T
3580 49040 BEEN READ IN YET,

3561

3362

3563 49100 STRING, <

3384 vedere’ eo1008 sewer 49ta0 XW *01000,701 #"LXI B," TO PICK UP "3" INTO C AND SKIP
3385 g0475* Govan geovTe 49140 yn S"DATA" TERMINATES ON "2

3586 49160 FAND @, "i" ONLY APPLIES IF

3367 49180 HGUOTES HAVE MATCHED UP

3388 ovaera? agave LENGTH=2, <ELSEt> VEXECUTED "ELSE"S ARE SKIPPED

3589 ageee

3590 49240 REM MUST PRESERVE (D,E) BECAUSE OF "GO TO" AND ERROR

3391 49260

3392 00474" doiven ovoe16e 49280 xHo *01000,7016 JMVI Cy THE ONLY TERMINATOR IS @

3593 o4a7>* Boleee Bvavad 49300 xWO *01000,0 iNO=OPERATION

3394 49320 FMDATA" ACTUALLY EXECUTES THIS @

3395 Go4aTet aoiead eave 49340 wt 8,0 FINSIDE QUOTES THE ONLY TERMINATOR I8 ZERO
3396 904077" ayovna neooae

3597 Gv4100* Beiuna av—I71 49360 Mov WHEN A QUOTE IS SEEN THE SECOND

3398 va4dioit aeigoe over1e 49380 Mov c,8 VTERMINATOR IS TRADED, SO IN "DATA"
3599 va4iee* Ovivoe ave10T 49400 Mov ByA FCOLONS INSIDE QUOTATIONS WILL HAVE NO EFFECT
3400 a4195* Beiaee gvaiTe 49420 Mov AyM GET THE CHARACTER

3401 04104" welove oveesT 49440 ORA FZERO IS ALWAYS A TERMINATOR

3ae2 e04105¢ eieee avast0 49460 RZ

3403 o4a1eo% waives ouoeTo 49480 cHP FTEST FOR THE OTHER TERMINATOR

3404 Bo41aT? Boieaa gvesie 49500 RZ

3405 04110" eolowe Buenas 49520 INx

3406 04111" @otoue gLa576 49540 CRI HIS 11 A QUOTE?

3407 av4i1e* aooeda ovavae

BASIC MCS 8980 GATES/ALLEN/DAVIDUFF MACRO 47(113) 95312 10eSEP@75 PAGE 1303
FS Mac OrSEPRb4 05311 RUN, GOTO, GOSUB, RETURN

ou4115¢ eo10eo oveste 49500 ve excha? FF SO TIME TO TRADE
oe4ii4? ogeara geaiout
wo4115? doveae aeauer?
49580 IFE LENGTH=2,<
49000
49620 7 WHEN AN "IF" TAKES A FALSE BRANCH IT MUST FIND THE APPROPRIATE "ELSE
49640} TO START EXECUTION AT, "OATA" COUNTS THE NUNBER OF "IPM
49600 IT SEES $0 THAT THE "ELSE" CODE CAN MATCH "ELSES WITH
49680 "1F"S, THE COUNT IS KEPT IN {tb}
49700}
0v4116" Bo1a00 auosz6 49720 1FTK HIS IT AN NIFH
wa4ii7? aaaoaa aegete
adieet Beine0 evasve 49740 REMER TIF NOT, CONTINUE ON
ow4ia1t @ooved ov4ras?
oudi2e* aponae ovaiiar
aediest waives geoere 49760 JSINCE "REN" CANTT SMASH
49780 710,E) WE HAVE TO BE CAREFUL
49800 180 ONLY IF B DOESNFT EGUAL
49820 TZERO WE INCREMENT D, (THE "IF" COUNT)
ea4ya4* opie aveere 49840 ° }GARRY ON IF (8) NOT ZERO
eo41es? o910e0 eveleT 49860 ' Oy A> JUPDATE (0)
204126" Baived gve303 49880 REMER>
a4ie7? voooee vedios?
oe413e" aeava aediart
49900
49902 j WITHOUT STRINGS THERE IS NO NEED 10 WATCH QUOTATIONS
49904 SO (8) IS SET UP AS THe SECONDARY TERMINATOR
49906 5 AND A SCAN IS MADE FOR (B1 OR ZERO
49908}
49920 TFE STRING, <
49940 DATAE Xn *01000/1 FMAKE (C)="3" AND SKIP
49960 rt
49980 REM? = XHD = 01900, 16 FAKE (C) #0
Seav0 xWD701000,¢ }ZERO AND NO=OPERATION
50020 LUOPOR: MOV AM
svoua ORA A FALWAYS STOP ON ZERO
Svao0 RZ
seoea CHP € CHECK FOR "3" IN DATA
Soieo RZ
Seie0 INK "
swi4y SNP LooPOR>
So1ee

FLOOK AT NEXT CHARACTER

BASIC MCS 6084 GATES/ALLEN/DAVIDUFF MACKO 4/(115) @5312 1@*SEP=75 PAGE 14
FS Nac beSEP|o4 GSt11 "LET"

3450 Se1e@ = SUBTTL "LET"
3451 904131" @o19@o ewos1d Se2ea LETS CALL PTRGET GET THE POINTER TO THE VARIABLE
3452 04132" Ondvad ovE5se5?

3453 404135" anova 9u4ie7?

3454 Ssuzeo FNAMED IN TEXT AND PUT

3455 suede TIT ON THE STACK, CH,L1 REMAINS
$456 Se20n HTHE TEXT POINTER ANO A,PSW ARE SETUP
3457 seese TAS THE TERMINATING CHARACTER,

3458 004134" Qai099 gvas1T Su3ee SYNCHK EQULTK FCHECK FOR "a"

3459 904135" eave ones”

3460 v041 36" 5@320 © REDINF:

3461 50340 IFN STRING, <

3462 404136" aeign9 BvouTEe 50300 Loa VALTYP

3463 024137" @pgone Be1543°

3464 e414? vavaee oe4i3et

3405 G04141" eolove 000565 50360 PUSH PSW>

3466 oo414e? Belvde ooesed seaeo PUSH =O

$467 004145* Bo1e00 ov0515 Sede CALL FRMEVL GET THE VALUE OF THE FORMULA

3468 004144" Bgeeen 065336"

3469 04145" @aa000 av4i3Tt

3470 so44o FINTO FAC

3471 004140" ao1a90 ovos43 Se4e0 XTHL F(HyL) sPOINTER TO VARIABLE

3472 Suaeo TTEXT POINTER TO ON TOP OF STACK
3473 ov414/* Ba1eon Boov4e 5e500 SHLD TSAVE VARIABLE POINTER FOR "FOR"
3474 04150" Baeene ge160s*

3475 004151° anaeaa auaiaar

3476 50520 STRING, <

3477 o415e" wo1eea gooSaL 50540 Por 0 HGET TEXT POINTER OFF

3478 004155" Geleve BeoSe1 Se5ea POR Pow GET THE VALTYP OF THE

3479 Suse FVARLABLE INTO (A)

3480 004154" Bolaa0 Bo0se5 50581 PUSH oD TRESAVE THE TEXT@POINTER

3481 5usee E LENGTH=2,<

3482 04155¢ BaIEAY ovMSTE se5e4 CPI 3 #SEE IF ITS A STRING

3483 04150" Gyoeee evovas

3464 04157" G91090 aeosads 50566 PUSH oH HSAVE THE POINTER AT THE VALUE POSITION
$485 a4160" valeee ovosae 90588 JNZ COPNUN TNUMERIC, SO FORCE IT AND COPY

3486 e4i61" BoeDeH Bv4esTT

3487 @94162" BoveeD oH4150"

3488 04163" Go1090 400315 50590 CALL «© CHKSTR> TNAKE SURE THE FORMULA WAS A STRING
3489 004164" Bpanva avovovs

3490 944165" apovad ov4diel?

3491 Se6uu LENGTH=2,<

3492 Swoee RAR FCARRY SET FOR STRING OFF

3495 Seo4o FOR NUMERIC

3494 50660 CALL HKVAL, }MAKE SURE VALTYP MATCHES CARRY
3495 50688 VAND SET THE ZERO FLAG

5496 50700 VON A NUMERIC VALTYP

$497 se86e Je copNun VIF A NUMBER COPY

3498 5e88@ INPCOM: PUSH =H SAVE POINTER AT VARTABLE

3499 004166" Bai1ov0 gvause 50900 LHLD —-FACLO HGET POINTER TO THE DESCRIPTOR OF THE RESULT
3500 004167" ondaua ‘wv1e3sT*

3501 904170" Opv900 904164"

3502 G94171" @n190D avosas 5u9e0 PusH FSAVE THE POINTER AT THE DESCRIPTOR

BASIC MCS 6080 GATES/ALLEN/DAVIDUFF MACRO 47(113) 03312 10SEPe75 PAGE 14e1
Fs mac O=SEPmO4d SEIT LET"

3503 vusi7e* aeiowe avov4s 5p940 INnx H

3504 004175" @eioae avow4s 52960 INx 4

3505 Bo4174" woleoe BoaS67 Se980 PUSHM

3500 wosi7>* erioae ovoser 51000 PoP 0

3507 004176" Oelave gvoese Sige LHLD = STKTOP VSEE IF IT POINTS INTO STRING SPACE
3508 404171" Mevav0 guIb1S*

3509 ao4aqn' wovene ab4167*

3510 oa4291" weinee avasat 51040 COMPAR VIF NOT DON?T COPY

3511 vudavet weleoo oveser 51060 PoP t) #GET BACK THE POINTER AT THE DESCRIPTOR
3512 vnseost eaivoo svvsee 51080 INC onTcry JOON?T COPY LITERALS

3513 vasan4? aeoove oeaerT?

3514 04209" goaova au4iTT?

$515 aodage* Boiaee aveese 51100 LHLO —-VARTAB #NOW, SEE If ITS A VARIABLE

3516 wed2or? dooove we1e2i?

$517 @edei1e? onvaae ne4end?

3518 ov4a11’ Gaieua wvasaT si120 COMPAR HBY SEEING IF THE DESCRIPTOR
3519 oo4a1e? @p1e00 guo153 S114e Mov LE

3520 04215" Ba1ave ovasae 51160 Mov HO

$521 wodai4? ooiose ovess4 51162 cc STROPY VIS BEYOND [VARTAB], IF $O COPY
3522 ov4ais? eaeene ae7ea1"

3525 pudatet avevee svaeart

3524 wader’? waiver voovse S120 Lax }GET THE LENGTH AND SAVE IT

3525 dudaavt vaieoe evoses Si2eo PusH FSINCE WE ARE GOING TO SET IT TO
3526 51240 4@ SO FRETMP DOESN*T UPDATE FRETOP
3527 @a4e2i’ @olvo0 wouesT 51260 XRA Ly VSET LT TO @ = ELIMINATING NULL
3528 51280 TSTRING IN FRETMP IS HARMLESS
3529 ov4222" oolave vvovee 51300 stax PUT @ IN THE LENGTH FIELD

3530 oe422s? volove goosid 51320 CALL FRETMP PRREE IT UP

3531 aodee4? apoono oia4a4et

3532 @e4aas? apounn ev4els?

3533 aede26e’ Aelaun ovos61 51340 PoP PSW 1GET LENGTH BACK

3534 ge4e2/? aoiono evaie7 51360 Mov Mea FREPLACE IT ( FRETMP RETURNS (0,E2 IN (HyL) )
3535 04230" Balewe 000555 51360 XCHG UT THE DESCRIPTOR POINTER BACK IN (D,/E)
3536 vo4es1" woleea ovasal 51400 PoP C) GET THE PLACE OF THE NEW VARIABLE
3537 5ideo LENGTH=2,<

3538 Eyery) CALL MOVED HCOPY THE DESCRIPTOR

3539 51460 3 LENGTHe2,<

$540 wedaser volgee 000515 sidee CALL = VMOVE>

3541 04235" Boveg0 veooour

3542 oo4as4? opopea Hedeed?

$543 oe4e35* ao1oea Buos4d 51500 PoP GET THE TEXT POINTER BACK

3544 go4a36" wolvoe oeos11 51see RET>

3545 oo4as7? 51549  COPNUM?

3540 51560 IFE LENGTH#2,<

3547 004237" BaleoH woosa6 51580 ANT 6 SETUP DISPATCH TO FORCE

3548 ao4eaet oveeve anova

3549 51600 TFORMULA TYPE TO CONFORM

3550 51620 170 THE VARIABLE ITS BEING ASSIGNED TO
3551 b042a1° Opivae gvovaL Si64e Hy PRCTBL TTABLE OF FORCE ROUTINES

3552 pusaue’ veeooD avebb4e

3553 424s? Goover aL4ess?

3554 p4a44? Baipae eva1iT 51668 cya (B,C) #TWO BYTE OFFSET

3555 bvsea5* Boluee auav—e 51680 8,0

BASIC MCS 8980 GATES/ALLEN/DAVIOUFF MACRO 47 (113) O5412 10"SEP*TS PAGE 1dn2
FS mac 6rSEPROd OS511 *LET®

3556 wos2a6" aovera auaeeo

3557 a94e47t deloee geavit 51709 Dao

3558 oodaset Beieoe ova1Te 51720 mov AM 1 (Hy L) SADDRESS TO GO TO

3559 04251" oviose ooL4s Si74e INK 4

3560 @a4a5e" aoloey ave14e 5176e Mov Hem

3561 oe425s" waleoe gva157 51780 Mov Loa

3562 we4as4? waieva weaver 51800 xt 8, PUTVAL, FRETURN TO PUTVAL

3563 964255" B7eO02 ov4eol?

3564 oed2se? envp0d ov4euet

3565 we4a57* aelaed Bves05 51820 PUSH 8B

3506 ondeeur Baivae 800551 51840 PCHL HDISPATCH TO FORCE

3567 0o4261" aaivan gvosa 51869  PUTVAL: POP ct] 1GET THE POINTER OF WHERE TO STORE
3568 51880 THE VALUE

3569 04202" Galva oves45 51900 PUSH oH SAVE IT BACK

357@ 04265" Baleae 0515 51920 CALL VMOVME > HMOVE THE VALUE IN

3571 004264" aedooa avovaor

3572 404265" ao2en0 au4esd*

3575 51940 LENGTH=a2,<

3574 51960 PUSH =H VSAVE THE VARIABLE POINTER FOR "FOR"
3575 51980 CALL MOVMF> TTRANSFER THE VALUE

3576 Ob4266" Boiveo fvosaL seoue PoP p) }FOR" WANTS VARIABLE POINTER IN
3577 Seoe0 4(D,E) FOR FNDFOR

3578 wvseor? Beioee avosaL Seoue PoP H GET THE TEXT POINTER

3579 ga4270" Boieoe 311 52000 RET

3580 52080

BASIC MUS 6980 GATES/ALLEN/DAVIDUFF MACRO 47(113) 93412 10eSEP-75 PAGE 15
Fs mac 1 ON GOTO CODE

3961 52100  SUBTTL ON GOTO CODE

3582 Sel2d IFN LENGTH, <

3585

$584 o4271? 901000 woastd S2ied ONGOTO: CALL = GETBYT HGET VALUE INTO (ED

3585 oo4a7e? doom oiiuen?

3586 @e4275* Onvane pe4eed?

3567 024a74* Boleue geA17e 52160 mov Ay 1GET THE TERMINATOR BACK

3568 oda7S* waleee aooieT Seave Mov Bra FSAVE THIS CHARACTER FOR LATER
3589 po4aTet BAleae ov0STS Seeeo crr GOSUTK TAN "ON ye, GUSUB" PERHAPS?
3590 pe4277" dane nupeI4

3591 e430" gdainve vaste se24o iy IsG0su YES, SOME FEATURE USE

3592 04301" eavevH ava3svor

$593 eu43net Govove Mv4eTe?

3594 04305" Bu1eme BvmS1T Se2eo SYNCHK GOTOTK JOTHERWISE MUST BE "GOTO"
3595 24304" ponano weoelL

3596 404305" ea1a90 ovevsS seeee ocx HBACK UP CHARACTER POINTER
3597 av4sn6" aoluoo gve11s S230 Su: MOV GET COUNT INTO [C)

3598 04307" Bolpeo soav1d seseo OCR HSEE IF ENOUGH SKIPS

3599 @o4310? Golvee ovo1TY Sesae Moy HPUT DISPATCH CHARACTER IN PLACE
3600 064311" Go1g90 ovOsIe Seseu ua HIF DONE, GO OFF

Se¢1 se43sie? cosas ov3s7e°

Seve 04313" Onova e4sel?

3603 04314° Bolvow oeos1d seseo CALL LINGT2 HSKIP OVER A LINE #

$004 444315" apcodn oH3e43*

3005 wv43sie* Oaevan wv4asiet

36 084317° @oiveo eeosTe Seana HA COMMA

Se07 Go4320" @neoae aoous4

3008 wo4321" Uole0n gvasae seqeo HIF A COMMA OOESN*T DELIMIT THE ENO OF
3609 seqae HTHE LAST LINE # MUST BE THE END OF THE LINE
3010 oo432e" On1900 oveses Seaeo LUOPON> FCONTINUE GOBBLING LINE #5
So11 44325" auoaGa au4aseT*

Se12 ov4as24? doveve ov4sis?

3613

So14 seseo

BASIC MCS 6980 GATES/ALLEN/DAVIDOFF MACRO 47(113) 03312 10eSEPe75 PAGE 16
F3 Mac peSEPe6d 05111 IF ye5 THEN CODE

3615 52520 SUBTTL IF 42, THEN CODE
cal

3616 044325* oelueo geosi5 52540 Ft
3017 904320" aoeneD de5336*

3618 04327" odnne ao4sest

$019 $2500 IFE LENGTH, <
3620 52560 IFN STRING, <
Beet 52600 LDA VALTYP $GET VALUE TYPE INTO (A)

3eee 52620 PUSH PSH>> SAVE THE VALUE TYPE ON THE STACK
3625 004330" eoleoa geaiTe Seeuo mov Aum JGET TERMINATING CHARACTER OF FORMULA
So2a 52660 LENGTH, <

3625 52680 CALL PUSHF FONTO THE STACK

3626 52700 MVE 0,0 FREEPS RELATIONAL OPERATOR MEMORIES
3627 Se7eo TLESS THAN =4

3628 se740 EQUAL 2

3629 se760 IGREATEK THAN #1

3630 $2782 LOOPIFs SUT GREATK SCHECK FOR A RELATIONAL OPERATOR
3631 Seau0 JC ENDREL FNOPE

3632 52820 NUNKELSLESSTK=GREATK+1 INUNBER OF RELATIONAL OPERATORS
3635 Seeae crr NUMREL, TIS THIS ONE OF THEN?

$034 52860 JNC ENOREL JNO SEE WHAT hE HAVE

$635 52880 cer 1 HSETUP BITS BY MAPPING

3636 52900 RAL Fa TO 1, 1 TO 2 AND 2 TO 4

$637 52920 ORA o FOR WITH EARLIER 6178

3638 52940 mov DA FSTORE NEW BITS

3639 52969 CHRGET TGET NEW CHARACTER

se40 52980 MP LooPir HSEE IF RELATIONAL

Seat 33000  ENOREL? MOV 4,0 1GET REALTIONAL MEMORIES

Bode 53020 Oka a JSEE IF THERE ARE ANY

3643 Ss0ae dz SNERR JNO RELATIONAL OPERATORS}

364g 55060 PUSH PSH FSAVE RELATIONAL MEMORIES

3645 53080 CALL FRMEVL> FPICK UP FIRST NON®RELATIONAL

So46 55108 CHARACTER AGAIN AND INTERPRET FORMULA
$647 Ssi20 JANSHER LEFT IN FAC

3648 004331% anivoo vnsTe 93140 LENGTHe2, <CPI 44 FA COMMA?

3049 904332" vevove eoows4

3650 04335" Onteus Bvas14 55160 cz CHROTK> HIF SO SKIP 11

3051 004334" dedove ovs426"

3052 0v4335" aevave 04526"

3653 53160 LENGTH, <

3654 994336" Ho1ove eo0376 53200 cPr GoToTk TALLOW "GOTO" AS WELL

$055 004337" agave wovgero

$656 904340" Ooinoe avOste ss2e0 sz oKGoTo>

3657 dvds4ait Booed Bvas4o?

3658 Go434e? dooeoa 904334"

3659 904345* Boleao gvasiT ssaua SYNCHK THENTK PMUST HAVE A THEN

3660 904344" Heooue weeds

3661 a4545* velone guausS 55260 ocx H

$662 04340" 55280 OKGOTO:

S03 53300 FE LENGTH, <

Seed 53320 Por Psa

3065 53300 POPR }POP OFF NUMBER

3666 53500 IFN STRING, <

Soe7 55360 XTHL> COMPARE FORMULA TYPES

FRMEVL FEVALUATE A FORMULA

BASIC MC
Fs

BASIC NC
F3

3721
37ee
3723
3724
3725
3726
3727
37268
3729
3730
3731
3732
3733
3734
3735
3736
3737
3738
3739

S 8080
mac

oo4as4er
wo4asay?
wo43sar

ooassit
ov4sse?
oua3sse

wo43sa?
ao4gsst
204350"
wo4ssrt
004360"
oo4se1?
904362"

0436s"
ovasear

Bv4sest
904360"
we43ert

S ase
mac

ee4370t
ao4a37at
oo43rer
oe437st
eous7ar
wu437s"
004370"
ooa37r?
eeagoer

ep4agit
wo4auget
wo4aas?

gaaaoat
oe44ase
onaane?

GATES/ALLEN/DAV LDOFF

OrSEPmod USt11

Be1090
dono00
eoeee

eaioo0
veooae
aneeae

op 1000
aaiove
voeoae
wpeena
oeinve
avovaa
aveooa

eeiev0
2oevaa

aeivao
@eeceo
evouea

GATES/ALLEN/DAVIOOFF
OrSEP R64

ao1000
ae1990
Be1ev0
@o1000
ao0eea
ao1090
eo0000
ano220
aai01

901000
aaneae
eaovne

eo1e0e
wovwse
epoca

avosis
acovour
aeasaie

evesie
ov4ases?
owasa7?

weasel
g0osse

oeavio®
weasse?
ovasas

oe3s75°
goasse?

voaves
oogeus

eo0s15
avae7er
ovaselt

seit

eegeeT
evasie
ovaser
geasTe
euaeee
aeasne
oe4ses?
ae4360"
aeaeas

aeosee
aeases?
ab4sTet

evnsas
oeassae
peaane?

MACRO 47(113) 05
Ih eee THEN CODE
53400
53420
53440
53460
53480
53500
53520
53540
55560
53580
55600
53620
53640
53660
53680
53700
53720
53740
53742
53744

IFE

IFN

53746
53768
53780
53800
sseee
53840

55860
53880
55900
53920

IFW

OOcOND:

53940

53960
53960
sage 7
Suge
Sanaa

IFE

i

"ELSE"
i
FALSIFS

54ap6e0
54080

54100 SKPMRF?

Sai20
S4ai4e

MACRO 47(115) 03
see THEN CODE

Saiee

54180

s4200

Suzeo

sazaa

S4a200
Su2eo
54300

54320
S43ae

54360

112 10*SEP*75 PAGE 1691

STRING, <PUSH
PUSH PSH
STRING, <

Loa VALTYP
CHP H

JNZ THERR
ORA ry

Jz NUMCHP
CALL = STRCMP
IMP SKPNCN>
CALL FCOMP
INR A

RAL

PoP 8
ANA B>
LENGTH, <
LENGTH=2,<

CALL = -VSIGNe#>

LENGTH=2,<
FSIGN>>
LENGTH, <

Por H>
LENGTH#2,<

rd PALSIF>

LENGTH=2,<
REM>

era
CHRGET

Goto

one GONES

LENGTH=2,<
HANDLER, HERE UN FALSE
MVE Ont

CALL DATA

$12 1eSEPR75 PAGE 1602

OkA
RZ
CHRGET

CPI ELSETK

NZ SKPMRF

p)
SKPMRF

boconp>

SAVE ThE TEXT POINTER
PRESAVE RELATIONAL MEMORIES

GET VALUE TYPE
HOH) HAS OLD VALTYP ARE
VIF NOT ITS A TYPE ERROR
SEE WHAT TYPE IT WAS
FZERO MEANS IT WAS NUMERIC

TNUST BE STRING, SO STRING COMPARE

HSKIP OVER NUMERIC COMPARE

JCOMPARE THE 2 SIDE OF THE RELATION STATEMENT
HBUILD RELATIONAL BITS

HLESS24 EGUALE2 GREATER=1

TSINCE CARRY IS ON ONLY IN

5377 CASE (FCOMP & STRCHP)

JPOP OFF WHAT RELATIONAL OPERATOR WAS

HSEE IF WE MATCHED

THEY

FOSFALSE ALL OTHERS®TRUE
HPOP OFF TEXT POINTER
THANOLE POSSIBLE "ELSE"

VIF TEST FAILED w= JUST SKIP REST OF THE LINE
TPICK UP THE FIRST LINE # CHARACTER
HLINE NUMBER MEANS "GOTO"

VINTERPRET NEW STATEMENT

IF" CONDITION

NUMBER OF "ELSE"S THAT MUST
1BE SEEN, "DATA" INCREMENTS THIS
FCOUNT EVERY TIME AN "IF" IS SEEN
FSKIP A STATEMENT

mms" 18 STUCK IN
180 THAT "DATA

FRONT OF "ELSE"S

WILL STOP BEFORE "ELSE" CLAUSES

VEND OF LINE?
VIF SO, NO "ELSE" CLAUSE
VSEE IF WE HIT AN "ELSE"

HNO, STILL IN THE "THEN" CLAUSE

FDECREMENT THE NUMBER OF
}MUST BE SEEN
FSKIP MORE IF HAVEN?T SEEN

MELSE"S THAT

TENOUGH

FFOUND THE RIGHT "ELSE" = GO EXECUTE

BASIC MCS 8980 GATES/ALLEN/DAVIDOFF MACRO 47 (115) @3312 100SEP=75 PAGE.
FS mac ORSEP#o4 OS¢11 PRINT CODE

3740 54400  SUBTTL PRINT COVE
3744

374 $a44o IFN LPTSH,<

3743, 54468  LPRINTS NVI Ant SAY NON ZERO

3744 54480 STA PRTFLG> SAVE AWAY

3745 ovd4nT? auivea aeavss 54502 ocx H

$146 gedaiet aaieoe avaser 4520 CHRGET FGET ANOTHER CHARACTER

3747 oo4a11¢ Baiedo oeosie S4sao Je croo HIF WE SEE A TERMINATOR

3748 wo4aie? anoove Be4ses?

3749 @04415" avavao ovaaas?

3750 54560 G0 TYPE A CRLF

3751 904414" valde ovas1e 54580  PRINTCS JHERE AFTER SEEING TAB(X) OR » OR 7.
3752 54600 FIN WHICH CASE A TERMINATOR DUES NOT
3753 54620 }MEAN WE SHOULD TYPE A CRLF
3754 54640 BUT JUST RETURN

3755 54660

3756 54680 A TERMINATING GUOTE?

3157 54700 STROUL

3758 Ss4reo NEWCHR> A QUOTATION == JUST PRINT IT
3759 g04415* ap1e90 weosTe 54740 TABTK

3760 ve44io’ endoee BvAede

3761 ao4a4iT? @oinve voaste 54760 TABER FTHE TAB FUNCTION?

37e2 o44a0? aeovon G@4577°

3763 vadaai? deoven eater

3764 54780 LENGTH, <

3765 Ma4aeet ateae wwos7e 54800 cer SPCTK

3766 e445? apvone Bonede

3767 Me44aa? eo1nee ovaste 54820 wz TABER> VTHE SPC FUNCTION?

5768 Gva4as’ BoveRe Bo45TT?

3769 Bed4a6* Boeoe0 ov44avt

3770 v44eT? Botvae 900345 54840 4 FSAVE THE TEXT POINTER

3771 904430" avieae weosTe 54860 4a

3772 904431" Bo0e00 oous4

3773 Mv4432* Bo1000 oveste 94880 COMPRT HIS 11 A COMMA?

3774 004433" wpeeDe av4555°

3775 004434" @pagv0 @e4aes?

3776 304435* Baier aoasTe 34900 cr 59 HIS IT A ym

3777 04436" @ovave ovaLTs

3778 gv443r? @vinea geasie 54920 vz NOTABR

3779 oo444e? aoGo0e wodesTt

3786 v4441" Bogave Bo4aasst

3781 goaaae? eoiove oeesar 54940 PoP 8 JGET RID OF OLD TEXT POINTER
3762 04445" Goiven oveS1S 54960 CALL FRMEVL BACK UP ONE CHARACTER AND READ THAT ONE
3763 @o44a4? anoeee 6e5536°

3784 gv4445* eoveve wo4aaer

3785 54980 JAGAIN SO THE CONDITION CODES ARE RIGHT
3786 55008 FEVALUATE THE FORMULA

3787 04496" Bolevo ovouss 55020 ocx 4 BACKUP FROM TERMINATOR

3788 poa4aT? woledo Bve345 55040 PUSH OH SAVE TEXT POINTER

3789 55060 STRING, <

3798 s5062 LENGTH#2,<

3791 0445" eoteao oasis 55064 CALL -GETYPE SEE IF WE HAVE A STRING
3792 24451" Booe00 aeoseT?

BASIC MCS 6986 GATES/ALLEN/DAVLOUFF MACRO 47(113) 03312 10"SEP=75 PAGE.
FS mac beSEPe6d S311 PRINT COOE

3793 @ed4se? Goda ovaaaat
3794 004453" olove gvasie s5066 rd STRUON> VIF SQ, PRINT SPECTALY
3795 fe4454 aoveoe weasoT?

3796 094455" Bavave gva4si?

3797 55068 LENGTH#2,<

3798 55080 LOA VALTYP

3799 551008 ORA ry

3800 ssiee INZ STRDON>> FHAS IT A STRING FORMULA?
3801 004456" ea1900 avasid s5140 CALL FOUT TMAKE A NUMBER INTO A STRING
3802 994457° 20 9vouoe%

3803 aoaueo’ ani goausa?

3804 55160 STRING, <CALL - STROUT> JIF STRINGS OFF JUST OUTPUT IT
3805 55182 STRING, <

3806 94461" Oaloev 9u0315 55200 CALL © STRLIT PMAKE IT A STRING

3807 Bv4a6e* Bpeeee BuToSTF

3808 24465" Bpaged Bua4asTt

3809 004464" aoiea0 vvoese sseee LHLO = FACLO GET THE POINTER

3810 04465" Onoove auies7*

3611 @04460° wouaee Be4dee*

3b1e2 ssa4e LPTSW,<

3813 55260, Loa PRIFLG

3614 55260 ORA a

3615 55300 Jz Istty LPT OR TTY?

3816 55320 Loa LPTPoS

3817 59340 ADO 4

3616 55360 crr LPTLEN WILL THIS NUMBER OVERLAP?
3819 55380 JMR LINCHK

3820 s54va IST TY#>

3821 o4467" eo1gee ovovTe so4aeo Loa TryPas FSEE WHERE WE ARE

3822 004470" Bavece avov4aT’

3823 04471" Bader” Be4d46S*

3824 04472" voloae BuoeDe ss44o AD 4 FADD THIS LENGTH

3825 04075" wolcHD voosTe 55460 cPr LINLEN FSEE IF GREATER THAN THE LINE LENGTH
3626 04474" Baveee Beaito

3627 ooaarar 5548@  LINPTS=8t,01

3828 004475" waleve avesed 555@0  LINCHK: CNC croO VIF SO CRLF

3829 9o4476" BoneBD euasas?

3630 oe4477" BoeGBa Go4a7er

3831 G045n0" On1090 200515 s9520 CALL STRPRT> PRINT THE NUMBER

3832 004501" @p0a00 BuTT4eF

3833 wo45a2t Bnvava gv4476°

3834 004505" Bo1eee avauTe s5s4e MVE FALWAYS END WITH A SPACE
3835 024504" evoree avoeae

3836 v45n5" Bp1ea0 09537 55560 OUTCHR

3837 55560 IFN STRING, <

3638 55590 IFE LENGTH=2,<

3839 04500" oo1eu0 svae67 55595 ORA TTURN OFF THE ZERO FLAG
3840 04507° valeve ov0s14 55597 STROON: CZ STRPRT>

3641 004510" Beee0a BeTT46

3642 GO4511" Baeeee Yeaoui*

3643 59598 IFN LENGTH#2,<

3644 55599 RA iy

3845 5560@ — STRDON CNZ STRPRT>> FJUST PRINT STRINGS

BASIC NCS 6980 GATES/ALLEN/DAVIDUFF MACRO 47(113) O3312 10eSEP=75 PAGE 1792
FS MAC beSEProd OSt11 PRINT CODE

3640 wa4512" Beivae ooDs4aL 55620 Por
3847 004515" welove gvesa3 55640 ame TPRINT SOME MORE

3848 004514" @pa000 Bv4aaier

3849 904515* @pd9B0 gu4asier

3850 04516" @pianD ovov66 So66d  FININLE MVI JPUT A ZERO AT THE END OF BUF
3851 04517" eovraa guovee

3852 v04sau' weipee guoeaL 55660 UxI Hy BUFMIN VSETUP POINTER

3853 g045a1" oeve00 gu1430"

3854 004522" Beaave anasiat

3855 ss7ee TFN LPTSWr<

3856 ss7eo pa PRTFLG

3857 s574a ORA a

3858 S576 JNZ PRINTH>

3859 oases? aa1990 ovovTe 55760 MVI Ay13

3860 wusse4* Bov920 auav1d

3861 004525" Gaieon avovEe 55800 STA Typos IMAKE TTYPOS LESS THAN LINE LENGTH
38e2 ue4s26" eov9a0 awovaTt

3663 084527" apvn2e gv45e1°

3864 55820 780 CROO DOESN*T GET CALLED AGAIN
3865 Gv4s3u" Beieae svass7 S584 OUTCHR

3866 004531" Beiave avo076 55868 MVI Ato

3867 004532" Be90U0 goou1e

3668 04535" Gaiedo 4eo337 95860 OUTCHR

3669 004534" epieeo ounoTe 55900 CRFINS LDA NULCNT GET NUMBER OF NULLS.

3870 004535" oveaee vuoede’

3871 004530" apen09 woaseot

3672 004537" @oivee BuavTS 55920  PRTNUL: DCR a

3873 394540" @a1g9e gvevee s594e STA TTyPOS VEVENTUALLY SETUP TTYPOS=0
3874 494541" Bveoee sueu4T?

3875 004542" apvoae aoasss?

3676 04543" evioee nvosiO 55960 RZ FALL NULLS DONE [A] 30

3877 55980 }SOME ROUTINES DEPEND ON CROO
3878 Seave TAND CRFINS RETURN (Al =@ AND Z TRUE
3879 @edsad? gpioev ouas65 Seaeo Push SAVE THE COUNT

3880 004545" eeieaD guaesT 56040 XRA a FEATS A NULL

3661 094546" aoigee 000537 Seaeo OUTCHR SEND 17 OUT

3882 004547" Apiove Huo3e1 Seaee POP Psu FRESTORE THE COUNT

3683 004550" Golc90 veesas Se1ed IMP PRTNUL HLOOP PRINTING NULLS

3864 094551" @peebe Bv4537°

3865 vu455e" @9e000 gu4asait

3666 Se12e FE STRING, «

3867 56142 STROUI: INX

3888 56160 © STROUT: MOV

3889 50180 ORA CHECK FOR END OF LINE

3890 Soave RZ FLET IT ENO THAT WAY

3891 56220 INX

3892 Se24o crr TA TERMINATING QUOTE?

3893 Se2cee RZ TDONE IF 80

3894 Se280 OUTCHR PRINT THE CHARACTER IN (Al
3895 50300 cPr cr VIF IT#S & CARRIAGE RETURN
3896 Sesee cz ckoo TYPE LINE*FEED AND SET (TTYPOS) eo
3897 5e340 IMP STROUT> }PRINT MORE CHARACTERS

3898

BASIC MCS 898U GATES/ALLEN/DAVIDUFF MACRO G1(113) O5812 1005EPm75 PAGE 17-3
Laj mac GrSEPr04 OSt11 PRINT CUDE

3899 56360 COMPRT: IFN LPTSWs<

3900 50400 Loa PRTFLG FOUTPUT TO THE LINE PRINTER?
3901 Seaed Ly TNGNeZERO MEANS YES

3902 Seago ISCTTY NO, DO TELETYPE COMMA

3903 Seadoo Loa LeTros HGET LINE PRINTER POSITION

3904 50480 <<<LPTLEN/CLMWID>=1>*CLMWID>7POSITION BEYOND WHICH THERE ARE
3905 Seve JNO MORE COMMA FIELUS, SO

3966 56520 cer NLPPOS #COMMA JUST DOES A "CRODO"

3907 56540 SMP CHKCOM USE TELETYPE CHECK

3908 56560 ISCTTY3>

3909 004555 aoledo ovov7e 56580 Loa TTYPOS 1GET TELETYPE POSITION

3910 904554" BooeeD eoBv4T*

3911 04555 Oaeoon gv4551*

3912 QuOoTe 56600 NUTPOS#S<<<LINLEN/CLMWID>=1>eCLMWID>FPOSITION BEYOND WHICH THERE ARE
S913 56629 JNO MORE COMMA FIELDS

3914 04556" @21000 gv0376 56640 cPL NUTPOS 750 ALL COMMA DUES 1S A "CROO"
3915 4e4ss/* ecevae aenvTe

3916 avassT? $6660 LINPT4se8 TFIXED UP BY "TERMINAL WIDTH" QUESTION
3917 B04560" BolvoO Bvos24 56680 CHKCOMs CNC CkDO FTYPE CRLF

3918 @04561% Bedeva Bv45e5*

3919 04562" aoveve wo4ssat

3920 804565" GoleaH Buns2e 56700 dnc NUTABR TAND QUIT IF BEYONO THE LAST COMMA FIELO
3921 904564" voveoe eb4e37*

3922 204565" B90008 Bb4561"

3923 @04560 auieve weese20 56728  MORCOM? SUI CLMWID 1GET (A) MODULUS CLMWID

3924 904567" apdene goev16

3925 M0457e OB1AHe BbOS2e 56740 MORCOM

3926 we4s7i? BReYRw Bw4So6"

3927 04572? BnveHe HE4564"

3928 804575" BOlvea BHOWST 36768 HWE WANT TO FILL

3929 56760 HTHE PRINT POSITION OUT

3930 56800 4TO AN EVEN CLMWID, SO

5931 56620 WE PRINT CLMWIDe(A] MOD CLMWID SPACES
3932 @4574* Boieao gve305 56848 P ASPA2 7G0 PRINT CA} +1 SPACES

3933 204575" BeoRee y4b26°

3934 04576" BePeve Mw45TIE

3935

3936 go4s77t

3937 @0457/" Ouieve a0e565 0 LENGTH, <PUSH Psw> TREMEMBER IF [A] sSPCTK OR TABTK
3938 LENGTH, <

3939 CALL. INTIOX> FINTEGERIZE A FORMULA INTO (0,E)
3946 LENGTH, <

3941 Oo4e00" eoinwo 000315 CALL GTByTC> VGET VALUE INTO CE}

3942 @v4eal’ boeouE M11e17°

3943 @o4ene" KaBeea Bv4575*

3944 ge4eus? aotedo ova3siT SYNCHK ")"

5945 B04604" Babee BHeUSL

3946 4H4605" Bo1eeo BonBSS ocx H

3947 LENGTH, <

3948 O04600" Galena oLese1 PoP PSw iGET BACK SPCTK OR TABTK

3949 4007" GoledD BvOSTS cPr SPCTK> WWAS IT SPCTK?

3950 004610" Baveoe Beaede

3951 04611" oatooe ovo345 Push }SAVE THE TEXT POINTER

BASIC MCS 8980 GATES/ALLEN/DAVIDUFF MACKO 47 (113) 95312 1USEP=75 PAGE 1794
FS mac 6eSEPeed OSt11 PRINT CODE

3952 57120 FN LENGTH, <
3953 ase1et ee1e9e Bve1TS 57140 Mov AYE 7FOR "SPC" PUT THE FORMULA
3954 Gode1st eolouy avosie ST1060 eri ASPAC> VALUE IN CAT

3955 494614 apenan av4eert

3956 064615" avoaDD av4eul?

3957 57180 LPTSW.<

3958 57200 Loa PRTFLG TLINE PRINTER OR TTY?

3959 s7220 OKA ry FNON*ZERO MEANS LPT

3960 sTeae Jz TTYIST

3961 57260 Loa LeTPos GET LINE PRINTER POSITION
3962 57280 IMP DOSIZT>

3963 Mv4616" Balone evouTe 57500 TTYIST: LDA T1yPOS 1GET TELETYPE PRINT POSITION
3964 uedeis? epeone Boow4Te

3965 204620" BoODDe ueaola?

3966 @v4621" Bainve aLvoLsT 57320 DUSIZT: CMA JPRINT [EJ#(A} SPACES

3967 G04e22" Opiave wooeDs 57340 aod [2

3968 dvd623" Boieee ovasee 57360 INC NOTABR VIF NEGATIVE, DON?T PRINT ANY
3969 Gode24? Bavave 204637"

397@ Bode25" Ovevee av4e1T?

3975 57380 SPACES

3972 04626" apieny ovooTS 57400 ASPA2s INR

3973 04027? Belese gvo107 57420 ASPAC: MOV 1(B) NUMBER OF SPACES TO PRINT
3974 004630" Galeoe BvouTS s744e ches F(A) ESPACE

3975 004631" ope goovau

3976 Bed65e" Le1000 BouS3T 57400  REPOUT: OUTCHR PRINT (A)

3977 04633" anivae eveves 57480 OCR HDECREMENT THE COUNT

3978 004634 Bol0e0 Beusee 57508 INZ

3979 004635" Ba0000 Bv4oset

3960 004636" @p20G0 avabedt

3981 00463/* Bo1900 auosat 97520 NOTABR: POP WPICK UP TEXT POINTER

3982 wedoae? eoloae avaseT 57548 CHRGET TAND THE NEXT CHARACTER

3983 004641" enloge suasus 57360 JMP FAND SINCE WE JUST PRINTED
3984 GvdeGe" Bovavo Bua4Iar

3985 004643" opodaa gv4o35t

3986 57560 FSPACES, DON?T CALL CROO
3987 57600 VIF 1T*S THE END OF THE LINE
3988 S762

BASIC MCS B@8U GATES/ALLEN/DAVIDUFF MACRO 47(115) 03812 10eSEP=75 PAGE 18
FS mac OrSEProd S311 INPUT ANO READ CODE

3989 57642 SUBTTL INPUT AND READ CODE
3990 $7660 IFN LENGTH, <

3991 04644" eoeeae oeavTT $7680 TRYAGN? DC"PREDO FROM START"

3992 ge4ea5* wnov00 geo1ee

3993 aode4e* aodnue voe1os

3994 204647" aoaove availed

3995 @vdesu? eoooee vouiiT

3996 004651" eneeee sveLan

3997 do4eSe* apoeee geoive

3998 @o4055° Bovown aoeiee

3999 de4e54* eroee 90117

4000 04055" aoaveo wve115

4001 004656" wenae BveLde

4uve 004657" epenen Boeres

4003 Be4ee0" angoee geared

4004 e24661" aogane avero1

4005 04662" Conee Yueree

40v6 G04665' wooed gered

4207 204605" OoeeaL veased

4008 2046604" apeove aoaLis

4989 04065" agveve Boouie

4010 064666" aevea0 avavad @

4oit

4oie HERE WHEN THE DATA THAT WAS TYPEO IN OR IN "DATA" STATEMENTS
4o1s IS IMPROPERLY FORMATTED, FUR "INPUT" WE START AGAIN,
4via FOR "DATA" WE GIVE A SYNTAX ERROR AT THE DATA LINE

4015

4016 Bo4667" BP1ae@ wwaLTe RMNOKS LDA FLGINP JAS IT READ OR INPUT?
4017 204670" Meee Be1one*

4018 @o4e71" eeeava God4oaet

4019 g04e7e* Beioee Dve67 ORA a VZEROSINPUT

4ven 004675" eolove svasce INZ OATSNE GIVE ERROR AT DATA LINE
4021 go4e74* aooede aueved?

4vee 04e75* aorwae au4o7ut

40e3 Pop 8 4GET RID OF THE POINTER INTO THE VARIABLE’ LIST
4924 04676 values ovAsaI

4ee5 0467!" Beigoo gvoEdI uxt Hy TRYAGN

4026 904700" anoede go4e4n?

4e27 9e47e1* weave Guae74?

4v28 end7ee waleva av0s15 CALL © STROUT PRINT "2REDO FROM START"
4029 04705" aneaee HuT7745¢

4030 004704" Heeoaa Bv47Q0°

4031 904705" Boigoe Bveuse LHLD TEMP FSTART ALL OVER BY GOING BACK
4032 04706" HooaGD Be1603"

4033 Bv4a70Tt Bedove Bv47aS¢

4934 904710" Bo1noe gveS11 RET> 170 NEWSTT POINTING AT THE START OI
4035 OF THE "INPUT" STATEMENT
4036 woa71i? INPUTS

4037 IFN LENGTH, <

4938 o04711¢ Bo1ea 000376 CPI 34 HIS IT A QUOTE?

4039 904712" apoE Yooude

4040 IFN CONTRWe<

4041 004715* Boloee gvav76 VI Ayo BE TALKATIVE

BASIC MLS 8980 GATES/ALLEN/DAYLDUFF MACRO 41 (113) 03312 10-SEP=75 PAGE 16-1
FS Mac beSEPre4d O5t11 INPUT AND READ CODE

@@4714* eovvve eeovou
@04715¢ oe eevee 58100 STA CNTWFL> TFORCE OUTPUT
ov471e* booea wv1541°
oo4717* OoveoR owAa7eEF
ea472e? onioLe voosee se1eo INZ Noratr VIF NOT NO MESSAGE
e04721" wpdooe gu473s?
ae4a72e" ep9000 wua7io®
se14e STRING, <
904725" Boieay e8O315 56160 CALL «= STRLTI JMAKE THE MESSAGE A STRING
eo4724" anoene vTedor
@e4725* gone e4a7ait
204726" Galovo vOs17 58160 SYNCHK 59 JMUST END WITH SEMI*COLON
ee4727" aoneae veers
004730" Paige BLEs4s se2eo PUSH oH TREMEMGER WHERE IT ENDED
004731" Bpio00 Bv0315 Se220 CALL STRPRT #PRINT 17 OUT
@e4732" ando0y euTT4e*
024735" ayoede ow4a7edt
064734" valve 9v0341 seed Por W>
56260 IFE STRING, <
5e26e CALL = STROUI
58300 SYNCHK 59> VENDS WITH SEMI*COLON
€04735" Goivee geosas 583e@ = NOTUTI: PUSH =H
58340 FE FUNCTS,<
56360 LHLD CURLIN 18 1T DIRECT?
Sesee MVI E,ERRID VIF SO "ILLEGAL DIRECT" ERROR
se4ee INK 4 }OIRECT MEANS THAT
seqee Mov Ay FCURLIN®65535
Seago ORA 4 FADDED ONE AND GOT Oo?
564ee Jz ERROR> VIF S0,GO COMPLAIN
5e4so FUNCTS,<
004736" Belo ovO315 58500 CALL ERRDIR> FUSE COMMON ROUTINE SINCE DEF
204737" opvova BUvTd3e*
084740 Booed Bo473e°
56520 FOIRECT IS ALSO ILLEGAL
@e4741* On1000 900315 5854 GETAGN: CALL = @INLIN HTYPE "2° AND INPUT A LINE OF
@e474e* BovQVy euedeet
oe4745* aoovaa ov4737°
@e4744* aioe evev4s 56560 IFN LENGTH, <INX FF NO INPUT WE QUIT
@04745* Ooo eee1Te 5esee mov aM
wed74e" votive evazer 58000 OkA A
ee4747? voi weoess Seeee ocx H
00475b* Boies avesel S8e4e POP 8 TAKE OFF SINCE MAYBE LEAVING
084751? @oigee wuesie 58600 rd STPEND VIF EMPTY LEAVE
0@4752" Bovvee av3500"
904753" gaoooe avaraet
204754" enivee Bvesed 58680 PUSH B> HPUT BACK SINCE DIDNT LEAVE
904755" eiooe evese3 58700 MP INPCON
We475e" wovoee oLATEd?
094757? eoacde e@uv4Tse?
Be4760" aioe eLas4s 58720 READ? «PUSH oH WSAVE THE TEXT POINTER
wea7el? Ovicee evouse se74e LHLD = DATPTR GET LAST DATA LOCATION
@e4a7ee? opvo0e av1627°
624765" Brae Be475e*

BASIC MCS 498U GATES/ALLEN/DAVIDOFF MACRO 47 (113) 05312 10"SEPm75 PAGE 1802
FS Mac beSEPwod OSt11 INPUT AND READ CODE

4995 004764" aeic0e avose6 58760 xwO 701000, 70366 HORI" TO SET [A] NON@ZERO

4096 004765" aeipan gvmesT 58764 — INPCON: XRA A FSET FLAG THAT THIS IS AN INPUT
4097 @G4766" Oe100e avov6e Seavo STA FLGINP HSTORE THE FLAG

4098 ou4767* anvene avieuet

4999 004770" Onaeoo au4a7eet

4100 38820

4101 5e6au IN THE PROCESSING OF DATA AND READ STATEMENTS?

aiee 56860 ONE POINTER POINTS TO THE DATA (IE THE NUMBERS BEING FETCHED)

4103 5888 ANO ANOTHER POINTS TO THE LIST UF VARIABLES

4104 56900

4105 S890 THE POINTER INTU THE DATA ALWAYS STARTS POINTING TO A

4106 58948 TERMINATOR w= A, OR ENDmOF*LINE

4107 58960

4108 994771" Oglonm oves43 56980 XTHL #(H/L)2VARIABLE LIST POINTER

4109 58982 }DATA POINTER GOES ON THE STACK
4119 04772" aloes epovaL 59080 xw0 7010001 PYLXI 8," OVER THIS CHECK

4111 004775" Woleoa ovasiT 5902@ LOPOT2: SYNCHK 44 IMAKE SURE THERE IS A",

4112 404774" apoven o000s4

4113 404775" @aieoe B00s1d 59040 CALL PTRGET FREAD THE VARIABLE LIST

4114 004776" @00000 gu6ses*

4115 904777" Oeoone «wp4a7eT?

4116 59000 FANO GET THE POINTER TO A VARIABLE INTO (0,E)
4117 ovSaee" @pieue suesas 59080 PUT THE VARIABLE LIST POINTER ONTO THE
4118 59100 FSTACK AND TAKE THE

ang 59120 }OATA LIST POINTER OFF

4120 s9i4e f

ayer 59160 NOTE AT THIS POINT WE HAVE A VARIABLE WHICH WANTS DATA

aiee 59168 AND SO WE MUST GET DATA OR COMPLAIN

ares 59200

4124 oa5901" ep1002 avoses s92e0 PUSH oD HSAVE THE POINTER TO THE VARIABLE WE
4125 59240 TARE ABOUT TO SET UP WITH A VALUE
4126 wesaee’ @p1ove ova17e 59200 Mov AUM FSINCE THE DATA LIST POINTER ALWAYS POINTS
4ie7 59280 TAT A TERMINATOR LETS READ THE

4126 59300 FTERMINATOR INTO (A) AND SEE WHAT
41e9 s93e0 vit Is

4130 wo5a05" opiove vvosTo 59340 CPI

4131 85y04* poeove 054

4132 waspas? aeieon ovasie 59360 era TA COMMA SO A VALUE MUST FOLLOW

4133 vusave? aevove ousues?

4134 ge5aa7* aaeove BBaTTer

4135 59380 LENGTH, <

4136 59400 ORA rN VIN THE 4k VERSION

4137 59420 INZ SNERR> WDATA MUST BE ALONE ON A LINE

4138 va5e10" epivae avov7e s944e Loa FLGINP FSEE WHAT TYPE OF STATEMENT THIS WAS
4139 gvseii? @overe abievet

414e oa5oie? BpeveD ausuoe?

4141 B05015* @aloee BooeET 59460 ORA ry

age 59460 LENGTH, <

4145 59500 INK 4 }POINT AT POINTER TO NEXT LINE

4144 59520 JNZ OATFND> VIF IT 18 A READ GO

4145 59540 FSEARCH FOR ANOTHER DATA STATEMENT
4146 G05e14" epio00 ovosee 59560 LENGTH, <JNZ DATLOP>

4147 905015" BeeuRe ab516S°

BASIC MLS 8986 GATES/ALLEN/DAVIDUFF MACRO 47(113) O3312 10eSEP=75 PAGE 18—5
FS Mac GrSEPHO4 OSt11 INPUT AND READ CODE

4148 B05e16" eeouve Basviie

4149 05017" Me1ae% BeBLTe 59560 vr Anan

4159 ge5a20" eadeee soonT7

4151 e5ea1t enioan 000537 59600 OUTCHR #OOUBLE PROMPT WHEN WE NEED MORE INPUT
4152 ovSe2e" bene Bve515 59620 CALL @INLIN HGET A WHOLE LINE AFTER TYPING "2"
4153 ea5025* eevee aveseet

4154 oe5ea4? eoveva esuis?

4155 59640 FTHE DATA NOW STARTS AT THE BEGINNING
4156 59660 jOF THE BUFFER

4157 59680 FAND GINLIN LEAVES (H,/L] 86UF

4158 ovsvase 5970@

4159 59720 LENGTH, <PUP }POP OFF POINTER TO THE VARIABLE
4160 59740 INx 4 JFUDGE CHARACTER POINTER

ater 59760 CALL REDINP> READ A VALUE USING "LET" CODE

4i6e 59760 LENGTH, <

4163 59800 STRING, <

4164 we5ed? aolave voure 39820 Loa VALTYP SEE IF ITS NUMERIC OR STRING

4165 ee5p26* onaeee v154s°

4166 e5ae7* ava000 wosvas?

4167 59840 LENGTH

4168 085030" Be1vee aves7o 59860 CPI 3 18 IT A STRING 7

4169 885031" Bove0e eaves

4179 @e5e32" @ateee wvesed 59880 PUSH PSH SAVE THE TYPE INFORMATION

4171 005035" @aivee wvasee 59900 INZ NUMINS> VIF NUMERIC,USE FIN TO GET IT

4172 005034" aoaeoa BeSsoTe?

4173 005035" Boaeea wosveo?

4a7a 59920 LENGTH=2,<

4175 59940 ORA A

4176 59960 wz NUMINS> VINPUT A NUMBER IF NUMERIC

4477 59980 VONLY THE VARAIBLE TYPE 1S

4178 ouaoe ICHECKED $O AN UNQUOTED STRING

4179 ogee CAN BE ALL DIGITS

4180 05036° aeivve wooseT e040 CHRGET

4161 995937" @oteeo evoier euveo nov D,A FASSUNE QUOTED STRING

4162 o9594u" eniona ovo1eT 60080 Mov yA SETUP TERMINATORS

4183 905041" aoiova oLves7o eu109 cr 34 HQUOTE ?

4184 oe5o4er wove ovDo4e

4185 05743" aptede ovesie ov1ee vz NOWGET I TERMINATORS OK

4186 05044? Coeova BuSvSS*

4187 905045" epep9% Bvsvs4"

4188 895040" B21090 awoLee 60140 cles FUNGUOTED STRING TERMINATORS

4189 05047" Bed000 auoLTe

4190 e5M5v? Balave gvovee ev16o NVI FARE COLON AND COMMA

4191 895051¢ @a00—8 oveLs4

4192 oo188 vex BACKUP SINCE START CHARACTER MUST BE INCLUDED
4193 ee5ese* valde awaess

4194 vee FIN THE QUOTED STRING CASE WE DON?T WANT TO
4195 vee FVINCLUDE THE STARTING OK ENDING QUOTE
4196 05955 Ba1oee 900515 62240 NOWGETS CALL 8 FMAKE A STRING DESCRIPTOR FOR THE VALUE
4197 905054° weave BvTeas?

4198 05255" woaova Beseade

4199 euade FAND COPY IF NECESSARY

4200 eve6e LENGTH=2,<

BASIC MCS 8980 GATES/ALLEN/DAVIDUFF MACRO 4/ (115) 93312 10-SEP%75 PAGE 1804
FS mac OrSEProd OS311 INPUT AND READ CODE

4201 ev595e° eo10~e Bveser 60262 © DOASTG: POP. PSW> POP OFF THE TYPE INFORMATION
42ve o5e57" @aiove 4vesss use XCHG 1(D/E) #TEXT POINTER

4203 a5ee0" ariooe ovevar ovsuo UxI Hy STRON2 RETURN LOC

4264 905961" eyoove BusuTT’

4205 €8596e2" aagvee wuSses4?

4206 e05e65* aainve aonsas ovsea XTHL A (H/L)SPLACE TO STORE VARIABLE VALUE
4207 ov5e64" aeinve aveses 60380 Push oD JTEXT POINTER GOES ON

4208 905065* a1pve 4eoses o0ava IMP INPcon> 100 ASSIGNMENT

4209 v5a66* avoved we4is7?

4219 425e67" epanee gesver?

4211 vo5e7a? erluve woeseT 60420 NUMINS? CHRGET

4212 05971" aoipan avesi5 ou4ae CALL FIN

4213 ea5e7e* Beoove avaveus

4214 905075" ap2aae Be5ve6!

4ais 60400 LENGTH#2,<

4216 ovso74* apiave ovesos o04ee IMP DUASIG> ASSIGNMENT IS COMPLICATED
4217 o05075* ecvade vosuso?

4218 205076" aoovaa avsuret

4a19 605ee FEVEN FOR NUMERICS SO USE THE "LET" CODE
4eeo ousee LENGTHe2,<

4eet 60540 XTHL FH,L) GET POINTER AT VARIABLE
4eee ensee CALL = MOVHF 100 THE ASSIGNMENT

42203 60580 POP H>> GET BACK THE TEXT POINTER
4eea a05077° 60600 STRONes

4ees 60620 IFN LENGTH, <

4226 05077" eoiove ovevss eu640 ocx 4

4227 005100" volae0 gveseT 6v668 CHRGET

4228 905101" aoieoo oevsie ove6d rd TRMOK

4229 evSiee* weve wusi11°

4a3n 985105" aaven wese7s?

4231 005104" aeiove 00376 60700 crt 44

4232 085105 verove evousa

4235 205100" oulove avosee ooreo NZ TRMNOK> ENDED PROPERLY?

4234 85107" aevevB ov4eoT?

4235 05110" Bedoos oo510e"

4236 95111" walaoe oeos4s 60740 XTHL

4237 e5112" Beles Booess 60768 cx H LOOK AT TERWINATOR

4238 005115" wa10v0 gooseT 6u780 CHRGET AND SET UP CONDITION CODES
4239 05114" oeiows veesve 60800 NZ Lopore }NOT ENDING, CHECK FOR COMMA
4240 905115¢ Baeaa— av47TS°

4241 @85116" wneove ovSsivT*

4eae 60820 HAND GET ANOTHER VARTABLE
4ea3 6ue40 TO FILL WITH DATA

4e4g

4245 085117" Yelove gveser 6vaee Pop o POP OFF THE POINTER INTO DATA
4246 085120" Oe10v8 avouTe 60908 Loa FLGINE FETCH THE STATEMENT TYPE FLAG
4247 965121" Be0OvB ovleuer

4248 05122" HaDeee wSs115¢

4249 905125" Boloue gooe6T 60920 ORA a

4250 60940 LENGTH, <RZ> #DON*T UPDATE DATPTR IF IT WAS AN
4251 60960 FINPUT STATEMENT

4252 05124" dolevn vvosss 60980 ACHG

4253 05125? veluae wvasae 61008 JNZ RESFIN UPDATE DATPTR

BASIC MLS 6980
FS MAC

GATES/ALLEN/DAV1LDOFF
brSEPRO4 OSE11

MACRO 47(113) 5312
INPUT AND READ CODE

1OeSEP*75 PAGE 1895

4254
4255
4256
4e57
4258
4259
4eoo
4261
4eee
4203
4eou
4ee5
4266
4267
4208
4269
4270
4e7.
dete
4273
4era
4275
4276
4e77
4e78
4279
4280
4261
age
4283
ae6a
4285
4266
4287
4266
4269
4290
4e91

wosi26?
aosier?

voveaa
Bovena

oesa5st

oosieit

e192 LENGTH, <
b1a4e OKA "
61060

61080 LxI

05130" avian eLeeso COULD HAVE ENDED WITH COMMA OR
COLON, BUT SHOULD BE A ZERO

O5131¢ FTEXT FOR "EXTRA"
005132"
o05135°
051 s4r
005155?
905136"
op5is7¢
Ho5140"
wosiai?
ousiaer
oesi4ase
@osiaae
evsias?
05140"
oosiare
005150"
oo5isi?
00515e¢
ovsisse
005154"
oo5159°
005156"
oasis7?
oosisit
easiour
oo5161¢
a5{ee?

eoied0
eovea0
eovvee
oe1p90
eeieoo
aeenee
eoovoo
ee1ee0
opieve
eovooe
ooepoe
eoooue
ooov0e
woovee
eovnee
@evva0
aoeneo
eeeneo
aevvae
@eone0
eovnve
eoevan
eaavue
eave
aaooae
eaeene
agavoe

gvavas
oesiaer
ovsizet
aveses
woasad
gu7ras?
905132"
ovnsar
gwosiy
ooouTt
aeo1es
900130
aeoied
ovo1ze
avoias
evovae
ovoid
aeaiar
ooaile
ovaii7
ovoize
eoias
voored
avosed
aoow1s
oeovie
eooven e>

Hy EXIONT

61108 PusH >
61lee cnz

PSAVE THE TEXT POINTER
STROUT IF WASN?T REAL END SAY SOMETHING

61140 PoP H
61168 RET
61168  EXIGNT: DC"ZEXTRA IGNORED"

GET BACK THE TEXT POINTER

SUBROUTINE TO FIND DATA
MUST BE AT
SO THE SEARCH IS MADE USING THE LINKS AT THE START OF EACH LINE,

IN THE 4K "DATA THE START OF THE LINE

IN THE 6K AND EXTENDED THE SEARCH IS MADE BY USING THE EXECUTION CODE

4ese
4293
4294

IS COMPARED WITH DATATK, EACH NEW
18 STORED IN OATLIN SO THAT IF AN

THE START WORD OF EACH STATEMENT
LINE NUMBER
ERROR OCCURS WHILE READING

4295
4296
4297
4298
4299
4300
4301
4302
4303
4504
4305
436

i

i

i

7 FOR DATA TO SKIP OVER STATEMENTS,

i

i

} DATA THE ERROR MESSAGE WILL GIVE THE LINE NUMBER OF THE
} ILL=FORMATTED DATA

i

oa5163"
oo5164*
005165"

@oiou0
ennoue
oa0ve0

eeasi5
aeav7at
905136

DATLOPS IFN LENGTH, <CALL «= -OATA>

Ife LENGTH, <POP
DATFND? IFN LENGTH, <
ovoee7 ORA A

ovosne JNZ NOWLIN>
ause1ar

wusiea?

@o5160°
05166°
oosie7?
@osi70°
wesivit

eo1e00
@eiene
aavnee
@penue

BASIC MCS 8y80
FS mac

GATES/ALLEN/DAVIDUFF
beSEPeod OSt11

MACRO 47 (413) 93312
INPUT AND READ CODE

1nSEP*75 PAGE

4307
4308
4309
4310
4341
asi2
4313
434
4315
4316
4317
4318
4319
4seo
ase1
asee
4325
asea
4325
4326
43e7
4328
4329
4330
4331
4332
4333
4334
4335
4336
4337
43368
4339
4340

61560 IFN LENGTH, <
61608 Wh
o1620

e164e Ayc
61660 cy

61680 €,ERROD

eooo4s
oeas67
oeei7a
aenece
geeuse
aeovas
aeosie
aveioe?
ou5i70°

oo517e"
oa5i73*
oesi74e
gesi79¢
ae517e*
@esi77t
aes2oe"
eeseoit
woseeer

@e1000
9e1v00
oo1000
eoicae
ee1000
voveve
201000
epooaa
eeovee

VSAVE POINTER TO THE NEXT STATEMENT
VSEE IF We ARE AT THE END

JNO DATA IS ERROR ERROD

617008 ERROR FF SO COMPLAIN

o17ee LENGTH, <INX
6174e LENGTH, <POP
61760 Mov E,M
61760 INK 4

61800 Mov oom
618e08 XCHG
61840 SHLO

FSKIP PAST LINE #
ooseast
oosen4?
weseas?
eu52ge*
aase2e/?
oaseiet
@esaii?
@a5eie*
oe52is¢
wosei4?
@e52i5* soioue
ous216" en0000
ee5217¢ oo1000
@es220" voove
oe52e21" vnecoo

61090
aeige0
@eivoe
eeicoo
eeievo
avieeo
aovav0
@ovoe0
ee1eo0
aaineo

eveser
900136
ovavas
ovoree
avosss
avovde
awis77¢
weseai?
00353
avnser
goosTe
avoeos
ovasae
ousies?
aseii?

GET DATA LINE #

DATLIN

61860 XCHG>
61860 NOWLIN? CHRGET
61980 crr

JRESTORE TEXT POINTER
1GET THE STATEMENT TYPE
DATATK VIS 1S "DATA"?

61920 Nz DATLOP INOT DATA SO LOOK SOME MORE

61948
61960

LENGTH, <POP
ouseeer IMP DATBK
woseest
wesead?

ae1900
agoves
aevooa

ovases
gosves*
ovseeo"

FCONTINUE READING

BASIC MCS 6y80 GATES/ALLEN/DAVIDUFF MACRO 47(113) @3312 10=SEP=75 PAGE 19
F3 MAC OmSEProd USt1i NEXT CODE

asay 62060 © SUBTTL NEXT CODE
43ae e2nea
4343 e210
asag oeleo
4545 belae
4346 oe160
4347 62180
4348 be2ve
4349 62220 LOW ADDRESS

4350 e2eue TOKEN (FORTK IN HIGH BYTE) 1 BYTES

} NOTES

i
i
i
i
i

4351 oeeeo A POINTER TO THE LOOP VARIABLE 2 BYTES

;
i
;
i
i
i
,
;

A FOR ENTRY ON THE STACK HAS THE FOLLOWING FORMAT?

4352 oe2ee A BYTE REFLECTING THE SIGN OF THE INCREMENT 1 BYTE
4353 62300 THE STEP 4 BYTES

4354 basen THE UPPER VALUE 4 BYTES

4355 ees4e THE LINE # OF THE "FOR" STATEMENT 2 BYTES

4356 62300 A TEXT POINTER INTO THE "FOR" STATEMENT 2 BYTES
4357 oesee HIGH ADDRESS

4358 ee4on
4359 eedeo
4500 eea4e
45e1 o05225° 62460 NEXT?

4562 o05225* Be1900 oeovel 6e4a@ IFN LENGTH, <LXxI 0, SCODE>;FOR THE "NEX

4363 gudee6" aovere soovee’

43e4 oeSee7* vevod0 avsees?

4305 62500 STATEMENT WITHOUT ANY ARGS

4366 62520 WME CALL FNOFOR WITH (0,E)#@
4367 vasesu’ bes4e

4368 i 62560 LENGTH, «

4369 62580 CALL PTRGET> PMUST HAVE A VARIABLE

4370 62600 LENGTH, <

4371 woSese" Go1000 dousea 62620 nz PTRGEY> GET A POINTER TO THE

4372 wodesit enodvn wvEdud*

4373 audaset Oeoova ouseze*

4374 e264n WLOOP VARIABLE INTO (0,E)

4375 oSa35" Op10v0 ovov4e 62660 WPUT THE TEXT POINTER

4376 005234" Opeedd e1oast

4377 005255" enve0d ovSe3i°

4376 62680 VIN A TEMP LOCATION

4379 62700 VIN CASE THE LOOP TERMINATES
4380 905236" eola0e Bvesid 2720 CALL FNDFOR FTRY TO FIND A FOR ENTRY

4381 ovSa3/* @aee0y Bu17T4at

4382 ovSe4et aovnva ausesar

4363 e274e FON THE STACK WHOSE VARIABLE NAME
43a 62760 IMATCHES THIS ONES

4385 62780 LENGTH, <

4386 eeSedit Paleve gHO30e o280e JNZ NFERR> PONEXT WITHOUT FOR"

4387 4oSeqe? ea0000 ave2ioe’

4388 ovS24s* @p9ev0 ovsesTt

4589 @@5e44 Baiowa ava371 62820 SPHL FSETUP STACK POINTER BY CHOPPING
4390 62840 HAT THIS POINT

4391 ga5ea5* eeieve ovosed 62860 PUSH WPUT THE VARIABLE PTR BACK ON
4392 go5e4e* eaieao overTe 62880 Mov HSTEP ONTO THE STACK

4393 005ea7? Baiewe aoov4s 62900 INX

TOTAL 16 BYTES

BASIC NCS 8G8 GATES/ALLEN/DAVIDUFF MACKO 47(113) @5312 100SEPe7S PAGE 1991
FS mac 6rSEPro4d S314 NEXT CODE

4394 oe525e" wol1090 Auos6d 62920 PUSH PSH
4395 wesesit ee1e90 goosed 62940 PUSH =O 7PUT THE POINTER TO THE LOOP
4396 62960 FVARLABLE ONTO THE STACK

4397 62980 LENGTH, <

4398 63000 VI E,ERRNF

4399 6se20 JNZ ERROR>

4uee o05a5e" wole00 eo515 63040 CALL = MOVE FSTEP VALUE INTO THE FAC

4401 Be5255° vaveLe oveooos

442 ga5254* apevaa ewSsedet

4403 e52e55? 9o1e0D ovoS43 63000 XTHL PUT THE POINTER INTO THE

4aea 63080 FOR ENTRY ONTO THE STACK

4405 owSase* valeva oves45 63100 PUSH oH PUT THE POINTER TO THE LOOP

4406 63120 TVARTABLE BACK ONTO THE STACK
4407 ows25/* Oeilvne Bees15 63140 CALL == FADDS TAOD THE STEP AND LOOP VARTABLE
4408 eo5260" BaeeLe gvOvove

4409 Be5a61f waeeee vesess*

4410 oo526e" aoiova evesai 63160 PoP 4 7POP OFF THE POINTER TO

agit 65160 JTHE LOOP VARIABLE

4412 085265" Ba10e0 900515 63200 MOVMF HMOV FAC INTO LOOP VARIABLE

4413 905264" weseee aeov00%

4414 905265" eoeo0e avseoet

4415 o05a6e" Balgaa gvosat 6seeu HGET THE ENTRY POINTER

4416 B05267" Go19e0 Bv0S15 6se4e GET THE FINAL INTO THE REGISTERS
4417 a05270" epoede avovons

4416 wasa7i’ @ev070 BvSeo4t

4419 wasa7et aaicoe o0054a5 o3s20eu TSAVE THE ENTRY POINTER

4420 0e5e75* Balaee Bve515 65200 FCOMPARE THE NUMBERS

4421 005274" Bev000 BoaTIae

4422 un5e75* epeva0 gvse7e’

4425 aoSa76’ eolvee ooasar 63300 h HSTILL POINTING TO THE FINAL VALUE
4424 wose77* waiver Bvosol 63320 B GET THE SIGN OF THE INCREMENT
4425 905300" eeivoo Boner 65340 8 FSUBTRACT THE INCREMENTS SIGN FROM
4426 63300 FOF (CURRENT VALUE=FINAL VALUE)
4427 05301" Baloee gvos15 65360 MOVRM GET LINE # OF "FOR® INTO [D,/E)
4428 O53ne" BaeoLe BoSETOs

4429 05305" voaeee ovSe74t

4ase GET TEXT POINTER OF "FOR" INTO (B,C)
4431 995304" baleve ovesie Looron VIF SIGN (FINAL*CURRENT) #SIGN (STEP) #6
4432 005305" wovane oeSse0"

4433 05306" oawave BeSsoe"

a43a FTHEN THE LOOP IS FINISHED

4435 805307" wvleDa 000553

4436 005310" Ouiewe dvobde CURLIN PSTORE THE LINE #

4437 005311" vavere wo1edTt

4458 4v5312" enone BuSses*

4439 005315" Baivee 00151 Lec VSETUP THE TEXT POINTER

44ae 905514" voloee ovo140 HB

4441 @v5315¢ Oe1ea0 avase5 NXTCON

4age 65316" BavoLe gose7Er

4443 05317" GaBeD0 gessi1*

aaa

4445 5320° Oalove ovS71 63580 = LOOPDN: SPHL FELIMINATE THE FOR ENTRY

44ude 65600 SINCE [H,L] MOVED ALL

BASIC MCS 698U GATES/ALLEN/DAVIDOFF MACRO 47(113) 93212 10*SEP=75 PAGE 19%2
FS MAC 6rSEPRo4 05811 NEXT CODE

agar 63620 }THE WAY DOKN ThE ENTRY

4448 045321° Ba1900 ovouse 63640 LHLD TEMP FRESTORE THE TEXT POINTER

4449 g0SS2e* Bava20 BvIEOS*

4450 905325" GonvOD Be5316"

4454 63660 LENGTH, <JMP. NEWSTT>

44se 63680 LENGTH, <

4453 005324" Ovieoe ouaITe 63700 Mov AyM HIS THERE A COMMA AT THE END
4454 asses? e190 BedsTe 63720 CPI a4 HIF SO LOOK AT ANOTHER

4455 005326" Govaee Bvevs4

4456 005327" Baleen auesee 63740 Nz NEWSTT FVARIABLE NAME TO "NEXT"

4457 005330" apanse Bv3suet

4458 005331" enevee ovSSe2e"

4459 005332" Oolese avaseT 63760 CHRGET FREAD FIRST CHARCTER

4460 @05335" volaae Bvos15 63780 CALL NEXTC> 7D0 NEXT, BUT DONFT ALLOW

4461 095334" onveda ovsesu*

4462 005335" Oppo BvSS30°

44o3 63800 FBLANK VARIABLE NAME (D,E]=STK PTR
4464 63820 TAND WILL NEVER MATCH ANY VARPTR
4465 63840 FUSE CALL TO PUT DUMMY "NEWSTT" ENTRY ON
4466

4467 63860

BASIC MCS 8980 GATES/ALLEN/DAVIDOFF MACKO 47 (113) 05312 10#SEPe75 PAGE 20
F3 hac brSEPmo4 OSt11 NEXT COVE

4aes
4469

BASIC MCS 6980 GATES/ALLEN/DAVIDOFF MACRO 47(113) @3212 10rSEP=75 PAGE 21
F3 Mac OrSEP=64 OSt11 FURMULA EVALUATION CODE

4470 90820  SUBTTL FORMULA EVALUATION CODE

4u7y

ate aueed IFN LENGTH=2,<

4473 ag060 IFN STRING, <

4a74 ov1ee

447s av1ee THESE ROUTINES CHECK FOR A CERTAIN VALTYP

4476 ao14e (A) 18 NOT PRESERVED

4477 av16d

4478 0160 CALL | FRMEVL EVALUATE A FORMULA

4479 aveeo *01000,70366 © FTURN CARRY OFF WITH ORI
4480 oveee FSET CARRY

4464 ova4e VALTYP. 10 MEANS NUMERIC 1 MEANS STRING
4age ave00 a HRESULT SHOULO BE 0 OR 3
4483 avese BAD RESULTS ARE 2 AND 1
4484 an3e0 PRETURN IF CORRECT RESULT
4485 evsee E,ERRTN INTYPE MISMATCH ERROR®
4486 e340 ERROR>>

447 00300

4488 avseo THE FORMULA EVALUATOR STARTS WITH

4489 aeave (Hib) POINTING TO THE FIRST CHARACTER OF THE FORMULA,
4490 ovaee AT THE END (H,L) POINTS TO THE TERMINATOR,

4494 20440 THE RESULT IS LEFT IN THE FAC,

age angen

4493 aease THE FORMULA EVALUATOR USES THE OPERATOR TABLE (OPTAB)
4490 avsve TO DETERMINE PRECEDENCE AND DISPATCH ADURESSES FORK

4495 aeseo EACH OPERATOR,

4496 av5ae A TEMPORARY RESULT ON THE STACK HAS THE FOLLOWING FORMAT
4497 aesee

4498 avseo THE ADDRESS OF *RETAUP* == THE PLACE TO RETURN ON COMPLETION
4499 aveed OF OPERATOR APPLICATION

4500 avezo

4501 ave4a THE FLOATING POINT TEMPORARY RESULT

4sve ev6e0

4503 aveee THE ADDRESS OF THE OPERATOR ROUNTINE

4504 2e700

4565 90720 THE PRECEDENCE OF ThE OPERATOR

4506 ao740

4507 20760 TOTAL 1@ BYTES

4508 ov7eo

4509 avsoo  IFE STRING, <FRMNUME>

4510 205336" wolves eenvss 6820 © FRMEVL: OCK 4 BACK UP CHARACTER POINTER
4511 905337" Baloo ovoLze 00840 FRMCHKE MVE 00 FINITIAL DUMMY PRECEDENCE IS 0
4512 405340" aadeve avenue

4513 05341" voted oases 00860 «= LPOPER: PUSH 0 FSAVE PRECEDENCE

4514 05342" eoioee Bves1s 20880 CALL = GETSTK MAKE SURE THERE 18 ROOM FOR RECURSIVE
4515 205343" apoone sewed?

4516 205344" woeaoe 905534"

4517 905345* eosoos guavas ov9e0 1

4518 005546? Woleee wvasi5 ange CALL VEVALUATE SOMETHING

4919 85347" OaGea0 avEv61"

4524 05350" wooooe ov5s45"

4521 005351" anieve weeevse av9aa SHLD SAVE TEXT POINTER

4522 085352" Onoeeo ov1605"

BASIC MC

8 6980 GATES/ALLEN/DAVIDOFF MACKO 47 (113) 95212 10eSEP*75 PAGE 2te1
FS mac brSEPR64 OSt11 FORMULA EVALUATION CODE

4523 905555" evee0e Bo5S47"

4524 905354" Baleee sveuse #0960 RETAOP? LHLD TeMPe PRESTORE TEXT PTR

4525 45355" Baeeee auieust

4526 @v5356" wavove ov5s52°

4527 905357" Bolvee ovesaL ge9s@ = TSTOP: POP 8 7POP OFF THE PRECEDENCE OF OLDOP
4526 @1000 TFN LENGTH=2,<

4529 @1920 IFN STRING, <

4530 a1ede Mov ArB FLOOK AT PRECEDENCE

4531 91060 crr tee VIF ITS SOME ARITHMETIC
4532 a1080 FTYPE THING WE SHOULONTT
4533 a1100 TSEE STRINGS

4534 a1iee cnc CHKNUM>> FTYPE MISMATCH ERROR IF NOT NUMERIC
4535 5360" osinge wwaITe @114@ © NOTSTV: MOV AyM VGET NEXT CHARACTER

4536 wi1eo IFN LENGTH, <

4537 05361" aeieoe ovavae o1180 mvt 0,0 TASSUME NO RELATION OPS
4538 0S362* Maeeee voevod

4539 005365" voloee oves26 91202 LUPREL SUI GREATK HIS THIS ONE RELATION?
4540 905564" ovaeee BvoesT

4541 905365° Molove ov0532 wieee ve ENOREL TRELATIONS ALL THROUGH
4542 005366" vaeeen avs4i5¢

4543 905367" B90000 Ou5355°

4544 aoaves O124@ — NNRELSSLESSTK*GREATK#1

4545 aa5s7et wo1eed oo0S7e a1260 cPr NOREL, HIS IT REALLY RELATIONAL?
4546 05371" vawovs gvoves

4547 205372? Oaivve vuosee 1280 INC ENOREL NO JUST BIG

4548 05375" dowova gvS415*

4549 405374" @oanv0 av5566° 5

4550 05375" veives 900576 01300 crl #SET UP BITS BY MAPPING
4551 205376" Baaevo weaver

4552 05377" Balova ovoveT o1see Ral #0 10 1 1 TO 2 AND 2 TO 4
4553 5490" Gaiove voeese 21340 XRA 0 FBRING IN THE OLD BITS

4554 d054e1" @a1900 ouoeTe 81360 CMP Py) JMAKE SURE RESULT IS BIGGER
4555 wo5aae? veloan ovn1eT 01380 Mov cry SAVE THE MASK

4556 ov5495* Boi1pon auvs3e a14eo Je SNERR HDON*T ALLOW TWO OF THE SAME
4557 05404" eyeovd gwevret

4558 aus4as* apeoun Bu5573¢

4559 25496" Baines e042 o14ee SHLD TEMPS FSAVE CHARACTER POINTER
456e vvS4a/? ageene av1575*

4561 a95a10? waeoee vesaoat

4562 @v5411" Bulow” eeoseT a1440 CHRGET GET THE NEXT CANDIDATE
4563 05412" aleve avas05 o1460 IMP LOPREL

4564 005415" Bavoad 9u5563"

4565 05414" Braver o65a07°

4566 5415" Baiven gvaiTe 91480 ENDREL: MOV AyD GET THE MASK

45e7 waSa1e’ aeivan Buoe67 1560 ORA A TWERE THERE ANY?

4568 Bv54ai7* aoineD gvasee a1see NZ FANREL VIF SO, HANOLE AS SPECIAL OP
4569 aa542e" @avev0 Gusbas?

4570 905421? anvoro avs4ais?

4571 oe542e" Colove ovo17® g1s4e mov AyM 1GET THE CHARACTER AGAIN
4572 05425" Bolon2 ovov4e 01560 SHLD = TEMP3> VSAVE UPDATED CHARACTER POINTER
4573 ouSaed? apdovn Bv157>°

4974 205425" wooevD gusaeur

4575 @05426° Halewe avas26 01580 sul PLUSTK TAN OPERATOR?

BASIC MCS 6980 GATES/ALLEN/DAVIDUFF MACRO 47(113) 05312 10-SEP=75 PAGE 21-2
FS mac OrSEPa64 O5311 FORMULA EVALUATION CODE

4576 085427? aavnve ouveso

4577 95430" wolese gu0530 a16e00 Ro PRETURN IF NOT

4578 @16e0 JTHIS CAN RESULT IN OPERATOR
4379 o164e FAPPLICATION OR ACTUAL RETURN
4580 005431" Wolede guosTo a166e crr LstorK THIGHER THAN THE LAST OF?
4581 005452" gaveve 9vo00T

4562 005435" Boleea Beose0 a1680 RNC

4563 we54s4t volvog 209137 aire mov Ea JMUST MUTIPLY BY 3 SINCE
4584 aired JOPTAB ENTRIES ARE 3 LONG
4565 airag STRING, <

4586 005435° Ba1eve avovTe a1760 Loa VALTYP HSEE IF LEFT PART IS STRING
4587 05450" Mebava Yo1d4s?

4568 4e54s7* BovavY duS4uedt

4589 91780 LENGTH=2,<

4590 95440" BoleBe ovOSTe a18ve CPI > #SEE IF ITS A STRING

4591 e544 vagoae ovovas

4592 a1820 LENGTH=2,<

4593 01840 ocr A>

4594 e5442? OlnA® BeoeEs 81860 ORA E FSET CONDITION CODES

4595 01880 LENGTHe2,<

4596 a19¢0 mov A, E> PREFETCH OPeVALUE

4597 095445" woleoe ovasia o19e0 rd CaT> ;MUST BE CAT

4598 @05444* DeB0ee o10S20

4599 05445" aageBe BoS4s6"

4ovo 21940 LENGTHe2,<

on w196e RLC AB ORIGINAL Axe

4ove a1960 Ad € FADD IN ORIGINAL A

4603 aeove Mov E,a> FCREATE TWO BYTE VALUE

4eea e2020 LENGTH, <

4ees ezo4e MI D,a> FHIGH ORDER #@

4ee6 05446" Boleve Booed eevee xt H,OPTAB FCREATE INDEX INTO OPTAB
4607 005447? aavave avers?

4e08 vas45u* Opeavd gus4aaar

4609 4es451* Bo1eee avovs1 e080 pap o FADD IN CALCULATED OFFSET
4e1e ousa5e" eoleee avoi7o aeiee Moy F(A) GETS OLD PRECEDENCE
4611 05455" O91000 ooaree veieo Mov ri FREMEMBER NEW PRECEDENCE
4ei2 vv5a54? wolnve ooaeTe e2i40 CMP FOLDeNEW

4613 05455" @e1ene ovosew @2160 RNC JMUST APPLY OLD OP

deg 2188 HIF HAS GREATER OR = PRECEDENCE
4e1s oeeco LENGTHea,<

4e16 aeeeo NX H NOW POINTING AT ROUTINE ADORESS
4e17 aeaso STRING, <CALL — CHANUM> JCAN?T BE STRING HERE

4e1e ae200 VSINCE THE ONLY STRING OPERATOR
4619 92280 HIS PLUS AND RELATIONALS
4eee aesvo HOON*T COME THROUGH HERE

4eat @2320 DUPREC: PUSH B TSAVE OLD PRECEDENCE

4eee a2s4o xr B,RETAOP VOPERATOR RETURN ADDRESS
4ee3 desea PUSH 8B JFIRST PART OF "TEMP" ENTRY
4oea @2360 IFN LENGTH, <

dees aeavo Mov B,E> TSAVE SECOND BYTE OF PRECEDENCE
deze aevee FSINCE FOR RELATIONAL OPERATORS
4ee7 ae44o IT GIVES THE VALUE TYPE OF
4e28 e240 HTHE LEFT S10E AND IT TELLS

Pamics BUALaTin!

BASIC MCS 8960 GATES/ALLEN/DAVIDOFF MACKO 47(115) 85312 10-SEP*75 PAGE 21-5
FS MAC GmSEPro4 StI FORMULA EVALUATION CODE

4629 oe4ee TWHICH RELATIONAL*OPERATOR
4630 gesva TIT WAS

4es1 e520 MOV c,o

4o32 2540 CALL PUSHF

4033 e250 LENGTH, <

4o3a 92580 MOV €,B> HGET SECOND BYTE OF PRECEDENCE AGAIN
4635 82600 mov oc (0) GETS PRECEDENCE

4636 B2620 PUSHM PUT ROUTINE ADDRESS ON THE STACK
4637 eeae LENGTH, <

4638 aeoed LHLD  TEMP3>

4639 2680 LENGTH, <

4oan e700 LALO TEMP2> HIF WE DONT HAVE "LENGTH"

aoa. 2720 FON OPERATORS CAN ONLY

4oae a274e BE ONE CHARACTER SO TO "REREAD"
4o43 B276o JAN OPERATOR THAT WE LOOKED

4oaa 2760 FAT BEFORE AND DECIDED NOT TO

4oas 22800 PAPPLY WE JUST "DOCK HM

4646 2820 JIF LENGTH IS ON WE HAVE TO

4oa7 G2840 FREMEMBER THE TEXT POINTER BEFORE
46468 028600 FTHE OPERATOR AND AFTER SO WE CAN
4049 92860 FEITHER RESCAN THE OPERATOR

46050 92900 ILATER IF IT DOESN*T GET APPLIED
4o51 e920 4OR GO BEYOND IT WHEN IT DOES

4ese 02940 ame LPOPER> PUT ON PRECEDENCE AND LOOK AT A
4653 62960 NEW OPERATOR

4054

4655 85000 LENGTHee,<

4656 405450" ByuleHe 4vO5a5 aS020 PUSH 8 FSAVE THE OLD PRECEDENCE

4057 05457" Bolveo avevel aso4a uxt By RETAOP TPUT ON THE ADDRESS OF THE

4658 665460" Baveue Be5354"

4659 b85461" Bobuee BeS44a7"

4ooo 83000 PUSH 8 FPLACE TO RETURN TO AFTER OPERATOR APPLICATION
4661 05a6e" Boleoe po0se5

4662 005465" balvve goeiTe 03080 mov AyD HSEE IF THE OPERATOR IS EXPONENTIATION
46635 805464" BB1006 BHOSTO O3100 crr 127 PHHICH HAS PRECEDENCE 127

4064 685465" berevM wBea1TT

4665 03120 MZ EXPSTK TIF SO, "FRCSNG" AND MAKE A SPECIAL STACK ENTRY
4066 e546" delveo avesi2

4667 605467" BoBBve BH5553"

4668 865470" BeBELe BR54O0"

4069 805471" 871000 BeM3Te oL ISEE IF THE OPERATOR IS "AND" OR "OR"
4070 Besa7e? Baeevo BbO121

4671 805475" volnoe Bb0332 ANDORD AND IF SO "FRCINT" AND

4672 885474" HeRBKY BH5571°

4673 905475" Babowe BHS4eT"

4o74 PMAKE A SPECIAL STACK ENTRY

4675

4676 THIS CODE PUSHES THE CURRENT VALUE IN THE FAC

477 ONTO THE STACK, EXCEPT IN THE CASE OF STRINGS IN WHICH IT CALLS
4678 TYPE HISMATCH ERROR, [0] AND (€) ARE PRESERVED,

4679

4060 Bb5476"% BA1Ave BvOvTE JUMRELS LDA VALTYP HGET THE VALUE TYPE

4681 BoSa7l* bpvvHe BH1545*

BASIC MCS 8986 GATES/ALLEN/DAV1D0FF MACRO 47 (113) 95412 10eSEP@75 PAGE 2104
FS mac brSEProd O5t11 FORMULA EVALUATION COVE

4eBe ovSsne* anovee BosaTat
4083 05501" eolaee gLvosTe as3ve cry 3 AND SET THE CONDITION CODES BASED ON IT
4084 ge5see" aooedn oesoes

4065 05595" wotena eoaste assee sz THERR 7BLOW UP ON STRINGS

4686 05504" oeve0o gvoveus

4087 95505" wad0da gos477?

4668 905506 BeloaM gwae4dd assao uxt H)FACLO 4GET POINTER TO LO IN Fac

4689 05507" wedeoo 901637"

4690 025510" oadeeD doSSo4*

4691 95511" Bolvag guelte ossua com

4092 85512 Balaee noouds a3su4 H

4693 25513" oeloee avoid. 03346 8M

4694 05514? Bole dooeds 05348

4095 005515" Bolgee av0305 93360 8 PUSH FACLO¢0,1 ON THE STACK
4696 05516" velava sveste 93300 veUsHO TALL OONE IF THE UATA WAS AN INTEGER
4697 B5517" Baveve 905536"

4698 oe5s2u* apeva oesseT?

4099 w65se1" avieas evalte assee cM

4700 00552e" Belave seaLds 03384 4

4701 05525" B91900 gva106 03586 8M

47ve B05524? Baicve ovavas 05388 "

47e3 905525¢ atone weaseas 03400 6 IPUSH FACr4,@ ON THE STACK

47¢4 v5520° @aiove aoas4e asaeo veusHo TALL DONE IF WE HAD A SNG

47@5 085527? apvoee av5536°

4706 905530" waveee 4oS517*

4767 05531" eo1ovw Booed as44e Hy DFACLO SWE MAVE A DOUBLE PRECISON NUMBER
4708 4553e" Goaae Av10ss¢

4709 085535° eeoova Besser?

4718 u5534° eeioue oveseT PUSH ITS 4 LO BYTES ON THE STACK
4711 05535¢ Golaae ovas67

4712 @0553e" anieos ovai15 VPUSHD: CE 1(C] 20PERATOR NUMBER

4713 05537" @oieda gvaie7 ByA 1(B)aTYPE OF VALUE ON THE STACK
4714 085540" voivee evosas 8 TSAVE THESE THINGS FOR APPLOP
4715 95541" oe1a08 geaeer 8, APPLOP JGENERAL OPERATOR APPLICATION
4716 wossaet eavovo oese4e?

4717 905545" eoova Be553e"

4718 JROUTINE == DOES TYPE CONVERSIONS
4719 ovSS44* Goleva avas05 FINTHP: PUSH = B VSAVE PLACE TO GO

4720 95545" volove evause LHLD TEMPS FREGET THE TEXT POINTER

4721 005540" wadsap ae15s7s*

4722 B0554/* aneeed BuS54er

4723 905550" welgda ovases une LPOPER PUSH ON THE PRECEDENCE AND READ MORE
4724 w95551f wooeue eeS3ai*

4725 90555e" Bageve guSss4ee

47a TPORMULA

4re7

ares FOR EXPONENTIATION WE WANT TO FORCE THE CURRENT VALUE IN THE FAC
a7e9 TO BE SINGLE PRECISION, WHEN APPLICATION TIME COMES WE FORCE
4730 THE RIGHT HAND OPERAND TO SINGLE PRECISION AS WELL

4734

4732 005555" olev0 XPSTKE CALL FRCSNG TCOERCE LEFT HAND OPERAND

4733 905554° govana

4734 85555" BAevee BwS5S1°

Tin

Pamed4 Suara

BASIC MUS 808 GATES/ALLEN/DAVIDUFF MACKO 47(113) 03312 10"SEP®75 PAGE 2105
Mac

FS OrSEPeod 03511 FORMULA EVALUATION CODE

4735 905550" Bele avas15 05840 CALL «= PUSHF }PUT IT ON THE STACK

4736 05557" oa0000 4eoooes

4737 005560" eago0n 905554"

4738 205561" Beipee geeve1 93860 uxt 8, FPWROES PLACE 10 COERCE RIGHT HAND
4739 aSSe2e" oovaee dvavave

4740 005563 Beanne 9uS557°

ray 03880 JOPERAND AND DO EXPONENTIATION
4742 05564" ee1u%0 geoeee 93900 b, 127 FRESTORE THE PRECEDENCE

4743 05505¢ ea0000 aea177

4744 005566" arise a0ases as9e0 FINTHP TPINISH ENTRY AND EVALUATE MORE FORMULA
4745 0556/" eavave gossaae

4746 05570" Bov0Re Ae5See"

4747 03940

4746 03960 FOR "ANDY AND "ORM WE WANT TO FORCE THE CURRENT VALVE IN THE
4749 03960 FAC TO BE AN INTEGER, AND AT APPLICATION TIME FORCE THE RIGHT
4750 aaove HAND OPERANO TO BE AN INTEGER

4751 aae20

4752 005571" ae1ae@ gveses @4a4@  ANDORD: PUSH =D SAVE THE PRECEDENCE (70 OR 80)
4753 wuss72? doivas Gee315 04060 CALL = FRCINT

4754 05575" A200 4dS030%

4755 @05574* weonse 905567"

4756 Ge557>¢ a21000 gves2L e4oeo PoP 0 110] 3PRECEDENCE

4757 85576" Ge1ne@ Beos4s 94100 PUSH oH PUSH THE LEFT HANO OPERAND
4758 05577¢ avivee gvever ate xr 8, DANDOR TMANDM AND "OR" DOER

4759 bvS600" epee BvE43T*

4760 05601" Bede 9055735"

4761 85692" Oniave Bvas0s aai4o ump FINTMP JPUSH ON THIS ADDRESS, PRECEDENCE
4762 05605* doooe gussaat

4763 u5604" Bodee BeSeau"

4764 4160 AND CONTINUE EVALUATION

4165 94180

4766 a4evo HERE TO BUILD AN ENTRY FOR A RELATIONAL OPERATOR

4767 oaeeo STRINGS ARE TREATED SPECIALLY, NUMERIC COMPARES ARE DIFFERENT
4768 a4240 FROM MOST OPERATOR ENTRIES ONLY IN THE FACT THAT AT THE

4769 24260 BOTTOM INSTEAD OF HAVING RETAUP, DOCMP AND THE RELATIONAL
4770 aqeeo BITS ARE STORED, STRINGS HAVE STRCMP, THE POINTER AT THE STRING DESCRIPTOR,
4774 a430e DOCHP AND THE RELATIONAL BITS,

4r7e 04520

4773 ov5ea5* doiove over7e 04340 © FINREL: Mov a8 F(A] #0L0 PRECEDENCE

4774 65606" Gaia 900576 04360 rr 100 TRELATIONALS HAVE PRECEDENCE 100
4775 005607" Booede oveL44

4776 05610" woivee Beoseo 4380 RNC JAPPLY EARLIER OPERATOR IF IT HAS
arty eaaee HIGHER PRECEDENCE

4778 ovSe11¢ @aigea aveses aaseo 8 TSAVE THE OLO PRECEDENCE

4779 guSe1e* @aiava Bvesed aagae 0 SAVE (D1 sRELATIONAL BITS

4780 905015 eatooe never a4a6e D,SCODE+2s6e4 [0] PRECEDENCE# 100

4781 05014" enave0 ae2vaat

4782 205615" deavse Bvseos*

4783 1 (E1=01SPATCH OFFSET FOR

4764 COMPARES IN APPLOP=4

4785 FIN CASE THIS IS A NUMERIC COMPARE
4766 oeSe16" aaiave ovewas H, DOCMP FROUTINE TO TAKE COMPARE ROUTINE RESULT
4787 885617" B¢e0m0 av6ST>*

BASIC MCS 608 GATES/ALLEN/OAVIDOFF MACKO 4/(113) 035512 10nSEP*75 PAGE 2166
FS mac 6rSEPeod S311 FORMULA EVALUATION CODE

4788 905e20* apona gose14?
4789 04560 TAND RELATIONAL BITS ANO RETURN THE ANSWER
4796 @o5e21" Oaiove BeOSa> 04580 4 FOOES A JMP TO RETAOP WHEN DONE

4791 @e562e* Ba1av8 900515 a460a GETYPE SEE IF WE HAVE A NUMERIC COMPARE
4792 045625" aeooe avesa7*

4793 ge5ead? Onova ovSe17*

4794 wo5east aelove geosae o4een NUNREL 1YES, BUILD AN APPLOP ENTRY

4795 95620" Bove Bos47e?

4796 GeSeaT? Boe~0 BLSe2S*

4797 05630" ee19a0 aveese o4ean FACLO GET THE POINTER AT THE STRING DESCRIPTOR
4798 005631" Goveed 901637"

4799 oe5e3e" an0e00 eese2e*

4800 205635" Bo1dee evas4s 04660 H SAVE IT FOR STRCHP

4801 05634" ov1900 aoovel 04680 8, STRCMP STRING COMPARE ROUTINE

482 05635¢ Beveve ovEsz0"

4803 005636" wevove g05e31"

4604 005637? Baloo gveses a4700 P FINTHP PUSH THE ADDRESS, REGET THE TEXT POINTER
4805 @v564u" eageea eessaat

4806 005641" Baav~B Bv5oS5°

4807 aareo SAVE THE PRECEDENCE AND SCAN

4808 aaree MORE OF THE FORMULA

4809 a47ao

4610 aa7ed APPLOP 18 RETURNED TO WHEN IT 18 TINE TO APPLY AN ARITHMETIC

rest aa7e2 OR NUNERIC COMPARISON OPERATION,

4eie a47oa THE STACK HAS A DOUBLE BYTE ENTRY WITH THE OPERATOR

4613 a4766 NUMBER AND THE VALTYP OF THE VALUE ON THE STACK,

4614 04768 APPLOP DECIDES WHAT VALUE LEVEL THE OPERATION

4615 04770 WILL OCCUR AT, AND CONVERTS THE ARGUMENTS, APPLOP

4816 arte USES DIFFERENT CALLING CONVENTIONS FOR EACH VALUE TYPE,

4817 4776 INTEGERSS LEFT IN (D,E) RIGHT IN [H,L}

4818 04778 SINGLES$ LEFT IN (6,C,D,£] RIGHT IN THE FAC

4819 aa7eo DOUSLES? LEFT IN FAC RIGHT IN ARG

4ee0 04798

4821 e95e4e eae Beoser @4800 APPLOPs POP 6 1181 8STACK OPERAND VALUE TYPE

4a2e e4seo 7(C) S0PERATOR OFFSET

4823 005645" ap1v0e 900171 a4aao nov SAVE IN MEMORY SINCE THE STACK WILL BE BUSY
4824 005644" ep1ue0 Bvaree agaeo STA FA RAM LOCATION

4825 05645" aadoae av1s44*

4826 GuS640" Brave BeSo40"

4827 85647" aeidee ovel7e 09880 mov re) ICHECK FOR DOUBLE

4828 005650" Aaivee 400376 34900 cl 8 #PRECISION ENTRY UN THE STACK

4829 905651" acvedo aeav1e

4830 085e52¢ Oaivee svesie aagee wz STKDBL FORCE FAC TO DOUBLE

4831 005655* @aeea a05725°

4632 905654" wovpae Bose4s?

4833 005655" Boigea evoure paque Loa VALTYP SEE IF THE FAC IS DOUBLE PRECISION
4834 05056" Bedowe ov1545°

4835 045657" eovee avSe53*

4836 g05e6e" doteay avasTe crr 8 FAND IF $0, CONVERT THE STACK OPERAND
4837 985661" evoeoe aeoere

4838 oSe62" aolnde ovesie vz FAcoBL 470 DOUBLE PRECISION

4839 305605" @ovove BuSTTS*

4840 656604" Ynavee BuSeSb*

Pamets BUALcaTin’

BASIC MCS 8980 GATES/ALLEN/DAVIDUFF MACKO 47(113) 05412 10=SEPm7S PAGE 2197
FS mac omSEPred O5411 FORMULA EVALUATION CODE

4641 905065" Seloea aveleT a5ov0 Mov DyA JSAVE THE VALUE TYPE OF THE FAC
4862 85660" Belov» gv017e osoeo mov vr) SEE IF THE STACK ENTRY IS SINGLE
4843 a5e67" aa1000 BeesTe a5ea0 crr 4 WPRECISION AND IF SO, CONVERT

4844 05670" Aovave ovevad

4845 o05671° @a1900 geasie 05060 vz STKSNG FTHE FAC TO SINGLE PRECISION

4846 g0567e? Aevnae geevei?

4847 05675" aeboe BeSeoSs*

4848 05674" ao1oae gvarTe asa6e yO SEE IF THE FAC IS SINGLE PRECISION
4849 905675* @rioee vvAsTe 95100 3 AND IF SO CONVERT THE STACK TO SINGLE
4852 095676" eevee yoouns

4851 45677" Galva avesee 5120 FACSNG PRECISION

4852 e570" envaeE gvELsat

4653 05701" eevee avse7et

4054 95148 NOTES THE STACK MUST BE INTEGER AT THIS POINT
4855 au57a2* apivae avesi2 05160 vz THERR }BLOW UP GN RIGHT HAND STRING OPERAND
4856 e575" woeoee BUSdoas

4857 wv5704* Bav0ee BeSTEUe

4856 057@5° ee1gee wood @5180 uxt Hp INTOSP HINTEGER INTEGER CASE

4859 e57H0 Bpeaue AbG716"

4860 905707" evaved euS7a5*

4861 205710" @oine@ goeede osaeo cles SPECIAL DISPATCH FOR SPEED

4862 805711" vacoe eeoved

4863 veSTie* ov1000 avou11 eseeo Dad V{H)LI POINTS TU THE ADDRESS TO GO TO
4664 805715" oo1900 evee11 aseae DAD

4865 ev5714* eeieos guerie a5260 Mov # (B,C) ROUTINE ADDRESS

4866 05715 delves guavas e528 INK

4867 5710" Bolove ave1ee 05300 Mov

4868 05717" Beivee Bva5s21 05320 POP 4(0/E)SLEFT HAND OPERAND

4869 ees7evt Belen gobUESe a5340 LrLo 1 (K/L) RIGHT HAND OPERAND

4870 o05721* Onoeee Be1637°

4871 eS72e* Beeva0 BvSTee*

4872 005725" daicve eases 95560 PUSH DISPATCH

4873 S724" voledy ou0311 05380 RET

4874 05400

4675 95420 THE STACK OPERAND IS DOUBLE PRECISION, SO

4876 05440 THE FAC MUST BE FORCED TO DOUBLE PRECISION, MOVED INTO ARG

4877 5400 AND THE STACK VALUE POPEO INTO THE FAC

4078 95480

4879 oes725¢ oe1a0a 900319 05500 © STKOBL: CALL «= FRCDBL MAKE THE FAC DOUBLE PRECISION
4880 905720" Baeoae ALab64«

4881 95727" oaene g0S721°

4882 005730" Be1000 00315 a5seo CALL = VMOVAF MOVE THE FAC INTO ARG

4883 005731" pagan avovous

4884 85732" Bevo B0S72e"

4885 05735" Buin eves41 e5sae PoP H FPOP GFF THE STACK OPERAND INTO THE FAC
4686 905734" Balaue avov4e 05560 SHLD —-DFACLO¥2

4887 005735* Beene 901635"

4886 85736" oneeve 9v5731°

4889 045737 Bateee ovos41 a5see POP 4

4890 05740" On1G000 avoede 05600 SHLD DFACLO STORE LOW BYTES AWAY

4891 o05741¢ wave Bu1ES3°

4e92 285742" BpedVG B0S735°

4893 005743" eel ovoser 5620 SNGDBL POPR WPOP OFF A FOUR BYTE VALUE

BASIC NCS 8080 GATES/ALLEN/DAYIDOFF MACRO 47(113) @5412 10eSEP®75 PAGE 21-8
FS mac brSEPod O5311 FORMULA EVALUATION CODE

4894 05744" waloos wvoseL

4895 905745" Geleve 9eos15 aseae CALL MOVER HINTO THE FAC

4856 205740" apoeed ouavees

4697 ge5747" gaeneD guSsTaI?

4898 85756" Baigen evOs15 @5660 SETDBL: CALL = FRCDBL. JMAKE SURE THE LEFT OPERAND 1S
4699 BOS751F Beea20 avST2o*

4908 05752" Baveee BvST4et

age1 @5660 FDOUBLE PRECISION

49@2 05755" @p1ee0 gooe4d 05700 h, DBLUSP HOISPATCH TO A DOUBLE PRECISION ROUTINE
4903 905754" epeaeD aueeret

4904 985755" ape00e OBS751°

49@5 085756" @o1ne9 ovowTe a5720  DovSPs OPRTYP TRECALL WHICH OFERAND IT WAS

4906 B05757* @ae000 av1544t

4907 @e5760" e9eB00 BvS754°

4908 005761" Go1e0@ Beaver 05740 HCREATE & DISPATCH OFFSET, SINCE
4909 25760 JTABLE ADDRESSES ARE TWO BYTES
491@ 005762" Bale00 gv0505 05780 SAVE (8,C) FOR SINGLE PRECISION
4911 005763" @eievo Bve117 25800 }DOUBLE BYTE OFFSET

4912 905764" epieeo Bv00e6 a58e0 FINTO (8,0)

4913 005765" eeeeon Buov0d

4914 005766" weloae dvdv11 ose4e FCALCULATE LOCATION OF KOUTINE TO GO TO
4915 we5767" Beiede gvoser 05860 GET BACK (6,C) FOR SINGLE PRECISION
4916 005770" @pione avo1T6 05380 GET THE ADDRESS

4917 B05771° avioee geovas @5900

4918 WeSTTe* @oloee 000146 a59e0

4919 005775" aeieoe Boais7 as94e

492@ wo5774* weleae avoss1 05960 TAND PERFORM THE OPERATION, RETURNING
49e1 95980 170 RETAOP, EXCEPT FOR COMPARES WHICH
agee aeave RETURN TO DOCMP

4923 geoeo

4924 aeo4ue THE FAC IS DOUBLE PRECISION ANO THE STACK IS EITHER

age5 aeaeo INTEGER OK SINGLE PRECISION AND MUST BE CONVERTED

4926 26060

4927 905775" aeiv00 200305 06100 FACOBL: PUSH = B TSAVE THE STACK VALUE TYPE

4926 ouS776* GP19ee avesid ao1ee CALL ViOVAF IMOVE THE FAC INTO ARG

4929 005777" @90000 gvS731*

493@ ov6900" Beeovd BvST7ST*

4931 voge1" ea1oee avos61 ve1do Por Pw POP THE STACK VALUE TYPE INTO A)
4932 woonae? eel9e0 avavbe ao1ee STA VALTYP IPUT IT IN VALTYP FOR THE FORCE
4933 Geevest apeoo0 avis4s?

4934 @a6094* oaevae av5777°

4935 e180 ROUTINE

4936 vb905" 201000 Bvo376 a6200 VSEE IF ITS SINGLE, SO WE KNOW
4937 @dena6’ Bagewe svave4d

4938 ao2eo THOW TO POP THE VALUE OFF

4939 e@eouT? Boleae oeas1e eo2ao SNGOBL FITS SINGLE PRECISION

4940 @26010* Yaeowe ausTas*

4941 Ovbo11" enuBBD BvEuest

aga ae260 780 DO A POPR / CALL MOVER

4943 even1e? waives vOSK1 de2so 4 WPOP OFF THE INTEGER VALUE

4944 o06015" Be1000 avoo4e 06300 FACLO FSAVE IT FOR CONVERSION

4945 Geon14 doves auLEsT*

4946 4s6015* eneevo avEvIE"

Tint

ferme Burra

@
e@

BASIC NCS 8980 GATES/ALLEN/DAV1UUFF MACRO 47(113) 03412 10eSEPe7S PAGE 2109
3 Mac brSEP=64 OSt11 FORMULA EVALUATION CODE

4947 dvba16" Bo1¥0G evase3 oosee gne SETOBL #SET IT UF
4948 a¢6n17" aadeeo aes7set

4949 96920" Bedeed oeELi4?

4950 oosae 5

4951 @6300 7 THIS IS THE CASE WHERE THE STACK IS SINGLE PRECISION

4952 26382} AND THE FAC IS EITHER SINGLE PRECISION OR INTEGER

4953 aouoe 5

4954 avepait weiede avesis 6420 STKSNG? CALL —- FRCSNG TCONVERT THE FAC IF NECESSARY
4955 e@v602e" Devon Bv5554s

4956 vesnest wpovne gvevi7*

4957 ge6ve4t @otoee gvaser eoaae POPR PUT THE LEFT HANO OPERAND IN THE REGISTERS
4958 @veves* epived ovesat

4959 GBen26* deiodo avoLad 6460 © SNGDO? LxI Hy SNGOSP ISETUP THE DISPATCH ADDRESS

4960 goeve7? eooove ovaTed?

4961 aa6030* eoevae ovevee’

4962 eoaee JFOR THE SINGLE PRECISION OPERATOR ROUTINES
4963 Yven3i* eoteeo ovoses 6500 HDISPATCH

4964 Yo6n3e" anove0 oLS7S6*

4965 906035" Bv0a00 evoveT*

4966 aeseo

4967 06540 THIS 18 THE CASE WHERE THE FAC I$ SINGLE PRECISION ANO THE STACK
4968 96560 IS AN INTEGER,

4969 26580

4970 06034" eaipoe ovas4i 26608 FACSNG: POP x }POP_OFF THE INTEGER ON THE STACK
4971 006035" Brive g8e315 aoe CALL PUSHF SAVE THE FAC ON THE STACK

4972 26036" aoeoue BL5557%

4973 o06037* woouda guEevse"

4974 Oe60ae" do1vee evasiS 96640 CALL © CONSIH CONVERT [H,L2 TO A SINGLE PRECISION
4975 46041" Boraee avoeGes

4976 oa604e" Go2ovD evELSe"

4977 6600 NUMBER IN THE FAC

4978 06045" do1oe0 avas15 26680 NOVRF }PUT THE LEFT HAND OPERAND IN THE REGISTERS
4979 06044" oaeoeD evSe61*

4960 926045" Gowoen Bvevai*

4961 6240" Galore ovesad 96700 fl PRESTORE THE FAC

4962 006047" daiveo avavae aoreo FACet FFROM THE STACK

4983 ep60Se* Covoaa ov16Ed1*

4984 96051" Goooa® eveLaa?

4985 aa6nSe* do1oo0 ovasat ae7aa x

4966 6955" Beioad evade 20760 FACLO

4967 06054 BedoeD Bo1637°

4988 996955" oedved ovEvse?

4989 Web56" Bvivee oases 6780 SNGOO> JPERFORM THE OPERATION

4990 6057? DovoWD BeBe?

4991 gv660" aovone BvEusat

4992

4993 enone" aoeeo

4994 6840 LENGTH=2,<

4995 6860 STRING, <

4956 a6aee XRA N

4997 26900 STA VALTYP>> JASSUNE THE VALUE WILL BE NUMERIC
4998 e661" Be1v90 ovase7 e920 CHRGET

4999 n662 wnivwe veasse e940 ac FIN FIF NUMERIC, INTERPRET CONSTANT

BASIC MCS 8980 GaTES/ALLEN/DAVIOUFF MACRO 47(113) 05312 10-SEP@75 PAGE 21e10
PS MAC beSEPeod StI FORMULA EVALUATION CODE

S000 006065" beoaee BESLTe®

5061 06964" waeueD BbovST*

Se@2 B86965* BY1bHe 00515 06960 ISLET FVARTABLE NAME?

5063 006066" Bowron Bese12e*

Sued B06267" BoaRBe BvEbeS*

S005 BveeTe* BoOlnBB BeOS2e 96980 ISVAR JAN ALPHABETIC CHARACTER MEANS YES
5006 BB6071" BePRBe Beb1604"

S007 B¥eaTe? waLEae BbORb6*

5006 G8OB7S* Bo1ewe BeOSTO 87000 PLUSTK FIGNORE "+"

5009 06074" Babene BHBe50

5010 @a6075* Baten ovasie oreee EVAL

S011 06070" OpA090 BHbvo1"

Sei2 e6077T* BadeeH BeEBTIY

5013 Yee19e? aoieas avO3Te arose 3," AS LEADING CHARACTER OF A
S014 bb6101" BA0eBe BoBvSe

Seis 01060 BCONSTANT?.

S016 #H619e" Goleta wobss1e 87080 FIN

3017 606105 Opeen0 BveboS*

S¥16 006104" BAeABH BebOTe*

S019 #86105 Bo1900 BoOSTO o7100 MINUTK NEGATION?

S020 GH6106" BneoKe B80e51

Sd21 ave1g/? Boleoe wBeasie oreo DOMIN

S022 06110" BB00K8 BHO14e*

S¥e3 @06113" BawoeG wheles*

Svea e7140 STRING, <
Se25 06112" BE1GHR BLAST 87100 cPl
3026 906115" BeeeBe avow4e

S027 26114" Oo1Gvo BeeSs1e 97160 wz STRUTI> FIF SO BUILD A LESCRIPTOR IN A TEMPORARY
S@28 06115¢ BoeQve BHTe4e

5029 Bvo110" Beepee bb110°

39030 87208 BDESCRIPTOR LOCATION AND PUT A POINTER TO THE
5031 o7220 FOESCRIPTOR IN FACLOy

Sese o7T240 LENGTH, <

5033 06117" Oele00 BeO35T6 07260 crr NOTTK CHECK FOR ®NOT" OPERATOR

5034 Mee120" YoeeHe BuBede

5035 ove121* Boigaa peasie 97280 vz NOTER>

5036 dvo122e" OeeORR evoed41e*

S037 006125" BGee08 4H6115*

3038 07300 FUNCTS,<

5039 086124" Of1080 860376 7320 cer FINTK FUSER@DEFINED FUNCTION?

5040 86125" BeREBe wuoedS

5@41 @@6120° Ooinee Bea51e 07340 Jz FNOOER>

S042 006127" baewoe BET4GS*

S045 806130" BooueO BbO12e"

5044 8861351" Op1000 Bves26 07560 sul ONEFUN HIS IT A FUNCTION NAME?

5u45 B¥o13e* BOGBLE HoBeb2e

S046 006133" Op108e eBeesee 07360 JN ISFUN FRUNCTIONS ARE THE HIGHEST

S047 906134 weeooe BeEeD4d*

3048 006135" Boee0e eeb127"

5049 O7408 NUMBERED CHARACTERS ALLOWED

5050 OT4eo S80 THERE IS NO NEED TO CHECK

5051 B1448 HTHE UPPER BOUND

5052 Wv61se" dolvoo oves17 @7400 © PARCHK: SYNCHK "(" JONLY POSSIBILITY LEFT

Tin!

34 FSTRING CONSTANT?

[oem cA Biauva

oe
e

BASIC NCS 6080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 05312 1@-SEPe75 PAGE 21911
FS mac beSEPe64 OSE11 FORMULA EVALUATION CODE

5053 006137" epev¥e guansY
5054 a74ea JIS 4 FORMULA IN PARENTHESES

5055 eo614e? weloa9 gvos15 07500 CALL FRMEVL FRECURSIVELY EVALUATE THE FORMULA
S056 Od6141" BadeuA BuS336°

5057 evo1de? Geoove 906134"

5058 46145" wri 000517 a7see SYNCHK 1")

5059 006144" aedeee evevs1

Suen da614s? waives oeosil a7sa0 ReT

S061 006146" @7560  DOMINE

Seee o756@IFE EXTFNC,<

5063 e7eve CALL OEVAL> NO * OPERATOR IN THIS CASE

Seog @7620 IFN EXTFNC,<«

5¥eS 6140" waive gveEee e7640 vd 0,125 4A PRECEDENCE BELOW *

Se66 e147" Beev— Yv~17S

5067 07660 BUT ABOVE ALL ELSE

SH68 ev615e* Br190 ovos15 27680 CALL = LPOPER 180 * GREATER THAN UNARY MINUS
5069 06151" vetooe Bu5s4i*

S070 46152" Bedoa0 Bv6141"

5071 006155* @oivea gvevse e700 LHLo  TEMP2> HGET TEXT POINTER

Su72 6154" Boece goieus?

5073 406155° veeooe ove1si*

S074 406150" eines evesas erred PusH oH

5075 7740 LENGTH=2,<

5076 006157" @oipae ovesis 07760 CALL VNEG>

5077 e616" Beeave avoveox

5078 6161" Beevaa gwo1s4?

3079 07780 LENGTH#2,<

5080 7800 CALL = NEG> NEGATE THE FAC,

5061 06162" e78ee FUNCTIONS THAT DON?T RETURN

5082 7840 STRING VALUES COME BACK HERE
5083 07860 LENGTH=2,<

Svea 07880 STRING, <

5085 7900 CALL CHKNUM>>

5v66 Op6162" Bv1000 avos4L 07920 PoP H

5087 vsb1es* bu10a0 gves11 a7940 RET

5088 av616e4" Bol1090 000515 07960 CALL © PTRGET HGET A POINTER TO THE

5089 v¥616e5" Gevove avEses?

5090 006160" BpeB0e Bu6160"

5091 07980 FVARTABLE IN (D,E)

5092 0616/" eploe Bve345 28000 PUSH oH WSAVE THE TEXT POINTER

5095 esoee STRING, <

5090 6040 XCHG FTRANSFER THE POINTER AT THE VALUE
5095 aeeeo FINTO (Hyd

5096 aaea CALL MOVE M> SETUP FAC WITH VARIABLE VALUE
5097 ae100 STRING, <

5096 Ue6170" Brine Bved5S ae120 XCHG PUT THE POINTER TO THE VARIABLE VALUE
5099 eb14e FINTO (HL), IN THE CASE OF A STRING:
5108 6160 THIS IS A POINTER TO A DESCRIPTOR AND NOT
5101 a5160 FAN ACTUAL VALUE

$102 906171° Go19ee oveLvae aseve HIN CASE IT?S STRING STORE THE POINTER
5103 ae6172* Be0000 B~1037°

5104 @46175* Brvuee 906165"

5105 vee 410 THE DESCRIPTOR IN FACLO,

BASIC MUS 8982 GATES/ALLEN/DAVIDOFF MACKO 47(113) 45312 1UeSEP*75 PAGE ateta
FS mac OmSEP6G OSt11 FURMULA EVALUATION CODE

S16 os24e FE LENGTHe2,<
5107 o06174" @y1e99 ovO315 aseoo CALL © GETYPE TFOR STRINGS WE JUST LEAVE

5108 206175" wa0200 avesoT?

5169 Gve17et BeandD averTe?

5110 006177" Gpiead Bv0S04 avaso nz VMOVEN> TA POINTER IN THE FAC

5111 Gaeeau? eneav0 avoveos

5112 geeemi* Goveve av6175*

5113 easeo LENGTH=2,<

5114 weseo Loa VaALTYP

5115 a834o OKA Ly

5116 a83e0 cz MOVE M>> VIF NOT, ACTUALLY TRANSFER THE VALUE INTO
S117 aa3eo HTHE FAC USING [H,L] AS THE POINTER,
5118 Oveade* eoleay avesar aeaeo POR PRESTORE THE TEXT POINTER

5119 weoaas? aeicun wvesit ae4e20 RET

5120 006204" waiove aeoove 98440 ISFUN: MYT

5121 eveags’ apevae doooge

5122 ae62a0" waloee oeovaT aedeo RUC WWULTIPLY BY 2

5123 evean7? Boieea gooiiT aeaeo mov ,

5124 oeee1o? eoivee avases aeseo PUSH SAVE THE FUNCTION # UN THE STACK
5125 Ga6ai1" Beieee aooseT aeseo CHRGET

5126 98540 IFN STRING, <

5127 ovbaie’ epieae gueir 28500 Mov Arc HLOOK AT FUNCTION #

51268 aveesi B8580  NUMGFINS=2*LASNUMN@2RONEFUNGL

5129 Ovbais? eoleee aoasTe eveve cPr NUMGEN HIS IT PAST LASNUM?

513@ vve2i4? epeeee aveesi

5131 ev6a1s¢ eoiese ovesse avez Je OKNORM FNO,MUST BE NORMAL FUNCTION

5132 aveete’ epvage aueesi?

5135 aveei7* eoeave nuEeout

5134 aBe4o

5135 aveoe MOST FUNCTIONS TAKE A SINGLE ARGUMENT,

5136 28680 THE RETURN ADDRESS OF THESE FUNCTIONS IS A SMALL ROUTINE

5137 28700 THAT CHECKS TO MAKE SURE VALTYP IS @ (NUMERIC) AND POPS OFF
5138 are THE TEXT POINTER, SO NORMAL FUNCTIONS THAT RETURN STRING RESULTS (1,€, CHRS)
5139 a874o MUST POP OFF THE RETURN ADURESS OF LABBCK, AND POP OFF THE

5140 26760 TEXT POINTER ANO THEN RETURN TO FRMEVL,,

S141 ae7eo

5142 98800 THE SO CALLED "FUNNY" FUNCTIONS CAN TAKE MORE THAN ONE ARGUMENT,
5143, o682e THE FIRST OF WHICH MUST BE STRING AND THE SECOND OF WHICH

5104 a8e4e MUST BE A NUMBER BETWEEN @ AND 256, THE TEXT POINTER 18

5145 aeaee PASSED TO THESE FUNCTIONS SO ADDITIONAL ARGUMENTS

5146 a888e CAN BE READ, THE TEXT POINTER IS PASSED IN [0,E],

5147 essve THE CLOSE PARENTHESIS MUST BE CHECKED AND RETURN IS OIRECTLY
5148 aageo TO FRNEVL WITH (H,L} SETUP AS THE TEXT POINTER POINTING BEYOND THE ")™,
5149 as9ue THE POINTER TQ THE DESCRIPTOR OF THE STRING ARGUMENT

5150 e8960 IS STORED ON THE STACK UNDERNEATH THE VALUE OF THE INTEGER

S151 26980 ARGUMENT (2 BYTES)

5152 ave00

5153 @a62ae? ooiove ovasiT a9020 SYNCHK "(1 }RIRST ARGUMENT ALWAYS

5154 wvbael’ vovoee 200050

5155 a9o4e STRING »= SECOND INTEGER

5156 ee2e2? oaieue ovosis a9a0e CALL FRMEVL, TEAT OPEN PAREN AND FIRST ARG
5157 @a6225* Govoaa BwSs3er

5158 @w62e4* apgado aveeie?

Tint

[oemts Biren.

BASIC MCS 8vB0 GATES/ALLEN/DAVIOOFF MACKO 47 (113) 05312 10-SEP@75 PAGE 21015
FR Mac 6eSEPeod AStit FORMULA EVALUATION CODE

5159 @ab2e5¢ Bp100@ nee317 09080 SYNCHK 4a FTWO ARGS SO COMMA MUST DELIMIT
5160 eeb22e’ eeeowo geevs4

5161 a062e7" eigoo ovesis 09100 CALL «© CHKSTR MAKE SURE THE FIRST ONE WAS STRING
S162 6230" vevoMe ov4164%

5163 ev6e3i* Beveua vooees’

5164 6232" daioee 00555 a91e0 XCHG 1(D,€) 8TXTPTR

5165 406235" daiove ovavse 09140 LHLO GET PTR AT STRING DESCRIPTOR

5166 96234" Bedoeo ov1637"

5167 06235" eoeave aves"

5168 evba3er Beicve wvos4s 29160 XTHL GET FUNCTION #

5169 29180 JSAVE THE STRING PTR

5170 06237" oe1uve woos4s ase00 PUSH PUT THE FUNCTION # ON

S171 06240 Baines a09553 9220 XCHG TUM) UL) STXTPTR

Si72 oa6241" Gale gvas15 agaaa CALL «= -GETBYT CE) SVALUE OF FORMULA

5173 aveade? aavees vi1i1e2e*

5174 g¥6245* Bagnea B06234"

5175 @6244* Ba1000 900353 ave60 XCHG TEXT POINTER INTO [D,E)

S176 aveeo JUH)L)SINT VALUE OF SECOND ARGUMENT
5177 @06245* Bolove Bves4s 09300 XTHL SAVE INT VALUE OF SECOND ARG

5178 e9320 FUH)L) SFUNCTION NUMBER

5179 eB6240" Bolo@ avases 09340 MP FINGO> DISPATCH TO FUNCTION

5160 asead7* aedove ovseTe?

5161 gv625e? waoven svoeder

5162 @%6251" an1ea0 Bees15 99560 OKNORM? CALL — PARCHK MAKE SURE 1TS THERE,

5163 H62se? BeRed 206136"

5164 6255" Be00I guEedT?

5165 09360 FREAD THE FORMULA INSIDE

5186 09400 JAND MAKE SURE ITS FOLLOWED BY ")"
5187 vs6254¢ Boinae o4os43 e420 XTHL VtH)L)SFUNCTION # AND SAVE TEXT POINTER
5186 o9a4a FE LENGTH=2,<

5189 99460 5

5190 89480 } CHECK IF SPECIAL COERCION MUST BE DONE FOR ONE OF THE TRANSCENDENTAL
5191 @9500 j FUNCTIONS (RND, SAR, COS, SIN, TAN, ATN, LOG, AND EXP)

5192 e9seo 5

5193 oe6255* aa1000 ava175 09540 nov Ay F(A) =FUNCTION NUMBER

5194 avovie 09550 BOTCONS=<SGRTK=UNEFUN> #2

5195 06250" Ba1040 Gva576 09560 cPr BOTCON LESS THAN SQUARE ROOT?

5196 906257" wave0e BedvIe

5197 ave2eu" erivee Bvesse 09580 uc NOTFRE DON?T FORCE THE ARGUMENT

5198 vveze1" eeeava aese7et

5199 2ve2ee? Gavowe BvEese?

S200 avees5 09590 TOPCON#B<ATNTK=ONEFUN> #241

S201 av6265" eo19ee ovasTe ave0e cr TOPCON VBIGGER THAN ARC#TANGENT?

S22 ov6264° wevove Bueess

5203 ev626s* oniees 4eosas 09620 PUSH SAVE THE FUNCTION NUMBER

5204 avo2sct aciove 9vas34 a9e4e cc FRESNG VIF NOT, FORCE FAC TO SINGLE*PRECISION
5205 Mobaer? wovoae Bvovees

S206 ausa7et enoeee Bv6e61"

See? oe6a7it eriges avesar 09660 PoP 4 TRESTORE THE FUNCTION NUMBER

5208 dveaTe? 29680 NOTFRFE >

5209 eueaTet Belene ovover as7ee xr 0, LABBCK RETURN ADDRESS

S210 wa627s? eevee gv616e"

5211 @6e74* evade aveee7?

BASIC MCS 6480 GATES/ALLEN/DAVIDOFF MACRO 47(113) 93412 10eSEPR7S PAGE 21n14
F3 Mac OrSEPeO4 OSt11 FORMULA EVALUATION COVE

S212 wvse7>? aeivae wuosed ag7eo PUSH =O IMAKE THEN REALLY COME BACK
5213 06276" uaioan gvavel o974@  FINGO? LXI 8, FUNUSP TFUNCTION DISPATCH TABLE

5214 @v6277" woddaa guares?

Seis 96300" ogenge gbbe75*

5216 wvese1? galeua aoowli o97ee bad 8 VADD ON THE OFFSET

Sei7 29760 LENGTH, <

5218 o9a0e PUSHM

5219 o9820 RET> 160 TO THE ADDRESS POINTED TO BY (H,L)
See a9eae LENGTH, <

5221 @6302" aaiove aeaire 29860 Mov com FASTER THAN PUSH

S222 006305" waives ovavas 09880 INx 4

S223 006304" Golvoo a00146 29900 Mov Hem

5224 wwosas’ waiveo ovaisi 09920 Mov Lc

5225 206306" Yaiveo 000551 a99ae PCHL> 1GO PERFORM THE FUNCTION

Seze 09960 i LENGTHe2,<

See7 09960
e268 10008
see9 tooes

IF
§ GET THE VALTYP AND SET CONDITION CODES AS FOLLOWS!
i
ses 100s0 5
i
,
i
i
i

CONDITION CODE TRUE SET FALSE SET

5231 10040
sese 10060
5233 10080
5234 10100
5235 1o1ed
5236 06307? aeivee wvovTe 10140 GETYPEs LOA VALTYP 1GET THE VALTYP

5237 06316" eovpen ov1545¢

5238 006311" Bedens gvbe77"

5239 06312" waloon 900576 1160 crt FSET GARRY CORRECTLY

S240 006315" anges avorie

5241 @06314¢ apioeg aeao7s 10160 ocr VSET THE OTHER CONDITION CODES CORRECTLY
S242 906315¢ Ba1v0a avoLTs 10200 ocr JV WITHOUT AFFECTING CARRY

5243 46316" aelo0~ avav7s 1v2ea ocR

3244 96317" Balve@ gve511 1ee4a RET>

5245

S246 10260 IFN LENGTHa,

Sear 10300 IFN LENGTH, <

See 10320 ORS XH *0190@,70366 = F"ORI" , FLAG AS "ORT

5249 10340 JVAND USE COMMON "AND" CODE

5250 10360 © AND$ = XRA A FLAG AS "ANON

5251 1038@ — ANDCONS

Se5e 10400 PUSH PSH

5253 1420 IFN STRING, <CALL_— CHKNUM>

5254 teaae CALL «= DEINT GET (0,E)INT VALUE AND CHECK SIZE
5255 10468 Por PSW

5256 10480 XCHG PCH) LO SINT VALUE

3257 10500 PoP 8 JGET HIGH ORDER OFF

5256 10se0 XTHL PUT INT VALUE ON

5259 10540 GET LOW OF SECOND ARG OFF

See 1e56e XCHG 4(0,€) LOW OF SECOND ARG

crast 105e8e CALL

S262 1eeve PUSH

5263 e620 cau GET (0,€)8INT VALUE

S264 10640 PoP

SIGN STR, SNG, OBL
ZERO INT, SNG, OBL,
ODD PARITY INT, STR, OBL.
NO CARRY oBLe10 INT, STR, SNG

Tint

[oem cp Biauca:

BASIC MCS 696b GATES/ALLEN/DAVIDUFF MACRO 47(113) ©3212 10eSEP=75 PAGE ate15
FS mac 6mSEPRO4 OSt11 FORMULA EVALUATION CODE

S265 10660 FOF FIRST ARG ANO CHECK SIZE
S266 1v68e PoP 1(B,C) INT VALUE OF SECOND ARG
5267 10700 Mov FTA] SLOW OF SECONO ARG
5268 1eree xT HSETUP JUMP ADDRESS
5269 10740 NZ TIT WAS "OR" SO FINISH UP
Se70 Loree ANA AND TWO LOW ORDERS
crigt 10780 mov FSAVE ANSWER IN (C)
seve 1wa00 mov FAY SHIGH ORDER SECOND ARG
$273 1oaee ANA FCA)SHIGH ORDER OF ANSWER
5274 1eaao PCHL FLOAT (A,C]_AS ANSWER
$275 19862 ORFINS ORA OR TWO LOW ORDERS
S276 10880 mov FSAVE ANSWER LOW ORDER IN (C)
5277 10900 Mov F(A) SHIGH ORDER SECOND ARG
5278 1e9ee ORA FOR THO HIGH ORDERS
5279 10940 TUALBHIGH ORDER OF ANSWER
See 10960 POHL FFLOAT (A,C) AS ANSWER
5261 10980 EL? UXT Hy PTDORL HMAKE (HyL] POINT AT OPERATOR ADDRESS
5262 11980 STRING, <
11020 Loa VALTYP FSTORE VALUE TYPE AS LOW
11040 RAR JORDER BIT OF [E)
11060 mov ad GET RELATIONAL MEMORIES IN (AJ
11080 RAL MOVE CARRY BIT IN
11100 nov Ey A> SKEEP THIS BYTE IN (E)
111ee STRING, <MOV £,0>
11140 nt 0,100 PRECEDENCE OF ALL RELATIONAL
11160 FOPERATORS 18 160
11180 Mov AB FA] #PRECEDENCE OF OLD OPERATOR
i12ee CHR 0 JSEE WHETHER TO APPLY OLD OPERATOR
11220 RNC FIF OLD OPERATOR HAS EQUAL OR GREATER
11240 FPRECEDENCE THAN IT MUST BE APPLIED
11260 une UPREC VSEE IF TIME TO APPLY
11280 JANO IF NOT SAVE INFO ON THE STACK
11300
1152@  PTOORL: ADR (DOREL) FADDRESS OF RELATIONAL
11540 JOPERATOR APPLICATION
11360 ROUTINE
11380
11400 TIME 10 PERFORM A RELATIONAL OPERATOR
11420 {C) CONTAINS THE BITS AS TO WHICH RELATIONAL
11440 OPERATOR IT WAS (IF STRINGS ON
11460 LOW ORDER BIT SAYS WHETHER IT WAS STRING OR NOT)
114800
115@@ DOREL? Mov Aye GET MEMORIES INTO (A)
11520 IFN STRING, <
11540 ORA A
11560 RAR> ICARRYSWHETHER WAS STRING OR NOT
11580 POPR iPOP OFF LEFT RESULT
11600 PUSH PSW SAVE WHICH OPERATOR IT WAS
11620 STRING, <
11640 CALL FCONP> 100 A NUMERIC COMPARE
11662 STRING, <
11680 CALL = CHKVAL EE IF VALTYP MATCHES
11708 CARRY AND SET ZERO IN THE

BASIC MUS 898 GATES/ALLEN/DAV1OUFF MACRO 47(115) G5412 1@=SEP=75 PAGE 21016
FS mac OrSEPmod USt11 FORMULA EVALUATION CODE

9516 11720 INUMERIC CASE
5319 11740 uxt H, DocHP COME BACK TO COMPARE

5520 11768 PUSH oH

321 11780 wz FCOMP 400 NUMERIC COMPARE

5522 11800 XRA a SET VALUE TYPE AS NUMERIC

3523 11820 STA VALTYP>>>

5324 1184@ STRING, <

5325 11860

53326 11680 THE FOLLOWING ROUTINE COMPARES TWO STRINGS

$327 11900 ONE WITH DESC IN [0,E) OTHER WITH DESC, IN (FACLO, FACLO1)

5328 11920 AsO IF STRINGS EQUAL

5329 11940 A=377 IF 8,C,0,€ POINTER FACLO

5330 1196¢ Asl IF B,C,D,E LT, FACLO

5331 11980

5332 12000 IFN LENGTH#2,<

5533 12020 STRCHP: PUSH =O SAVE DESC, POINTER TO FIRST STR,
3334 1eo40 CALL FREFAC JPREE THE FACLO STR

5535 teeea POP o JRESTORE 1ST DESC, POINTER

5536 1e08e PUSHM SAVE LENGTH

9337 1a1e0 PUSHM SAVE POINTER

5538 teiao CALL FRETMP FREES 18T DESC, POINTER

5339 taiao CALL MOVIN 4B,C) POINT AT FIRST CHAR

5340 12160 7(E] HAS THE LENGTH

534) teteo PoP 4 GET 2NQ CHARACTER POINTER IN H
3542 leave XTHL GET 2ND CHARACTER COUNTER IN L
5343 ieeee Mov OyL> FSAVE IN D

5344 teeqaTFE LENGTH=2,<

5345 006320" Bo1nee 400315 12260 STRCMP: CALL FRESTR JFREE UP THE FAC STRING, AND GET THE
5346 oesei? aoeoee 410431°

5347 ov6322" eovove BveS10°

5348 1eese POINTER TO THE FAC DESCRIPTOR IN (HyL)
5349 06325" weigue gv0176 12300 SAVE THE LENGTH OF THE FAC STRING IN CA)
5350 06324" Balava avavas 1eseo

5351 46325" ool ava116 12340 : VSAVE THE POINTER AT THE FAC STRING
5352 12342 DATA IN (B,C)

5353 gve320" Bgiove avavas 12300

5354 06327" Balowe eva106 12380 BM

5355 006330" Balaae aveser ieave o JGET THE STACK STRING POINTER

5356 06331" Beige eeo3se5 sedeo 6 SAVE THE POINTER AT THE FAC STRING DATA
5557 @9633e" ap19v0 400365 teaao Psw HSAVE THE FAC STRING LENGTH

5356 06335" Baloo avesis fedeo FRETMP VPREE UP THE STACK STRING AND RETURN
5359 006334" Boeane a1o44ue

5360 006335" Bevan av6s21"

5361 12480 HTHE POINTER TO THE STACK STRING DESCRIPTOR
5562 1e5e0 FIN (hy)

5363 06336" Opinoe goesel 12520 Por (0) LENGTH OF FAC STRING

5364 246337" Balo4e ev0156 1esae mov FCEDSLENGTH OF STACK STRING

5365 296340" @oivee aoavas 12560 INX

S3e6 426341" doiene ave116 12580 mov 7(8,C)SPOINTER AT STACK STRING

5567 06342" aeioon avao4s 1e6ud INx

5366 G06345¢ aolove aeeiee 1ebee nov

5569 06344" aoloue aeasai 12640 PoP GET BACK 2ND CHARACTER POINTER
5370 6545 Geieue av0i175 12600 CSLOOPs MoV HBOTH STRINGS ENDED

[Pemc4 Biptvar.

BASIC MCS 6086 GATES/ALLEN/DAVIOUFF MACRO 47(113) 03112 109SEP*75 PAGE 21017
FS mac GeSEPeod 5311 FORMULA EVALUATION COVE

5371 @06S46" Baloun vode6e 12668 ORA FTEST BY OR*ING THE LENGTHS TOGETHER
5372 006547" vaiove 9ees10 12700 RZ VIF SO, RETURN WITH A ZERO
5375 906350" Moluee wvaiTe ered Mov GET FACLO STRING LENGTH
5374 096351" @alvea ouaeeT 12740 OR VIF 1T ENDED, OTHER MUST NOT HAVE
eeesse? vais avees7 1e760 cma iMAKE 91
086353 vaiose avosie 12780 RZ TEST
096354" aoivoe wvees! 12800 XRA a JMUST NOT HAVE BEEN ZERO, TEST CASE
906355* ep1000 eeoe7s 12820 chp € }OF 8,C,0,E STRING HAVING ENDED FIRST
906356" valuse sooeTd 12840 INR A PRETURN WITH Azd
60635/" aoloun aeesao 12860 RNC HTEST THE CONDITION
12860 © FHERE WHEN NEITHER STRING ENDED
996360" oaieae Boaved 12900 ocr 0 }DECREMENT BOTH CHARACTER COUNTS
406361" oieno aveess e920 ocR €
@e636e" unions eoevie 1e94e LOAx  B JGET CHARACTER FROM B,C,0,E STRING
286365" woloue BeveTo 12968 cme 4 FCOMPARE WITH FACLO STRING
gvese4* Bois evaedss 12960 INx 4 FBUMP POINTERS (INX DOESNT CLOBBER CC#S)
006365° aaivao veaves 13000 INK 8
886366" oni eousie 13020 Jz c
926367" Bvvves oues45*
006370 Sevede av6334°
006371" enioae eeov77 13040 cue THERE WHEN STRINGS DIFFER
wee37e? suioeo eases 13060 IMP SIGNS> FSET [A) ACCORDING TO CARRY
406373" Bava avaveds
eee374" oane0 Bv63s67°

VIF BOTH THE SANE, MUST BE MORE TO STRINGS

13080 TFN LENGTH, <
086375 Heleee avovTa 15100 DOCMPS INR SETUP BITS
006376" voloas eeeel? 15120 Ave JGELESS 28EQUAL 1sGREATER
@06377* Op1eeH 60501 13140 PoP WHAT O1D HE WANT?
eve4ne* ovie0a aveede 15160 ANA ANY BITS MATCH?
eo64a1* aeieee geosve 15160 ADI 55 IMAP 9 10 8
@ee4ne? aoGe00 900377
96405" apieae eeaes7 15200 $68 a AND ALL OTHERS TO 377
15220 LENGTH=2,<
@ean4? Be1oue avos15 15240 CALL «= CONIAR# ICONVERT (A) TO AN INTEGER SIGNED
906405" Beooee voce
yeeuse? eeneee 206573"
ee6aa7’ doieee ev0305 15260 one RETAOP> FRETURN FROM OPERATUR APPLICATION
@vou1or eeeoee @05354°
@veaii’ voweas eveses?
15280 LENGTHe2,<
15300 JMP FLOAT IMAKE FAC#(A] SIGNED
13320 HCOULD FALL INTO FLOAT BUT MESSY (SAVES
15340 TWO BYTES)
13360
15380 NOTERS MVI 0,90 FYNOT" HAS PRECEDENCE 90
1s4v0 CALL = LPOFER G0 PERFORM
13420 IFN STRING, <CALL © CHKNUN> $MAKE SURE ITS INT
13440 CALL = DEINT HGET VALUE IN (0,6)
15460 Nov AVE
13480 cha FCOMPLEMENT
13500 nov CyA 1(C) LOW ORDER OF ANSWER
15520 mov AYO
15540 CHA COMPLEMENT HIGH ORDER 100

BASIC MCS 8986 GATES/ALLEN/DAVIDOFF MACRO 47 (113) 05212 10-SEP=75 PAGE 2te16
FS mac brSEPeo4 USE11 FORMULA EVALUATION CODE

s4eq 15568 CALL = GLVACF TFLOAT [4,C) AS RESULT

5425 13580 POR 8 FTAKE RETURN ADDRESS OF FRMEVL

5426 15600 JNP RETAOP>> VOFF AND RETURN TO THE RIGHT

5427 15620 FPLACE SO THE TEXT POINTER

5426 15640 WILL GET SET UP TO WHAT IT WAS

5429 13660 JMHEN LPOPER RETURNED,

5430 15680 LENGTH#2,<

5431 vbarer evi9yn evavee 13700 MVI 0,90 JNNOT" HAS PRECEDENCE 90, SO

5432 ovedis? vovesn oeaise

5433 veeqia? Baieoe 90515 13720 CALL «= LPOPER TFORMULA EVALUATION IS ENTERED WITH A DUMMY
5434 ovb415? aoveus guss4it

5435 @ve4ier apovan aveaier

EvETS 15730 VENTRY OF 90 ON THE STACK

5437 @voai7? Oaieea o00s15 13740 CALL «© FRCINT FCOERCE THE ARGUMENT TO INTEGER
5438 wv64ee? Ba00u0 Bv55T5*

5439 ovb421" epeoun “uedid?

5440 ovea2et wioae ev0175 13760 Mov Ak FCOMPLEMENT tH)L)

5441 086425" Brlo90 gvous7 15780 cya

5442 Guoae4? @o1c00 avo157 13800 Mov Lia

5443 wv6aad* ealgeo goal74 15820 Mov Aen

5444 Ov6aao’ Baieee ova0sT 13840 cha

5445 weedaT’ valone eoaiar 15860 mov Hea

5446 406430" Goleas ovov4e 15860 SHLD —- FACLO JUPDATE THE FAC

5447 006431" aod000 ov1637°

5448 avease? doone0 Avo4ad*

5449 4v6433" Boloun ovasa1 13900 Por TFRMEVL, AFTER SEEING THE PRECEDENCE
Suse 15910 FOF 90 THINKS IT 1S APPLYING AN OPERATOR
5451 15945 780 IT HAS THE TEXT POINTER IN TEMP2 SO
5452

5455 006434" Op1000 vases 13920 RETAOP PRETURN TO REFETCH IT

5454 O6435° Boeene BuSssat

5455 006436" Bavgee ovedsi’

5456 14gae

5457 14044 DANDOK APPLIES THE "AND" ANU "OR" OPERATORS

5458 14046 AND SHOULD BE USED TO IMPLEMENT ALL LOGICAL OPERATORS,

5459 14948 WHENEVER AN OPERATOR IS APPLIED, ITS PRECEDENCE IS IN (8),

S4eu 14050 THIS FACT IS USED TO VISTINGUISH BETWEEN "AND" AND "ORM,

S461 14952 THE RIGHT HAND ARGUMENT IS COERCED TO INTEGER, JUST AS

S462 14054 THE LEFT HAND ONE WAS WHEN IT WAS PUSHED ON THE STACK,

5463, 14056

5464 oa64s7? @pioee vvosus 14060 DANDOR: PUSH B SAVE ThE PRECEDENCE "OR"S70

5465 oveaao? @eiove voesis 14080 CALL FRCINT FCOERCE RIGHT HAND ARGUMENT TO INTEGER
5466 vve44a1" aveno0 dvEe4aDe

5467 Gabage? apeaee H06a3d°

5468 on644s* @eiove B40561 14100 Por PsW GET BACK THE PRECEDENCE TO DISTINGUISH
5469 1aiee FANON AND #OR

547e oeaad? Goleoe ovosaL 14140 o JPOP OFF THE LEFT HAND ARGUMENT

5471 vse4as? eolgve gues7o 14168 7 FSET ZERO FOR "ORY

5472 06446" apeodd BvOI06

5473 ov6447? aeieao oeorTs 14160 HSETUP LOW IN (A)

5474 06450" eeleud auesie 14200 }DO "OR" IF PRECEDENCE wAS 70

5475 B¢6451" Opeon0 auedes?

5476 ovea52* @etovd ave4ai?

Tint

[Pamecs Barra

BASIC MCS 8986 GATES/ALLEN/DAVIDUFF MACRO 47 (113) 95212 1@mSEPe7S PAGE aLr19
FR mac beSEPmOd OSt1! FORMULA EVALUATION CODE

5477 06453" @p10ee aveeas 14eeo ANA
5478 046454" Baieve B0o157 14240 Mov

5479 06459? aeigon ovo174 1a260 Mov

5480 06456" wolove gvoeue 14a6e ANA

5461 406457" B9100e Boe1a7 14300 mov

5482 006460" @91900 ovas03 14seo ame FRETURN THE INTEGER (H/U}
5463 av6461" ao¢av0 wuovoor

5464 a96462" aevav0 266451"

5485 1asee 1 AS THE "ANDMED RESULT
5466 006463" Ba1e00 gvoeEd 14324 ORFIN L

5487 006464" Beivee Bva157 14526 Lea

5488 e465? Opiowe ove1T4 14326 Ay

5489 eb460" Yaivoe gedebe 14330 C)

5490 ev6467* waivoe ove147 14332 Hea

5491 wae47e? Boloae a00305 14334 MAKINT> PRETURN THE INTEGER [HyL)
5492 av6471* aova0e ove461s

5493 woe472* waeove aeed61"

5494 14336 1 AS THE "ORMED RESULT
5495 14340

BASIC NCS 8980 TES/ALLEN/DAVLOUFF MACRO G7(115) @5312 1GeSEPe75 PAGE 22
FS MAC GRSEProd O5t11 DIMENSION & VARIABLE SEARCHING

5496 1456@ © SUBTTL DIMENSION & VARIABLE SEARCHING
5497 906475" goteoo ovoess 1438@  DIMCON: DCX 4 SEE IF COMMA ENDED THIS VARIABLE
5498 26474" Bela Boose? 14400 CHRGET

5499 Bved7>* guived Bvesie 14a4ed RZ TIF TERMINATOR, GOOD BYE

5500 evb47o" acinee ovasiT 14aae SYNCHK 44 FMUST BE COKMA

5581 06477" eaaeoa gonws4

5502 sagaa

5503 14444 THE "DIM" CODE SETS DIMFLG AND THEN FALLS INTO THE VARIABLE
5504 14446 SEARCH ROUTINE, THE VARIABLE SEARCH ROUTINE LOOKS AT

5505 14448 DIMFLG AT THREE DIFFERENT POINTS?

5506 14450

5507 14452 1) IF AN ENTRY IS FOUND, DINFLG BEING ON INDICATES

5506 14454 A "DOUBLY DIMENSIONED® VARIABLE

5509 14456 2) WHEN A NEW ENTRY IS BEING BUILT DIMFLG*S BEING ON
5510 14458 INDICATES THE INOICES SHOULD BE USED FOR

5541 14460, THE SIZE OF EACH INDICE, OTHERWISE THE DEFAULT
5512 144ee OF TEN 1S USED,

5513 1aded 3) WHEN THE BUILD ENTRY CODE FINISHES, UNLY IF DIMFLG IS
Soia 14466 OFF WILL INDEXING BE DONE

5515 14468

5516 evesoe? aaieue avavar 14478 xT 8, DIMCON PLACE 10 COME BACK TO

5517 906501" Booed ave475*

5518 av6sde? eoovee ovearit

5519 06505" wine eases iagvo Push 8

5520 av6sa4? vaioan 902366 14500 WD 701000,70366 =} "OKI" NON ZERO THING

5521 14520

S522 14540

,
J ROUTINE TO READ THE VARIABLE NAME AT THE CURRENT TEXT POSITION
5523 14560 7 AND PUT A POINTER TO ITS VALUE IN (O,E), [(H,L) IS UPOATED
5524 14582} TO POINT TO THE CHARACTER AFTER THE VARIABLE NAME,

525 14600 7 VALTYP I$ SETUP, NOTE THAT EVALUATING SUBSCRIPTS IN

5526 14620 7 A VARIABLE NAME CAN CAUSE RECURSIVE CALLS TO PTRGET SO AT
3527 14042 j THAT POINT ALL VALUES MUST BE STOKED ON THE STACK,

5528 14e6e

5529 206505" anieae oveesT 14680 PTRGET: XRA a MAKE [A] 20

5530 ov6sne’ oieve 14700 STA DIMFLG FLAG IT AS SUCH

5531 96507? aaecao

3532 00510? oea000

$533 evesiit oetove oo 14720 mov 8,4 JGET FIRST CHARACTER IN (8)
5534 e6sie? oni1ege 14740 PTRGT2: CALL ISLET CHECK FOR LETTER

5535 906515" ogeoaa

5536 6514 aeenad

5537 96515" Geioae 14760 Je SNERR MUST HAVE A LETTER

5538 av6516* evno0

5539 006517¢ angoee

5540 ao6sae* eaiove E 14780 XRA a

5541 dv65e1" ee1020 ovel1T 14800 mov CyA FASSUME NO SECOND CHARACTER
5542 14820 LENGTHe2,<

5543 14840 STRING, <

5544 14860 STA VALTYP>> FOEFAULT 18 ZERO (NUMERIC)
5545 ov6seet oo1000 aeoser 14880 CHRGET GET THE FOLLOWING CHARACTER
5546 14900 LENGTH, <

3547 14920 INC NUSEC> ONLY NUMBERS ALLOWED

3548 14940 LENGTH, <

Poem cA Biaican

BASIC MCS 8080 GATES/ALLEN/DAVIDUFF MACRO 47(115) 05112 1@=SEPm75 PAGE 22=
FS mac OmSEPeO4 OSt11 DIMENSION & VARIABLE SEARCHING

9549 a65es? Balcav o00332 14960 Jc TSseC ARRY SET BY CHRGET IF CHARACTER IS
555¢@ av6se4? eone9 v6534"

5551 veses* agen av6d16°

5552 14980 NUMERIC

5553 6520" Oe1aua 200515 15000 ISLET SET CARRY IF NOT ALPHABETIC
5554 ev6se7? wpeave gusb1et

5555 906530" Boveee ovededt

5556 06531" Bale gv033e 15020 ve NOSEC> JALLOW ALPHABETICS

5557 @v6532" aveoee eves4aT?

5558 946535" oeega— gv6527°

5559 906534" walove gve117 15a4@ -ISSECs Moy cya JIT IS & NUNBER@*SAVE IN C
556 06535" oni0009 900527 15062 EATEMs CHRGET HLOOK AT NEXT CHARACTER

5561 15¢6@ IFN LENGTHY <

3562 906536 orloae ovasse 15100 Jc
5563 4653/7¢ Bedow— vv6535°

5564 26540" vodone gvE5se*

3565 6541° Mploaa 900515 15120 CALL ISLET

5566 06542" ov0000 ause1et

5567 0s6543" Beoeey 206537"

5568 46544" aplune avesee 15140 INC EATEM> SKIP ALPHABETICS

5569 06545" 490200 4v6535°

5570 286546" BavAve ovEs4e?

5571 oves4re 15160 NUSECS

5572 1516@ FE LENGTH-2,<

5573 006547" weiavo gvovet 15200 Uxr D,HAVTYP SAVE JUMPS BY USING RETURN ADDRESS
5974 906550" aedoee av6574"

5575 046551" vereDo vuE545?

3576 6552" wAiaoe gvased iseee PUSH

5577 086555* Ba1000 gvoLu2e 15240 MI ASSUME ITS DOUBLE PRECISION
5578 oe6554° veveee oveLie

5579 006555¢ @91008 ave376 15260 cPr CHECK THE CHARACTER

5560 av65Se" Babee gvaLds

5561 06557° e91000 avesi0 15280 RZ JWHEN WE MATCH, SETUP VALTYP
5582 06560" ep1900 averes 153v0 HCHECK FOR INTEGER

5583 006561" eedoee awevee

5584 a465ee* a91000 ovaS7e 19320 crr

5585 oveses angaee aooeds

5566 ov65e4* eoinee vves10 19340 RZ

5587 246565" @nivoe gvoved 15360 INR o FCHECK FOR STRING

5588 006566" wives BvesTe 15380 as"

5569 6567" Bavave ovouad

5590 @a6s7et Gein 200510 154e0 RZ

5591 @06571° @aiee soared 15420 0 SINGLE PRECISION IS THE DEFAULT
5592 av6S72* ealo0e oueLss 15440 k JNO MARKING CHARACTER

5593 a06575¢ ev1v0e 900311 15460 RET GET RID OF RETURN ADDRESS
5594 06574" eaiowe oveiTe 15480 HAVTYPS wT) FSETUP VALTYP

5595 006575* eevee gvaLbe 155e0 VALTYP

5596 206576¢ Beva~e Bv1545°

5597 B6577* @evoee Bo655e"

5598 Bubeme* Brinee geeseT 15520 CHRGET> READ PAST TYPE MARKER

5599 15540 LENGTHR2,<

Seve 15560 STRING, <

Seat 15580 sul use 1S IT & STRING?

EATEN FSKIP NUMERICS

BASIC MCS By8e
F3 MAC

Seve
5003

Seu4

5605

S606

5607

5608

Seno

Se1e

Se11 svoeit
Sele desde
5613 aeeoust
5614 veeenar
5615

5616 ove60d"
5617 f6600"
5618 ga6sa7?
5619 ev6610"
Se2e g06611"
Seat

Sez2 vooote?
5623 906613"
Seed gueeidt
5ee5 06615°
5e26 006610"
5ee7

5e28 wve611?
See9 auesee?
5630 voeeait
5631 ob62er
5632 uvoeas?
5633 aveeed?
5634 g066e5°
5635 aue626t
5636 Dabeert
5637 o26630¢
5e38 vee6si"
5639 ag663et
Sede 006635¢
5641 oob6s4t
Se42 on6635¢
5643 Yub636¢
5644 a6637t
5e45 veboavt
Se46 ov6641"
5647 aveo4et
5648 206045"
5649 Bvboaut
S050 006045"
5651 006640"
5652 as664T?
5653 eoe6s0’
5654 oo66si?

BASIC MCS 6980
FS mac

5655 oveese?
5656 206655"
5657 aoe6sa?
5656 06659"
5659 6650"
Seon vae6s7*
Seet
Se62 cn6660°
5663 cebooi?
5664 Udenbe?
5665
S666
5667 46665"
5668 eeooat
5669 0666"
5670 e666"
5671 g26667"
Se72 vvoK7er
5673 vab6ri!
5674 ovesTet
5675 026675°
5676 Gve674?
5677 006675°
5078
5679 06676"
5660 ab667/"
5661
Seb
5683
5684
5065
5666
See7
5666
5689
5690
5691
5692
5695
5694
5695
5696
5697
5698
5699
S7ee
57@4
5702
573
5704
5705 wnerout
5706 on67a1°
5707 ave7oet

GATES/ALLEN/DAV1OUFF
6eSEProd S311

wai1eae avov7e
290209 ooreait
@a0eus 0v6576*
@o1990 ovoeve

Bo1eve goose
aovov9 avouse
@e19e0 aoasie
@20000 everas?
aevove aveoee?

eo1ee@ oveesT
291000 geeuee
Oev0v0 guieoit
eger00 aeeb1e’
Galvan avosas

bo1eon ooor7e
Bai1oon evovse
@p00e0 aeieert
Cove wvooid?
@p1000 400365
@e1eee wuosss
Doiaue Boouse
@eenee ovieas?
@pevee aveoei*?
ae1eea ovosa7
@oivee avesar
@olvee geosie
@90200 aKeo7i?
apvoee eeobest
ealeee avovse
@oivee euo1s7
@eivea aveers
@eivee vooves
eeiene gvosee
@eevee eveeeu’
@ee0ee av6633°
@eioee geavse
@eivee eeveri
Ge1eee svasve
A0000e ovebeot
O92000 oebodet
Golvee evaves

GATES/ALLEN/DAVIDUFF
GrSEPe64 S211

@o1000 avavse
eo1eeo gove7e
@oi1von guosie
aeoeon over4e?
Geeeue avob4a7?
@91099 weapT7e

apiven ovowes
e1990 sooves
Bo1090 aeo17d

001900 evov4e
venoee soava
@e1000 4eou31
@ri1e9a oveses
290008 av6eest
Gonos ov6655*
ee1eee aeosa5
@o1eeo wooiis
@91099 900107
eaieea Bv0s05
woleee avo0es

oo1eee 00005
oaioee evevas

9o1000 aoowse
aeen2e av16as?
weaver ave6eT*

MACRO 47 (413) @3212 10=SEP=75 PAGE 22n2
DIMENSION & VARIABLE SEARCHING

15600 NZ NOTSTR
15620 INR A
15640 STA VALTYP
15660 RRC

15680 00 c
19700 Mov ry
15720 CHRGET

15740 NOTSTRE >>

1576@ IFN LENGTH, <

15780 Loa SUBFLG

15800 apo M>
15820 crer a0

15840 Prd ISARY

15860 LENGTH, <
15860 XRA a
15900 STA SUBFLG>

15920 PUSH oH
15960 : LENGTH#2,<
15960 Mov AyD
15990 LHLD = -VARTAB

16000 LOPFND3 PUSH PS
1ovee XCHG
1ooue LHLO = ARYTAB

16068 COMPAR
1008 PoP H
16100 Jz NOTFNS

1o12e Lax
te14e Mov
16160 CHP
16188 Nx
16200 INZ

1oeeo Loax
16240 CHP
16260 INE

16280 INx

MACRO 47(113) 03412 1@SEPe7S PAGE 2203
DIMENSION & VARIABLE SEARCHING

16302 Loax >
16320 che 8
16340 rd FINPTR

16360 XWD
16360
16400 NOTITL: INK
16420 INx
toago mov
16460
16460
16500 MI

701000,7976

16520 Dao 0
16540 Ine LOPFNO

16560 NOTFNS? PUSH
16560 Mov

16608 mov

16620 PUSH

16640 NX

16660

16660 INX 8
16700 INK a>
16720 LENGTH=2,<
16730 LHLD = ARYTAB
16740 XCHG

16760 LALO VARTAB
16780 LOPFND? COMPAR

16800 rd NOTFNS
16820

16840 mov

16860 SUB

16880 INx

16900 JNz

16920 Mov

16940

16968 -NOTIT?

10960

17000

17020

17040

17060

17080 J LOPFND
17100 NOTFNS: PUSH = B
17ieo

17140 LxI
17160

17160 LHLO © STRENO

By 6¥SCODE>

VIF NOT VALTYP ALREADYS@
FIA)

FLAG THIS AS A STRING

PMAKE (A) 2128

JMAKE (A] BSECOND CHARACTER

#BACK INTO (C) WITH STRING BIT ON
#GET CHARACTER AFTER "5"

}GET FLAG WHETHER TO ALLOW ARRAYS.

FADD ONTO CHARACTER

FARRAY PERHAPS (IF SUBFLG SET NEVER WILL MATCH)

HIT IS}

TALLOW PARENS AGAIN
SAVE IN FLAG LOCATION

FSAVE THE TEXT POINTER
ALUE TYPE INTO [AJ

FUH,/LISPLACE TO START THE SEARCH

SAVE THE VALUE TYPE
1(D,E) POINTER INTO SIMPLE VARIABLES
FUH;L] SEND OF SIMPLE VARIABLES

FSEE IF THE END HAS BEEN REACHED
FH) BVALTYP
TCOULON?T FIND IT, SO MAKE A NEW ENTRY

GET THE VALTYP OF THIS SIMPLE VARIABLE
FSAVE SO WE KNOK HOW MUCH TO SKIP
FCOMPARE WITH OUR VALTYP

INOT RIGHT KIND w= SKIP IT

FIALDSFIRST CHARACTER OF THIS VARIABLE
TSEE IF OUR VARIABLE MATCHES

FSEE IF SECOND CHACRACTER MATCHES.

HTHAT WAS IT, ALL OONE

FOMVI A," AROUND THIS INX SINCE THE POINTER
HIS ALREADY INCREMENTED

SKIP OVER THE
FCURRENT VARIABLE SINCE WE DIDN¢T MATCH
FSAVE THE VALTYP IN CA)

FEH,/L) NUMBER OF BYTES TO SKIP

FADD ON THE POINTER
TAND SEARCH SOME MORE

FSAVE THE LOOKS

(B,C) SLENGTH OF THIS VARIABLE
4 (8150

FSAVE THE VALTYP ON THE STACK
FAKE THE LENGTH INCLUDE

HTHE LOOKS TOO

IPLACE TO STOP SEARCHING

GET THE PLACE TO START
TSEE IF We ARE THERE
FCOULDN?T FIND THIS VARIABLE
180 MAKE ROOM FOR IT

VIS THIS VARIABLE THE ONE?
NOPE
FTRY SECOND CHARACTER MATCHING

TTHAT WAS IT}
SKIP OVER THAT ONE*=NOT IT

FTRY AGAIN

PREMEMBER WHAT THIS
TVARTABLE LOOKS LIKE

}THE AMOUNT TO SHOVE
FEVERYTHING UP BY

FTHE CURRENT END OF STORAGE

[oemcs Buaar.

BASIC MCS 680 GATES/ALLEN/DAVIOOFF MACRO 47 (113) O5812 10*SEP*75 PAGE 2204
Fs mac 6rSEPeod USthh DIMENSIUN & VARIABLE SEARCHING

5768 nv67a5* BPiowe 300545 17200 PUSH SAVE THIS #

5709 206704" BoineD guowI 17aee Dad 6 FADD ON THE AMOUNT OF SPACE

5716 17e4e VEXTRA NOW BEING USED

S711 @vb67Ad? Baloae gvesar 17200 PoP 8 }POP OFF HIGH ADDRESS TO MOVE

5712 06706" Bpive0 geaS45 17280 PUSH oH FSAVE NEW CANDIDATE FOR STREND

5713 wGe7vT? Baleee wyos1d 17300 CALL. HBLOCK TRANSFER AND MAKE SURE

5714 gv671e? Beeore apenas?

5715 ove711" Gaesee aveTaI?

5716 17520 HWE ARE NOT OVERFLOWING THE

S717 17540 STACK SPACE

5718 ope712* aleve avesa1 17560 4 7 (K/L) =NEW STREND.

S719 gver1s? Op1e02 ovov4ae 17360 STREND FSTORE SINCE WAS OK

5720 eve714* Beeeva vibes?

5721 @06719* epePeg aner1o*

ST 17490 THERE WAS ROOM, AND BLOCK TRANSFER

17420 FWAS DONE, SO UPDATE POINTERS

@e6710" boleos ove14e 174g Mov GET BACK (HyL) POINTING aT THE END
006717" 1000 900151 17400 Mov JOF THE NEW VARIABLE
e672" opie ueLde 17480 SHLD FUPDATE THE ARRAY TABLE POINTER
ov6721¢ ood Bv16E2st
eve72e* ooveva av6714°
@0o725" oaivao avgLss 1750  ZEROER? DCx 4 F(H/L] 1S RETURNED POINTING TO THE
@e6724* Buiva eveuEe 17520 MVE cre) FEND OF THE VARIABLE SO WE
06725" Booesy avevee
we6726 valve ovos47 17540 COMPAR FZERO BACKWARDS TO (D,E] wHICH
ov6727" veiave goose 17560 JNZ ZEROEK FPOINTS TO THE START OF THE VARIABLE
996730" Ovenve aveTeS*
wee731" wovoee ewoTeIt

Fin

17580 LENGTHe2,<
906732" Botees ovosei 17600 PoP o FLED EVALTYP.
06735" Balouo ove165 17620 mov nye FSTORE AS PART OF THE LUOKS
006734" Belceo oovas 17640 INX H>
206735" Balove dvosat 17660 POR °
006736" Beiae0 av0163 17680 nov me HPUT DESCRIPTION
06737" eo10ve BeaLas 17700 INx
026740" eaves guaree 171720 mov m0 1OF THIS VARIABLE

17/740 FINTO MEMORY

17760 FE LENGTH=2,<
26741 Be1022 900553 17780 XCHG POINTER AT VARIABLE INTO (0,6)
ese74e? Boieae ouoees 17800 FINPTR: INK o> TPOINT AT THE VALUE

17820 IFN LENGTH-2,<

17840 INx x

17860  FINPTR XCHG> HVARIABLE POINTER INTO (0,€)
906743" Bolous Besar 17380 PoP " RESTORE THE TEXT POINTER
oe744* Bnigoo aeesii 17900 RET

Toemcs Suara,

17900 IFE MULDIM,«<
17960 ISARY: PUSH = B JREMEMBER WHAT VARIABLE LOOKS

17960 TLIKE

16000 IFN STRING, <

18020 PUSH OH FSAVE THE TXTPTR

16040 LHLD = DIMFLG VILIEDIMFLG (H) 8VALTYP

16060 XTHL> }PUT VALTYP AND DIMFLG ON THE STACK

BASIC MCS 6980 GATES/ALLEN/DAVIDUFF MACRO 4/(113) @5312 10-SEP=75 PAGE 2295
FS mac beSEPeod 05311 DIMENSION & VARIABLE SEARCHING

5761 16080 FAND RESTORE THE TEXT POINTER
576e 18100 IFE STRING, <

5763 16120 Loa DIMFLG SINCE THIS CALL 18 RECURSIVE
5764 16140 PUSH — PSW> }OIMFLG MUST BE SAVED ON THE STACK
5765 16160 CALL INTIOX VEVALUATE THE INDEX INTO [0,6]
5766 16168 SYNCHK  ")" FMAKE SURE HE CLOSED IT

5767 16200 IFN STRING, <

5768 18220 XTHL FUL) S0IMFLG (HI =VALTYP

5769 16240 FTEXT POINTER ONTO THE STACK
s77e 18260 SHLD —-DIMFLG SAVE BOTH VALUES BACK

S771 16260 PoP H> PRESTORE THE TEXT POINTER

5772 16300 FE STRING, <

5773 18320 Por Psw GET DIMFLG OFF THE STACK

S174 16340 STA OIMFLG> RESTORE IT

5775 16368 XTHL VIH)L) GET VARIABLE DESCRIPTOR
5776 16360 HTEXT POINTER IS PUT ONTO

5777 16400 THE STACK

5778 1e4eo XCHG 1(0,€) s0ESCRIPTOR

S779 16440 7TH) L) INDEX

578¢ 16460 oan 4 IMULTIPLY BY 4 TO GET

5781 16480 DAD H VYTE OFFSET

5782 16500 PUSH oH TSAVE THE INDEX

5783 1e5ee LHLD = ARYTAB PLACE TO START SEARCH

5764 16540 XM *0120e,1 "LXI B," OVER THE NEXT 2
5785 16560 LOPFDe: POP 8 7 (B,C) LENGTH OF LAST VARIABLE
5786 16560 Dap 6 TSKIP OVER LAST VARIABLE BY ADDING ITS
5787 18608 TLENGTH ONTO (H,L)

5768 16620 XCHG 7(0,E} GET CURRENT SEARCH POINT
5789 16600 PUSH FSAVE THE VARIABLE LOOK

5790 16660 LHL GET PLACE TO STOP

5791 16660 COMPAR VSEE IF WE ARE THERE

3792 18700 XCHG VtH,/L] GETS SEARCH POINT

5793 16720 PoP D JPOP OFF VARTABLE LOOKS

9794 18740 wz NOTFOO HCOULON?T FIND IT

5795 16760 PUSHM JPUT ON LOOKS OF VARIABLE

5796 16780 JWE ARE EXAMINING

5797 16800 XTHL PUT CHyL] ON THE STACK AND
5798 16820 JLOOKS OF VARIAGLE WE ARE

5799 16840 FEXAMINING INTO [H,L)

Seco 16860 COMPAR HIS THIS THE VARIABLE

5ée1 16880 Por }POP OFF SEARCH POINTER

5802 16900 PUSHM }PUSH LENGTH OF VARIABLE

580s 18920 HBEING EXAMINED ONTO THE STACK
5ee4 18940 NZ Lopro2 VIF NO KATCH,GO LOOK SONEMORE
585 16960 Loa DIMFLG 718 THIS VARIABLE TRYING TO BE
5806 18980 HDIMENSIONED AND ALREADY

5807 19000 ORA A EXISTS?

5808 19020 MVE E,ERROD HTHATS ERROR ERROD

5809 19048 INZ ERROR

S810 19960 MAKOFN: POP 0 }POP OFF LENGTH OF THIS VARIABLE
Sait 19080 pcx C) PDECREMENT LENGTH SO We CAN
Sé1e 19100 FJUST LOOK AT *CARRY* AFTER
5813 19120 FCALLING COMPAR

BASIC MES B98e GATES/ALLEN/DAVIDUFF MACRO 47(115) ©5312 10SEPe75 PAGE 22-6
FR Mac beSEProd O5t11 DIMENSION & VARIABLE SEARCHING

19140 XTHL FTRADE POINTER AT VARIABLE WITH
19160 FINDEX INTO THE VARIABLE
19160 COMPAR }SEE IF INDEX IS TOO BIG
19200 MV E,ERRBS }THATS ERROR ERRBS

19220 INC ERROR HSINCE LENGTH REALLY HAS AN
19240 EXTRA ONE ADDED 10 IT
19260 VIF INDEX*LENGTH DOESNT CARRY
19260 JHE IS IN TROUBLE

19300 PoP 0 }POP OFF POINTER AT VARIABLE
19520 DAD VAD IT TO THE INDEX

19340 PoP 1POP OFF TEXT POINTER

19360 XCHG FTEXT POINTER INTO CHyL]
19380 RET VARIABLE POINTER INTO (D,€)
19400

19420 NOTFOD: Mov Me PUT LOOKS DOWN

19440 Inx H

19460 Mov M,0

19480 INK 4

19500 UXT 0, SCOVE+44 JDEFAULT SIZE IS 10

19520 Da OIMFLG TARE WE DIMENSIONING

19540 ORA A

19560 Jz NOTOIN

19560 PoP 0 ;POP OFF INDEX

19600 PUSH PUT INDEX BACK ON

19620 INX

19690 Nx

19660 Nx

19689 Nx

19708 NOTOIM: PUSH

19720 Mov 7PUT LENGTH DOWN

19740 INK

19760 Mov

19780 INK

19800 PUSH

19620 oan 0

19840 CALL REASON JMAKE SURE WERE NOT RUNNING
19860 FINTO THE STACK

19880 SHLO © STREND HSETUP NEW STORAGE END
19900 Por 0

19920 ZERIT2: DCX 4

19940 MI Mo

19960 COMPAR

19960 INZ ZERIT2

2eae INP MAKOFN> FINISH UP

Toemts Baar

2vade

BASIC HLS 8980 GATES/ALLEN/DAVLOUFF MACRO G1(115) 05312 10nSEP=75 PAGE 23
mal

FS GrSEPeod OSt1L MULTIPLE DIMENSION CODE

S660 20060 SUBTTL MULTIPLE DIMENSION COVE

5861

bee 20100 IFN MULOIM, <

5663, 2v1ee

566g 2e14e FORMAT OF ARRAYS IN CORE

5865 20100

5866 20180 DESCRIPTOR

5867 aveeo LOW BYTE = SECOND CHARCTER (200 BIT IS STRING FLAG)
5668 2veeo HIGH BYTE = FIRST CHARACTER

5869 2e24 LENGTH OF ARRAY IN CORE IN BYTES (DOES NOT INCLUDE DESCRIPTOR)
5e7e 2ve6e0 NUMBER OF DIMENSIONS 1 BYTE

5671 eveso FOR EACH DIMENSION STARTING WITH THE FIRST A LIST

sere 20300 (2 BYTES EACH) OF ThE MAX INOICE*)

5873 2u3see THE VALUES

5874 20340

5875 46745" aaleue vvesas 20360 ISARY: PUSH  H FSAVE DIMFLG AND VALTYP FOR RECURSION
5876 46746" walove auovse 203680 LHLD = DIMFLG

5877 w6747* Bowgee weis4et

5878 96750" aoveee 006730"

5879 06751" Bolgee Bous4s aeseo XTHL HTEXT POINTER BACK INTO (HyL1
5860 0v67TS2" Belooe BvaveE 20420 MVE 0,0 SET # DIMENSIONS 20

5861 906755" eovovy auevou

5882 006754" golnee Buas25 20449 INDLOP: PUSH =D HSAVE NUNBER OF DIMENSIONS
5883 006755" @el0%9 400505 20400 PUSH 8B HSAVE LOOKS

5864 406756" eeiaoe Bu0s15 20480 CALL INTIOX VEVALUATE INDICE INTO (0, €)
5685 006757" aovov0 av3se2e*

5886 96760" Booove aveTaTE

5867 Cve7e1? Bolove evasat 20500 Por POP OFF THE LOOKS

5868 006762" UOloue BvoSe1 2vseo POP H(A) = NUMBER OF DIMENSIONS SO FAR
5889 406763" @e1ed0 900555 20s4e XCHG Ft0,E) TEXT POINTER

5e90 20560 7tH,L) SINDICE

5891 avo764? Be1900 Boos4as 20seo XTHL PUT THE INDICE ON THE STACK
5892 2veon VUH/LISVALTYP & DIMFLG

5893 006765" @o1000 BvOSa5 ava PUSH oH FRESAVE VALTYP AND DIMFLG
5894 006766" C9102@ vvos5s 2ee4o XCHG FUH)LISTEXT POINTER

5895 06767" Buiove Beo074 20660 INR A FINCREMENT # OF DIMENSIONS
5696 6770" baleee Beale? 2vose Mov DyA 1 (D) #NUMBER OF DIMENSIONS
5897 e771? Boieve avoi7e 20700 Mov apm GET TERMINATING CHARACTER
5698 wee7Te? Yalgae 00376 2v7eo crt 44 4A COMMA SO MORE INDICES FOLLOW?
5899 6775" oagene Boau5a

5900 0u6774* aeie0e gvos12 20740 Jz INDLOP VIF SO, READ MORE

5901 066775" BoveoD ouE7S4?

5982 006776" Baeoae Bv615S7*

5983 Gue77/" Beicae BuosIT 20760 SYNCHK ")" JAKE SURE IT ENDEO PROPERLY
5904 gs/gav" everoe Bvovs1

5905 aalooi? veivoe avovae 2e7ee SHLD TEMP2 FSAVE THE TEXT POINTER

5986 Be7ove? aevave Buteast

5907 ao7oa3* wpeeve 206175"

5908 va7eo4? Auinoe ovasai 2080 Por 4 FUH)LI® VALTYP & DIMFLG
5909 BeToe>" eolev0 sooo4e 2vsew SHLD OIMFLG FSAVE VALTYP AND DIMFLG
591@ Ov70G0" Booeee BeId4e?

5911 o07a97" eaveee geToue

5912 e710" Baleve avased 20840 PUSH }SAVE NUMBER OF OIMENSIONS

BASIC MCS 6960 GATES/ALLEN/DAVLDUFF MACRO 47 (113) OS212 10*SEP975 PAGE 23-1
FR Mac beSEProd OSt11 MULTIPLE OIMENSION CODE

5913 2e8e0

S914 20880 j AT THIS POINT [8,C)=LUOKS, THE TEXT POINTER IS IN TEMP2,

5915 20900 j THE INDICES ARE ALL ON THE STACK, FOLLOWED BY THE NUMBER OF DIMENSIONS,
5916 20920

5917 oo7a11¢ @aleMe Bvouse a094e LHLD = ARYTAB F(H;LIEPLACE TO START THE SEARCH
5918 voraie? BavaeD avieast

5919 097015" BaveDe au7eoE*

5927 oo7a14" Opleve aoou7e 20960 wD 701000,7076 WMV A," AROUND THE NEXT BYTE
5921 ouTais? woieve Bvoes 20980 = LOPFDAt DAD 0 SKIP OVER THIS ARRAY SINCE IT*S
5922 21000 NOT THE ONE

5923 vuTa1e’ BelovD avos53 2ioee XCHG 4 (D,E] CURRENT SEARCH POINT
5924 uoroi7? eeioon goavse 21040 LHLO © STREND GET THE PLACE TO STOP INTO [HyLJ
5925 gu7paet apvene ulead?

5926 volver? eveene obTeiet

5927 votoee’ epinve av035S 21050 XCHG 1 (yb) SSEARCH POINT

5928 o97M25* Oa1puo Bvas4aT 21900 COMPAR ISTOPPING TIME?

5929 21080 LENGTH=2,<

593@ veroa4* Balave avoure 21100 Loa VALTYP>

5931 Gu7a25" eoeavM BuID45°

5932 vvraae? eoeove ustueut

5933 ourael* Beleno ouasie artes Jz NOTFOD TYES,;COULON'T FIND THIS ARRAY
5934 wu7ase" apenVe aB7ia4t

5935 007031" weevee seTved*

5936 21140 LENGTHe2,<

5937 007032" Oainvn GeveTe 21160 che y VSEE IF THE VALTYPS AKE THE SAME
5938 007035" anlene guavas 21180 INx H

5939 07034" Opleoe gvusee 21200 INE NMARY2>

5949 va7a35* weeene au7eSot

5941 aerase? aevone av7e3s0°

5942 G0793/" @o1000 4vo176 aiade Mov AM GET FIRST CHARACTER

5943 av7940" Boivao geveTL 21e60 cP G) WSEE IF IT HATCHES

5944 ov7o41" ColoaD avow4as 21280 INK 4

5945 Bv7ode? Colave Boesee 21300 INZ NMARYS WNOT THIS ONE

5946 Go7a4s? eovene wuT0Si*

5947 au7ag4* Bevoue wuTess?

5948 G07945* aelyno ova17e aisee Mov AM #GET SECOND CHARACTER

5949 G07a4e" Belone BudeTe 21540 cr 8 TANOTHER MATCH?

5950 ai3e@  IFE LENGTHe2,<

5951 o07o47? BolnoD GvovTe 21380 Xn0 ‘01002 ,7076 FSKIP THIS INCREMENT WITH "NVI A,”
5952 @e7a5e" valves venues 2140@ = NMARY2: INX H>

5953 e7051" waleva geauas 21420 NMARYIt INX 4 IPOINT TO SIZE ENTRY

5954 v7a5e" Goleee vvvis6 21440 Mov EyM FD, E) SLENGTH

5955 207055" Gaigey aeovas 21460 INK 4 FOF THE ARRAY BEING LOOKED AT
5956 e7a54? valves oeeie6 21460 mov OnM

5957 wa7U5>* Yolee0 auavas 21500 INK 4

5958 a07uS6" Boleae svasae 21520 NZ LUPFOA VIF NO MATCH, SKIP THIS ONE
5959 007057" Bowove BeTvIS?

59ee 9760" BpeovE GuToast

5961 21540 FAND TRY AGAIN

5962 Od7ue1" Maivae ovooTe 21500 OIMFLG HSEE IF CALLED BY

5963 va7a6e* eade0d guio4e?

5964 027065" epeese werus7*

5965 vaTo64" Beiove BLoeET 21580 ZERO MEANS NO

Tem cA BiALvar

e
e

BASIC MCS 6080 GATES/ALLEN/UAVIDOFF MACKO 47113) O5t12 10-SEPRTS PAGE 23n2
Fs mac brSEProd OSt11 MULTIPLE DIMENSION CODE

5966 e07065¢ HeleoM gvev36 21600 wT E,ERRDD "DOUBLY DIMENSIONED" ERROR
5967 wo7a66" aonnve gooule

5968 av7H6/? waluny ovesee arez0 ERROR

5969 a7a7e? Bevove avaroet

5970 eu7a71* eooaDD Bu7v6e"

5971 21640

S972 21660 TEMP2=eTHE TEXT POINTER

5973 aieve WE HAVE LOCATED THE VARIABLE WE WERE LOOKING FOR

5974 airoe AT THIS POINT [MyL} POINTS BEYOND THE SIZE TO THE NUMBER OF DIMENSIONS
3975 ai7e0 THE INDICES AKE ON THE STACK FOLLOWED 8Y THE NUMBER OF DIMENSIONS
3976 aioe

5977 weTaTe? velvay vaser 21760 PoP Psw F(A] 2NUMBER OF DIMENSIONS
5978 a07e7S* erieee aoueTe 21780 cHP i JMAKE SURE THE NUMBER GIVEN NOW AND.
5979 21800 AND WHEN THE ARRAY WAS SET UP ARE THE
5980 21620 FSANE

5961 07974" doloon ovesie a1aue rr GETOEF JUMP OFF AND READ

5982 0775" Bebove ovTeGS*

5983 @a7a7e* Garvan we7ETL?

5964 21860 ITHE INDICES. 44,

5985 207077" Belvee gvevse 21860 © BSERRs MVT FYSUBSCRIPT OUT OF RANGE"
5986 87100" Bedvee svavt

8987 87101" Baiove eveses 21900 Jue

5988 GeTiaet aavevo ooerae?

5969 007105" Gaeovo ov7075°

5990 21920

5991 21940 HERE WHEN VARIABLE IS NOT FOUND IN THE ARRAY TABLE

5992 21960

5993 21980 BUILDING AN ENTRY?

5994 2eou0

5995 2e0e0 PUT DOWN THE DESCRIPTOR

5996 22040 SETUP NUMER OF DIMENSIONS

5997 22000 MAKE SURE THERE IS ROOM FOR THE NEW ENTRY

5996 22080 REMEMBER VARPTR

5999 22100 TALLYS4 (VALTYP FOR THE EXTENDED)

6000 2eieo SKIP 2 LOCS FOR LATER FILL IN e= THE SIZE

oe. 22140 LOOP: GET AN INDICE

ove 22160 PUT NUMBER #1 UCHN AT VARPTR AND INCREMENT VARPTR
oous 2e1e¢ TALLY= TALLY * NUNBERSL

ved 22200 DEGREMENT NUMBER=DIMS

eves 22220 INZ Luop

enee 2ee4n CALL REASON WITH CH)L] REFLECTING LAST LOC OF VARIABLE
ve7 2e200 UPDATE STREND

eves 2eabu ZERO BACKWARDS

veo 22300 NAKE TALLY INCLUDE MAXDIMS

eoio 2ese0 PUT OOWN TALLY

oi 22540 IF CALLED BY DIMENSION, RETURN

eoie 22560 OTHERWISE INDEX INTO THE VARIABLE AS IF IT

6013 22380 WERE FOUND ON THE INITIAL SEARCH

e014 2euve  j

6015 anrinae 2e4eo NOTFDOE

ete 22440 FE LENGTHe2,<

6017 @B7104" de1oee ava167 2e400 OV Mya }PUT DOWN THE VARIABLE TYPE
6018 aa7105* dpieoo avenas 2e4se INK 4

BASIC MCS 8080 GATES/ALLEN/DAVIDUFF MACRO 47(115) @5312 10-SEP=75 PAGE 23-5
Fs mac 6mSEPeo4 USt1i MULTIPLE OIMENSION COVE

6019 oe7T196" waleve evO137 22500 mov E,A
6e20 07107" vainnA geavee aeseo VI D,0> 1 (D,€) SIZE OF ONE VALUE (VALTYP)
6v21 oa7116" waeeae gvova0

ener 22549 TFN LENGTH=2,<

oues 22500 UxI 0, SCODE+4> FINITIALIZE TALLY TO FOUR

owed oe7111" Baieoe evoi61 22580 Mov Myc }PUT DOWN THE DESCRIPTOR

6@25 907112" velewe vovUuss 22600 INK 4

ou26 07115" oaivee ava1ed 22620 mov MB

oue7 07114" woione aonvas 22040 INX 4

owes 07115" Matune evase1 226600 POP Psw FV {ALSNUMBER OF DIMENSIONS

6029 207116" waleoe poBube 22080 STA TEMPS FSETUP GETSTK CALL

6038 weritT? BoARee BeTI2Z4*

6@31 veT120* ooeeeH weTive?

6032 Be71al’ YoleeM a0051d 22700 CALL GETSTK HGET SPACE FOR DIMENSION ENTRIES
6035 ov712e? waveee gvevedt

6034 veT1es* Baenve geT1IT?

6635 verias* Boleaa 90551 2e7ee TEMP6: = PCHL JPLACE TO STORE NUMBER OF DIMENSIONS
6036 22740 FOR GETSTK AND LATER RECALL

6037 22760 FILIMPUREL$ PCHL TO CONFUSE DISASSEMBLY
6038 woT1ad? epieve avovae 22780 SHLD TEMPS VSAVE THE LOCATION TO PUT THE SIZE
6039 wori26* epenre Bv1575°

onde verier? epeeoe aurieet

6041 22800 vIN

ov42 woT13H" Cplove oeouas 2eaeo H PSKIP OVER THE SIZE LOCATIONS

6045 Ba7131" Bolece BoouGs 2ea4e H

6u44 B07132" Baivee eoo101 22860 B,C #(B)2NUMBER OF DIMENSIONS

6045 22680 }THIS DEPENDS ON THE FACT THAT GETSTK
eude 22900 PRETURNS ITS ARGUMENT IN (C)

6047 007135" aoleee avar6e 22920 Mov m8 HSTORE THE NUMBER OF DIMENSIONS
6048 4o7134" Bo1eve guavas 22940 INK H

6049 07135" Uoleee BoOLTE 22960 © LOPPTA: LDA OINFLG HCALLED By DIMENSION?

6059 407136" Beeeoe Bw1s4ae?

6051 497137" weneeR auri26’

6e52 ouri4o? wo1eee ovoeET 22960 ORA a

6@53 07141" @alooe vooi7e 23000 Mov A,B F(A] 8NUMBER OF DIMENSIONS

6054 voTiaet eaivee gvouor asoee uxt By SCODE+11 FASSUME ITS NOT "DIM"

6055 Us7145" aeeneo BeevIS"

6056 oB7144" Beaeve BLT136°

6057 007145" @oinee govsie 23040 er NOTDIN TOEFAULT DIMENSIONS TO TEN

6058 4u7146e* apeove aurise?

6059 e147? BeoR~e BH7145"

6462 87150" Gaiows aens01 23060 WPOP OFF AN INDICE INTO (B,C)

6¥61 007151? Bsieve gvooos 23080 TAOD ONE TO IT FOR THE ZERO ENTRY
6e62 wo71Se" wolves veoier 23108 NOTOIM: FPUT THE MAXIMUM DOWN

6¥63 7155" Waivoe eeuLas 23120

6064 07154" Ba1e00 go0160 asi4e

6065 807155" Baieee gvav4s 23160

6866 97156" BaiaBe ove36d 23180 SAVE THE NUMBER OF DIMENSIONS
6¥67 07157? woleoa eves4s ase0e FSAVE THE POINTER INTO THE NEW ENTRY
6u68 7160" Baiowe dv0315 23220 PMULTIPLY (8,CJ=NEWMAX BY CURTOL® (0,E)
6¥69 987161" oavere svOvoes

6070 907162" BpeeBa BBT146°

6971 07163" Galeve ou2s5S 2sea 1D, E) 2NEW CURTOL

Tint

[Pemes Evauen

BASIC MCS B48 GATES/ALLEN/DAVIDUFF MACRO 47(115) 5112 109SEP=75 PAGE 2304
F3 Mac GeSEPeo4 S314 MULTIPLE DIMENSION CODE

6vT2 Bor164* Mo1eve BLasad 23260 PoP #GET THE POINTER INTO THE ENTRY BACK
6075 ov7165° Boleve ovesoL 25260 PoP GET THE NUMBER OF DIMENSIONS BACK
0074 BNT166* Gvieoe Buevud 23300 ocr 8 FOECREMENT THE NUMBER OF DIMENSIONS LEFT
6v75 Ba7167? Be1a0e Bvasee 2s3ee INZ PHANOLE THE OTHER INOICES

ov7e avrI7H" BeOOwe GwT135°

6077 ovT171" @oeoHe BwTiELt

6078 aaTi7e? Oplovd weolee 2s3ue mov 4 (B,C) #S1ZE

6079 97175" Golgoe vui1s 25300 Mov

6u8e 07174" waleve e355 23380 XCHG F(D,E) START OF VALUES

6061 v7175° OnigeD ave031 23400 ban FUN)L] SEND OF VALUES

6682 GLTIT6? Ouieve avO332 asueo Ic FOUT OF MEMORY POINTER BEING GENERATED?
6863 Ber17T" BavevD ovTaTTS

6084 veTeno’ Bneena BoTITLr

6985 aeTaait Aaieve oe0515 asaao CALL «= REASON VSEE IF THERE IS ROOM FOR THE VALUES
6e86 voTane? OveGaD aeav4s?

6v87 verans? aeevea oeT:TT

6u68 Berend’ vaiove auauae asaeo SHLD STREND JUPDATE THE END OF STORAGE

6269 vurend’ Beooee avib6ed*

6690 wBrene’ BaeeuL ve7eve

6091 oereaT? Bo1oee avowss 23480 = LERITA: DCX 4 FZERO THE NEW ARRAY

6892 we72iu’ valeve gupvE6 2sseo MVI Me

6093 weraii’ vavera seovod

6094 eeTatet vaiove avasaT 2sseo COMPAR }BACK AT THE BEGINNING?

6895 ov7215" Walowe ovOsee assae INZ ZERITA FNO,ZERO MORE

6096 e714? Hoouue abTeuT?

6697 9e7a15¢ eenee av7eas?

6098 werater veives geaues 235e0 INX 8 FADD ONE TO THE SIZE TO INCLUDE

6299 23580 FTHE BYTE FOR THE NUMBER OF DIMENSIONS
61¢@ ver2ir? Wolpoe oea14T 25600 Hea 10H) 3ZERO

6101 voraevt woleoe seovTe 25620 DIMFLE

6102 wwTaei? eneede oeiduet

6103 walazet aos au7ei4t

6104 voraes? woleve ovveoT 25640 A TARE WE DIMENSIONING ?

6105 ee7aad’ woieee aoov7e 25660 TEMP6 GET THE NUMBER OF DIMENSIONS

6106 ovread’ Beeoee Buried?

6107 wuraee’ Boreve ge7eart

6168 e722? aninea 980157 25660 rary V(LTSNUMBER OF DIMENSIONS

6109 su7as¥" weleve svovs1 23700 4 TEH)L)SNUMBER OF DIMENSIONS TIMES TWO
6118 e721" woipoe weoLrl 23720 8 FADD ON THE SIZE

6ilt 25740 #70 GET THE TOTAL NUMBER OF BYTES USED
6112 07232" epivae ave355 25760 (0,2) 8TOTAL SIZE

6113 07235" wuioue eveuse 23780 TEMPS PLACE TO STORE SIZE

6114 Go7Asa" Boroeo 61575°

6115 9a7235° weenae ge7eed?

6116 aB7es6? Meiove ed1es 23800 ME PUT DOWN THE SIZE

6117 ge7es7? weiooe evouas 238e0 H

6118 aB7a40" voinne goe16e 23840 4,0

6119 097241" Bolvee avouas 23800 h

6120 ad7Tade? Yoiooe geosce 23880 FINNOW

6121 007245" peaeve ev7s31°

6122 aarea4? Beoove wuTes4t

6123 23900

e1ed 25920 AT THIS POINT (H,L] POINTS BEYOND THE SIZE TO THE NUMBER OF DIMENSIONS

BASIC MCS BHBY GATES/ALLEN/DAVIDUFF MACRO 4/ (115) 5412 10=SEP=75 PAGE 2395
FS mac brSEPmo4 S311 MULTIPLE DIMENSION COVE

ores 23940 7 STRATEGYS
6126 23900 NUMDIMSNUMBER OF OIMENSIONS

61e7 2s9e0 CURTOLEG

6128 24000 + INLPNMEGET A NEW INDICE

6129 aueeo 5 POP NEW MAX INTO CURMAX

6130 24040 MAKE SURE INDICE IS NOT TOO BIG

6131 24900 5 MUTLIPLY CURTOL BY CURMAX

6132 2aoee ADD INDICE TO CuRTOL

6133 24100 NUMDIMSNUMOIM®1.

6134 24ie0 INE INLPNM

6135 24140 USE CURTOL*4 (VALTYP FOR EXTENDED) AS OFFSET

6136 24ieo

6137 ov7245¢ eoleee gvouas 24180 INK 4 }POINT PAST THE NUMBER OF DIMENSIONS
6138 007246" waivee gaovel 24200 xT 8, SCODE FCURTOLSZERO

6139 ge7aa7? varava weavev’

614@ ovrasu? eaeoee avreas?

6141 oo7a5i* eo1eee svooes 242e0 xwd 7U1e@0,7026 "MVI 0," AROUND THE NEXT BYTE

6142 voraset eaivee gvesa 24240 INLPNM; POP 4 V(HyL15 POINTER INTO VARIABLE ENTRY
6143 wa72ss* veleoe Bu9136 24260 Mov EM 1 (D,E)=MAXIMUM FOR THE CURRENT INDICE
6144 vo7as4* walene voevas 24280 INX 4

6145 07255" ep1oe0 oue1e6 24300 Mov Oym

6146 207256" wpioae ovouas 24320 NX 4

6147 woTasT? woleoe gvos4s 24340 XTHL F(H)L]SCURRENT INDICE

e148 24300 FPOINTER INTO THE VARIABLE GOES ON THE STACK
6149 07260" valone 200565 24380 PUSH PSH TSAVE THE NUMBER OF DIMENSIONS

6158 ee7261" Yalese ovosaT agave COMPAR 7SEE IF THE CURRENT INDICE IS TOO B16
6151 ov7a6e" eoivee ovOSee 244eo INC HIF SQ "BAD SUBSCRIPT" ERROR

6152 307265" eavove ouTe77e

6153 wora64? aeeave ovreuT?

6154 ware6s* Baigue av0545 24440 PUSH oH FSAVE THE CURRENT INDICE

6155 207266" Beluvo gvesid 24460 CALL = UMULT FCURTOLECURTOL*CURRENT MAXIMUM

6156 Ue7eer? wpen0O BUTIE1®

6157 ae7aTe* eeeovo eres?

6158 waraTit weieoe gudsar 24460 Por 0 FINDICE INTO [0,E)

6159 aore7e? vvieve aoaw31 24508 Dao 0 FADD THE INOICETO CURTOL

6160 07275" Belvoe evaser 24520, POP Psw #GET THE NUMBER OF DIMENSIONS IN (A)
6161 Ge7e74? voiere gvev7s 24540 ocr a FSEE IF ALL THE INDICES HAVE BEEN PROCESSED
6162 wa7a7s* epieoe ovaie4d 24560 MoV i) (B,C) =CURTOL IN CASE WE LOOP BACK
6163 vo7a7e’ eelvee ave11s 24580 Mov Cok

6164 ve7eT7It epivee ovosee 24600 INZ INLPNK FPROCESS THE REST OF THE INDICES
6165 eur3au" Bovovs Bu7ese?

6166 versal? agave vureoTt

6167 2uoee LENGTH=2,<

6168 evTsoe? walove ovovTe 24640 Loa VALTYP FSEE HOW BIG THE VALUES ARE

6169 ov7305* peepee guId4s*

6170 ea7304" Bpeeee ve7soe"

6171 24000 PAND MULTIPLY BY THAT SIZE

6172 99730>¢ Meleee ove104 2qeee BM FSAVE THE ORIGINAL VALUE FOR MULTIPLYING
6175 0¥7306" Baigee oeo115 24700 Col BY THREE

6174 907307" weleee avovs1 24720 H TMULTIPLY BY TWO AT LEAST

6175 007310" Beieee oeoseo 2474e 4 FOR INTEGERS AND STRINGS

6176 @v7S11" aoevee venvod

6177 2a7eo 7NO MORE MULTIPLYING BY THO

ToemecA BiArvan,

@
e

BASIC MCS 8980 GATES/ALLEN/DAVIDOFF MACRO 47 (113) 05312 10=SEPH75 PAGE 23-6
Fs mac OrSEP=64 O5t11 MULTIPLE DIMENSION CODE

6178 G0TS12" Og1090 Boesse 24760 Je SMLVAL

6179 67315" Boeeve av7seer

6186 Ge7314" aoease Bv7ses*

6181 Ga7315" Bolden BvovS) 24ave Dap 4 INOW MULTIPLIED By FOUR

6162 Yo7sie’ enivon avasie 24820 rd DONMUL VIF SINGLE ALL DONE

6163 wOT3i7* Baenen BeTseo?

6164 w97320" Bovaee ovrsis?

6165 we7s21" waieee auousi 24840 ban 4 BY EIGHT FOR DOUBLES

6166 ov7s2e? wa1e0e Bvesue 24860 © SMLVAL JPO DUNMUL FOR STRINGS

6187 oB7325" BaeaeD BwTS26°

6188 u7se4* vovove ouTsiTt

6169 087325¢ @slove auowid 24860 OAD 8 FADD IN THE ORIGINAL

6198 Wa7320" 24900 DONMUL>

6191 24920 IFN LENGTH=2,<

6192 24940 Dao H PMULTIPLY CURTOL BY FOUR

6195 24960 Dao H>

6194 247526" Beleun vooser 24980 PoP 8 JPOP OFF THE ADDRESS OF WHERE THE VALUES
6195 25000 BEGIN

6196 Be73a7* waive eBuavIT 25020 OAD cy ¥AOD IT ONTO CURTOL TO GET THE
6197 a5o4e HPLACE THE VALUE IS STORED
6198 007330" epieee avesss 25000 XCHG PRETURN THE POINTER IN (0,6)
6199 G07331° eoleee vuewse 25060 FINNOWS LHLD —-TEMP2 FREGET THE TEXT POINTER

Seve aa7332" Boveve aviE—s?

6201 207335" epeaee verses?

62e2 027334" Golene Bvov>S 25108 ocx FREREAD THE TERMINATING CHARACTER
6203 001335° woluee govseT 25120 CHRGET

6204 07356" Boluen ovasiL 25140 RET>

6e05

eave 25180

BASIC MUS 68 GATES/ALLEN/DAVIDOFF MACRO 47 (113) @3t42 1@=SEP%75 PAGE 24
FS hac 6rSEPrOd USt11 FRE FUNCTION AND INTEGER TO FLOATING ROUTINES

25200 © SUBTTL FRE FUNCTION AND INTEGER TO FLOATING ROUTINES
25220 IFN LENGTH, <
007337" wolves oeouse 25242 FREt © LHLD ~—- STREND JGET END OF VARIABLE AND TEXT SPACE
87340" panaDM ovIeast
Q07341f wovede av7S3e°
007342" peleee evesss aseoa XCHG PUT IT IN (D,E] FOK SUBTRACTION
87345" weloue aeoual 25260 uxt HSCODE F2ERO CHL)
007344" eevvee awavuet
07345¢ wovede ev7s4u"
ar34et epioae aeau7d 25300 bao sP }PUT THE STACK POINTER IN {HyL)
a53e0 STRING, <
25340 LENGTH=2,<
#07347" Bo1oe oves15 25360 CALL OGETYPE
027350" ganven ovEsaTt
007351" webaed gv7S44*
007352" wo1oe goesoe 25370 INZ GIVDBL>
007355" weavers 9u7STe*
027354 waoee ge7s5e°
25300 LENGTHR2,<
25400 La VALTYP TWAS THE ARGUMENT A STRING?
a54eo ORA A
a54ao JZ GIVDBL> JNO, GIVE FREE VARIABLE SPACE
@07355* waieee gvos15 25460 CALL FREFAC }FREE UP ARGUMENT ANO SETUP
207356" apveae a10454¢
407357? eeov0e av7353*

Tin

254eo TO GIVE FREE STRING SPACE
@87360" Bo1000 Bees15 25500 CALL GARBAR 700 GARBAGE COLLECTION
007361" Booveo a1aeder
007362" Ogovve e7S50°
007363" oieoe eeouse assee LHLD — STKTOP 1BOTTOM OF FREE AREA
007364 Bovoee ab1615¢
007365" oveave av7561°
807360" Maine ev03ss 25540 XCHG
@e7367¢ Gaivoe eeoLse 25see LHLO —- FRETOF>>. 1TOP OF FREE AREA
087370 Bawowe BvIdTS*
@07371" ooeove eLTse4?

Toamtp Busia

THIS ROUTINE SUBTRACTS (0,€) FROM (Heb)
AND FLOATS THE RESULT LEAVING IT IN FAC,

IFE LENGTH=1,<
GIVOBL: MOV Ak #00 THE SUBTRACTION
SUB E
mov cya
Mov AyH
BB r)
GIVACK? MOV By C>
IFN LENGTH=2,<
GIVABF: MOV 0B
MVI Eo #GET ZERO IN LOW
IFN STRING, <
xt HeVALTYP FLAG VALUE TYPE AS NUMERIC
mov HeE>

BASIC NCS 898 GATES/ALLEN/DAVIDOFF MACRO 47(115) O5412 1@mSEP=75 PAGE 2401
F3 mac OrSEProd OSt11 FRE FUNCTION AND INTEGER TO FLOATING ROUTINES

2sque WI 8,144 SETUP TO FLOAT (&,C)
as9e0 MP FLOATR>
20120 LENGTH=a,<
007372" oa1een eoo17s 2e14e mov Ark FEW) Lb) =0H)L) = (0, E)
007373" waleve aevees 2oiee sub €
007374" Oaieoa gvarsT 20160 Mov rr
007375" oalvee gveiT4 2e200 Mov ArH
007376" Beloee aveese 20220 $68 0
97377 aigoa ovavat 2e2ue xHO *01000,7021 HSKIP THE NEXT TWO BYTES WITH "LXI Dy"
@e74qet ee1a9e gva15S7 26260 © SNGFLT: MOV LA SNAKE {A} AN UNSIGNED INTEGER
2e74a1" Beloved Beve57 26280 xRA A
go7avet epinee geor47 26300 © GIVINT? NOV Hiya
907403" Belooe Deese3 26320 on MAKINT>
907494" eoo~eD BeEATIX
e7a95* Bavove av7570"
2e3ee LENGTH, <
26324 LPTSH,<
26326 La LPTPos
26328 SMe SNGFLT>
07406" eeiode gveuTe 26330 La TTYPOS 1GET TELETYPE POSITION
ea7aor? eaves gvevar?
Be741v Pevoae Be7404"
26332 LENGTH=2,<
26334 nov yA FRETURN FLOATING 1 BYTE
26336 XRA A TUNSIGNED FROM A
26338 JMP GIVABF>> IGIVING e255

26300

BASIC MCS 8986  GATES/ALLEN/OAVIDOFF MACRO 47 (413) ©5212 1@*SEP=75 PAGE 25
3 mac OrSEPro4 StL SIMPLE*USER*DEFINED*FUNGTION CODE

6266 26380 © SUBTTL SIMPLE-USER*DEFINED=FUNCTION COVE

6289 26390 IFN FUNCTS,<

6290 2o4v0 5

6291 26420 7 NOTE UNLY SINGLE ARGUMENTS ARE ALLOWED TO FUNCTIONS

6292 20440 AND FUNCTIONS HUST BE OF THE SINGLE LINE FORME

6293 26460 DEF FNA(K)EX™24Xm2

6294 26480 NO STRINGS CAN BE INVULVED WITH THESE FUNCTIONS

6295

6296 2oseo IDEAS CREATE A FUNNY SIMPLE VARIABLE ENTRY

6297 26540 WHOSE FIRST CHARACTER (SECOND WORD IN MEMORY)

6296 26560 HAS THE 200 BIT SET,

6299 20580 THE VALUE WILL bes

6300 20600

ose 20620 A TXTPTR TO THE FORMULA

o3ve 20640 A PTR TO THE ARGUMENT VARIABLE

6303 26660

6304 26680 FUNCTION NAMES CAN BE LIKE "FNAQM

6305 aeree

6506

6307 ov7411* vo1ve® BvOs15 26780 CALL GETFNN HGET A POINTER TO THE

6308 887412" ePvoH |BTSSLt

6309 87415" Bavaee Bu74eT°

e510 acevo FUNCTION VARAIBLE

6311 On7414* @e1000 goeveL 2o8ee Lxd 8, DATA EVENTUALLY RETURN TO "DATA"
6512 vrais? aeavee ovavTet

6313 G07410" OpovHe BaTdiet

6314 ge74i7? eoioee Bv0505 aeaua PUSH B HAND SKIP THE FORMULA

6315 ae742K! Patove aveses 26860 PUSH OD SAVE A POINTER TO 17

6516 @o7421" Ooieee 9ves15 26880 CALL ERRDIR FOEF IS "ILLEGAL OIRECT”
6517 gv74ae? openaa Bu75S2°

6518 a74a5* eovode Gw7415*

6519 go74a4* vei1ovs geosi7 20900 SYNCHK "(" ;MUST HAVE "CM

6520 e745? eoaeee ovavse

eset 2e9e0 SINCE WE STORE A TEXT POINTER
6322 Go7426r Goieoa oves15 26940 CALL = PTRGET GET POINTER TO ARGUMENT
6323 eeraal? wareve svE5es?

6324 @8743U" Boon BwT4ee?

6525 20960 IFN LENGTH=2,<

6326 26980 IFN STRING, <CALL — CHKNUM>>;STRINGS ILLEGAL

6327 evr4si? earvee ovsi7 27008 SYNCHK ")" #MUST CLOSE IT WITH ")"
6528 a743e" Beovs DvavS)

6329 97433" ovine yeesi7 27eeo SYNCHK EGULTK PRUST HAVE EQUAL

6530 007434" BaoeaD aweese

6531 e7435* vo1eee owai04 27040 Hov 8,4

6332 007430" Aolooe 4v0115 27060 nov CL

6333 007437" Galuoe avesas 27080 XTHL FPUT THE TXTPTR ON THE STACK
6534 27100 #(H)LI=PTR TO FUNCTION VARIABLE
6335 ertea 1B ,C) 8TXTPTR

6536 4b7Ta4u? ovine avesas ariae MP OEFFIN PUT DOWN THE TEXTsPOINTER
6337 907441" Baecve gU7521°

6338 wn7aue? Goeono aurael?

6339 27168 FAND ARGUMENT POINTER IN
6540 27180 IMEMORY, RESTORE THE TXTPTR

Team ep Baran:

BASIC NCS 6y8@ GATES/ALLEN/DAVIDUFF MACKO 47(115) 05312 1@"SEPm75 PAGE 25e1
FS mac 6rSEPeod USt1L SIMPLE*USER®DEFINED*FUNCTION CODE

6341 27200 FAND GO TO "OATA" SKIPPING THE
sae 27220 FREST OF THE FORMULA

6343

6344 ge7445¢ Bo1v0H Bva315 27260 FNOOER: CALL GETFNN HGET A POINTER TO

6545 GB7444? weove guT>5Sue

6346 7445? vernee gvT44I?

6347 27260 THE FUNCTON DEFINITION IN (D/E)
6348 27a4e" weiove aveses 27300 PUSH oD SAVE THE POINTER

6349 auTuaT? voieoe oLms1> 27320 CALL PARCHK VEVALUATE THE VALUE TO BE PASSED
6550 a7 450" eeraae av61356°

6351 27451" wooo BvT44ar

6552 27340 LENGTH=2,<

6553 27360 STRING, <CALL — CHKNUM>> jARG CANNOT BE STRING

6354 ee7ase? opie avos45 27380 XTHL 7UH)L)=POINTER TO FUNCTION DEF
6555 27400 JTEXT POINTER GOES ON THE STACK
6356 Ov7USSt ee1aeo aveS67 27420 PUSHN {PUSH THE POINTER AT THE FORMULA
6357 27440 FONTO THE STACK

6358 07454" Oo1ade ovoS21 27460 Por 4(0,£)8PTR TO FORMULA

6359 007455" dolvae 900367 27480 PUSHH PUT A POINTER TO THE

6360 27500 FARGUNENT ON THE STACK

6361 Taso? Oaluae a00341 27see POP FUM/LISPOINTER TO ARG

6362 07457? Yv1Gve 0567 27540 PUSHF IH SAVE ARGS OLD VALUE ON THE STACK
6563 BO7460" O10 B00367

6364 07461" avieve Beeuss 27560 ex

6305 07462" Bo1vd0 0005S 27580 ocx

6366 007465" Calero BvevsS 27600 ocx }POINT TO FRONT OF ARG AGAIN
6367 0v7464" Goiesv BeBv5S 27620 ocx

6366 07465? Bolend aves45 27600 PUSH SAVE IT

6569 01a60" Gvivee 90547 27660 COMPAR WSHOULON'T BE EQUAL UNLESS

6370 27680 FUNCTION WAS NEVER DEFINED

6371 @7467* Boieea BeOses 27700 PusH oD SAVE FORMULA TEXT POINTER

6372 au7a7et avieva vvevse 27720 MVE €, ERRUF NOW (D,£) FREE SO CHECK IF (ZERO) SET
6373 BOTA71* BoGeve BvAvee

6374 utara? woiped eeosie 27740 uz ERROR

6375 07475" eoowe wveiee?

6376 Be7474? Boee~D BLTAST

6377 wera7s? boiove avos15 27760 MOVMF PUT CURRENT FAC INTO OUR ARG VARIABLE
6378 aa7aro? oaderd BvSeb4s

6379 wera7r? Govave @e7473"

6380 27780 VOUT OF FAC INTO (HL) LOCATION
6381 907540" ein0e avosa1 27600 PoP H FPOP OFF FORMULA TXTPTR

6382 27810 LENGTH=2,<

6563 27820 CALL PRMNUN> EVALUATE IT AND MUST SURE ITS NUMERIC
6364 2reee LENGTH=2,<

6385 va7Sse1¢ erlooH ave515 278e4 CALL FRMEVL

6586 vw7Sae’ wPoe Bu5336°

6387 27505" Bovaoe avT47or

6568 aO7Su4t Bulove oLvas45 27826 PUSH OH

6389 907505" Yolnve av0315 27828 CALL FRCSNG

6390 907506" Bporas eLoebT*

6391 Yarsu7? aovene vuT>¥e"

6592 07510" Beinae oues4d 27830 Por

6393 7511" deinae Boouss 27840 ocx

BASIC MCS 8980 GATES/ALLEN/DAVIDUFF MACRO 47 (113) 95312 10eSEP=75 PAGE 25-2
Fs MAC OmSEP6d O3t11 SIMPLE*USER*DEF INED=FUNCTION CODE

6394 woTS1e? bo1HeG wvasaT 27860 CHRGET FSEE IF TERMINATED

6395 MorSi3* eai1enn gwosee 27880 INZ SNERR VIF NOT SYNTAX ERROR

6596 4e7S14* aneown awevTe?

6397 ov75is* Onvava ew7Su6*

6398 27900 #70 BE NICE SHOULD HAVE NEW CURLIN
6399 27920 iBUT VERY MESSY

64en veTSie’ ovieEe Bvas4i 27940 Por ct }POP OFF POINTER AT ARG VARIABLE
6461 Ge7S17* Galena Bvasar 27960 Por 0

64b2 voTSewt apiv0d ooa3se1 27980 PoP B> #POP OFF OLO VALUE

64e3 26000 IFN MULOINISTRINGJFUNCTS,<

64e4 we7seif aeiov0 ouarer 28020 © OEFFIN: MOV MC

6485 ovTSe2? aelane nouo4s 26o4e INx H HSTORE THE OLD VALUE

6486 4a7525" BalevH uHe16e 28000 mov M8

6407 Bo7Se4t epinan uono4s 26080 © PUTDEI: INX 4

6468 G075a9° aolene Bue16s 26100 Mov ME

6409 onTS26° wploee Buae4s 28ieo INx H

6419 Ge75e/" Boloee ovo162 26140 MoV Md

6411 087530" Baioue avosad 28160 POP H OP OFF OLD TXTPTR

6412 07531" eginoe wwasit 26160 RET> ALUE IS IN FAC == ALL DONE

6413, 26200 IFN FUNCTS,<

o4ia es2e0  ¢

6415 26240 7 SUBROUTINE TO SEE IF WE ARE IN DIRECT MODE AND

e416 26260 7 COMPLAIN IF SO
i
ia

6417 eseeo

6418 007532" beleue ooosad 26300 ERRDIR: PUSH =H SAVE THEIR (HyL)

6419 007535" evlven ounwse 26320 LHLD CURLIN WSEE WHAT THE CURRENT LINE 1S
6420 B07534" BeveDD guieu7?

6421 007535" gagoon aeTD>14*

6422 Be7530" woleno auov4s 28340 INK FDIRECT 18 65,535 SO NOW @
6423 wvrS37* Colpan gua174 28560 Mov

6424 007540" Bolon0 Bvue6d 26380 OKA HIS IT ZERO Now?

6425 907541" algo goos4d 26400 PoP

6426 weTS4et Ov1veD aouseE 2eden RNZ PRETURN IF NOT

6427 07543" Baleoe aenvse 2eauo MVI E,ERRID PUILLEGAL DIRECT" ERROR
6428 407544" Beaver auov14

6429 97545" oolave vvoses 2e40ee ERROR

6430 207546" BogaeD avelve?

6431 07547" Boevee BeTd3a"

o43e 2eqea

6433, 26500 7 SUBKOUTINE TO GET A PULNTER TO A FUNCTION NAME

e434 26520 i

6435 au7550" eelnoe BuosIT 28540 GETFNM: SYNCHK FNTK PMUST START WITH "FNM

6436 U07551* weoeoD Bvoeds

6437 ga7sSet apioaw avev7e 2eseo wd Ay128 FDONT ALLOW AN ARRAY

6458 07553" voovaD veeeod

6439 7554" Bolove BunuEe 2esea STA SUBFLG #DON?T RECOGNIZE THE "(" AS
6440 07559" Beeove Bb1eD1*

6441 07550" Baweun guTS46*

baue 280

6443 Gv7557" walaee geoe6d 28020 ORA " FUNCTION BIT

6444 027560" Boigne ovale? 28040 Mov BA }GET FIRST CHARACTER INTO (8)
644s 286600 LENGTHe2, <

6446 28680 STRING, <CALL  PTRGT2 FREALLY GET THE POINTER

Team ep Baran:

e
e
e
@
e
e
e
e

BASIC NCS 6080 GATES/ALLEN/DAV1OUFF MACKO 47(113) 05412 10=SEPe75 PAGE 25-3
FS mac GrSEPro4 OSt11 SIMPLE*USER*DEFINED@FUNCTION COVE

o4a7 26700 IMP CHKNUN>> }MAKE SURE 11S NOT A STRING NAME
6448 oo7561" Bo1eMD aeoses 26720 FE STRING&SLENGTHm2>,<JMP  PTRGTaQ>>

6449 Gersee? eveaee gvedie?

645¢ 007563* waeavy av7555°

6451 26740 © PAGE

BASIC MES 6080 GATES/ALLEN/DAVIDUFF MACRO 47 (115) O3812 1eSEP=75 PAGE 26
FS mac OrSEProd OSt11 STRING FUNCTIONS

6452 28760 © SUBTTL STRING FUNCTIONS

6453 28780 IFN STRING, < FSTRING HANDLING SUBROUTINES
6454 26800 Ff

6455, 28820 7 THE STRS FUNCTION TAKES A NUMBER ANO GIVES

6456 28842 A STRING WITH THE CHARACTERS THE OUTPUT OF THE NUMBER
6457 28860 7 WOULD HAVE GIVEN

6458 26eb0 Ff

6459 GBTS64° 28900 © STRSt

6468 2e9e0 IFN LENGTH#e,<

oae1 28940 CALL «= CHKNUM> TNAKE SURE THE ARGUMENT
o4ez 26960 VIS A NUMERIC

6463 v7S64" Galore gv0s15 28980 CALL FouT 700 ITS OUTPUT

6464 YATS65? weDBDe av4asTa

6465 Ga7S6o? BpeP20 BUTd>beF

6466 YeT567* Bvieee auos1S a9ou0 CALL STRLIT FSCAN IT AND TURN IT INTO A STRING
6467 097578" BovveD BuTE3T*

6468 wv7571" vovOGe BuT>eS*

6469 BeTSTet Buleoe aB0315 avaeo CALL FREFAC TFREE UP THE TEMP

647@ Bu7STS* Gaboen v10434"

6471 COTST4? Bavene ouTSTOF

6472 G87575* waloea seeound 29040 xr 8, FINBCK

6473 Ye7STO? aneLea B1O546°

6474 407577" aeoeaa ov7575°

6475 wa7Avu? @eiove avasad 29060 PUSH B #SET UP ANSWER IN NEW TEMP
6476 29080

e477 29100 STRCPY CREATES A COPY OF THE STRING

6478 29120 WHOSE DESCRIPTOR IS POINTED TO BY (HyL],

6479 29140 ON RETURN [D,€] POINTS TO DSCTMP

6480 29160 WHICH HAS THE STRING INFO (LENGTH,WHERE COPIED 10)

6481 29180

6462 Gd7T6D1" Baieve BLOITe 29200 STRCPY? Mov ay #GET LENGTH

6483 aa7ene" waleoe avovaS 29ee0 INK 4 #MOVE UP TO THE POINTER
e484 e924e IFN LENGTHR2,<

6485 29260 INK He

6486 be7oUS* eAivoe BLeS4d 29280 PUSH oH #GET POINTER TO POINTER OF ARG
6487 Bvreoat voinoe Bv051d 29300 CALL GETSPA GET THE SPACE

6488 gu7605* eevouD avTITe?

6489 Guroue’ aeeea2 Bv7ST76°

6490 BeTeBT? Beivon BuBs4ai 29320 Por 4 FIND OUT WHERE STRING TO COPY
6491 7610" Opivee BLe5s67 29540 PusnM FREALLY 18 IN [6,C)

6492 ee7ol1? glove wueser 29360 Por 6

6493 ovtete’ Baigae 200315 29360 CALL «== STRAD2 FSETUP OSCTMP

6494 07615" Oneeve guTeeTT

6495 7614" BaveDe AuTEBS?

6496 BB7615? baleve vensad 29400 PUSH oH SAVE POINTER TO OSCTHP
6497 @B7e16* Baleae aea1ST 29420 Mov La FGET CHARACTER COUNT INTO [L)
6498 Uare1T? Beleoe oees15 29440 CALL HOVSTR WMOVE THE CHARS IN

6499 uareevt oveeoy mio4aiT?

6500 Gvlea1? Bovere ovTb1S*

6501 aereae’ we1gee veoser 294600 Por TRESTORE POINTER TO DSCTNP
65@2 uvreas? oaivos v00511 29480 RET RETURN

6503

6504 0a7624* Ba1ee® vH0515 2952@ «STRINI? CALL GETSPA GET SOME STRING SPACE (1A) CHARS)

&
Teamth Buarvan

°
@
e

BASIC MCS BOBL GATES/ALLEN/DAVIDOFF MACKO 47(113) @5312 1@eSEF=75 PAGE 2601
FS mac 6rSEPrO4 5311 STRING FUNCTIONS

6505 evread* Boone weTTTe?
6506 ve7eaet aevaae ve7e20"
6507 OuT6al? Belove ovoLdd 29540 © STRAD2? LXI Hy DSCTMP HGET DESC, TEMP
6508 47630" Gerad evID7er

6509 087631" Boodoe avTeZ>*

6510 e762" eiove gves4s 29560 STRADI: PUSH oH FSAVE DESC, POINTER

6511 927635" Belaa@ ave16e7 29580 MoV Mea SAVE CHARACTER COUNT

e512 29600 IFN LENGTHee,<

6513 29620 INx H> MOVE TO ADDRESS FIELD

6514 ev7634 woloee 29640 IMP PUTUEL FUSE COMMON CODE TO

6515 007635" aeoee ‘

6516 07636" Bevave ou7eS"

6517 29600 FSTORE (0,E)=POINTER TO FREE SPACE

6516 29680 FAND RESTORE (H,L} AS THE DESCRIPTOR POINTER
6519 29682
e520 29684
o5e1 29686
o5e2 29688
6525 29690
524 29092
6525 29694
e526 29696
e5e7 29697

STRLT2 TAKES THE STRING LITERAL WHOSE FIRST CHARACTER
18 POINTED BY [H,LJ#1 AND BUILDS A DESCRIPTOR FOR IT,
THE DESCRIPTOR 18 INITIALLY BUILT IN DSCTMP, BUT PUTNEW
TRANSFERS IT INTO A TEMPORARY AND LEAVES A POINTER
AT THE TEMPORARY IN FACLO, THE CHARACTERS OTHER THAN
ZERO THAT TERMINATE THE STRING SHOULD BE SET UP IN (8)
AND (0), IT THE TERMINATOR IS A QUOTE, THE QUOTE IS SKIPPED
OVER, LEADING QUOTES SHOULD BE SKIPPED BEFORE CALL, ON RETURN
e526 29698 THE CHARACTER AFTER ThE STRING LITERAL IS POINTED TO
e529 29700 8Y (H,L) AND IS IN (Al, BUT THE CONDITION CODES ARE
6530 a97ee NOT SET UP,
6531 29704
6532 7637 Oo1eve avaess 29720 © STRLIT# vex HW
6533 wu7edot woloee weave 29740 © STRLTIE MV. 8,34 FASSUNE STR ENDS ON GUOTE
6534 ou7641t BoeDue avow4E
6535 wuTede? Bo1nee avaree 29760 STRLT3? MOV 0,8
6536 407645" Bolove aves4s 29768 STRLTa@t PUSH oH SAVE POINTER TO START OF LITERAL
6537 peTH4AaT BeLeve Boow16 29800 NVI c,255 FINITIALIZE CHARACTER COUNT
6538 827645? Bonobo 200577
6539 Ov764e" veiewe veavas 29820 © STRGET: INx 4
654e ov7647t Boiova eve17e 29840 nov AM FGET CHAR
6543 vo76Se* Boinae avoe14 29860 INR c BUMP CHARACTER COUNT
ry
8

e542 27651" Be1nee avezeT 29880 ORA VIF @, (END OF LINE) DONE
6543 7652? Bv1000 evOSIe 29900 Jz TRFIN iTEST

6544 7655" eease M07bO5°

6545 on7654* Boveae 07635"

6546 #87659" Boinve BueeTe 29920 CHP 0

6547 887656" BviAee avOsIe 29940 vz STRFIN

6548 7657 Genade BvTbOS?

6549 dToou? oreo av7653"

6554 807661" Beivoe avve7o 29960 8 CLOSING QUOTE

6551 avTo62" Beles gvOsLe 29980 STRGET NO, GO BACK FOR MORE

6552 007605" eevee av7e46"

6553 007664" Bowes 07657"

6554 07665" Beia08 Bvas76 Soave © STRFIN: © 34 FIF QUOTE TERMINATES THE STRING
6555 pu7eoot avecuo aouede

0556 O0766/" welave ovasi4 soe i CHROTR SKIP OVER THE QUOTE

6557 av7e7ut BoveKe BvS42"

BASIC MCS 6960 GATES/ALLEN/DAVIDUFF MACRO 47 (415) 05212 10*SEP=75 PAGE 26-2
FS mac O=SEPro4 StI STRING FUNCTIONS

6558 047671" aveOKD BYTES"

6559 ov7e7e" Bolove woosus soa4o XTHL

6560 087675" eeiveo avooas 300600 Inx

6561 007674" Bion gvas53 seose XCHG GET POINTER TO TEMP

65e2 407675" Avigua Bva1T1 se10e Mov c GET CHARACTER COUNT IN A

6565 ov7676" Ba19Me BooSId 3o120 CALL © STRADe HSAVE STR INFO

6504 4a7677" Beeena avTeeT?

6565 war7ev’ apeouo uT7ETe*

6566 30140 FCOMPARE DESC, POINTER & STR POINTER
6507 UeT7e1" ep19n0 Gvos47 so1e0 COMPAR 110 SEE IF STR IN BUF

6568 wuT7H2" Bolon2 Buosed 30180 enc STRCPY VIF IN BUF, MUST COPY IT,

6569 0a7795¢ vopesa gu7eBIt

6570 87704" Baenee 4eTeTTS

6571 30200 FOTHERWISE STR IN PROGRAM,

6572 sweeo

6573 sa4y SOME STRING FUNCTION IS RETURNING A RESULT IN OSCTMP

6574 30260 WE WANT TO SETUP A TEMP DESCRIPTOR WITH OCSTMP IN IT

6575 30280 PUT A POINTER TO THE DESCRIPTOR IN FACLO AND FLAG THE

6576 $0300 RESULT AS TYPE STRING

6577 30320

6578 907705" Bp1040 vowel 30340 © PUTNEWS LXI D,DSCTME 7(0,€] POINT AT RESULT DESCRIPTOR
6579 vo77H6? wneooe Bw157Lt

658e YeT7er* eaecea ov7705"

6581 vo7TI0" wo10%9 wBoouse 30360 LHLD  TEMPPT FV (H,/L)=POINTER TO FIRST FREE TEMP
6582 BOTTI1" @AvEDD wu1Dd47"

6583 wurTi2* eo0000 ovT7ae*

6584 GO7713" Beivoe avan4e 30360 SHLD FACLO FPOINTER AT WHERE RESULT DESCRIPTOR WILL BE
6585 BOTTI4? geenne GuLEsT*

6586 07715" BeaOu0 BwTTII?

6567 30400 LENGTH#2,<

6588 GU7TI6* Belaue woouTe se4e0 MVI ADs

6569 B¥7TIT* BpBeDD BvovBS

6596 warTew? B10u0 woouse 30440 STA VaLTye FLAG THIS AS A STRING

6591 oaT7al? BeuoeD BvId4s¢

6592 Hor72e’ onvave wu7i14*

6593 we772s* vo1900 906315 3n4e0 CALL MOVED JAND MOVE THE VALUE INTO A TEMPORARY
6594 o07724* Bae Bu4ess»

6595 oo7725" anvvae weTT21*

6596 30480 LENGTHe2,<

6597 30500 nVI At FLAG RESULT AS STRING

6598 suse STA VALTYP TSTORE IN "VALUE®TYPE" LOCATION
6599 30540 CALL MOVED FTRANSFER THE DESCRIPTOR IN

6o0e v7726° Yalove vuosaT 30508 COMPAR FOSCTMP IS JUST BEYOND THE TEMPS
out 30580 TAND IF TEMPPT POINTS AT IT THERE
boone seove TARE NO FREE TEMPS

6683 veTT2T* aaleve avowse 30620 ores E,ERRST THSTRING TEMPORARY" ERROR

6604 worrsot wevnee ooaeeD

6605 407751" volove wuvsie 30640 Jz ERROR 760 TELL KIM

e6be wO774e* Goovue avaloe?

6ev7 07735" waeoue BuTTeKt

6608 097734" Uelove wvnLae 306600 TENPPT FSAVE NEW TEMPORARY POINTER

6609 007735" ogeoue gn1547"

6610 07730" Bowore wuTTse*

Team eA Bvarcan:

BASIC HCS 8980 GATES/ALLEN/DAVIOUFF MACKO 47(113) ©5312 10*SEPR7S PAGE 26-3
FS maAC 6RSEPeo4d OSt11 STRING FUNCTIONS.

6611 987787" Bo1eve oeas41 30680 Por 4 GET THE TEXT POINTER
6612 Gv7740" Boieee gea1Te 30700 MoV AyM GET CURRENT CHARACTER INTO (A)
6613 @a7741" woleoR weosit 30720 RET

6614 3e74e oF

6615 30760 ©} PRINT THE STRING POINTED TO BY (HyL) WHICH ENDS WITH A ZERO

6616 30780 j IF THE STRING IS BELOW OSCTMP IT WILL BE COPIED INTO STRING SPACE
6617 3eeu0 5

6618 e7742" Baiowe BeBv4S 30820 © STROUI INX H HPOINT AT NEXT CHARACTER

6619 Ba7745" eeieee Bv0S15 30840 © STROUT: CALL = STRLIT GET A STRING LITERAL

6620 487744" eevoDD BuTeST*

6621 Be7745* voeuve 207735"

beee 3ube0
bees 30880
e624 30900
6625 ov7746" Bo120e ovOS1d 3e9e0 SS
6626 007747" BovaDe 10434"

6627 oa7756" @aeave avTT44t

ee28 30940 IFE LENGTHe2,<

6629 ver7S1* Go1nee BvOs1S 30900 CALL = OGETBCD (0) LENGTH (B,C) =PDINTER AT DATA

6630 4e775e" Baenee avoveLr

6631 u7755" BpeevD BuTT4T*

6632 BvTTS4* Beiean svoved 30970 INR 0 FINCREMENT AND DECREMENT EARLY

6633 30980 170 CHECK FOR NULL STRING

6634 47755¢ eoioae aeo—ed 30992  STRPR2t OCR o> TDECREMENT THE LENGTH

6635 31060 IFN LENGTH=2,<

6636 31080 CALL NOVRN 1GET LENGTH IN (E)

6637 31100 INR € FAND POINTER TO CHARACTERS IN (B,C)
6638 $1120  STRPR2? OCR E>

6639 07756" Beioae vwns10 31140 RZ FALL DONE

6649 avT7S/* Geiowe voouie 31160 Lax GET CHARACTER TO PRINT

6641 G77" Geiove veOs37 31180 QUTCHR

6642 we7761" eoivew gva376 31200 cPr

6643 eTTee? Covoue Boue1s

6644 GuT765¢ GaIooB evOsi4 31220 cz

6645 woreda? Gadove wvassar

6646 ures? ooeove gvTISet

6647 GurTeo? Goivae veowas 31240 WPOINT TO THE NEXT CHARACTER

6648 007767" Boipa0 voo303 $1260 STRPR2 FAND PRINT ITye

6649 ov777U" Booeee wvTTSS

665e BvITTI Yowwee OvTTO4

6651 31280

6652 31300 GETSPA » GET SPACE FOR CHARACTER STRING

6653 31320 HAY FORCE GARBAGE COLLECTION,

6654 31340

6655 31360 # OF CHARS (BYTES) IN (A)

6656 31360 RETURNS WITH POINTER 1N [0,E} OTHERWISE IF CANT GET SPACE

6657 31400 BLOWS OFF TO "OUT OF STRING SPACE" TYPE ERROR,

6658 314eo

6659 buT7Te? OniovH BEneET 31440 GETSPA: ORA a FMUST BE NON ZERO, SIGNAL NO GARBAG YET
6668 7775" Beivee Beeb1e 31460 XWO *01000,"0016 #"MVI CM! AROUND THE NEXT

6661 27774" Boigve weeseL 31480 © TRYGIa: POP PSW FIN CASE COLLECTED WHAT WAS LENGTH?
bee2 087775" weivue 00565 $1500 PUSH PS FSAVE IT BACK

6663 07776? Gaivaw BeBeSe 31520 LHLD © STKTOP }GET BOTTOM OF STRING SPACE

PRINT THE STRING WHOSE DESCRIPTOR IS POINTED TO BY FACLO,

TRPRT? CALL — FREFAC FRETURN TEMP POINTER BY FACLO

BASIC MCS 648M GATES/ALLEN/DAVIDUFF MACRO 47(115) @3212 10*SEPe75 PAGE 26—4
FS mac 6eSEPred OSt14 STRING FUNCTIONS,

6664 wa7777" eovoue Mu1e15*

6665 Bie—ew? eagonD wwT7T7L°

6666 Gidaeit belove vvasss 31540 XCHG IN (D,E)

6667 Bivooe? Moione owovse $1560 LHLD = FRETOP GET TOP OF FREE SPACE IN (HyL)
6668 aisaast apvavd ov1d73°

6669 o1oMed*? eovoun avT7T7It

6670 19805" weleae guousT 51580 cma fet OF CHARS

6671 uivane’ Baivae avaii7 31600 Mov FIN (B,C)

ee72 vivee7’ veleen gueeee S162@ MVE

6673 oive1e? Bovedd wuns77

6674 widei1t Be1900 ovev11 31640 ban FSUBTRACT FROM TOP OF FREE
6675 Bivaie’ waioon gvov4s 31660 INK H

6676 Biee1s* Galvan gonsa7 31680 COMPAR FCOMPARE THE TWO

6677 vivoi4? ealuen gvesse 31700 Je GARBAG #NOT ENOUGH ROOM FOR STRING, OFFAL TIME
6078 014015" Baeebe Bi0w26’

6679 B1eo10" Baeeee giguast

6682 10017" Baleoe BuovKe 31720 SHLD FRETOP FSAVE NEW BOTTOM OF MEMORY

6661 010020" oneovn mu1575°

6682 biv0e1" woveee wive1d*

6683 Bingeet epiuee Buav4s 31740 INK 4 7MOVE BACK TO POINT TO STRING
6684 vidnes? Galnae BvOS53 31760 XCHG PRETURN WITH POINTER IN (0,6)
6685 Gidvad? Yolove BvOSe1 31780 © PPSWRT: POP PSH #GET CHARACTER COUNT

6666 wieaes* Belvso ovasi1 51800 RET FRETURN FROM GETSPA

6687

6688 Giva2e’ aoiveo wvese1 31840 © GARBAG: POP PsW THAVE WE COLLECTED BEFORE?
6689 wivoe’? wolvee woeuse 31862 MWVI E,ERRSO GET READY FOR OUT OF STRING SPACE ERROR
6690 41n958" Bove Bvae1e

6691 aivn3i* waioee veusie 31880 ra ERROR 760 TELL USER HE LOST

6692 a100se? vor oveiee?

6693 010033" varave oiewev*

6694 10034" @oioa0 HoveTT 31900 che a FSET ZERO FLAG TO SAY WEVE GARBAGED
6695 010035" Bpleoe ov0365 31920 PUSH PSH TSAVE FLAG BACK ON STACK

6696 Giease" eelene guoval 31940 LxI 8, TRYGLe TPLACE FOR GARBAG TO RETURN TO,
6697 Gi0e37* BeovoD wuTTT4F

6698 wivede? enveon wieeser

6699 10041" Yaleew vvos0d 31968 PUSH 8B #SAVE ON STACK

6708 1004e" Baieoe vuBvSe 31960 GARBA2S LHLD = MEMSIZ VSTART FROM TOP DOWN

6701 910045° oaeevo guI545°

e7¥2 210044" Boeeee 410037"

6703 seounIFE REALIO,<

6704 seoew MI AyT TRING THE BELL ON GARBAGE COLLECTION
6705 se04o OUTCHR>

6706 010045" Baleve BvovdE $2060 FNDVAR? SHLD  — FRETOP LIKE SO

6767 G1Gade? vovedy geid7st

6708 viovaT? Gagove e1pL4se

6709 Giea5e? oainee aveuai sea8o xr 4, SCODE GET DOUBLE ZERO

6716 010051" wovven ovoveD?

6711 v1005e" weovee viv—aet

6712 16055" Baiowe bos45 se1we PUSH OH FSAY DIDNT SEE VARS THIS PASS
6713 010054" oaiove avouse seieo LHLD © STKTOP JFOKCE DVARS TO IGNORE STRINGS
6714 910055" BaweME ov1E15°

6715 010056" wagese a10u51°

e716 saiae VIN THE PROGRAN TEXT (LITERALS, DATA)

Team ep Biarcan:

BASIL MCS 8980 GATES/ALLEN/DAVIDUFF MACRO 47(113) 03112 10=SEPR75 PAGE 26-5
FS Mac beSEPro4 OSt1t STRING FUNCTIONS.

6717 #10957" we1000 avas4s 32169 PUSH OH FORCE FIND HIGH ADDRESS
6718 G1ug6e" Baloo ovov4d se160 uxt Hy TEMPST HGET START OF STRING TEMPS
6719 e10861" weeee go1551°

6720 1eA6ee" eee BinEss?

6721 010065" Boicoa 200353 seevo XCHG FSAVE IN [D,E)

e722 10004" vaiooe ovoese seeeo LHLD  TEMPPT HSEE IF DONE

6723 10065" Bavene guis47e

6724 210966" wares gioLe1?

6725 10967" Baiooe evossS 3ee4o XCHG FLIP

6726 10076" op1000 gves47 seeoe COMPAR I TEST

6727 010071" Be100B ovoveL 32280 uxr By TVARK FORCE JUMP TO TVAR

6728 e10n7e" BAvea BibLes*

6729 010075" Bovoee 01065"

6750 910074" Belove ovesve 32300 NZ pvare 700 TEMP VAR GARBAGE COLLECT
6731 eiea7s’ aoveee e192i13¢

6732 10976" Booee erovTe?

733

6734 g1e077* weivan oveuse 52340 SVARSt LHLD — VARTAB GET START OF SIMPLE VARIABLES
6735 10100" BeeodH ouleer?

6736 o1v1a1? epeee0 B10K75°

6737 e1v10e" eo1bee ovOs5S $2360 © SVAR —XCHG HGET IN (b,€)

6736 910105¢ e100 ovaLse 32380 LHLO © ARYTAB GET END OF SIMPS

6739 v101e4" Baouee Bvi62st

6740 a1aias? coeove e10100"

6741 o1e196* waives avosss 32ave XCHG FFLIP

6742 010107" epipee ovesa7 Seaeo COMPAR FSEE IF AT END OF SIMPS

6743 10110" Colooe aueste seaaa Jz ARYVAR TIF YES, DO ARRAY TYPE STRINGS
6744 @10111° Beecee g10140"

6745 v1o11e" aeeee e10104"

6746 1v115* e1e0e BvO176 saao0 Mov aM GET 2ND CHARACTER OF VARTABLE
6747 010114 Galove evoeas Sseaeo INx 4 FBUMP POINTER THICE

6748 10115" Belene auaLas 32500 INx H ,

6749 32520 LENGTHe2, <

675@ 10116" eeieoe evoeas 32540 INx H POINT AT THE VALUE

6751 810117" Bvioee evv376 32560 cred 3 FSEE IF ITS A STRING

6752 1a1ee" boeone veovOs

6753 e1vialt Gelove ovoSeE 32580 INz SHPVAR VIF NOT, JUST SKIP AROUND IT
6754 o1012e? eave v101se°

6755 @1G1a5¢ ooeawe 10111"

6756 w1n1e4* Be1bse BvOS15 32600 CALL DVARS COLLECT 1

6/57 o1n125? beeen aipelae

6758 e10120" wavony Bio1ee?

6759 e1viel? boieve vv—eST s2620 XRA a FAND DON?T SKIP ANYTHING HORE
6760 10130" Helveo avo137 $2640 SKPVARE MOV E,A

6761 010131" Beivoe eooe26 32660 MVE on 4D, E)=AMOUNT TO SKIP

o7ee e10132" Boeaae avovee

6763 014135" Beioee voees1 32680 bao o>

6764 32700 LENGTH=2,<«

6765 32720 ORA A FSET CFS

6766 32740 CALL DVARS> FCALL THE VARIABLE GARB ROUT,
6767 10134" velove vovses 32768 NP SVAR GET NEXT ONE

6765 010135? aoaere e1eiger

6769 10136" Bnoeea w10125°

BASIC MCS 8980 GATES/ALLEN/DAVIDOFF MACRO 47 (113) @3212 10eSEP=75 PAGE 26-6
FB mac OrSEPeo4 BS311 STRING FUNCTIONS

6770
10137" baie evesar $2800  ARYVA2t POP 8 #GET RID OF STACK GARBAGE
B18140" Googe evesss 32820 © ARYVAR? XCHG TSAVE ARYVAR IN (D,E)

@10141° vateve geovse 32840 LHLO — STRENOD GET END OF ARRAYS
@1014e" oeaee BbI625
@10145* eaeean 910135"
10144" egivee gvOS55 32860 XCHG FLIP BACK
910145* ooieee geesa7 32860 COMPAR TSEE IF DONE WITH ARRAYS
@10140" Boles vase $2900 Jz GROPAS YES, SEE IF DONE COLLECTING
@10147" waeeap oigesat
@10150" Bp2e00 10142"
seve LENGTHma,<
010151? Oeioe0 eoo17© S294 Mov Ay GET THE VALUE TYPE INTO (A)
10152" Boivon avovas $2960 INK H>
810155" opivee 90515 52980 CALL | MOVRH HGET LENGTH OF ARRAY IN (B/C)
010154" Govoee wodsoex
910155" Gooooe w1oi4a7?
35000 LENGTH#2,<
$3020 Mov Ay E> #GET 2ND CHAR OF VAR NAME IN A
@10156* Go1oae avosas 33040 PUSH oH FSAVE POINTER TO DIMS
610157" @oioee oeavit 33069 DAD 8 FADD TO CURRENT POINTER POSITION
53080 E LENGTHe2,<
@10160* Bo1naa 900376 35100 cPr 3 WSEE IF ITS A STRING
910161" eovoe0 evovas
@1016e" Goigee weesce 33120 NZ ARYVAR> VIF NOT JUST SKIP IT
610165" waoes 10137"
@10164" aveve 10154"

$3140 LENGTH=e,<

33160 ORA Ly SEE IF STRING VAR

35160 JP ARYVAa> NG, KEEP ON TRUCKIN
010165" Guiene oaduae 33200 SHLO TEMPS FSAVE END OF ARRAY
810166" oaone~e
810161" eavdo
010170" Oo 33220 Por GET BACK CURRENT POSITION
e1e17a? ve B60116 33240 mov #PICK UP NUMBER OF DINS
O10172* ep1v9e Beoboe 33260 MVE WMAKE DOUBLE WITH HIGH ZERO
810175" apooee veaver
010174" Oaiooe avevid 35260 aD 4G0 PAST DIMS
@10175° ogivea evpe11 33300 Dap }BY ADDING ON TWICE #0IMS (2 BYTE GUYS)
©18176" Opin eeaw4as 33320 INX FONE MORE TO ACCOUNT FOR #DIMS,
@10177* Baivog evasss 33340 © ARYSTRE XCHG FSAVE CURRENT POSIT IN (0,6)
@1v20e* aui1o99% eeoEse 33560 CHLD GET END OF ARRAY
#10201" apovee 01575°
@1e2de" wpwoee 210160"
@ia2es? ee1cas 960355 33360 XCHG FIX (H,L) BACK TO CURRENT
e10204* go1G00 ovos47 33400 COMPAR SEE IF AT ENO OF ARRAY
elv2es? eo1000 evosie 33420 Rr ARYVAR FEND OF ARRAY, TRY NEXT ARRAY
@10200" aon i1014L"
e1e207? bonesy iveai*
@1a2ie* eiava evover 33440 xr By ARYSTR FADDR OF WHERE TO RETURN TO
10211 @o0000 10177"
G1e21e? Bovevs wioede’
10213" apigou eveses $3460 PUSH 1GOES ON STACK

Team Baran:

BASIC MCS 8986 GATES/ALLEN/DAVIDUFF MACRO 47 (113) 05812 109SEPe75 PAGE 2697
FS MAC OrSEPeO4 OS311 STRING FUNCTIONS

ees 33480 IFE LENGTH=2,<
6624 wiver4at 35500  OVAR

6825 910214" Ye100e eoeesT 33520 OVARS: XRA

6626 10215" eolnae eoeece 33540 ORA SEE IF ITS THE NULL STRING

6827 o10216° e100 aooeds 35500 INK

6828 010217° Oe1u0e ove136 35580 MOV

6629 eiv22L’ eloge Boneas 33600 INx

6830 10221" ep1000 aveize 33620 Mov

6831 O1v2ee? veloen epaeas 33640 1x 4(D/E) POINTER AT THE VALUE

6832 35660 LENGTHe2,<

6635 33680 ORT 128 FORCE DVAR TO CALL GRBVAR

6834 33700 PUSHH SAVE LENGTH

6635 35720 PUsKM HSKIP NEXT TWO BYTES

6836 33740 POP o GET POINTER IN [0,E)

6837 33760 POP 8 #POP OF STRING LENGTH

68368 33780 RP FIF WASNT A STR, RETURN

6039 33800 Wov i JGET LENGTH OF STRING

6040 33820 OkA a> SET CONDITION CODES

6841 G1de2s? Bele avesi0 33840 RZ NULL STRING, RETURN

6842 G1e224" Beived gvoio4 53860 MOV 8,4 WMOVE CHL) TO (B,C)

6643 ives? ooiees avelis 35880 mov Cok

6844 10226" Belvo gooLse 53900 LHLD — FRETOP GET POINTER TO TOP OF STRING FREE SPACE
6645 ideal? webeus B01575"

6846 910230" Hebe a1eerl®

6847 v10231" Below aves4T 35920 COMPAR 71S THIS STRINGS POINTER LT, FRETOP

6648 10232" wolees ovor4ge 33940 Mov 48 JMOVE [B,C] BACK TO [HyL)

6849 010235" Bo10ge be151 33960 mov uc

6850 810234" Bolady wveS30 33980 RC HIF NOT, NO NEED TO MESS WITH IT FURTHUR
6851 1255" Bv1ed0 Bvos41 34000 POP 4 }GET RETURN ADDRESS OFF STACK

6852 O1da3e? eoloe avusas 34020 XTHL JGET MAX SEEN SO FAR & SAVE RETURN ADDRESS
6853 10237" Bulade aves47 34048 COMPAR HLETS SEE

6854 B1vedu’ Bp19ee AvOS45 34000 XTHL SAVE MAX SEEN & GET RETURN ADORESS OFF STACK
6855 10241 Bolo0e 00545 54080 PUSH SAVE RETURN ADDRESS BACK

6856 G1vaue? duleas avaiae 34100 MOV FMOVE (B,C) BACK TO CHyL)

6857 102G5* Gu1erG OuIS1 s4120 MOV

6858 810244" Bo1000 avoseE 34140 RNC FIF_NOT, LETS LOOK AT NEXT VAR

6859 1245? aoieud avesor 34160 POP GET RETURN ADOR OFF STACK

6860 1246" oLeDe avOS01 34160 POP POP OFF MAX SEEN

6861 10247" BH1ORe evose1 saeeo POP AND VARIABLE POINTER

e862 81025" aoiese eoos45 saee0 PUSH SAVE NEW VARIABLE POINTER

6863 B102a51" Balas oveses 34240 PUSH FAND NEW MAX POINTER

6864 Gieaset Meivoy g0aS05 3a2e0 Push FSAVE RETURN ADDRESS BACK

6665 Giva5s* erie Be—Ss1L 34260 RET AND RETURN

e866 34300 i
6867 34320 5
6668 3asan i
6869 B10254" Bele awesar 34360 GRBPAS: POP ° ;POP OFF MAX POINTER
6870 o10255¢ ep1ae oves41 $4380 Pop x SAND GET VARIABLE PUINTER

6871 #10256" GH1n90 00175 saaoo Nov FGET LOW IN

6872 B1va5T? Bniove Bees 344ae0 ORA 4 #SEE IF ZERO POINTER

6873 wide6e Beige 900310 34440 RZ HIF END OF COLLECTION,

6574 54460 THEN MAYBE RETURN TO GETSPA

6875 o1u261" Balove enouss 34480 pcx JCURRENTLY JUST PAST THE DESCRIPTOR

HERE WHEN MADE ONE COMPLETE PASS THRU STRING VARS

BASIC NCS 8980 GATES/ALLEN/DAVIDUFF MACRO 47(115) 03512 10*SEPR7S PAGE 26=
FS mac beSEPe64 O5811 STRING FUNCTIONS

e676 videee? eevee e106 345v0 Mov By UB) SHIGH BYTE OF DATA POINTER
6877 1026S" M190 wnoESsS 34520 ocx 4
6878 010264" beio4e aealte 34540 MOV cM F{B/C)SPOINTER AT STRING DATA
6879 Givaod’ waledo ovos4s 34550 PUSH oH #SAVE THIS LOCATION SO THE POINTER
be 34552 CAN BE UPDATED AFTER THE STRING 1S
6851 34554 MOVED
6682 wiba6e6’ Boieee ovaes3s 34560 ocx H
6883 34560 LENGTH=2,<
6864 34600 Dex H>
6885 viv26r? anived avaise 34620 mov Lem #{L] STRING LENGTH
6686 10270" e180 ovavde 34640 vd he 7(M)L} GET CHARACTER COUNT
6887 vive71’ aneoee ovnvoe
6888 Bivele’ erieve aveurt 34660 oad 8 HUM) LI ®POINTER BEYOND STRING
6889 10275" eolooe avar1ed 54680 MOV 018
6890 o18a74* Boleeo ovo131 34700 mov E,c }{D,E) 8ORIGINAL POINTER
6891 10275* @aiven gauss 34720 ocx H }OON*T MOVE ONE BEYOND STRING
6892 g1va7e’ eoioe0 ovo1e4 34740 HOV yn }GET TOP OF STRING IN (B,C)
6893 w10277" aoiove wuoits 34700 MOV Cok
6694 g103G0" wale wouse 34780 LHLO —- FRETOF FGET TOP OF FREE SPACE
6895 10301" Bagove wv157S¢
6695 wivsve’ eneove BieeeT*
6897 #10305" aoi00e 9vas19 34300 CALL BLTuc HMOVE STRING
6898 10304" Bacvoa Beenie?
6899 910305¢ Beto 910301"
6980 B143¥6* Botoue BvOS4I 34820 PoP JGET BACK POINTER TO DESC,
6981 210307" aioe ooelel 34840 hoy PSAVE FIXED ADDR
692 010310" eoluve avovas 34860 INx MOVE POINTER
6985 G18311" eateeo wuo16D suaea MOV HIGH PART
6904 wiesie* avivoe gvn1si 54900 Nov
6945 010315" Geleve voo1ad 34920 Mov #(H)L1=NEW POINTER
6986 410314? Oaiveo BenESS 34940 ocx iFIX UP FRETOP
6907 010515* Melon 34960 IMP PANO TRY TO FIND HIGH AGAIN
6908 910510" woeoee
6909 10317" Bacaee a10se4"
6910
e911 sooo +
gta $5020 7 THE FULLOWING ROUTINE CONCATENATES THU STRINGS
i

«
TORm £4 BUALraTin.

6913, 35040 THE FACLO CONTAINS THE FIRST ONE AT THIS POINT,

6914 35060 (HyL) POINTS BEYOND THE * SIGN AFTER IT

6915 35068

6916 10320" Waivoe wvoses 35100 PUSH 8B }PUT OLD PRECEDENCE BACK ON

6917 010321" Be1e08 980545 35120 PUSH oH SAVE TEXT POINTER

6916 o10s2e" Baioue avnuse s514e LHLD = FACLO GET POINTER TO STRING DESC,

6919 010325" ooeueD

6920 010324" vowooD

6921 010325" oaiene avosas 35160 XTHL HSAVE ON STACK & GET TEXT POINTER BACK
6922 v10526" Bolowe evas15 35160 CALL EVAL VEVALUATE REST OF FORMULA

6923 910327" Yowevs vere

6924 10330" Beouue 10525"

6925 010331" waieue avosas ss200 XTHL FSAVE TEXT POINTER, GET BACK DESC,
6926 410332" Galeve veos1d 352e0 CALL CHKSTR

6927 010335" Geen2e gboes0e

6928 010334" apa wieseT?

ere @ © @ 6 6 Ce 6

BASIC MCS 8980 GATES/ALLEN/DAV1DOFF MACKO 4/(113) O5342 109SEPR7S PAGE 26-9
mac

F3 beSEP|o4 5541 STRING FUNCTIONS

6929 016335" Oulaee BwelTe 35240 MOV AyM

6930 010336" Beleae 4vas45 35260 PUSH H HSAVE DESC, POINTER,

6931 910337" Bo1eGe ovaLSe 35260 LALO FACLO GET POINTER TO 2ND DESC,
6932 010340 BG00H 61637"

©9335 H1H341" OBBLOR 410535"

6934 O10s4er eoiooe ovos4s $5300 PUSH HSAVE IT

6935 016345 BoleoY Beeeve 35320 ADO “ #ADU TWO LENGTHS TOGETHER
6936 810344" BA1G08 aHnnse 35340 MV E,ERRLS +SEt IF RESULT ,LT, 256
6937 O10343" BoB000 evou1T

6938 10340" Boloos ooss2 35360 Je ERROR FERROR "LONG STRING”
6939 010347" BoBEBH Me210e"

©6948 010350" BpeeHe 619540"

6941 619551" BpleHe eba515 35360 STRINI FGET INITIAL STRING

6942 010352" BnaeeD BeTe24*

6943 610353" BYOeBB 410547"

6944 810354" Baise BboSseL 35400 0 HGET 2ND DESC,

6945 810355" BH1eVO BbO515 354e0 FRETMP

6946 610356" BaboHe B1B440"

6947 610357" BevoeH 410352"

6948 10360" Baivve abos4s 35440 FSAVE POINTER TO IT

6949 910361" G210R0 4va315 35460 FRETMe TPREE UP 1ST TEMP

6950 @1636e" BOeHee 710457"

6951 010363" Boveve v10356*

6952 010364 welune ovesa> 35460 " FSAVE DESC, POINTER (FIRST)
6953 810365" BoleoG woabse 35500 DSCTMP+e }GET POINTER TO FIRST
6954 810366" bannoe BuISTe*

6955 A1036/" OOBOHR b1b36e"

6956 010370" balaga 966553 39320 FIN (ore)

6957 O10371" 361060 460515 55540 MOVINS: PMOVE IN THE FIRST STRING
6958 10372" Bovove a10407?

6959 G1H375" GeUGDe H10366"

6960 10374" Co1080 BHO515 35560 MOVINS HAND THE SECOND

6961 410375" Beeeue B1e407°

6962 10370" Baeweo 10572"

6963 10377" wolaee oboEa1 35580 Hy TSTOP FCAT REENTERS FORMULA EVALUATION AT TSTOP
6964 10400" epaae ev5357°

6965 610481" Gade 810575"

6966 v1v4ee’ Buiove ovos4s 35600

6967 10403" aolneo 000345 35620 H TEXT POINTER OFF FIRST
6968 10404" Gala2e gvOsv5 35649 PUTNEW 7THEN RETURN ADORESS OF TSTOP
6969 410495" Gubebe B07TAS"

6970 B104e0" baHEne H10400"

6971

e972

6975 910487" 41000 Hbes41 35700 MOVINS: POP 4 GET RETURN ADOK

6974 wiB4ie’ Boleue Bvos4s 35720 XTHL FPUT BACK, BUT GET DESC,
6975 35740 IFE LENG THe, <

6976 1H411" Baloee ObO1TO 35768 mov AM FCA SSTRING LENGTH

6977 B1M41e* BBieHe BHOb4S 357860 INK Ll

6978 010415? BeloeB guB11e 35800 mov cm 4 (8)C]SPOINTER AT STRING DATA
6979 10414" voiooa eeouas 35620 INK HW

698@ 410415" Bo1e0e Bvo10e 35840 MOV Bem

6981 10410" Bf1600 Hb0157 35860 mov Ly am P(LISSTRING LENGTH

BASIC MLS B98U GATES/ALLEN/DAVIDUFF MACKO 47(113) 05312 10eSEP=75 PAGE 26n10
F3 Mac OrSEP$64 05311 STRING FUNCTIONS.

69be 39860 IFN LENGTH=2,<
6983 35900 PUSHM GET LENGTH ON STACK

6984 $5920 Pushm AND POINTER

6985 35940 PoP FTEXT POINTER HERE

6986 35960 Por FCHARACTER COUNT HERE

6987 10417" Be1ene nuovS4 35980 MOVSTRS INR

6968 wioaevt alone woovss $0000 MOVLP? OCR FSET corns

6989 @10421° Galvae swosio Son20 RZ 10, NO BYTE TO NOVE

6990 G1p4ae? Yoleee guov1e So040 Lax GET CHAR

6991 10425" @oloun auovee se060 STAX HSAVE IT

6992 Gib424" Beioun gooves $6000 INx FMOVE POINTERS

6993 Givged* Gaivoe avowed 3e100 INK

6994 Gieae6? erinve auos0s Se1ed ane FKEEP OOING IT

6995 10427" aevora aio4evr

6996 010430" GovaDG vious?

6997 se140

6998 3e160 FREIMP IS PASSED A POINTER TO A STRING DESCRIPTOR IN (D,E]

6999 56180 THIS VALUE IS RETURNEO IN [HyL], ALL THE OTHER REGISTERS ARE MODIFIED,
7000 Se2uv A CHECK TO 1S MADE TO SEE IF THE STRING DESCRIPTOR (D,E£) POINTS
7001 Seaev TO IS THE LAST TEMPORARY DESCKIPTOR ALLOCATED BY PUTNEW,

Tove 36240 IF SQ, THE TEMPORARY IS FREED UP BY THE UPOATING OF TEMPPT,

7003 Se200 IF A TEMPORARY IS FREED UP, A FURTHER CHECK IS NADE TO SEE IF THE
7004 $6260 STRING DATA THAT THAT STRING TEMPORARY POINTED TO IS THE

7005 36500 THE LOWEST PART OF STRING SPACE IN USE,

7006 36320 IF SQ, FRETNP IS UPDATED TO REFLECT THE FACT THAT THAT SPACE IS NO
7007 30340 LONGER IS USE, THIS CAUSES DIFFICULTY FOR ASSIGNMENT ("LET") BECAUSE
7008 36360 THOUGH A TEMPORARY IS BEING FREED UP, NAMELY THE VALUE TO THE RIGHT
7069 36380 OF THE EQUAL SIGN IN THE "LET", THE ACTUAL DATA

7018 Seque IS STILL ACTIVE DATA SINCE A VARIABLE IS BEING SET UP TO POINT
7031 $6420 AT IT, "LET" FOOLS FRETMP BY SETTING THE LENGTH OF THE

Tole se4aa0 TEMPORARY TO ZERO TEMPORARILY,

7013 $6460

1014 016431 G12 oveS15 $6460 FRESTR? CALL — CHKSTR JMAKE SURE ITS A STRING

TO15 010432" DODO 810535%

To1o 818435" neDoue wieder?

7917 010434" Bo1noo $6500  FREFAC? LHLD — FACLO

718 916435" Bov000

1019 018430" vonooo

Tee 810437" Boines BE $520 FRETM2: XCHG FFREE UP THE TEMP IN THE FACLO

Toe) @10440¢ Golvoo 36540 LHLO = TEMPPT HGET TEMP POINTER

Wwee wivaai? eovove

7023 10442" apoueD B1b435¢

724 010445? Geleve Bvouss 30560 ocx H FLOOK AT WHAT IS IN THE LAST TEMP.
7825 010444" oviows ovo1v6 36580 Mov ByM 1 (B,C) POINTER AT STRING

7026 i844? voles avovsS 30600 ocx HDECREMENT TEMPPT BY STRSIZ

7027 B1b44d0r Ga1BeE Boo116 36620 Mov cyM

7028 10447" dolove BoovSS 36640 ocx

7029 30660 LENGTH=2,<

1030 36680 ocx n>

7031 010450" Gaigve ovesaT 30700 COMPAR }SEE IF (D,€) POINT AT THE LAST
7032 810451" Bo1G00 evesss sored XCHG PRETURN WITH (HyL)

1033 36740 FPOINTING AT CURRENT DESCRIPTOR
7034 1e452* B01080 soosoe $6768 RNZ FRETURN NOW IF NOW FREEING DONE.

Team cp Baran:

eeeeeeeeeeeeé

e
e
e
@
e
e
®@
e

BASIC MCS 880 GATES/ALLEN/DAVIDOFF MACKO 47(113) 43312 10°SEPR7S PAGE 26e11
FS hac beSEPeod @5z11 STRING FUNCTIONS,

7035 010455" wolaee ovavae 36780 SHLO  TEMPPT JUPDATE THE TEMP POINTER SINCE
136 910454" aovage @e1s47?

7037 010455" wove B1e441"

1038 30800 ITS BEEN DECREMENTED BY 4
7039 @10456" @o1v00 oB0s25 30820 PUSH HSAVE (D,E) TO RETURN IN CH,L)
7040 819457" @91000 goo1ed 30840 Mov 0.8 4{D,E1=POINTER AT STRING

7041 @1va60" Beieee ove151 36800 MOV Ec

7042 @10461* oie woovss 30880 pcx 0 }SUBTRACT ONE

7043 10462" welaee gov116 3090 cy F{C) LENGTH OF THE STRING FREED UP
7044 910463" dp10n0 ovovse 30920 FRETOP HSEE IF ITS THE FIRST

7045 w1e4es* Bpvepe Bv157S*

7046 10465 dove BiB45at

7647 36940 FONE IN STRING SPACE

7048 010466" Yoieoe eeosaT 30960 COMPAR

7049 818467" BoleoD woosee 30980 JNz NOTLST #NO SO DON*T ADD

7058 b19470" BaBeAe B1v4aTIE

7051 910471" Bogue 10404"

Ted2 81472" Goivee eveie7 37000 Mov BA IMAKE (8) 20

753 10475? Balaoe evOvIL 37020 Dab 8 #ADD

7054 18474" boluses ovovde 37040 ShHLO —- FRETOP FAND UPDATE FRETOP

7055 610475* Opoaee Bv1575°

1056 010476" Boas B1E470"

7057 010477" Goinve Bvosa1 $7060 © NOTLST: POP GET POINTER AT CURRENT DESCRIPTOR
7058 19500" woilneo Heesit $7080 RET

7059 371007

7060 3712@ THE FUNCTION LEN($) RETURNS THE LENGTH OF THE

7061 $7140 7 STRING PASSED AS AN ARGUMENT

1e62 3716@

7063 b1u5a1* @eleee BeoveL 37160 LEN? UxI 8, SNGFLT FCALL SNGFLT WHEN DONE

7ve4 e105ee" eoaDnD wuTaver

765 010505" ondaee 910475°

766 910504" doiaee Bees05 s7avo PUSH 8B ILIKE SO

7067 910505" @eleve avosis 37220 LENL? «CALL FRESTR HFREE UP TEMP PUINTEO TO BY FACLO
7068 10540" BevAv0 410431"

7069 G105a7* aecvee Bi0see*

707% @10510" @eivee BveeST sra4g XRA ry SFORCE NUMERIC FLAG

7e71 Bivsi1* Boleo0 ooOLeT s7260 Mov DA VSET HIGH OF (D,E) TO ZERO FOR VAL
7072 37260 LENGTH=2,<

7073 37300 STA VALTYP>

7074 1512? Baieoe von176 37320 mov Ay

7075 010515" Boigoe evoceT 37340 OR ry 7SET CONDITION CODES ON LENGTH
7076 18514" OGia00 evOsi1 37360 RET PRETURN

1017 373804

7078 37400 7 THE FOLLOWING IS THE ASC($) FUNCTION, IT KETURNS AN INTEGER
7679 37420 WHICH IS THE DECIMAL ASCII EQUIVALENT

7080 37440

7081 010515? alone avos15 37460 CALL LENL SET UP ORIGINAL STR

7082 019516" ogoBoG 19505"

7063 010517" BnGeDB B1B5z0°

7084 10520" M1000 evosie 37480 ra FCERR FNULL STR, BAD ARG,

7085 widseit Baeene v1077e

7066 810522" OOOO 10516"

7087 18523" Bolave oeou4s 37500 INx HBUMP POINTER

BASIC MCS G86 GATES/ALLEN/DAVIDUFF MACRO 47(115) 05312 10eSEP=75 PAGE 26912
FS mac OmSEP=64 5315 STRING FUNCTIONS.

7088 37520 IFN LENGTHea,<
7089 37540 INx He #BUMP POINTER

7098 10524" Bolas wvensoT 37560 PUSHM GET ADDRESS

7091 910525° Galop avos4s 37580, Por H GET ADOR IN (H,4)

7092 10520" Ootovd ovaiTe 376u0 mov AM GET FIRST CHAR

71093 a1vs27* daieae ovosos 37620 aMP SNGFLT FSNGFLT IT

71054 10530" evoouD weT4eut

7095 010531" @eaves g1a5ai*

7096 s7oaa 5

7097 37660 CHRS(#) CREATES A STRING WHIGH CONTAINS AS ITS ONLY

7098 37680 CHARACTER THE ASCII EQUIVALENT OF THE INTEGER ARG (#)

1099 37708 WHICH MUST BE ,LT, 255,

T10@ 37720

7101 10532" Ov1000 evou7e 37740 CHRSt MVE Ant FONE CHARACTER STR

712 019535" aoa~an ovevel

7103 10534? gaives wvosid 37760 STRINI }GET STRING IN OSCTHP

Tied 10535" eoeeea ovTbed?

7105 010536" @pva0a 10530"

T1e6 19537? aoleon 9bO51 37760 CONINT FGET INTEGER IN RANGE

7167 10540" goaean e11be3"

T1€8 1541 BoovaD @10535°

7169 G1es4e? aotven oveuse 37800 OscTMP+2 1GET ADDR OF STK

7110 010545* woevee B1d7e?

7111 010544" Boese si0540¢

T112 @16545? doleus wuEoLeS 37820 mov HE SAVE ASCII BYTE

7113. 010540" oleae ovoseI 37840 FINBCK: POP 8 FRETURN TO HIGHER LEVEL &
7114 37869 7SKIP THE CHKNUM CALL,

7115 810547" Bo1e09 ovoses 37880 IMP PUTNEW 7G0 CALL PUTNEW

7116 G1U55U" BovEeD OvTTES*

7117 010551" Gowen e10545°

7116 37900

7119 37920 THE FOLLOWING 18 THE LEFTS(S,#) FUNCTION,

7120 37940 IT TAKES THE LEFTMOST # CHARS OF THE STR,

The 37960 IF # 18 ,GT, THAN THE LEN OF THE STR, IT RETURNS THE WHOLE STR,
Thee 37960

7123 w195Se° eotove weosis 3e0@0 LEFTS? CALL PREAM TEST THE PARAMETERS

7124 01553* Baoave 10764"

7125 810554" op0a0e 10950"

M126 010555" volves aeeesT see20 XRA JLEFT NEVER CHANGES STRING POINTER
7127 018550" Boloee ovesas 30049 LE XTHL SAVE TEXT POINTER

7128 010557? @olave weaiiT 36000 Mov OFFSET NOW IN (C}

7129 010500" orio0e aves45 38080 PUSH TSAVE DESC, FOR FRETMP

7130 810561" doived 0176 38100 ov GET STRING LENGTH

7131 G10502* Galva avoe7e 30120 CHP ENTIRE STRING WANTED?

7132 010505* @01900 wousse Se140 Jc TIF #CHARS ASKED FOR.GE,LENGTH, YES
7133 010564 Oneeed 10570°

7134 910565? waves o10553°

7135 810560" valevo eeoi7e sb160 nov }GET TRUNCATED LENGTH OF STRING
7136 01056/" Oolowe Boovel 38180 XW *01004,7021 SKIP OVER MVI USING "LXI D,"
7137 @10576" Oeloon eeav1e Se2ee  ALLSTRE MVI Ce TMAKE OFFSET ZERO

7138 018571" eobeee voevoe

7139 910572" wo1uee ovosa5 se220 PUSH B JSAVE OFFSET ON STACK

T14@ 010575" Baieve ovas1s se240 CALL © GETSPA GET SPACE FOR NEW STRING

e
Teemcr Barua

BASIC KCS 8780 GATES/ALLEN/DAVIDUFF MACKO 47(115) 05512 1@@SEP75 PAGE 26015
FS mac OrSEPRod OSELL STRING FUNCTIONS.

°
e
®
e
°
®
e
e
®
e
e

7141 010574" Beowaw av777e"

7142 910575¢ Groeae gi056e4"

7143 10576" Boleoo 80501 PoP
7144 010577" Goieoe ensai PoP
7145 010600" Baigoe ovas4s Push
7146 014601" aelvee soavas INx
147 LENGTHR2, <
7148 INx He

7149 @1gea2* ao1eee avaree nov By GET POINTER LOW

7158 10605" voleno evovas INx x '

7151 @10604" daivwe weo14e Mov Hy POINTER HIGH

7152 10605 eeleao veo1se Mov LB HGET LOW INL

7153 Givene’ ariove Beaves NVI 8,0 GET READY TO ADD OFFSET TO POINTER
7154 10607" Boeeoe evoven

7155 @18610" Baivee veoeit Dad 8 wAOD IT

T156 ©1611" weieee weo1es MoV By GET OFFSET POINTER IN (B,C)

7157 @1e61e? @aieod vari nov Cot

7158 010615¢ woinee gvas1S CALL STRAD2 SAVE INFO IN DSCTMP

1159 @10614" davued OoTeETE

7166 010615 Bveooo 10574"

7161 G10616" wo1ve@ wweisT nov Lia GET# OF CHARS TO MOVE INL

7162 10617" Opiove ave515 CALL = MUVSTR MOVE THEM IN

7163 Giveze’ woveve wid4iTe

7164 @10621? downed 210614"

7165 eideee? oived veser PoP 0 GET BACK DESC, POINTER

7166 10625" Bolen @vos1s CALL | FRETMP FPREE IT UP,

7167 10624 voovad v1044'

7168 a18625* Boeva0 wige2v"

7169 Gives? Balvne vOS0S MP PUTNEW PUT TEMP IN TEMP LIST

M170 @18e27? OnBvee BvT7Ta5"

TA71 010630" Goeave Bideed"

T1712

7173 010631 Boleno eeusis $6000 © RIGHTS: CALL FCHECK ARG

7174 @ives2? Goveve 10764"

175 010635" Goeove 10627"

176 010634" Botove Boeser 38700 PoP #GET DESC, POINTER

177 @106035° @olev2 eased $8720 PUSH SSAVE BACK FOR LEFT

1178 G1063e" @atove evouse 36740 DAK GET PRESENT LEN OF STR

7179 618637" @oivve eedeew 30760 suB FSUBTRACT 2ND PARN

7180 18640" veieve Loses 38760 MP HCONTINUE WITH LEFT CODE

7181 10641" Bod—ee 10556"

7182 10642" GoweeD B1v6Se"

7183 36800

7164 36820 N10 (S,#) RETURNS STR WITH CHARS FROM # POSITION

7185 38840 ONWARD, IF # 18 GT LEN(S) THEN RETURN NULL STRING,

7186 58860 MED (Sy#,#) RETURNS STR WITH CHARS FROM # POSITION

7167 36880 FOR #2 CHARS, IF #2 GOES PAST END OF STRING, RETURN

7168 38900 AS NUCH AS POSSIBLE,

7189 38920

7198 10645" Bo1ove BHaSSS 36940 MIDS? = -XCHG PUT THE TEXT POINTER IN (H,L)
7191 10644" gaivoe Bvo1Te 36960 MOV at GET THE FIRST CHARACTER

7192 10645? doleve ev0515 36960 CALL © PREAMe HGET OFFSET OFF STACK AND MAKE
1193 010646" Yeeowe e10767"

TGET BACK OFFSET
}GET BACK DESC POINTER,
BUT KEEP ON STACK

8
4
H
H HMOVE TO STRING POINTER FIELD

BASIC MCS B98Y GATES/ALLEN/DAVLOUFF MACRO 4/(113) 93212 10eSEP=75 PAGE 26=14
FS Nac peSEPRO4 OSELL STRING FUNCTIONS

7194 010647" @e@ov0 aioedi®

7195 39000 SURE DOES NOT © Gy

7196 810650" Bo1uee aves05 39020 PUT OFFSET ON TO THE STACK
7197 19651% volo eave 39040 VIF THO ARG GUY, TRUNCATE,
7198 @1veSe* anvave oeasT7T

7199 019653" Belaee ovvs7e $9060

7eee 010654" Gvav00 Beoest

7201 @10655% ga1po8 auosie 39080 7 UE) SAYS USE ALL CHARS
Tate 010650" @aanve 10665"

7203 010657" Bowe ALBede?

Tee4 39100 VIF ONE ARGUMENT THIS IS CORRECT
7205 10668" da1ena evnsi7 59120 SYNCHK 44 FCOMMA? MUST DELINEATE SRD ARG,
Tev6 B1v661" avowed ovaLs4

7207 10662" Boies ov93s15 39140 CALL GETBYT GET ARGUMENT IN (EJ
7208 10663" dave e1ivevt

7209 Giveed? eooene 1656"

7210 010665" duieoo 909517 39160 MIDez — SYNCHK")" IMUST BE FOLLOWED BY )
7211 @1G660" aoovoy evans1

T2l2 10667 Qu1ov0 0561 59180 PoP Pow GET OFFSET BACK IN A
7213 wlv67et voioa0 evns4s 39200 XTHL SAVE TEXT POINTER, GET DESC,
7214 10671" Gvleoo eoave1 39220 uxt ByLEFT2 TWHERE TO RETURN TO,

7215 10672" oBvO B1d56ev"

7216 WiveTS? waveeR 010665"

7217 10674¢ ga1eve #b0305 39249 PUSH GOES ON STACK

7218 Givers? Bateed eLOeTS 39260 ocr SUB ONE FROM OFFSET

7219 @10676" Yo1pon avGe7e 39280 ne HPOINTER PAST END OF STR?
7a2e 916677? Barove , BvaveE 39300 avd FASSUME NULL LENGTH STR
7221 @107ae* eaone® avover

Taz2 10701" Gaived evasee 39320 RNC FYES, JUST USE NULL STR
7223 o1e702" valevd eo117 39340 Mov SAVE OFFSET OF CHARACTER POINTER
7124 010703" doivas weoi7e 39300 Mov GET PRESENT LEN OF STR
7225 10704" olove wevear 39380 sub FSUBTRACT INDEX (2ND ARG)
7226 1070S? Goigue weoeTS 39400 CHP VIS IT TRUNCATION

7227 G10706" e100 gvore7 39420 Mov GET CALCED LENGTH IN B
7226 10707" Bolvee Bensse 39440 RC FIF NOT USE PARTIAL STR
7229 010710" eo1ee8 seores 39460 Mov 7USE TRUNCATED LENGTH

7236 10711" Go1000 eO511 39480 RET> FRETURN TO LEFT2

7234 39500 IFN LENGTH,<

Tese 39528 3

7233 39540 THE FOLLOWING FUNCTIONS ALLOW THE

esa 39560, USER FULL ACCESS TO THE ALTAIR 1/0 PORTS

7235 39580 INP(CHANNEL#) RETURNS AN INTEGER WHICH 18 THE STATUS
7236 39600 OF THE CHANNEL, OUT CHANNEL, VALUE PUTS OUT THE INTEGER
7237 39620 VALUE ON CHANNEL #, IT 18 A STATENENT, NOT A FUNCTION,
7238 39640

7239 10712" Bo1e00 sousi5 3966@  FNINPS CALL CONINT FGET INTEGER CHANNEL #
Te4e o1aris? eowode 1102s"

7241 e16714" gous o1067e"

Tede 10715? Ooloew evavee 39680 STA INPWROFL GEN INP INSTR

7243 @10716" dooean o10721"

Tea 10717" Gooaae B1eT15¢

7245 @1u72v! doiuee evos3s 39702 INPWROE IN }THE INP INSTR

Teds 10721" DoeevA avevoo

Teme Evavar

BASIC NCS U6 GATES/ALLEN/DAVIOOFF MACKO 47(115) 05112 10eSEP75 PAGE 26915
FS mac GaSEP=64 O5511 STRING FUNCTIONS

eeee2e#eeee?ee

7247 o1eT2e? Boleve wuoses 9720 ome SNGFLT FSNGFLT RESULT
7248 w1e7as? Beeere vuTage*

7249 wiared? vavoen 10716"

71258

610725" Boleo0 @v0s15 FNOUTs CALL — SETIO GET READY
e10720" boveoD 11005"

@1e727* Booed lores?

10730" Bnivoe Bvases OUTWRO? OUT 00 iT
610731" BoaG00 Beeeow

10732" O1v00 o~uS11 RET HAND THATS ALL

THE WAIT CHANNEL #,MASK,MASK2 WAITS UNTIL THE STATUS
RETURNED BY CHANNEL# IS NON ZERO WHEN XORED WITH MASK2

AND THEN ANDED WITH MASK, IF MASK2 IS NOT PRESENT IT IS ASSUMED
TO BE ZERO,

019733* ealove 80515 FNWAIT?: CALL © SETIO }SET UP FOR WAIT
010734" GovoGe 11003"
010755? Gudves B1e726*
810730" Baigos evased PUSH PSH HSAVE THE Mask
019737" Bui wooLse MVE E,o JDEFAULT MASK2 TO ZERO
010746" Govov9 veraL
810741" Bolgoo Bvevss ex H
@1e74e" Bolonn vase? CHRGET }SEE IF THE STATEMENT ENDED
010743" Bolo wvEsie vz NOTTHR HIF NO THIRD ARGUMENT SKIP THIS
919744" poveoa o10755°
@10745* Bovvea B10734*
@10740" evievw Bv—S17 40000 SYNCHK 44 IMAKE SURE THERE IS A ","
w1e747" boveDo eveEs4
01075" Ovivea vasis av0ee CALL GETBYT
@10751% boveoD wBiiveLt
o10752" Bevave B1e74at
210753" Goines avosar 40100 NOTTHR? POP c FREGET THE "AND" MASK
010754 01900 900535 4e120  STAINP IN r) VTHE INPUT INSTR
@10755* Gve00e wvovve
010750" Bolpue ouvess 4e14o XRA ia FXOR WITH MASK2
@10757? Baioss Bevedd 40160 ANA 8 FAND WITH MASK
@18760" Beigoo Boosie 40180 ye STAINE FLOUP UNTIL RESULT 18 NON@ZERO
w10761 BeaGvd 10754"
@1076e" HedOGD 910751"
4va00 FNOTE? THIS LOOP CANNOT BE CONTROL=CtED
aveeo FUNLESS THE WAIT I$ BEING DONE ON CHANNEL
4vago FZERO, HOWEVER A RESTART AT @ IS OK,
#18765" aoioso ouasid 49260 RET>
4v280 IFN STRING, <
40300 FUSED BY RIGHTS ANO LEFTS FOR PARAMETER CHECKING AND SETUP
810764" Bolovo eva353 4o3eo  PREAM? = XCHG FPUT THE TEXT POINTER IN CH)LI
@10765" ooieve @vosi7 40340 SYNCHK ")" FPARAM LIST SHOULD END
810760" Gune40 BeBLSI
4@300 FUSED BY MIDS FOR PARAMETER CHECKING AND SETUP
@1076T? ois wvaser 40380 © PREAM2t POP 6 FGET RETURN ADDR OFF STACK
w19770" Beleve woes21 4e4aoo PoP 0 GET LENGTH OF ARG OFF STACK
w10771" Co1Gey Bvo305 4oaeo PUSH B SAVE RETURN ADUR BACK ON

BASIC MCS BOBO GATES/ALLEN/DAVIOUFF  MACKO 47(113) 03412 10=SEPR75 PAGE 26016
F3 aC 6rSEPROd 03511 STRING FUNCTIONS

Tse0 wiB7Te? voloHe eoo10s 4oa4o nov BE FSAVE INET LENGTH
7301 10773" Ba1e00 nova 4460 INR 8

T3b2 810774" aaigve gvoeas agaee OCR 8 SEE IF EQUAL TO ZERO

1303 4osee FE LENGTH=2,<

7304 10775 Bolvoo evosoe 4e520

7305 G10770" 4536 ILLFUNS

7306 910776 Uoleeo woBw3e 40540 CERRY

13¢7 10777" oooead aLvoveS

13€8 011006 Baiona evases 40560

7509 11001" Boove verde?

1510 @1100e" Boweva a1a761"

134. 49560 LENGTH=2,<

Tsi2 4600 Jz FCERR HIT MUST NOT BE @

7313 4eeeo RET>

7314 4e640 LENGTH, <

7315 11003" datean avos1d 4eo6n CALL GET6YT HGET INTEGER CHANNEL NUMBER IN (A)
7316 G11004° Bove a1iueot

1517 911905* @pevoe o11081°

7518 11006" doleon ovOv6e 40680 STA STAINP#1 FSETUP "WAIT!

1519 @11007° BoeeoD 910755°

7320 @11o18¢ BoaDne 1104"

7321 @11011" oa1ave avav6e 4o7oa STA OUTHROFL SETUP "OUT™

TS2e @11o1e" Boowno 210731"

7323 11915" BeeceD o1tecT?

7324 @11014% Beiood BouSIT 4u7e0 SYNCHK 44 TMAKE SURE THERE IS A COMMA

7525 11915" ooeevs Bvous4

7526 11016" aivoa ebovEee 40740 xwo *U1000,6> MMVI 8," AROUND THE CHRGET

1327 40760 IFN STRINGILENGTH, <

7528 B11e17" enie0e BvoseT 40780 GTBYTC? CHRGET

7329 40800 FE LENGTH=2,<

7330 011020" Ooleve BbOS15 40820 GETBYT: CALL = FRMEVL

7531 1ioa1? anaven ev5536*

7332 @ligee? Bowoed e11v12e*

7333 011025" op1000 evosas 40840 CONINT: PUSH

7334 @iloes? vaieee veasis 40869 CALL FRCINT

7335 11g25* Boavae Bved4ai®

7356 eiiveot wovoue aii1vel*

1537 wilaeT? Boieas weasss 40860

71338 011030" Oaluoe voosaL 49900 0 H>

7339 4u920 TFN LENGTH#2,<

7340 4094@  GETBYTs CALL = FRMNUM FREAD FORMULA INTO THE FAC,

7341 4096@ CONINT: CALL — POSINT> FCONVERT THE FAC TO A SINGLE BYTE INTEGER
7342 811031" Valowe BenITe 40980 MOV AyD HSHOULO BE ,LT, 255

7543 11032" Golone eveesT 41900 ORA A FSET cots

7544 @11035" @olgoe ovesoe 41020 INZ FCERR FWASN®T ERROR

7345 11034" Boeoe 10/76°

7346 011635" veeows oiivese

1347 011036" Bolewn ovELsS 41040 ocx FACTUALLY FUNCTIONS CAN GET HERE
7348 41060 WITH BAD CH,LJ BUT NOT SERIOUS
7349 41980 SET CONDITION CODES ON TERMINATOR
TS5@ 011037* voloee 9ease7 43100 CHRGET

7551 11040" Baiede vai7s aire nov FRETURN THE RESULT IN CA} AND CE]
7352 11041" Caloee ovosit 41140 ReT>

Toamth Busan

BASIC MCS 8960 GaTES/ALLEN/DAVIDOFF MACKO 47 (115) 03312 10eSEPe7S PAGE 26-17
F3 Mac OrSEPmed Silt STRING FUNCTIONS

1358

1554 41160 1

7355 aieee

7356 41202 ¢ THE VAL FUNCTION TAKES A STRING AND TURN IT INTO

71357 41204 7 A NUMBER BY INTERPRETING THE ASCII DIGITS, ETC,,

7358 41206 ‘EXCEPT FOR THE PROBLEM THAT A TERMINATOR MUST BE SUPPLIED
v

FN STRING, <

1359 41208 BY REPLACING THE CHARACTER BEYOND THE STRING, VAL
7360 41210 IS MERELY A CALL 10 FLOATING INPUT (FIN),

7561 4ieie
1562 11042" Galego ovOS15 4220
7363 @11045" an0000 @105a5*

71364 11044" aovove 911034"

TSe5 @11949" Go1uoo BuosI2 aie4o vz ZERO PRETURN ZERO IF NULL

71366 911946¢ Gooeve Bvaveex

7507 011047" gaeus 11045"

1568 911050¢ Boiovo vais? 41260 mov EA GET LENGTH OF STR

7369 41270 LENGTH=2,<

1570 41280 Nx > FTHIS IS ALL A KLUOGE

7571 011651" @oleve woooas 41300 Nx H FO HANDLE THE FACT THE IF

7372 911052" voiove aveser 41320 PUSHM HTWO STRINGS "1" AND "aM

7373 G11053* Goleoe pvo140 41340 mov HB JARE STORED NEXT TO EACH OTHER

7574 011054" Baieoe Bee151 41360 mov Lic JAND FIN IS CALLED POINTING To

7375 811055* Buiowe vovsi 41360 Dab 0 VTHE FIRST TWELVE WILL BE RETURNED

7376 11856" Baloo BoELee 41400 nov 8M HTHE IEA IS TO STORE @ IN THE

7377 11957 Bo1000 B00162e 4i4ee MOV MD HSTRING BEYOND THE ONE VAL

7378 11960" @p1000 ovos4s 4144o XTHL VIS BEING CALLED ON

T3719 G1lv61* wolaoo wvesed 41400 PUSH 8B JTHE FIRST CHARACTER OF THE NEXT STRING
7580 11962" Oa1994 00176 41480 mov ayy GET FIRST CHARACTER OF ARGUMENT

7361 G11063" wolves gve515 41500 CALL FIN HTURN IT INTO A NUMBER IN THE FAC

7362 011964" BpM900 BbbI0S"

7565 11965" vovv0 11046"

71584 611960" bviveD vOsed 4isee Por HGET THE MODIFIED CHARACTER OF THE NEXT
7385 41540 STRING INTO [B)

1586 811967" Ooiuee avasar 41500 GET THE POINTER TO THE MODIFIED CHARACTER
7387 011070" Boleoe Bvo1eD 41580 TRESTORE THE CHARACTER

7588 4ieco VIF STRING IS HIGHEST IN STRING SPACE

1369 41620 THE ARE MODIFYING [MEMS1Z] AND

7390 41640 HTHIS IS WHY [MEMSIZ) CANT BE USED TO STORE
7391 41668 STRING DATA BECAUSE WHAT IF THE

7392 41660 #USER TOOK VAL OFF THAT HIGH STRING

7393 @11a71" Boipoo Bons11 41700

1394

7395 41740

ALE CALL LENE 400 SETUP, SET RESULTSREAL

BASIC MCS 8780 GATES/ALLEN/DAVIDOFF MACKO 47(113) 95212 10*SEPe75 PAGE a7
Fs Mac GeSEPeod OSES FANCY LIST, DELETE,ED1IT,LLIST

7396 41760 SUBTTL FANCY LIST, DELETE, EDIT, LLIST

1397 41780 IFE

7596 41800 IFN

7399 4ig2e@  LLIsTs Ant GET NON ZERO VALUE

74v0 41840 PRTFLG> SAVE IN 1/0 FLAG

74¥1 911072" waieve ovesar 41860 LISTE 8 JGET RIO OF NEWSTT RETURN ADOR
T4ve 911075" Boiove Bo315 41860 SCNLIN FSCAN LINE RANGE

7403 11074" OaevOD ves3S¢

Tava 611075" BeevDa w11b64"

14e5 011076" v1veo eased 419008 FSAVE POINTER TO 1ST LINE
7406 911077? Bo1990 Bvasai 41920 POP GET POINTER 10 LINE

7407 911100" epiesa gvoser 41940 POR GET NAX LINE # OFF STACK
7408 011101" Be1e08 evES67 41900 PUSH PUSH LINK

7T4e9 @11192" Boio0a avo1Te 41980 Mov SEE 1F END OF CHAIN

7416 011103" eoteae evaees 4eov0 ORA

T411 B11104" @o1o0e avesat 4202 PoP 4GE1 LINK OFF STACK FOR ISCNTC
712 O11195* Bolose vvost2 42040 uz FLAST LINE, STOP,

7413 011100" Bayan gwel4se

7414 il107* daooee BiteTA?

7415 42060 LISTEN, <

7416 11110" eo1e0@ 00515 42080 CALL ISCNTC> JCHECK FOR CONTROL=C

7417 11111 Beoaad avs4EK"

7418 @1ti1ef WeRBOO H11106°

7419 11115" Oa1098 aveses 42100 PUSH FSAVE LINK BACK ON

THz 11114" Bolode BeeSeT 4eteo PUSHM PUSH LINE #

74281 @11115¢ 91000 ob0363 4er4e XTHL SGET LINE # INTO (HyL)

Taze @11110" BoleeD 0955S 4areo XCHG HGET MAX LINE IN [HyL}

7423 W11147" Bolaee ovos4a7 4e1ee COMPAR PAST LAST LINE IN RANGE?
7424 vili2v? e10ee vesel 4eave POP 8 i TEXT POINTER TO (B,C1

7425 11121" Ooived ewosse 42260 Jc STPROY HIF PAST, THEN DONE LISTING,
Tues wilize? eeeona oveiaar

TaeT writes? eoogoe oiiiiit

7428 w111ed? Malena wevsus 4eeeo XTHL SAVE MAX ON BOTTOM OF STACK
1429 iitast dainge avesas 42300 PUSH SAVE LINK ON TOP

71430 11126" Oaleed owvased 4ese0 PUSH SAVE TEXT POINTER BACK

7431 @11127" @o1ea0 @vO555 42540 XCHG GET LINE # IN (H,L)

7432 011138? aloud 00515 42560 CALL #0 CRLF TO START OUT

7435 011131 oeena evades?

7434 411132" BooeNa wi1iee?

7435 NU WE WANT (H)L] ON THE STACK
7436 0111335" Bo1900 ov0315 LENPRT PRINT AS INT WITHOUT LEADING SPACE
7437 G11134" ao0ee0 OvSS618

7438 011155? @aveMa 111351"

7439 @11130" BoloBY aeeL7e fd Lydd

744@ 011137" Baveve veevau

7441 @11108¢ aotouG voesad Por 4

Tage 011141" @otaea BKos37 OUTCHR PRINT A SPACE AFTER THE LINE #
7443 B1114e" doiee0 Besi5s CALL BUFLIN FUNPACK THE LINE INTO BUF
Ta4a 011143" @o0vue 011163"

7445 B11144" eoovee 11154

746 @11145% Belove aves xi Hy, BUF} FPOINT AT THE START OF THE UNPACKED CHARACTERS
7447 @1114e" @ag~ve OH1430"

7448 11147" Goeved v11145¢

Femcs Bisean,

BASIC MES 8980 GATES/ALLEN/DAVIDUFF MACKO 47(115) 5312 10=SEPe75 PAGE 27~1
Fs MAC 6rSEPeod 5211 FANCY LAST, DELETE, E01IT,LLIST

7449 011150 Bo1900 oeowes 42520 MI 8,0 FSTOP ON ZERO ONLY

7456 011151" Bneee voowen

7451 011152 @niged Beas15 4a5ae CALL © STRLTS TLITERALIZE THE LINE STRING
7452 11155? BadeG0 aD7e4eF

7453 011154 Opooee 11146"

7454 811159" Bo1gee 000515 4esee CALL STRPRT PRINT QUT THE CHARACTERS

7455 011156" Ope0v0 auT146*

7456 G11157* wedvod 011153"

1457 011160" enlee@ Loses 4a5e0 ane Lista TPRINT ANOTHER LINE

7458 811161 Badne0 w1LUTTE

7459 O1116e opeov0 11156"

7460 O11165* eo1vue geoLer 42e0e  BUFLING LxI By BUF*1

T4e1 11164" Beene ov1430°

T4ee 11165¢ Bo@vaa e11161°

7463 G11166" Bolded oeovee xnd *01000,7026 VMI 0," AROUND THE NEXT BYTE
7464 911167" ap1e00 BeosaL Pop H RESTORE POINTER TO START OF TEXT
7465 911170? Be1080 ave1Te mov aah 1GET & CHARACTER FROM LINE,

7406 wi1171" Opigve eeneos INK JADVANCE STUFF COUNT

T4eT wili7e? eioee eva267 ORA F18 IT A RESERVED WORD

THe8 G11175" Boloae voovas INx INCREMENT POINTER INTO TEXT
7469 GI1I74* Bolvee oveCve STAK STORE A ZERO IF THE END

7470 @11175* Bo1000 ovoste RZ FZERO, END OF LINE,

TAT O111764 Batooe Beos62 JP TREGULAR CHAR, JUST PRINT IT
7472 O11177 opoeve 11170"

7473 lied’ Gowove wiiied?

7474 11201" valowe avesTe 4eavo CPL ELSETK FIF ITS "ELSE" DON'T PRINT THE COLON
7475 @ilae? eoenee wvoeer

7476 42820 FIN FRONT OF IT

7477 011203" @B1000 aeusie 42040 cz OCXBRT## TBACKUP STUFF COUNT TO ELIMINATE
7478 w11e04* BeesH eave

71479 G11eas* waveaa 11177"

7480 liege? varove euvsee 42860 sul 127 #GET RID OF SIGN BIT AND ADD ONE
7481 011207" BaveDa ove177

7482 O11210f Balvve Guasas 42860 PusH oH FSAVE CURRRENT POSIT

7483 Wliziit oeloae woovel 42900 uxt 0, RESLST JGET RESLST POINTER,

7484 Olialet Adeeve Hear7et

7485 11215¢ Boaven vlievd?

7466 Wllel4? Bo1dve ovBsed 42920 RESRCH: PUSH D

7487 Blais? eoleve BLvose5 42940 PUSH —PSW FSAVE THE RESERVED WORD NUNBER
7486 G11aler Aalaoe geese 42960 RESCRIt LOAX 0 JGET CHARACTER FROM RESLST

7469 @1la17f eotove eeoves 42980 INK o FBUMP RESLST POINTER

7490 @lleaw? av1eee aveeer 4sav0 ORA A STEST BITS

7491 Gileel* Oolooe dvasee 43020 JP RESCRI FNOT AT END OF RESERVED WORD YET
7492 Gileeet eavna o11eler

7493 wileast ogwove Giieter

7494 B1laed4? eo1ove eHso1 43040 Pop pow
7495 @11aa5? wales ove075 43060 ber A }DECREMENT CHAR
7496 ilee6’ Yolove avos4d 45080 PoP 4 POP START POINTER WERE

1497 Olleel? dolove wousee 45100 INZ RESRCH 7NOT AT ENO OF RESLST YET,

7498 Oilaset voeous witeLae

7499 @11e81 eoeovd w1ieee"

756¢ 45120 {HERE WHEN FOUND RIGHT RESERVED WORD

7901 @112s2* dploed oveITS 45140 PRITS: MOV Ay GET A CHARACTER FROM RESERVED WORD

8
A
H
8

BASIC MCS 8980 GATES/ALLEN/DAYJDUFF MACRO 47 (115) 05212 1*SEP=75 PAGE 272
FS Mac OrSEP=64 “5314 FANCY LiST, DELETE, EDIT ,LLIST

7562 11235" Belvoe avoeoT7 45160 oRA a FSET CONDITION CODES

7503 11234 duigon vereee 43180 STAX 8

7504 011235* Galaga e@vesTe 43200 JM PRITS

7505 O11236* Gopewe 11167"

7156 11237? auoues e112e30°

7307 €11240" waiaon avovas 4see0 Ink

7508 G11241° Bo1090 guovGs 4saqo INX #BUMP RESLST POINTER

7309 Ollade? eoloae avesos 43200 JMe JPRINT THE REST

7510 011245 BavaeM allese*

7511 11244" Boveoe A11es6°

7o1e as260

7513 43300 THE FOLLOWING CODE IS FOR THE DELETE KANGE

7514 43320 COMMAND, BEFORE THE LINES ARE DELETED, *OK*

1515 45300 IS TYPED,

7516 43300

7517 @1124>* @a1090 guosid 43380 DELETE: CALL —-SCNLIN PSCAN LINE RANGE

T5168 8112460 vena ov2533°

7519 011247" Bowous o11e4s?

Ts20 11250" ulus oevse1 45400 PoP t) sPOP NAX LINE OFF STACK

1521 011251" Bpiove evased asueo Push BB FSAVE POINTER TO START OF 1ST LINE
Ts2e 11252" Yolous ovvs15 Perry) CALL = FNOLIN HFIND THE LAST LINE

7523 11255" BovonD BuesTI?

7524 911254° avo aiteaer

7525 O11259* eolven Bvose1 43400 PoP 8 7GET POINTER TO FIRST IN (B,C)
To26 011250" waleee 4ues4s 43460 PUSH oH HSAVE THE POINTER TO THE NEXT LINE
7527 011257" oie geaedd 43500 UxI Hy REDDY FPRINT "OK" PREMATURELY

7528 11260" PovaM—e Be1T25°

7529 O11261¢ goonve 11255"

753 @lla6e* @oleee 000515 4s5e0 CALL = STROUT

7531 011263¢ oyonoe av7743°

7532 @11264° ooo00G wiieoLt

7933 @11205¢ Goin gvavad 43540 Lxt Hy PINE 7G0 BACK TO FINI WHEN DONE
7534 @11260% aooou0 aveeTe?

7535 911267" oowoee 1126s"

7536 lla7u? volove ovesas 43500 XTHL FCH,LI "POINTER TO THE NEXT LINE
T9317 @11271 P1009 Gvos53 43580 XCHG }(0,E) NOW HAVE THE POINTER TO THE LINE
7538 43000 FBEYOND THIS ONE

7539 o1laTe’ @pioee veouse 43620 LHLD FCOMPACTIFYING TO VARTAB

754@ 011273" Onv0GH Be1621°

7541 vileT4* eompay arteber

7542 11275" Bvieus gveuse 43042 MLOOP: LDA

7543 @ite76* @o1000 gvoede 43660 STAK FSHOVING DOKN TO ELIMINATE A LINE
7544 BileT7? Golvoo aveues 43680 Nx

7545 911300" Bolen eaves 43700 Nx

7546 011301" @o1000 GousaT 4steo COMPAR

7547 11302" Boluoo avosee 43740 INC HDONE COMPACTIFYING?

7548 11305 D0 o11e75°

7549 11304" BeovdD o11e73°

7550 011505" Bolo verde 4576 Mov HB

7551 11300" do1000 900151 43780 Moy Lc

7552 @11307* @n10ee avov4s 43800 Nx 4 TNEW VARTAB

7553 011510" G91000 evov4e 43820 SHLD VARTAB

7554 11311" @o00de o16e21*

Teemtp Barrer,

BASIC MCS 8B) GATES/ALLEN/DAVIDOFF MACKO 47 (113) 03312 10-SEP=75 PAGE 27-3
FS MAC OrSEPw64d O5311 FANCY LIST, OELETE,E0IT,LLIST

7555 11312" appove 411505"
7556 011315" @aioue gvosit a3e4e RET>
7557 43800 © PAGE

BASIC MLS 898K GATES/ALLEN/DAVIDOFF MACRO 47(113) 45312 10eSEP=75 PAGE 28
FS Mac 6rSEPRod OStIL OISK COVE

43880  SUBTTL DISK Cove
45900 IFN OSKFUN,<
43920 5
43940;
43900
43980 ¢
44900 7 OSKIS (SECTOR) IS A STRING FUNCTION THAT
44020 - RETURNS THE 133 BYTE STRING STORED ON SECTOR,

i)

0

THE STATEMENT DSKOS STRING, SECTOR WRITES
THE STRING (UP TO 132 DECIMAL CHARS
ON THE SECTOK SPECIFIED,

44aao
44000 DSKOS: CALL — FRMEVL VEVALUATE FORMULA

aaeee SYNCHK 44 7FOLLOWED BY COMMA

44i0e PUSH oH WSAVE TEXT POINTER

4aieo CALL FRESTR VFREE UP THE FACLO

4aiae XTHL 7{H,LISTXTPTR SAVE POINTER AT
44160 FSTRING DESCRIPTOR ON THE STACK
agree CALL GETBYT FEVALUATE 2ND ARG(SECTOR) IN CE)
44200 XTHL SAVE TEXT POINTER, GET DESC,
4aeeo Push F(C)=LENGTH [H,L) #POINTER
auede PUSHM

44200 POR (H,L) GET STRING POINTER
4aeeo PoP

44300 mov , FSECTOR NUMBER INTO (8)

4aseo MVE

Prery) suB

44560 Je FSTRING TOO LONG

44380 INR

44400 Mov FNUMBER OF ZEROS+1

44aeo ches HSETUP A MASK

4aaao INR c

44400 MVE }LOAD THE HEAD

44480 out #TO DISK STATUS

44500 SECLP3 IN GET SECTOR STATUS

44se0 RAR VTEST FOR START OF SECTOR

44540 INC FKEEP WAITING

44560 ANI }START OF SECTOR, RIGHT ONE
44580 ne 8 FCOMPARE TO FIND GUT

44600 JNZ 41F NOT

44e20 Md FWRITE ENABLE 018K

44e4o out

44660 wv FALL ONES ALWAYS WRITTEN FIRST
44680  WRITOK? IN GET STATUS

44700 ANA 0 WRITE OK

gated dz (0, NORE LOOPING,

44740 mov A,B 7GET CHARACTER TO WRITE

4a7eo out 10 HSENO IT OUT

44780 DCR c HTEST FOR NULL
44800 Jz ZRLOP

44820 NOTYTOI IN 8 POLL

44840 ANA ry) FNASK TEST
44860 era NOTYTD WAITING
44880 Mov Aum GET CHARACTER
4aseo out 10

aasee bck c FDECREMENT CHARACTER COUNT

BASIC NCS 608 GATES/ALLEN/DAVIDUFF MACRO 47 (113) 95212 10eSEP=75 PAGE 2801
FS Mac 6rSEPwod OSt11 O1Sk CODE

Te11 aagae INX 4
Tele 4a9ee NoTYTD

7013 44980 ZRLOPs 8

7e14 45000

7615 45020

Te16 45040 7PUT OUT A ZERO

To17 4500

7616 45080

7619 4510@

Teen 45129 © TRUFIN? FUNLOAD THE HEAD

Toei 45140 ol 9

Teze 45160

Tees a5iea FDONE

Teed 4se0e

Te25 45220 © OSKIS? AAs FA LOT OF CHARACTERS ARE COMING
7626 45eae STRINI PMAKE ROOM

1627 45260 CONINT PHHERE ARE THEY?

7628 45280 VSECTOR NOW IN (E)

7629 45300 OSCTMP+e PLACE TO STORE THEN
7630 45320 Ala GAD THE HEAD

1631 45340

1632 45360  SECL Pet #GET SECTOR INFO

7633 45380 TSEE IF BEGINNING OF SECTORCREAD)
7634 45400 TIF NOT, KEEP WAITING
7635 45420 TX UP SECTOR #

7636 4544o 63 GET SECTOR #

1637 45460 eE VIS IT THE ONE WE WANTED
7038 45460 SECLP2 RY TO FIND IT

7639 45500 C,137 HGET # OF CHARS TO READ
Teaw 45520  READOK 8 ET DISK STATUS

Teas 45540 A PREADY TO READ BYTE
7642 45560 READOK

7643 45580 10 FREAD THE STUFF

71644 45eue Mea SAVE IN STR

7645 45620 4 }BUMP DEST POINTER

7646 45640 c FLESS CHARS

Tea7 45660 READOK

7648 45680 AB FUNLOAD HEAD

7e49 45700 out 9

7650 asteo Me FINBCK FUSE CHRS TO FINISH UP
7654 45740

1652 45700 PATCH: BLOCK 20>

7653 48780 PAGE

BASIC MCS BG86 GATES/ALLEN/DAVIDUFF MACRO 47(113) 03412 10-SEP=75 PASE 29
FS mac GrSEPeO4 StL CLOAD, CSAVE, CONSOLE

45800 SUBTTL CLOAD, CSAVE, CONSOLE

45820 7

45840 THE CONSOLE COMMAND ALLOWS THE USER TO CHANGE THE I/O CHANNEL

45860 THAT THE USER TERMINAL IS ON, BY GIVING THE COMMAND CONSOLE X

45880 WHERE X IS SOME INTEGER THE TERMINAL DEVICE WILL BE POLLED FROM

45900 CHANNELS X AND X#1, RESTARTING AT LOCATION ZERO FORCES THE TERMINAL

45920 TO BE ON CHANNEL ZERO AGAIN,

45940

45900 IFN CONSSH,<

45980 INTERNAL consoo

46@00 CONDO: xRA a SFORCE A CHANNEL ZERO CONSOLE

4oe20 CALL CONS2 FON RESTART AT ZERO

4o040 JMP READY TYPE "OK" AND ACCEPT INPUT

46060 CONSOL CALL —-GETBYT FETCH AN INTEGER INTO (Al

4oa8e RNZ HCHECK FOR A TERMINATOR

4e1ee Const

4o120 LEN REALIO,<

46140 STA cNLcaL JCHANGE ALL THE FLAG INPUT CHANNEL REFERENCES

4o160 STA CNLCAe

46160 STA CNLCAB>

46200 LENGTH, <

4oeeo STA CNLCAG>

4eado INR A FUA]=DATA INPUT CHANNEL

4e200 STA CNLCBL TCHANGE ALL THE DATA INPUT CHANNEL REFERENCES.

4o2eo sta cNLCB2

4e3uo RET>

46520 IFN CASH, <

46340 7

46360 7 CASIN READS A CHARACTER FROM THE CASSETTE

46380 7 INTO (A) WITHOUT MODIFYING ANYTHING BUT [AJ ANO THE CONDITION

4e4oo + CODES
i
(5

Teemer Bvarrar,

4oaeo
4e44e CASINS IN 6 FROUTINE TO READ A CHARACTER
4eaeo ANT IDONE }PROM THE CASSETTE INTO (AJ
deaee INE CASIN

4esee IN 7 FREAD THE DATA

4eseo RET

4es4o 7

46509  CASOUT OUTPUTS THE CHARACTER IN (A) TO THE CASSETTE

46580 f WITHOUT MODIFYING ANYTHING

4eovo i

46620  TWOCSOs CALL —-CASOUT HOOUBLE OUT OF A)

46640  CASOUT: PUSH — PSW FROUTINE TO WRITE A CHARACTER IN (A)
46660 CASLK3 IN 6 FONTO THE CASSETTE

4eeeu ANI OONE

40700 NZ CASLK FWALT TILL CASSETTE IS READY
4e720 PoP PSh GET THE CHARACTER BACK

4e74e out 7 HOUTPUT THE CHARACTER

46760 RET

46780

40800 THE CSAVE COMMAND WRITES A PROGRAM ONTO CASSETTE BY DUMPING
4eseo BASICS CORE, THE HEADER IS THREE 211°S FOLLOWED BY A ONE
40840 CHARACTER FILE NAME, THE END 1S THREE ZEROS IN A ROM,

BASIC MCS 6980 GATES/ALLEN/DAVIOOFF MACKO 47(115) @3312 10-SEP=75 PAGE 29-1
mac

FS beSEProd USE11 CLOAD, COAVE, CONSOLE
1107 deco

7708 4eaey CSAVE; PUSH H

77109 4e900 MVE Apeiy

7710 deseo CALL = CASOUT 7PUT OUT THE START BYTES
M74 4es4e CALL THOcso FTWO MORE TIMES

THe 40960 Mov AWM GET FILENAME

7743 4e980 CALL = CASOUT STORE AFTER 211¢S

7140 47000 LRLD TXTTAB FSTART OF PROGRAM

TS 47020 XCHG

1116 47040 LHLO — VARTAB FEND OF PROGRAM

TIT 47060 LOPCSO: LDAX 0 JGET A BYTE FROM THE PROGRAM
7718 a7eee INK 0

7119 47100 CALL «© CASOUT FSEND IT OUT TO THE CASSETTE
T7120 are COMPAR VTHE END?

Tet 47149 NZ Lopcso TIF NOT,QUTPUT MORE

Tee 47100 CALL TwOCsO FTWO MORE @*$ TO MARK THE END
1723 47188 PoP 4 FRESTORE THE TEXT POINTER
7724 47200 CHRGET 3GO PAST THE FILE NAME

71785 areee RET

7726 a7e4o
7127 4726@ 7 THE CLOAD COMMAND CLEARS CORE AND THEN READS A PROGRAM

7728 47260 j FROM CASSETTE, SINCE THE LINKS OF THE FILE ON CASSETTE

7129 47300 7 WILL BE WRONG IF THE FILE WAS SAVED WITH A DIFFERENT VERSION OF
7130 47320 } BASIC FINI IS JUMPED 10, A SCRATCH IS DONE AT THE START SO RESTARTS
1734 47340 7 AT @ WON?T LEAVE THINGS IN A GARBAGE STATE,

1132 47300

77133 47380 = CLOAD: STA FACLO FSAVE THE FILENAME

7734 a74ee0 CALL SCRTCH PRESET EVERYTHING

1735 4742@ — LOPCLK: MvI 8,3 FNUMBER OF START CHARACTERS

1736 a744@  LUPCLat CALL CASIN GET A CHARACTER

1137 474608 CPI ait FSTART CHARACTER?

71738 47480 INZ LUPCLK INO, RESET COUNT AND LOOK SOME MORE
7739 47500 ocr 8 FDECREMENT THE COUNT

7749 47seo INZ Lorca WSEEN THREE YET?

7741 4a7sae xT Hy FACLO #POINT AT THE FILENAME

7142 47560 CALL = CASIN JREAO THIS FILENAME

7143 47580 chr cf VTHE RIGHT FILE?

7744 47608 Jnz LOPCLK VIF NOT, START COMPLETELY OVER

7745 47626 LKLD TXT TAB }PLACE TO STORE THE PROGRAM

7746 47e4@ = DOCRS: MMVI 8,4 }NUMBER OF ZEROS TO GET

7747 47660 HBEFORE STOPPING

7748 47682 DOCSMR: CALL CASIN GET A CHARACTER

7749 47700 MOV MA HSTORE IT

7750 47720 CALL = REASON TMAKE SURE THERE IS ROOM

7791 41740 Mov AyM JREGET THE CHARACTER

1752 47760 ORA ry TA ZERO?

77153 47780 INK H

1754 47800 NZ bocrs PRESET # OF ZEROS SEEN

7755 47820 vcr 8 TOECREMENT NUMBER OF ZEROS

1756 47842 NZ DOCSMR FSEEN FOUR?

1157 47860 SHLD —-VARTAB TSETUP END OF PROGRAM

7758 47880 Lxt H, REDDY FTYPE "OK" PREMATURELY

7759 47900 CALL = STROUT

BASIC MCS 6960 GATES/ALLEN/DAVIDOFF MACRO 47(115) OSt12 10-SEP2TS PAGE 29-2
FS Mac GrSEP@64 Sti CLOAD, CSAVE, CONSOLE

7760 47920 JMe FINI> }FIX UP THE LINKS AND GO BACK TO MAIN
77161 47940 PAGE

Teemcp Buaran,

BASIC MCS 8960 GATES/ALLEN/DAVIDOFF NACKO 47 (113) @5312 10=SEP*75 PAGE 30
FS HAC GrSEPRO4 OSE11 PEEK ANU POKE

7162 47960 SUBTTL PEEK AND POKE
7163 47980 IFN LENGTH, <

7164 49000 IFE LENGTHe2,«<

7765 11314 Bo1vwe eves1d 48020 PEEK} «CALL. FRCINT HGET AN INTEGER IN (H,L]

Tree B1131d¢ enoeeD Blues®

T1e? O11310" poweep 011511°

7766 @11317" B10ea BvOITe 4bouo mov Apne HGET THE VALUE TO RETURN

7765 48000 LENGTHea, <

7770 40080 CALL POSINT HGET THE VALUE OF FACLO INTO (D,E)
174 4e100 LDAX o> TREAD THE VALUE

1772 @11320" Bo1eOo vases 4e1e0 one SNGFLT AND FLOAT 1T

1173 O11321f BvaveD Bu7aee?

TI74 @11322" BoveeL w11519"

1715 4a14e LENGTH=2,<

7776 011323" oo1oe 9vo315 48160 x CALL FRMEVL

1777 @11324* BBB BO5S3e°

7778 @113e5¢ Ooeoos w11521°

7779 11326" Bo1eun 40545 46180 PUSH OH SAVE THE TEXT POINTER

7780 011327? valued avOs15 48200 CALL FRCINT HGET INTEGER VALUE OF FAC IN (HyL}
7781 011330" OooaAD 11515*

7782 G11331% Beveve v115ea°

7783 G1133e" Balove aves4s 4e2e0 XTHL> GET BACK THE TEXT POINTER

7184 4240 LENGTH=2,<

7785 46260 CALL INTI02 FREAD LOCATION TO POKE

77186 ae2b0 PUSH D> SAVE THE LOCATION

7787 011333 vo1000 gves17 48300 SYNCHK 44 CHECK FOR A COMMA

7788 811334" avveve BHoLS4

1789 @11335* Bolewo evasis 48320 CALL GETBYT

7790 @11330 Bp0000 B11eeu"

7791 11337" BoBoea 11330"

71192 V11340" Boloeo BvoSeL 48340 PoP GET THE ADDRESS BACK

7793 11341" eo1e90 veobee 48360 STAX STORE IT AWAY

7194 11342" @e1oee voesII 48300 RET> FSCANNED EVERYTHING

7795 48400

7196 4e4e0 NOTES IN THE 8K PEEK ONLY ACCEPTS POSITIVE NUNBERS UP TO 32767
7197 44ae POKE WILL ONLY TAKE AN ADORESS UP TO 32767 » NO

1798 48460 FUDGING ALLOWED, THE VALUE 15 UNSIGNED,

7799 4eaee

7800 11536" 48500 ,C154P

7804 40520 END

NO ERRORS DETECTEL
PROGRAM BREAK 1S 011343

10K CORE USED

BASIC MCS 6980 GATES/ALLEN/DAVIOOFF MACRO 47 (115) @3312 10*SEP=75 PAGE 31
Fs mac brSEPro4 05311 SYMBOL TABLE

a ageee7 CNLCAL 005114" SIN DconP eoo7ee*
ABS 9197" ExT CNLCae oesi27? SIN DCKBRT e11e04t
AFF Beoin4 CNLCAS @03461% SIN bory CT
ALLLST eeessat CNLCAa 003303" SIN EF ooraii?
ALLSTR e1057e° CNLCBL oosi24* SPD OEFFIN oo7sei*
ANDOKD oa5s7it cnLcbe 003130" SPD DEL aie7it
APPLOP aesedat CWICCN ous4e5¢ DELETE o1i24s¢
ARG ae16sa? CNTWFL ovrs4it OFACLO 001033"
ARGLO eeieast CoLIs eve7e5* om oe6seat
ARYSTR e117" CUMPRT ee455s¢ DIMCON oe64a7st
ARYTAB we16es? CONIA ee4as’ OIMFLG oo1saet
ARYVAR 910137" CONINT o11ges? OIRIS gosseut
ARYVAR @10140° CONSIH eens? OMULT 000676"
ASC @10515° CONSSW avovee ONTCPY oosei7t
ASP Ae oo4e26r CONT oussaet DOASIG 005056*
ASPAC ou4ee7t CONTRW evover DOCMP 006375°
ATN 900137¢ CONTW eeoui7 DOGOND 904354°
ATNFIX 0o0137° CUPNUN we4as7? DoosP @05756°
ATNTK eposee cos oooisi? OOMIN 006146"
8 eoa0ge COSFIX 0131" DONMUL oo7326"
BLTLOP ooe013° ck 00015 DURES oo1544t
BLTU @p2ous? cRoOO eo4ses? bOSIZT eodoar?
BLTUC ovevia? CKDONE @ee753° OSCTNP oe157u*
BOTCON woeete CRFIN oo4534* DSKFUN eooeea
BRKTXT e734? CRUNCH ee2533° osuB auee74?
BSERK eo7errt cSLoor 9e6345¢ OVGERR oe2e7s*
BUF woi4si? CURLIN aaieo7* DVAR @19e14¢
BUFLEN epo11e czLoor oe2316° OvaR2 @10213¢
BUFLIN 011163" r) evoove OVARS @10214°
BUFMIN eo14ser apy aeve7e? E eeoves
c aeeon1 DANDOK 906437" EATEM 096535°
CAsSh eaevoo DATA ooav7er EIT @oaesat
cat w10sen? DATATK evozes § ELSE @e4ora?
CHEAD anesve? DATBK geseas? ELSETK euveee
CHKCON vo4sen? DATFND @05166* ENO ea3474"
CHKSTR o10432° DATLIN geis77* ENDCON eo3sei?
CHRS @10532° DATLOF oe5163" ENOREL e@sais*
CHRCON 903433¢ DATPTR aoi1627" ENDTK eavece
CHRGTR Bas420" DATSNE CO EGULTK eeeeeo
CLEAR ao3703" DeLbsr eovere* ERRBS oeoeis
CLEARC egeaase ERRCN egoeet
CLMW1b eoevre ERRDD eveuie

ERRDIR @a7532°

ERRDVO aoee1s

ERRFC eveeas

ERRFIN oeera7t

ERRID eoewla

ERRLS eooe17

ERRNF eaeees

ERROD oeoved

Teed Evarvan

BASIC MCS 8980 GATES/ALLEN/DAVLDUFF MACKO 47(113) @5112 10eSEP=75 PAGE Sint
FS Mac OeSEPmo4 OSt1L SYMBOL TABLE

ERROW eoeee7 SPD FPWR eeavee EXT INCHR ea3i26°
ERRUK weeiee? INT FPWR gessee? EXT INDLOP ea6754°
ERROV eeeeae SIN FRCUBL @o5751° EXT INEG eveeaa
ERRKG weeeos sro FRCINT @113530¢ EXT INIT ogeies?
ERRSN geovve SPD FRCSNG 907506" ExT INLIN oee776r
ERRSO @oev16e SrD FRCSTK geeooe ExT INLING ao3eas?
ERRST woovea SPD FRCTBL aueeea? INLINN oe2772"
ERRTAB 90730" FRE 007337" INLPNH geresat
ERRTM #90015 SIN FREFAC a10434° INPCOn eeais7¢
ERRUF @gveee SPD FRESTR e10431° INPCON oo47es?
ERRUS eovv1e SPO FRETMe a10437° INPRT @e2i4ait
EVAL apones? FRETMP a1e44or INPUT ooa7ii'
EXCHGT aeaivot FRETOP @01575° INPWRO o10720°
EXIGNT wosider FRMCHK 905337" INRART eoveee
EXP egeier? PRMEVL a05336° INT eaoveo
EXPSTK @e5553° FSUB eeg7ae’ INTDSP oaa716¢
EXTFNC eever FUNCTS eovent INTIDe @oso25°
Fac woreda? FUNDSP avo103" INTIOX aose22t
FACUBL @g5775° GaRBAe @1o042° INTXT eo17e2o"
FACLO 001037" GARBAG a1ov2e" INXHRT a2eea"
FACSNG eoous4? GETAGN evarar? TSARY @g6745°
FADD eoo704" GeTeco 07752" ISCNTC 2@34e0"
FADDS eese2eo" GETBYT @11020° ISFUN waeena?
FALSIF o04363° GETDEF aoreas? 1sGOSU 004306"
FBUFFR oo1655° GETFNN 07550" ISIGN eoeede
FCERR o10776° GETSPA ae7772° ISLET Beseiet
FCOMP. aese7at GETSTK eeeved? ISSEC @eo53ar
FOIV ooe7ie? GETYPE eeosar? 1su8 oee72e"
FIN @11064° GIVDBL ae7s7ar ISVAR aeeiedr
FINBCK @10546° GIVINT ea7aner kKLOOP avesaat
FINGO aoeeTer GUNE 005370" L aoeeas
FINI woee7er GUNE@ 003376" LABBCK weeree?
FININL ee4sie? GUNES 003375° Lasnun 200306
FINNOW oe7331¢ Goopcn eosoaae LEFTS o10552°
FINPTR ege7de? GOSsuB o03770° LerT2 @10560°
FINREL ae5eus? GOSUTK gover4 LeFT3 a10556°
FINTNP eo5saar GoTo enaeio? LEN o105a1°
FLGINP woi1evat GOTOTK aueeio Let o105a5¢
FLOAT eaveve GRBPAS a1eesa* LENGTH aeovae
FLOATR eeouve GREATK a0eesT LePsKe oeati7e
FMULT ee7 10° GTBYTC o11017°

FNOFOR oei74ar 4 ovaved

FNOLIN wees7i? WAVTYP avestar

FNDOER ee74ast Tavo @e0716° EXT

FNDVAR w19e45¢ COMP aa0726¢ ExT

FNINP. e1e712" IDIV owarag? Ext

FNOUT o1o7est TDONE @eoed1 sro

FNTK eooe4s IF 204325

FNWAIT 810733" TFORON eu3e67"

FOR @a3154¢ IFTK eee21e sro

FORTK opoees ILLFUN @10776" INT

FOUND oueo4e? IMULT geo72e* ExT

FouT @07565°

BASIC MCS 698K GATES/ALLEN/DAVIDUFF MACRO 47(115) O5412 10=9EP=75 PAGE 51-2
FS mac brSEP=64 WSt11 SYMBOL TABLE

LESSTK eoeeer MOVRM 10154" ExT OMERR ae2es7*
Ler oe4isit MOVSTR o1o4i7" ONEFUN aeozee
LINCHK wo4gu7s? MULOIN geeea1 sro ONELIN ae23es?
LINGET oa3se4e" MUSTCR av2e17" ONEON oas2es?
LINeT2 oose4s" NEG aevvo0 ONGOTO ae4e7i*
LINLEN oaeiie NEWCHR oo4ga7? OPRTYP @ais4ae
LINLIN enereat NEWSTT wessae? OPTAB 990163"
LINPRT @1i134¢ NEXT ousees* ORFIN aao4es*
LINPTS @o3103" S NEXTC oes5e30° OUTBEL oa3ee1"
LINPT2 we3s74? § NFERR. ae2ia0" OUTCON oases?
LINPTS eo4arar NMARYA ge7esi’ ouToo aaovsa"
LINPT4 ooassr? NOARYe 07050" OUTHRD 010730"
List @11072° NMREL evaves PARCHK 006136"
Lists 11077" NODATT aee7i0" PEEK o11si4*
LISTEN eveoes NODEL, aveear’ PLooP @11i70°
Los @neies? NOPRIN oosi1s? PLUSTK aavese
Loor ooes7ar NOSEC @vesa7 POKE o1isest
LooPoN ee5s2er NOTABK 004637" POPGOF ooi77ar
LOOPER ee17se? NOTDIN ow7iset POPHRT eeoaee
Loopon oo43sv7" NOTER aveaia’ Pus
Lopote ae4773¢ NOTFOD oarieae PPSWRT
LOPFDA ee7e1s? NOTENS: @o6671" PREAM
LOPEND we6ees? NOTFRE oveeTe’ PREAM2
LOPPTA @07135° NOTIT1 @06660° PRINT
LOPREL @p5363° NOTLST aiga77t PRINTC
LPOPER e531" NUTOL 003176° PRINTK
LPTLEN oov1le NOTOTE a4735° PRITS
LeTsh eovene NOTSTV 005360" PRITG
STORK eoeee? NOTTHK 010753" PRTNUL,
4 eevee NOTTK avsede $8 Psw
MAIN @e2165? NOTTRE a05s67? PTRGET
MAKINT ae74o4? NOWGET a0se53° PTRGT2
MEMSIZ oeisast NOWLIN oose1a? PUFOUT
M10s 10643" NTHIS. o02736° PURE
MIDE @10665 NIWIS1 averaer PUSHF ooen36t
MINUTK oovesi NULENT g0a04e" PUSHMA ‘
MLOOP e11e75° NULL 003566" PUTDEL
MLOOPR weeece’ NUMCMD avoado PUTNEW
MORCOM oa4see* NUMGFN. @00051 PUTVAL,
MORLIN apse4e" NUMINS aosore* G
MORPR eoaaie? NUMLEV evoees Ss QINLIN
MOVE 8 EXT NUMREL @05476" QInt @aeeda ExT
MOVEN 25: ExT NONTMP a@00es
MOVFR ExT NUTPOS eveo7a
MOVINS. NXTCON ae3276"
MOVLP. NXTRES aeeees’
MOVMF ext OUONE evveoa
MOVEF @oeu44? EXT OKGOTO 204346"

OKNORM aeesit

OLDLIN @vteii?

OLOTXT oeie1s*

Teemecs Buarrar,

BASIC MCS 8480 GATES/ALLEN/DAVIDUFF MACKO 47(115) Q5412 109SEP#75 PAGE 3193
FS Nac 6rSEPRO4 OSt11 SYMBOL TABLE

RAMBOT @20e00 SNGDO eevee’ TABER a04s77°
READ oo4a76o* SiGusP average TABTK goeede
READY opei4s’ SNGFLT ae74o0" TAN @0135°
REALIO eoouel sp evead6 TANFIX @0135¢
REASON aeen4s? SPCTK @eoede TEMP aa1603"
REODY egi7es? SUR ooorer? TEMP2 @aieas?
REOINF 094136° SURF IX geoiei? TEMPS @@157s*
REM woaerat SGRTK geee71 TEMPS oa7iear
REMER 004103" STAINP. a107sa? TEMPPT geisare
REMTK waver START avovour TEMPST oeissi*
REPINI oeeiee? STEPTK aoaa47 THENTK gae4s
REPOUT woae3e’ STKDBL @as7as* TMERR a05703°
RESCRI o1le16? STKINI avearar TOFF @a30a5¢
RESER eeeee7? STKSNG aaooar? TON aeseaa"
RESFIN oe3a5sr STKTOP auvi61s* TOPCON 200035
RESLST eaui7er STMOSP geosea? TOTK eeoeds
RESRCH ete? STOP wosarer TRCFLG 1631"
RESTOR wosuder STPEND eessau" TRMNOK ae4eo7*
RETAOP oe5354° STPROY @vaiaae TRMOK oesii1¢
RETURN ooauaat SIRS eo7564° TRYAGN oe4egar
RIGHTS 010631° STRI averse" TRYGI2 oer774¢
RNO egies? STRAOL ae7ese? TRYIN easiect
RNOF IX ooo1est STRADE eu7ee7" TRYOUT oe3i13°
RUN eos75at STRCMP. @ooseo" TSTACK eooean
RUNC oe2437" STRCPY ao7eai* TSTOP 0@5357°
RUNCE @aape7? STRONG @ose77e TTICHN eooves
SCNLIN oves3st STRUON eoasor? TTOCHN eevee,
SCRATH eoeuait STREND e@16as* TTYCHR ee3se7a"
SCRATK ooees7 STRFIN eo7ees? TIYIST eedeiet
SCRTCH apegeet STRGET Be7646" TTYPOS eeeod7?
SETDBL 005750" STRING weeees TVAR 010063"
SETIO o11003° STRINI we7ezae TXTTAB eo1617"
SGN operas? STRLIT ae7e37* UMULT oe7ee7*
SIGN @eoe5o? STRLTE ev7odse USERR oo4e37*
SIGNC oo0055° STRUTS eereder USINTK aoaea4
SIGNS 096373" STRLTI ee7eaar USRLOC eoo111t
SIN ae0133" STRNG ooerar? VAL, a11e4de"
SINFIX STROUL oo77aee VALINT eaoeee
SKPNKF e STROUT ao774se VALSNG aoeveo
SKPVAR @10130° STRPRE oo775s¢ VALTYP eo1543¢
SMLVAL voTseet STRPRT ae7746" VARTAB oe162i*
SNERR wpeore STRSIZ aeoees VINT oeo1est

SNGDBL oo5743° STUFFH ae2667" VMOVAF @05777" EXT

SUBFLG aa16e1? VNOVE @o77a4* ExT

SVAR a1oi0e" VNOVFA @oevee ExT

SVARS. o10077" ViOVF tt epee" EXT

TABEND eo2653" VNOVMF ee4eoae EXT

VNEG @obieo" EXT
VPUSHO eo5536"

VSIGN oo4a34a7" EXT

BASIC MCS 8980 GATES/ALLEN/OAVIDOFF MACRO 47(113) 03112 109SEP#75 PAGE
FS mac 6eSEP=64 05311 SYMBOL TABLE

ZERITA oereaT?
ZERO @11ede? EXT
ZEROER ogo7es?
SCODE @aavea? INT

Teemees Bvarran,

791
1978
ese
ase8
2979
3ee5
3623
4080
4555
4914
5379
54uge
5942
6269
6659
7074
1ee7
7768
9o4e
986
993
1005
1we7
1049
1eooe
let7#
12348
lager
1e6s#
abet
12998
13168
15338
15508
13648
13818
13988
tain
14298
1447#
1464e
14618
14968
isiee
15308
15488
sez
17ee8
4onow
weTae
ALLLST 2115
ALLSTR T1378
ANDURL a7see

APPLOP
ARG
ARGLO
ARYSTR
ARYTAB
ARYVA2
ARYVAR
Asc
ASP Ae
ASPAC
ATN
ATNFIX
ATNTK
8

BLTLOP
aLTU
BLTUC
BOTCON
BRKTXT
BSERR
BUF
BUFLEN
BUFLIN
BUFMIN
c

CHRCON
CHRGTR
CLEAR
CLEARC
CLMWID
CNLCAL
CNLCAe
CNLCAS
CNLCAG
CNLCEL
CNLCBe
CNTCCN
CNTHFL
COLIS
COMPRT
CONIA
CONINT
CONSIK
CONSSK
CONT
CONTRW
CONTW
COPNUN
cos
COSFIXx
cr
cRDU
CROONE
CRFIN
CRUNCH
csLour
CURLIN
czLoor
0

oaov
DANDOR
DATA

DATATK
DATBK
DATF NC

799
ageie
4125
22078
lee
136
136
136
26598
26248
26394
2665
162
2401
3774
1608
7107
1668
tee
1417
148
tele
3486
924
139
120%
155
2314
3869%
1976
53708
136
20798
B28
aver
2394
2898
3294
3729
4553
4aa6
5480
5655
6a2e
6501
6993
7488
160%
4759
1964
9588
4133
43am

1689

2004

1920

1655
2105
24se
2925
3426
4188
4566
4956
5876
5669
6118
6578
Te4e
7489

3716

2595

2oue

se4e

Tm

Teams varia

DATLIN
DATLOP
DATPTK
DATSNE
DBLUSP
COMP
DCXBRT
DOIV
EF
DEFFIN
DEL
DELETE
DFACLO
DIN
DIMCON
DIMFLG
DIRIS
OMULT
DNTCRY
00ASI6
oocHP
DOCOND
DoDsP.
ONIN
DONMUL
DORES
DOsizt
DSCT MP
OSKFUN
osue
OV@ERR
OVAR
Dvare
DVARS.
(3

EATEN
EoIT
ELSE
ELSETK
END
ENDCON
ENOREL
ENOTK
EGULTK
ERRBS
ERRCN
ERROD
ERRDIR
ERROVO

FACSNG
FADD
FADDS
FALSIF
FBUFFR
FCERR
FCONP
FOIV
FIN
FINDCK
FINGO
FINI
FININL
FINNOW
FINPTR
FINREL
FINTNP
FLGINP
FLOAT
FLOATR
FMULT
FNOFOR
FNOLIN
FNDOER
FNDVAR

eves
19168
1asie
1a91e
lates
12678
isaie
447
7309
136
1ases
1228s
1a7ee
isaie
1184¢
170
15668
13448
4519
33978
4260
1408
466!
36H
144
4839
146
6932
4use
1418
1430
3696
159
147
1aie
1161
141#
647s
5180
2015
2497
6121
5650
4569
ange
1631
14>8
1458
1159
17358
1989
Soae
67068

1669
42988
2990
4oat
4905
1153
74788
1151
o307#
o4n4e
15378
7S17#
16808
5516#
5517
5531
30398
1149
35244
4e17
5396
3736
4964
Soo1F
6187
2292

6508
936

4147

18778

eezet
oae5e
1797
Seek
5370
6372
1267
5563
10978
S388#
2383
30148
30198
a54e
2932
3459
5986
3063
5967
6317
1878

1857
Seee
5378
64e8
7262
5569

3725

45608
2936
6330

16838

3155
ager

swav

7534

4887

5910

307s

4e91

5965

3345

TS06#

71382

o0se

3365

1029

4798

7345

102

4315

1049

47

6692

6585

Tame Buarear.

FNINE
FNOUT
FNTK
FNWAIT
FOR
FORTK
FOUND
Four
FPWR
FPURG
FRCOBL
FRCINT
FRCSNG
FRCSTR
FRCTBL
FRE
FREFAC
FRESTR
FRETN2
FRETNP
FRETOP
FRMCHK
PRNEVL
Fup
FUNCTS
FUNDSP
GARBAe
GARBAG
GETAGN
GETBCD
GETBYT
GETOEF
GETRNM
GETSPA
GETSTK
GETYPE
GIVDBL
GIVINT
GONE
GONE@
GONES
GOODCH
Gosub
GOSUTK
GoTo
GOTOTK
GRBPAS
GREATK
GTBYTC
ct)

HAVTYP
ADD
IconP
IDIV

IFORDN
IFTK
TLLFUN
IMULT
INCHR
INOLOP
INES
INIT
INLIN
INLINC
INLINN
INLPNN
INPCOM
INPCON
INPRT
INPUT
INPHRO
INRART
INT
INTDSP
INTID2
INTIOX
INTXT
INXHRT
ISARY

aaa
ace
3181
3336
3560
3981
4308
a7ee
4943
535u
5626
9875
oo4a
6154
6366
e4es
6675
e829
e886
6977
7156
71482
5594
1165
1173
17h
2033
3o16#

3419
906
1169
26e8e
5901

134
2e79
euase
e512
6165
4209
4u96#
1926
4usee
T2458

4859
Beit
5865
1704#
2388
Se7se

73058

sees

1957
eugoe
e5ve

7208

7141
4515
5108

2sor

73308

ISCNTC
ISFUN
TsGQSU
ISIGh
ISLeT
ISSEC
TSUB
ISVAR
KLOUP
L

LABBCK
CASNUM
LEFTS
Lerte
LEFTS
LEN
Lena
LENGTH

LEPSKP
LESSTK
Let
LINCKK
LINGET
LINGT2
LINLEN
LINLIN
LCINPRT
CINTA
LINPT2
CINPTS
LINPTa
Ist

Lista
LISTEN
Los
Loor
Looron
LOoPER
Looron
Lopote
LOPFDA
COPFND
LoPPTa
LOPREL
LROPER
LPTLEN
LPTSH

LsTorK
4

MAIN
MAKINT
MEMSIZ
MIDS
NIpe
MINUTK
MLOOP
MLOOPR
MORCON
MORLIN
MORPR
MOVE
MOVFIY
MOVER
MOVINS
MOVLP.
MOVE
HOVRE
MOVE
MOVSTR
MULDIN
AUSTCR
NEG
NEWCHR
NEWSTT

29908
5047
3592
166H
3i1ee
5550
168H
5006
22998
830
5193
6265
6988
soa
19548
948
11298
Tale
938
7001#
cr
789
ord
toi?
1879
2380
2867
3315
3665
3936
4200
4368
4615
5332
5627
225
ete
6975
7397
18968
19368
1o7Te
SBabe
15>
Si74#
1148
2u6le
1gee
2over
3095#
sate
59168
1126

74908
120%
920

aisie

4ase

17408

35988

Syiae

s9aie

Sosee

uaoe

45390

45ise
1138

be

2875

10299
764

2069

2385

3ae0

4453

9349

5937

e118

6804

Tw25

7380

19618
169%
155
952

Tage
155

75428

20470

39238

3171

37468
14is
143¢
idee

6958

69888
143%
tee
1aee

6499

398
2539
145¢
37454
28538

7417
51208
35978

sous
55598
1167
508%
241s
1754
5ee4
6269
7152
5210
5128
Tiese
7e15
7181
70634
7082
22
813
1g2e
1625
1697
2488
2903
3388
3085
3940
4215
4370
4655
5344
5661
247
6587
6982
7163
1904
asag
2738

1972
3on4
2601
2517
2916

T4018

2054

3330

S1TS#

so12

5662

3304

e403

soma
5486
6849

Toamth Buaicar,

NeXT
NEXTC
NFER
NMARY.
NNARYA
NHREL
NODATT
NOvEL.
NOPRIN
NOSEC
NOTABR
NOTOIN
NOTER
NOTFDD
NOTFNS
NOTFRF
NOTIT1
NOTLST
NOTOL
NoTUTI
NOTSTV
NOTTHR
NOTTK
NOTTRE
NOWGET
NOWLIN
NTHIS.
NTHIS)
NULCNT
NULL
NUMCND
NUMGEN
NUMINS
NUMLEV
NUMREL
NUMTMP
NUTROS
NXTCON
NXTRES
ODONE
OKGoTO
OKNORW
OLOLIN
OLOTXT
OMERR
ONEFUN
ONELIN
ONEON
ONGOTO
OPRTYP
OPTAB
ORFIN
OUTBEL

ouTcoN
ouToo
OUTHRD
PARCHK
PEEK
PLOOP
PLUSTK
POKE
POPGOF
POPHRT
Pos
PPSHRT
PREAN
PREAN@
PRINT
PRINTC
PRINTK
PRITS
PRITA
PRTNUL
Psw

PTRGET
PTRGTe
PUFOUT
PURE
PUSKF
PUSHMA
PUTDEI
PUTNEW
PUTVAL
Q

QINLIN
GQINT
RAMBOT
READ
READY
REALIO
REASON
REDDY
REDINP
REM

1962
a3ere
1881%
5946
so4e
45444
246
2o11e
2o1sH
555/
3779
6058
5056
5934
Sean
5198
Sear
7050
2749
agar
45358
Tate
inase
2999
4186
4305
2365
ensue
a34e
1105
29308
Si2be
4ite
i11e
aoaee
1168
s9ie8
20394
2355e
ieee
3657
5132
lodee
loare
135
ivaow
cree
2809
1101
1ee4e
9568
8475
2520

aie
146
T254#
sa5ee
934
T4od8
155
1110
1760
1ou#
913
e5ai
Tred
T1935
wie
37518
9968
T5018
T4648
3aTew
a7
5465
532
Tate
3452
5534¢
1678
1
1416
a7.
oaale
o576#
3565
9818
99e8
lover
oeew
19318
1949#
tard
1304
13954
1495
155
1418
158
1070
135
So
135
17108
S4a6u8
1986

43e1#
4uo1
4587
5953"
S952
4546
eaiie

2619
S571#
3921

ea628
54318
6015#
Se73e
Saree
5e52

7057#
2757#
4g63#

727 9%
5034
eseew
41968
43ere
24358
ange
3098
3085¢
2938
5130
geri
1849
4795
119%
3915
age
2370
2617
Sobee
bi6ee
3031
2254
18574
seas
2124
28298
3584"
4ee5
4607
‘Sabor
assee

3969 39818

3065

5194 Saue

6350

1we9 4576 = 5009

asre
3882
6149

6323

2587 «2588 bat
39373948 ate
6160 «= 6661 bbb

9898
998
1019
1027s
10468
10568
1267
13468
1451
1568

2631
4e01
6685

990
999
1019#
1028
1047
i778
1269
1370
14518

3019
4394
6688

9908
9998
1020
1g268
1047#
1187
12698
1372
1472

3045 3188
49315357
6695 6868

oo1e
10018
1oaie
10298
10488
11948
1294

1393

1070"

Teemer Biacar

REMER
REMTK
REPINI
REPOUT
RESCR]
RESER
RESFIN
RESLST
RESKCH
RESTOR
RETAOP.
RETURN
RIGHTS
RND
RNOFIX

SINFIX
SKPMRF
SKPVAR
SMLVAL,
SNERR
SNGUBL
SNGDO
SNGDSP
SNGFLT
sp
SPCIK
aR
SORF1X
SORTK
STAINP
START
STEPTK
STKOBL
STKINI
STKSNG
STKTOP
STMDSP.
STOP
STPEND

STPRDY
STRS

STR1

STRADL
STRADE
STRCNP
STRCPY
STRON2
STRDON
STREND
STRFIN
STRGET
STRING

STRINI
STRLIT
STRLT2
STRUTS
STRLTI
STRNG
STROUT
STROUT
STRPRE
STRPRT
STRSIZ
STUFFH
SUBFLG
SVAK

SVARS.
TABEND
TABER
TABTK
TAN

TANF IX
TEMP.

TEMPE
TEMPS
TEMPS
TEMPPT
TEMPST
THENTA
TNERR
TOFF

TON

TOPCON
TOTK

TRCFLG
TRMNOK
TRMOK
TRYAGN
TRYGI2

S4gue
g9e8
139
S970
74.86%
a3sie
29898
98eH
Taped
1980
aseqe
1984
950
cri)
9118
1076
2057
3265
20988
1130
10058
144
48968
Tease
897
159
160%
1548
926
139
37198
6754
6179
135
4895"
4959e
1159#
b269H
1739
1oev#
915
9158
1oase
Teeo8
84
1o2ea
431
1884
ape
147
10568
1086
30164

19598
94
24188
osion
6494
age
3522
4204
3795
136
e544
6539"
4o#
22768
3804
5126
esa4e
150
4197
65354
4951
2516
146
144
66348
332
11o#
e303
16250
6073/8
67349
2561
3762
nies
929
139
1635e
116
170
6030
149
150
19234
169"
1995
1995
S20ve
1gise
16758
4g1o#
42e9
39918
6618

3421
eae
1956#
3979
1492
eua7
4254
2351
1498
2218
4658
33528
11738
917Te

sesie
21968
3296H
7403
21778
2936
2178
4948
7264
8978
8498
854
5393
9268
926%
37a7
67608
61868
173
4940
4990
4960
764
1852
3766
9158

5194
7285
13e8
2605
48798
2es7#
49548
16498
2949
30108
4085

1426
64598
ease

esu7#
5345#
o48ae
4eean
3e408
1668#
6548
6552
148
2289
3805
5324
6942
3807
65368
7452
saz
eue7e
bo18H
1917
6649
3e4dt
1178
eased
2264
6768

esrre
3768
3760
929%
929%
2208
16394
1618#
60358
1otew
lo1a#
3660
4686
2185
Siver
Seve
2780
2905
aes
4esou
4pe6
6697

7484

29e4e
S498 5454

3732

16748 «2122 2684 2947 3186 = SaaT

77173
3295

3e4e $506 ©6237 = 6664.

3474
6801

7036

4557

4032

oie

5538

4376

6396

2206
3464
4585

4449

eee
3476
Seeq

2e4e
3755
5095

2275
3789
5097

Toemer Bvarran,

TRYIN
TRYOUT
TSTACK
TSTOF
TTICKN
TTOCHN
TTYCHR
TTYIST
TTYPOS
TVAR
TXTTAB
UMULT
USERR
USINTK
USRLOC
val
VALINT
VALSNG
VALTYP
VARTAB
VINT
VMOVAF
VMOVE
VMOVF A
VMOVFN
VMOVNF
YNEG
VPUSHO
VSIGN
ZERITA
ZERO
ZERUER
SCOVE

SSTART
Ch
+P

3910-3964 = 6G

levee
Lone 4oar 4834 449335237 5596
3516 5630-6735 7540 7554

4929
6594

aeira
2u7se
21168
21944
2e20K
2eole
2316#
23056
eaite
2474e
25094
25998
27374
27878
abate
29059
29518
30308
$u55e
S1008
31868
3e358
3eore
35354
34238
34918
35438
3068
37048
S7oaa
304s
3e5ue
39204
39714
ao34H
agers
4149
geila
4esoe
as3sa
aa0se
44398
4seae
4omie
4o7ae
47164
47So#
4eous
4e4ee
4ea9H
49358
497 4d
Seas

5931

6169

Femep Buscar

cc
CHRGET

cna

che

seas
51a58
51758
5e39a
54soe
5494e
55594
Seale
S608
5798
59358
59848
6uev8
oleae
o167#
be10#
oe75#
os4re
e42es
e478
os4oa
rr
bo2ba
66834
orale
67568
6803"
e91e8
o94ee
69974
T0574
71098
71654
Te1o#
e748
73338
T4158
14548
74948
75358
11798

Toemes BvAcar

ORT
our
OUTCHR

PCHL
PoP,

1wse
1415
1193
1473

967
1015
1058
1194
1474
2467
6986
21s?
4e26
6875

2637
2396
6541

#85
2070
244u
3405
Seee
5739
6048
6483
6631
7506
a5a1
5556
7304

815
3e45
4334
54be
7095
2b25
7547
1905
288s
4ess
eu7s

747h

avid
25.1
3095
4597
5386
6691
asi7

4eav
2507
1919
Su64
472
6236
6694
1648
2925
4562
5209
e7rel

27
2035
2299
2eve
3188
3519
4o8e
asm.
4ead
Sead
5476
5675
bued
e145
eae
6782
6889
Toe?
715e
7374

1874
2918
3866
5431
6537
reel

1757
34a1
5486
7467

2e74

sea5
1194
2164
3045

TeemLA BuALvAT

aves
4889
5355
5888
6392
6803
7144
7424

2101
2797

Push Pe ae
PUSH

Team dA Birra

STAX
su8
sul
SYNCHK

XCH6

6426

2a7e
3458
3976
amit
5903
6435
7098
7546
5499

2900
4sT2
6584

3873

TeemcA Suara

SPOOLER RUNTIME 48

*RENDER USER

eREND®* USER

*RENGH® USER

eRENDA® USER

AKENDA® USER

xxENOe® USER

*eENDO® USER

#HENOQK® USER

#REND AR USER

*#HENOW® USER

weeENONe USER

axkENDa® USER

*RENDA® USER

wRENDA® USER

xAENDA® USER

aaavonve

MLtS

MLTS

mits

MiTS

MiTS

mits

MITS

M1LIS

MLTS

MITTS

MLTS

MiTs

MITTS

MLTS

MITs

SECONDS, 3140
16090,6000)

(6000, 600)

(6090, 6000)

(6000, 6008)

fo2av, 600y)

(6400, 6000)

(6200,6v00)

[60U0,6v00)

1600@,6000)

{66060, 6000)

Levaa, euve)

(oad, 6v00)

(6000, 6600)

16040, 6000)

(eve, ev4u)

CS,
JoB

Joa

1637 DISK READS,

123 DISK

FS SEQ, 42 DATE 10-SEP-75

SEQ,

SEQ,

sea,

StQ,

Sea,

sta,

SEQ,

Sea,

SEQ,

Stu,

SEQ.

sey,

Sto,

SEO,

4e

4e

42

42

DATE

DATE

DATE

OaTe

GATE

DATE

OATE

GATE

DATE

OATE

DATE

DATE

DATE

DATE

1D=SEP@75

1O-SEP R75

10eSEPeTS

1O@SEP HIS

1G=SEP 67S

10"SEP #75

10-SEP #75

10°SEP 275

LQeSEPe7S

10-SEPe75S

1W°SEP 275

10+SEPe7S

10*SEPR7S

108SEPe75

WRITES,

386 PAGES

09322331 MONITOR ALBUQUERQUE

a9i2et3ay

agieetsy

e9t2e31

e9s2e831

@9s22831

O9i2at51

O9r2et3t

a9seet31

09522351

e9s2e831

09322331

@9s22331

o9322331

O9reer31

MONTTOR

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

MONETOR

MONITOR

MONITOR

MONITOR

AL BUQUERGUE

ALBUQUERQUE

ALBUQUERQUE

ALBUQUERQUE

ALBUSUERQUE

ALBUQUERQUE

ALBUQUER GUE

ALBUQUERQUE

ALBUQUERQUE

ALBUQUERQUE

ALBUQUERQUE

ALBUQUERQUE

ALBUQUERQUE

ALBUQUERQUE

SCHOOLS

SCHOOLS

SCHOOLS

SCHOOLS

SCHOOLS

SCHLOLS

SCHOOLS

SCHOOLS

SCHOOLS

SCHOOLS

SCHOOLS

SCHUOLS

SCHOOLS

SCHOOLS

SCHOOLS

FREFFRRRRRRRFPP
FRFFFFRRRRRFPRE
dddddddedddadad

FFF
FFF
FFF
FFF
FFF
FFF
FREFFFFEFEPR
FREFFFFRFFFF
FRFFRFRRFRFR

ae a
444 444
444 4a4
444 444
aaa 444
aaa 444
a4a4q aaa
444 444
444 444
444 444
444a4agag4gaaaa

4444444644444444

444444404444444
444
444
444
444
444
aag
4aq
444
4a4agq

Sse7b

Sa7B

Soa7B

5e7B

S¢7B

So7B

Sa7B

5076

S076

Sv7B

sa76

5678

Ssa7s

Sa7B

5078

PEEEES SECO SE CRECSSS SEES SECOSES EEG

weENDR®

#AEND RR

*REND HR

weEND OW

wREND On

weEND Ow

eeEND EW

wwENDwn

wRENOR®

wENDan

wRENDa®

REND Ow

weENOne

wrENDaw

wRENOae

Tim

Teeth ByALvA
LPTSPL VERSION 60(344) RUNNING ON LPTO
RSTART* USER HITS [(6000,6000) JUB F4 SEQ, 245 DATE 27"AUGe75 0722323 MONITOR ALBUQUERQUE SCHOOLS 507A *START®
REQUEST CREATED? 27eAUG=75 6311325
FILES OSKBG2F4(6098,6000) CREATED? 27AUGR75 06410102 PRINTED? 27*AUG=75 87223330
QUEUE SWITCHES: /FILESASCII /COPIES$1 /SPACIN /LIMITS468 /FORMS NORMAL,
FILE WILL BE DELETED AFTER PRINTING

¢MEOIUM?
7ON MACHINES
CASSETTES

®

eeeoeeeeee#ee#e#e#8#8f @#8e ¢ @ @© @ @

PUSHEM
PuSnie

PUSHR

STAX
suB
sur
SYNCHK

XCHG

3019
3285
5186
395
4796
5519
6967
6530
6911
7299
49%
ory
7496
Say
4552
3115
52
3159
sve
2945
71971
629
7304
1763
e534
5518
4953
sese
6094
6561
7210
1768
5586
Seed
aro
3019
490
bose
2241
1868
4097

3148
3286
5679
4495
4gue
5576
6149
eee
6930
7333
see
2160
7420

3339

856
3544
6613
4908
1856
1744

1795
2779
3518
ayia
5058
6158
rr)
7270
1798
9590
S4ae
1671
3030
494g
676
2755
1944
4ea4

3216
3347
4055
4656
4927
5073
6515
erie
6967
7419

4309

Teemet Buaran,

MATHPK FOR BASIC MCS 8080
c 23nAUGeod O5t46

eeges1
eeover
ewoeas
veovee
guouse
venues

avovar

GATES/ALLEN/DAVIDOFF MACRO 47(115) 26109 27RAUG=75 PAGE 1

COMMON FILE

aoieo
av2ee
weson
e400
aesou
aveve
ao7ee
eesve
avsve

e110

Meseos
COMMON F

SEARCH
SUBTTL
SALL
LENGTH:
REALTO=1
CASSH=a
LPTSW==0
OSKFUNSs@
CONSSH2=d

CONTRW2=1

ILE

THE UNIVERSAL FILE

7 0 MEANS 4K,

1 MEANS 8K,

2 MEANS 12K

ICASSETTE SWITCH (CSAVE,CLOAD)

JON TO READ/WRITE

FALLOW 7O

MATHPK
c

avovas
avoves
ovowel

FOR HASIC MCS ane
25rAUGR64 OSt46

a120a
e130
ay4e0
e1see
e1680
e170

e1988
ezave
22100
ee2ze0
ee300
weaga
oesva
az600
eez7ea

a2900
03000
03100
e320

es4eo
93500
ese0o
03700

23900
eave
24100
a4ano
24300
aaago
a45ea
a4e0e
a47ee
aaaao
e400
a5000
asivo
as200
05300

GATES/ALLEN/DAVIDOFF

COMMON FILE

asavo
25500
5600
a5700
a5eeo
e590
aeaee
Be109
ae2ve
26300

oo5ue
eooud
26700
96800
26900
e700
7100
arava
07300
arava
a7500

IFE

DEFINE

DEFINE
DEFINE
DEFINE
DEFINE
DEFINE
DEFINE

DEFINE

IFN
DEFINE

REALIU,<
LPTSWa20
CaSseeg
CONSSWe=@
OSKFUNS=a
CONTRW==0>

LENGTH, <
EXTFNCEaQ

STRING#=0
CASSW#a0
LPTSWaso
OSFFUN=20
CONSSWss0
CONTRW==a>

LENGTHe1,<
EXTFNCest
MULOIM==1
STRINGES1>

LENGTHe2,<
EXTFNCSa1
MULOINesS
STRINGS=1>

SYNCHK (A)  <KST
A>

CHRGET, «RST

OUTCHR, <RST

COMPAR, <RST

FSIGN, <RST

PUSHM, <RST

PUSHFN, <PUSHM
PUSHN>

CRLF, <

7013

STRING, <"010>>

PUSHR,<

PUSH oD

PUSH B>

FSIMULATOR DEFAULTS.

7 ON MEANS EXTENDED FUNCTIONS

7 ON MEANS MULTIPLE DIMENSIONED ARRAYS ALLOWED
} GN MEANS STRINGS ALLOWED

MACRO 47(113) @609 27mAUGe75 PAGE 191

DEFINE

DEFINE

IFt,<
IFE
IFE
IFE
IFE
IFN
TFN
TFN
IFN
TFN
PAGE

POPR,<
Por 8

ig o>
MOVRI (By C,D,€)
xMD *U1000,"
exe c

EXP 8

xWO 701000,"
EXP €

exp b>

LENGTH, <PRINTX
LENGTHed , <PRINTX
LENGTH, <PRINTX
REALIO, <PRINTX
REALIO, <PRINTX
CASSW, <PRINTX
LPTSW, <PRINTX
DSKFUN, <PRINTX
CONSSH, <PRINTX

ove1 17 *UXT Be

o@a1 ve "LXE om

/SMALL/>
7MEDIUM/>
7816/>

/SIMULATE/>

7ON NACHINE/>

/CASSETTE/>

/LPT/>

7018K/>

/CONSOLE/>>

MATHPK FOR BASIC MCS BH80

Fa

76
7
78

MATHPK
Fa

129
130
431
132
133
134
135
136
137
138
139
140
14a
142
143
144
145
146
147
148
149
150
151
152
155
154
155
156
157
158
159
160
dor
162
165
164
165
166
167
168
169
170
i714
i7e
173
174
175
176

GATES/ALLEN/DAVIDOFF MACRO 47(113) 06309 27*AUG"75 PAGE 1

mac 23rAUG904 6108 FLOATING POINT MATH PACKAGE CONFIGURATION

oe108
ootee

20160
aia
avage

ooe4a
ov26e

aeovan 90300

a0340
onsee
90580
geage
eeaew
evage
aeaee
aeqea
eesee
oeseo
ees4o
eesen
eosee
eosoe
wvoee
Queso

aurea
ee720
ee74a
aa700

aveeo
aus4a
aused
eeeee
aes0e
oeseo
avs4a
20900
eusea
21000
B1n20
@1040
e186
e1a80
21100
a11ee

SUBTTL FLOATING POINT HATH PACKAGE CONFIGURATION
TITLE | MATHPK FOR BASIC HCS 8@8@ GATES/ALLEN/DAVIVOFF

IFNOEF LENGTH, <
PRINTX 11! MUST HAVE COM 111
END>

8 VALLE ALERT L214
FTHROUGHOUT THE MATHPACKAGE} 1

+Peeo

INTERNAL, ZERO, FLOAT, FLOATR, MOVE, FADD, FADDS,FSUB,FMULT»FDIV, FIN, FOUT
INTERNAL, PUSHF , ABS, INT, GINT, SGN, SQR»RND, SIN, FCOMP, SIGNC, OVERR
INTERNAL INPRT,LINPRT , MOVFM, MOWMF p MOVFR, NOVRF , MOVRM, NEG, INRART, INXHRT
TFN EXTFNC,<

INTERNAL FPWR, EXP,L0G,COS, TAN, ATN, FONE>

TEN MULDIM&<LENGTHea>,<

TFN
INTERNAL,

TFN

INTERNAL FADDT,FSUBT,FMULTT, FOIVT>

IFE LENGTH#1,<

INTERNAL FRWRT>

IFE LENGTH#2,<

INTERNAL VMOVME y VMOVFM, FRCINT, FRCSNG, FRCOBL, VNEG, PUFOUT,DCXBRT, 1ADD
INTERNAL 18UB, IMULT, IDIV, ICOMP, INEG,DADD,0SUB,OMULT,DDIV,OCOMP, INTFNC>

EXTERNAL FAC, FACLO, FBUFFR, MINUTK, PLUSTK, ERROR, OVGERR, ERROV, FCERR, SIGN
EXTERNAL SCODE

IFE LENGTH=2,<

EXTERNAL OFACLO, ARG, ARGLO, VALTYP, THERR, TEMP2, TENP3>

COMMENT %
EXTERNAL LOCATIONS USED BY THE MATH*PACKAGE
THE FLOATING ACCUMULATOR
IFE LENGTHee,<
BLock 1 I (TEMPORARY LEAST SIGNIFICANT BYTE.
OFACLUs BLOCK 4 7 (FOUR LOWEST ORDERS FOR DOUBLE PRECISION
FACLOs BLOCK 3 {LOW ORDER OF MANTISSA (LO)
T(MIODLE ORDER OF MANTISSA (MO)
JtHIGH ORDER OF MANTISSA (HO)
FACs = BLOCK 2 1 (EXPONENT
T(TEMPORARY COMPLEMENT OF SIGN IN NSB
IFE LENGTH=2,<
ARGLOs BLOCK 7 F{LOCATION OF SECOND ARGUMENT FOR OOUBLE
ARG? = BLOCK «1 > 4 PRECISION)
FBUFFRE BLOCK “013 BUFFER FOR FOUT
IFE LENGTH=2,<BLOCK “D<S@e13>>
~

FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACKO 47(113) 96309 27*AUGe7S PAGE te
MAC 23wAUGHO4 BOT08 FLOATING POINT MATH PACKAGE CONFIGURATION

21180

e1e20
e124
21268
e128
21300
o1320
o1s4e
a1300
91380
e14ee
a14eo
ai4aao

e1480
91500
aisee
@1540
91500
21580

a1620

91660
01660
a1700
ai7ee
ai74o
a1760

21800
o1820
01842
016600
a186e
91990
a1920

21960
01980
e200
eevee
a2040
22000
aza8e
2100

THE FLOATING POINT FORMAT IS AS FOLLOWS:

THE SIGN IS THE FIRST BIT OF THE MANTISSA
THE MANTISSA IS 24 BITS LONG
THE BINARY POINT 18 [0 THE LEFT OF THE MSB
NUMBER = MANTISSA * 2 ™ EXPONENT
THE MANTISSA IS PUSITIVE, WITH A ONE ASSUMED TO BE WHERE THE SIGN BIT IS
THE SIGN OF THE EXPONENT IS THE FIRST BIT OF THE EXPONENT
THE EXPONENT IS STORED IN EXCESS 200 I,£, WITH A BIAS OF 200
SO, THE EXPONENT 1S A SIGNED BeB1T NUMBER WITH 200 ADDED TO IT
AN EXPONENT OF ZEKO MEANS THE NUMBER I$ ZERO, THE OTHER BYTES ARE IGNORED
TO KEEP ThE SAME NUMBER IN THE FAC WHILE SHIFTING?
TO SHIFT RIGHT, EXP2=EXP4}
TO SHIFT LEFT, EXP3REXPat

$0, IN MEMORY THE NUMBER LOOKS LIKE THIS?
(BITS 1724 OF THE MANTISSAJ
(BITS 9916 OF THE MANTISSA)
(THE SIGN IN BIT 7, BITS 28 OF THE MANTISSA ARE IN BITS 6-0,
(THE EXPONENT AS A SIGNED NUNBER + 200)
(REMEMBER THAT BIT 1 OF THE MANTISSA I9 ALWAYS A ONE)

ARITHMETIC ROUTINE CALLING CONVENTIONS?

FOR ONE ARGUMENT FUNCTIONS?

THE ARGUMENT IS IN THE FAC, THE RESULT I$ LEFT IN THE FAC
FOR THO ARGUMENT OPERATIONS?

THE FIRST ARGUMENT IS IN BsG.04E ToE, THE "REGISTERS"

THE SECOND ARGUMENT IS IN THE FAC

THE RESULT IS LEFT IN THE FAC

THE "S" ENTRY POINTS TO THE TWO ARGUMENT OPERATIONS HAVE (HL) POINTING TO
THE FIRST ARGUMENT INSTEAD OF THE FIRST ARGUMENT BEING IN THE REGISTERS,
MOVRM IS GALLED TO GET THE ARGUMENT IN THE REGISTERS,

THE "IT" ENTRY POINTS ASSUME THE FIRST ARGUMENT IS ON THE STACK,

POPR IS USED 10 GET THE ARGUMENT IN THE REGISTERS,

NOTES THE "T" ENTRY POINTS SHOULD ALWAYS BE JUMPED TO AND NEVER CALLED
BECAUSE THE RETURN ADDRESS ON THE STACK WILL BE CONFUSED WITH THE NUMBER,

ON THE STACK, THE TWO LU*S ARE PUSHED ON FIRST AND THEN THE HO AND SIGN,
THIS IS DONE SO IF A NUMBER IS STOREO IN MEMORY, IT CAN BE PUSHED ON THE
STACK WITH TWO PUSHM*S, THE LOWER BYTE OF EACH PART IS IN THE LOWER
MEMORY ADORESS SO WHEN THE NUMBER IS POPPED INTO THE REGISTERS, THE HIGHER
ORDER BYTE WILL BE IN THE HIGHER ORDER REGISTER OF THE REGISTER PAIR, I,E,
THE HIGHER ORVER BYTE WILL BE POPPED INTO B, D OR Hy

x
PAGE

MATHPK FOR BASIC MCS 8086 GATES/ALLEN/UAVIDOFF MACRO 47(413) 06329 27-AUGe75 PAGE 2
Fa hac 23rAUG=64 66408 FLOATING POINT ADDITION AND SUBTRACTION

77 @212@ SUBTTL FLOATING POINT ADDITION AND SUBTRACTION
116 gaia FENTRY TO FADD WITH POINTER TO ARG IN CHL)

179 990004" @e1o8e ava0a1 @2160 FADOHs LXI Hy PHALF GENTRY TO ADD 172

160 eveni? Boenve avesie?

181 @vapve* eyovee aeR000

182 @90905" Baiove gv0515 @2180 FADDSs CALL MOVRM GET ARGUMENT INTO THE REGISTERS
163 ge904? vavana aeieds?

164 992" Baevee guava?

185 Bonar’ Beivas geeses e2200 np Fano 100 THE ADDITION

186 60409/" dovave evaves?

187 ava1e' aaodeg eeovede

188

169

190 HSUBTRACTION FACS SARG@FAC

4191 IFN EXTFNC,«

192 ooeM11" Botovd @va315 FSUBSt CALL = MOVRM> FENTRY IF POINTER TO ARG IS IN (HL)
195 eveie’ oeoeae evieds?

194 909@15* asec eeeou7"

195 Ire LENGTHet,<

196 Bowe14* Boles goovaL xWO 1000,041> W"LXI HM AROUND NEXT 2 BYTES

197 LENGTH=2,<

198 @ave1>* Gntewo avasar POPR> FENTRY IF ARGUMENT IS ON THE STACK
199 Beeeio’ Beieed eeo521

200 @aaa1T* Bai000 ovasi5 CALL NEG FNEGATE SECOND ARGUMENT

201 Gaanew’ Beovea oui1i75°

2€2 eeoser* aevere avoviet

203 FALL INTO FADD

204

25

206 FADDITION FACT EARG#FAC

207 PALTERS A,8,C,0,E,H,U

208 IFN LENGTHw2,<

209 envaee? bolese aveea xWO 1008,041 #"LXI _H® AROUND NEXT 2 BYTES
210 aces" eoleee avose1 FaDoT: POPR> VENTRY IF ARGUMENT IS ON THE STACK
211 odad? opieea ecoser

212 00922" eoleea avo170 Faoo: MOV VCHECK IF FIRST ARGUMENT IS ZERO
213 a00026* Bp1000 aooeE7 ORA GET EXPONENT

214 eovee7? e100 ovosie RE HIT 18, RESULT 1S NUMBER IN FAC
215 eva030* eo10ee ovvere Loa GET EXPONENT

216 800031" agoaee aeaeoex

217 @ea3e" Boaeee suave0"

218 000935" eaiv00 avve67 OR 1SEE IF THE NUMBER IS ZERO

219 04934" Baioae ovoste Rr FIT IS, ANSWER IS IN REGISTERS
228 000039" eavee av1e2s*

221 00036" egeeee aneesi*

eee

ees @2720 jE WANT TO GET THE SMALLER NUMBER IN THE REGISTERS SO WE CAN SHIFT IT RIGHT
2e4 @274@ — FAND_ALIGN THE BINARY POINTS OF THE TWO NUMBERS, THEN WE CAN JUST ADD OR
225 @2760 SUBTRACT THEM (DEPENDING ON THEIR SIGNS) 8YTEWISE,

226 0ve037" aeieeo evoeee ee7ee sub 8 FCHECK RELATIVE SIZES

227 eeenau" Bo1eoo ovosee ae800 INC Faout HIS FAC SNALLER?

228 800041" Baeene avousT*

229 ovan4e" Bpoeee aeaus5?

WPK FOR BASIC MCS 8060 GATES/ALLEN/UAVIDOFF MACKO 47(115) 06309 27*AUGe75 PAGE ent
Mac 23-AUG@64 26108 FLOATING POINT ADDITION AND SUBTRACTION

230 009945" @a100e ooees7 o2se0 CHa YES, NEGATE SHIFT COUNT
231 200044 aol000 goau74 ees4a INR

232 000045" ag1¢ae ovO353 ee8eo XCHG TSWITCH FAC AND REGISTERS, SAVE (DE)
233 @oanae* agicd0 ov231> ae86a CALL, }PUT FAC ON STACK

234 aavoa7? eaeaoe eres?

235 000959" ea000e weaoait

236 B8p51* Boleve Bu_S53 w2909 XCHG 7GET (OE) BACK WHERE IT BELONGS
237 eeaose? avieee av0315 ease CALL WPUT REGISTERS IN THE FAC

236 002055" agveee aviees?

239 900954" Boeeee aeav4a7*

240 080655" Be1e02 ovas01 aeo4o POPR WGET THE OLD FAC IN THE REGISTERS
241 ease? ooieee avasat

242 oeeasT? @2900 = FADDI:

243 @2980 «TFN LENGTH) <
244 00057" Bpleae geasTe aseve cPr
245 e060" eeavee 20003)

246 G00061" @e1ee0 evasee 3020 RNC> INO, ALL DONE
247 000962" wo1000 g00s6> a3e4a PUSH PSW VSAVE SHIFT COUNT

248 Geve63" Baica2 evos15 e300 CALL UNPACK TUNPACK THE NUMBERS

249 000064" Beovee ov1eTe*

250 000065" eaeoDe ovovss*

251 @0a966" Bei9ee aeo1a7 Mov HA TSAVE SUBTRACTION FLAG

252 00067" Baieee poas61 POP PSW GET SHIFT COUNT BACK

253 Gv0e70" Bo1eee ovo315 CALL SHIFTR SHIFT REGISTERS RIGHT THE RIGHT AMOUNT
254 990071" pooee a00334°

255 @vaa7e? agonee oeaa—a*

256

257 VIF THE NUMBERS HAVE THE SAME SIGN, THEN WE ADD THEN, IF THE SIGNS ARE
256 TOIFFERENT, THEN WE HAVE TO SUBTRACT THEM, WE HAVE TO DO THIS BECAUSE THE
259 IMANTISSAS ARE POSITIVE, JUDGING BY THE EXPONENTS, THE LARGER NUMBER IS IN
260 TTHE FAC, SO IF WE SUBTRACT, THE SIGN OF THE RESULT SHOULD BE THE SIGN OF THE
261 TPAC? HOWEVER, IF THE EXPONENTS ARE THE SAME, THE NUMBER IN THE REGISTERS
262 FCOULD BE BIGGER, SO AFTER WE SUBTRACT THEM, WE HAVE TO CHECK IF THE RESULT
263 TWAS NEGATIVE, IF IT WAS, WE NEGATE THE NUMBER IN THE REGISTERS AND

264 TCOMPLENENT THE SIGN OF THE FAC, (HERE THE FAC IS UNPACKED)

265 VIF WE HAVE TO ADU THE NUMBERS, THE SIGN OF THE RESULT IS THE SIGN OF THE
266 IFAC, 80, IN EITHER CASE, WHEN WE ARE ALL DONE, THE SIGN OF THE RESULT

267 WILL BE THE SIGN OF THE FAC,

268 cvve7S* eoteae evoeEd ORA 4 GET SUBTRACTION FLAG

269 ge0074" ee1oe0 guaeai xr Hy FACLO SET POINTER 10 Lofs

27@ 0007S" eaeeeD Beovoo%

271 g00076" Boe0e0 aeav71*

272 Go0077" ee1cee vovsee ap FADDS PSUBTRACT IF THE SIGNS WERE DIFFERENT

273 00100" eoees ove1e>°

274 e101" Bveeee aeoe7s*

275 gev19e? Bo1ede Bvesis FADDA FADD THE NUMBERS

276 00103" Beov—e avee74e

277 eo1es? oaovee avaivor

278 0195" Beicae avasee RUUND FROUND RESULT IF THERE WAS NO OVERFLOW

279 Geeiao’ eeevee ovaess*

26@ 900107" woeere avalos?

261 }THE MOST IT CAN OVERFLOW IS ONE BIT

262 a00110" Beivas avao4s VTHERE WAS OVERFLOW

31 PARE WE WITHIN 24 BITS?

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06209 27=AUG#75 PAGE 202
Fa Mac 23eAUGHO4 26108 FLOATING POINT ADDITION AND SUBTRACTION

263 09111" ve1000 avaved ass20 INR ” INCREMENT EXPONENT

264 evita’ Ceia00 avoste 03540 fra OVERR FCHECK FOR OVERFLOW

285 aen115* eevee avaze7?

286 000114" aavoee evare6?

287 05500 LENGTH, <«

268 e3580 CALL SHFTRO> SHIFT RESULT RIGHT ONE, SHIFT CARRY IN
289 ase00 LENGTH, <

290 ee0115" Beles evaese e620 MI bet SHIFT RESULT RIGHT ONE, SHIFT CARRY IN
291 00116" oecooe goaeer

292 evv117" Bata avasis @56a0 CALL © SHRADD>

293 ova120" eaeesa avascet

294 ov121" Beoeee 00113"

295 ge012e* wa1eme ava3s0s @3660 IMP ROUND TROUND RESULT AND HE ARE DONE

296 ewv12s* eves avee3s*

297 000124" aeeows eoeree’

298 a3680 THERE TO SUBTRACT C,0,E,B FROM ((HL)40,4,2) 90

299 @00125¢ Be1e09 oveesT 93700 ADDS: XRA FSUBTRACT NUMBERS, NEGATE UNDERFLOW BYTE
300 880126" opie aoeeed e372e $uB
301 ee0127" Colvoe ove1a7 e374 mov
302 000130" eAlose BveiTe 03760 Mov
303 000131" Opia9 aveess 03780 $88
304 200132" wolewe 900137 @3e0e mov
305 000135" valoda avecas 3820 TNX
306 800134" Belo Bee176 03840 Mov
307 @00135* Ori1900 Gooese 03868 $88
308 900136" aplove goe127 03860 Mov
309 240137" Bales ovacas as9ee INx
312 900140" Baleea ova176 03920 mov
311 @vo141" Belgas aoeesd @3940 $58
312 00142" Beioee ove1i7 03960 mov A

313 03980 FBECAUSE WE WANT A POSITIVE MANTISSA, CHECK IF WE HAVE TO NEGATE THE
314 eaoaa J NUMBER

315 000145" oe1eae on0334 e420 FADFLT: Co NEGR ENTRY FROM FLOATR, INT# NEGATE NUMBER IF IT
316 @0144" eeeces eeosie*

317 @9e145" epee avores?

318 eaaae } WAS NEGATIVE, FALL INTO NORMALIZE

319

320

a1 a4100 FNORMALIZE C,D/E,8

3ee aaiea ALTERS AyB,C,D,E,MyL

323 oaiao SHERE WE SHIFT THE MANTISSA LEFT UNTIL THE MSB IS A ONE,

324 e4ioe EXCEPT IN GK, THE IDEA IS TO SHIFT LEFT BY 8 AS MANY TIMES AS

325 4180 POSSIBLE,

326 oevrder eaaeo

327 eaaeo LENGTH, <
328 o42ao MVI Ha #CLEAR SHIFT COUNT

329 e4a6e Mov Ac 1S THE NUMBER NORMALIZED?
330 aa2se ORA a

331 a4300 aH ROUND TYES, WE ARE DONE

332 @4328 NORM2s CPI 340 18 THE RESULT ZERO?

333 ea3ae vz ZERO HYES, ZERO THE FAC

334 04360 ocr 4 JNO, DECREMENT SHIFT COUNT
335 04360 mov LT) FSHIFT THE LO LEFT

SAVE IT
ISUBTRACT LOW ORDERS

JUPDATE POINTER TO NEXT BYTE
FSUBTRACT MIDDLE ORDERS

JUPDATE POINTER TO HIGH ORDERS
FSUBTRACT HIGH ORDERS

oor xcorimm>ce>

FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 6309 27=AUGeTS PAGE 203
Mac 23eAUGeod 6108 FLOATING POINT ADDITION AND SUBTRACTION

o4avo apo a SHIFT IN A ZERO
aged mov By A
eaaaa CALL «= SHFTLO SHIFT THE REST OF THE NUMBER LEFT ONE
e4460 Mov Aye JGET THE SHIFT COUNT
aaaea JP NORMa> FCONTINUE IF NUMBER IS NOT NORMALIZED
@4see IFN LENGTH, <
00146" e108 verso 4520 Nov LB PUT LOWEST 2 BYTES IN (HL)
@v0147* Oeiede oee14s 04548 mov He
@00150" Bove evees7 a45ea XRA A #ZERO SHIFT COUNT
00151" egieaa vere? 04580 NORMI: MoV B,A SAVE SHIFT COUNT
@0152" Ooieea aeei71 04600 Nov ie 400 WE HAVE 1 BYTE OF ZEROS
020153" Be1ece enoz67 o4eeo ORA A
040154" oo1000 aaeaa INZ NORMS NO) SHIFT ONE PLACE AT A TIME
290155" oeeoee Ul
20150" Baeeee averaae

04660 THIS LOOP SPEEDS THINGS UP BY SHIFTING 8 PLACES AT ONE TIME
#00157" Cotoe evorre ouobe Mov c,0 YES, SHIFT OVER 1 BYTE
@@0160" aeivee evoled e47eo mov OH
@ee161" aaivoa aeaias earee Mov Heb
@e016ee? @eiooe 000157 a474a Mov be SHIFT IN 8 ZEROS FOR THE LOW ORDER
@@0165* eeieae ov0i70 24760 Mov ArB VUPDATE SHIFT COUNT
00164" Bo1ea0 eeeseo a478a sur 10
080165" Boa000 evov1e
200160" Co1e09 av0376 e4ec0 crt 340 FOID WE SHIFT IN 4 BYTES OF ZEROS?
@ani6e7* anaes eeosae
820170* 01008 e302 ease JNZ INO, TRY TO SHIFT OVER 8 MORE
eee171* eooeee gveisi*
@ee17e? oo0000 evai5s*

o4saa YES, NUMBER WAS ZERO, FALL INTO ZERO

a4se0 ZERO FAC
wagee FALTERS A ONLY
aas4e EXITS WITH Azo
a49ea }6Y OUR FLOATING POINT FORMAT, THE NUNBER IS ZERO IF THE EXPONENT IS
a4geo 4 ZERO
000175" Go1009 evnesT 95000 ZEROS = XRA cy ZERO A
ba1T4* eeivea Beavee @5920 © ZEROA; «STA Fac VZERO THE FAC*S EXPONENT, ENTRY IF Aso
@88175* Beoued eLOe31»
999176" eavooe Beo1TI*
ovai77" erie a@asit aso4a RET TALL DONE

eareav? esivas ovoves 05100 NORM2s FOECREMENT SHIFT COUNT
euaani? aeivas eeousi os120 FROTATE (HL) LEFT ONE, SHIFT IN A ZERO
Ban202" Baivas oeniTe aside FROTATE NEXT HIGHER ORDER LEFT ONE
@e0203" oaieos wooveT @5168

eeo2a4* oie evo1e7 05160

900295* goiced oeai7i 25200 JROTATE HIGH ORDER LEFT ONE

@ve2de’ aoieaa weer? as2ee SET CONDITION CODES

@ee2a7* Googe vaii7 aseaa

Bae2ie' goioss Bes6e @5260 © NORMS+ JWE HAVE MORE NORMALIZATION TO DO
@00211" apavos evaeou"

MATHPK FOR BASIC NCS 8080

Fa

389
390
391
392
393
394
395
396
397
398
399
4a
4e1
aoe
403
404
4e5
406
407
4e8
409
410
ait
a2
a3
aia
415
416
47
418
419
420
424
422
4e3
424
aes
426
427
az8
429
430
431
432
433
434
435
436
437
436
439
aaa
aay

MATHPK
F4

44a
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
46a
44
doe
463
464
465
466
467
4e8
469
470
471

a7e
473
474

475
476

477

478
479
abo
get

462
483
484
485
486
487

488
489
490

491

age

493

ava

Mac

ooeaie’
weveist
@aoaiae
eonais?
aea2iet
oonaiit
aeo2ee"
oavaai?
wovaeer
eovaes?
eepaage
guoees?
Qodaao
eonaart
ovva3ar
aoo2sit
oonaser

aov23s?
oueas4?
weeasse
Bav23er
gea23r?
CG
eeoedit
oov2der
oooaase

aevaaar
eevadse
oeeeder
eovaare
eavese?
aevasi?
eovase?
Bovasst
vooesd’

FOR BASIC MCS 80860
Mac

owvesst
eagaset
ovoas/t
eevee"
@vee2ei"
gooe2ee?
aev2es?
weeasae
oov265¢
eevace’

oae267"
aoa270°
eoee7i"
owoe7er
oooa7s?

wonarae
eavars?
@avaTot
ovoa7Tt
eou3ae"
avose1"
oaa3soe"
eeo3as*
ooaspae
eeo3aa"
evesper
eve3ore

CES
oonsii?
ooosier
eoosise
oeasiae
ae0s13¢

23RAUGHO4 06408

epee0ee
epinee
ee1ens
@e1000
eo1ece
eo1eea
eovv0e
eaaeeo
ea1eeo
aevean
eaeves
Qa1000
eo1000
901000
eeovad
eevee
901000

@o1eoe
oa1ea0
eoveco
aevcen
ea1eeo
Go1000
apeeoe
ea0e00
eo1eee

CO
ee1cao
ee10eo
CE
ae1ceo
ee1000
eetees
aeeoae
eooeas

geei75*
Beei7e
900134
eeoies
eeeeo?
oeosie
oeoess?
auoeri?
ooov4i
aoa175*
ouoe2e"
avazae
9ea167
ovasee
@ea173¢
avoees?
ee0310

aoe17e
oaaeas
pueeess
weoese?
gudeor
920374
eveess?
aveess*
300106

ecouas
Qo0176
aeosae
avozee
oooes)
900117
900303
ooiees?
aoaedi?

25wAUGwO4 6108

@o1000
Be1eae
eo1eaa
wo1eeo
Bo1eee
eoieae
eo1eee
eaooaa
@21000
eareus

@areve
waaoan
eo1e00
@ooeae
eooven

Ge1e00
eaieao
Baieaa
eieus
eeieoo
®o1e00
ooteue
eo1e00
301000
eeieeo
@aieeo
aoieoo

eeieeo
600000
eova0
01000
eo1e00
aoa

eonus4
en0sae
avavea
ovasae
aeoe14
avosoe
@ae16
aoozee
ooaved
gopsae

eeouse
avaveds
avoses

oueoaux
oooess*

oua176
oosees
000137
gages
900176
aerate
eater
ovougs
900176
gevett
oeoii7
900511

goo041
avoueis
gevere?
avei7e
ovges?
aeaie7

GATES/ALLEN/DAVIDOFF MACRO 47(113) 0

9 2T*AUGHTS PAGE 2n4

FLOATING POINT ADUITION AND SUBTRACTION

5200
05300
05320
25340
05360

as3e0

as4ava
as42o
esaaa

as4ea
a5480

essa
25560
a55e0
a5600
e5620

a5e40
25660

aseso
95700
e5720
25740
os760,

as7ee
25800
asseo

aseea
05900
asveo
25940
05960
05980
veoea
aeaea
aoa

ROUNDS
ROUNDB?

IFE

SHFTLO?

ov i) PALL NORMALIZED, GET SHIFT COUN
mov E,W PUT LOS BACK IN E,B

Mov Bek

ORA A CHECK IF WE DID NO SHIFTING

az ROUND>

Lxr HyFAC ” FLOOK AT FACS EXPONENT

Apo M UPDATE EXPONENT

Mov Mya

NC ZERO CHECK FOR UNDERFLOW

RZ NUMBER IS ZERO, ALL DONE

FALL INTO ROUND AND WE ARE DONE

FROUND RESULT IN C,0,£,8 AND PUT NUMBER IN THE FAC
FALTERS A,8,C,0,E,4,U
JHE ROUND C,0,E UP OR DOWN DEPENDING UPON THE MSB OF B

Nov AyB ySEE IF WE SHOULO ROUND UP
UxI He PAC FENTRY FROM FOIV, GET POINTER TO EXPONENT
ORA A

cm ROUNDA 400 IT IF NECESSARY

tov Beh PUT EXPONENT IN 8

JHERE WE PACK THE HO AND SIGN

INK H POINT TO SIGN

MOV A 1GET SIGN

ANI 200 GET RID OF UNWANTED BITS
XRA c PACK SIGN AND HO

Mov yA SAVE IT INC

IMP MOVER SAVE NUMBER IN FAC
LENGTH, <«

SHIFT C,0,E LEFT ONE
THIS IS USED BY NORMAL, FOIV

FALTERS A,C,0,E

Mov AYE GET THE LO

RAL, SHIFT IT

Mov EyA TSAVE IT

Mav Ayo HSHLFT THE NEXT HIGHER ORDER
RAL

GATES/ALLEN/DAVIDOFF MACRO 47(113) 6109 27~AUGe75 PAGE 295

FLOATING POINT ADDITION AND SUBTRACTION

Beer
Bese
eo1aa
ve12d
e140

ae200
oo2ee
ae240
ae260
aeeeu
a6300
wo3se0
e6340

Be30u
26380
ae4oe

aesay
96460

ao4aee

aesae
26560
36580
26600
a6620
aeede
6660
e680
06700
ae720
96740
06760
oe78a
aoae

96860
eosee
06900
ao920

ge94a
ae9ee
ao98e

ROUNDAS

OVERR?

FADDAt

NEGRE

mov O,A
Mov AYC }SHIFT THE HIGHEST ORDER

aoc & FROTATE A LEFT AND SET CONDITION CODES
Mov Cry

RET> TALL DONE

#SUBROUTNE FOR ROUND? ADD ONE TO C,D,E

INR (i TADD ONE TO THE LOW ORDER, ENTRY FROM QINT
RNZ FALL DONE IF IT IS NOT ZERO

INR D 7ADD ONE TO NEXT HIGHER ORDER

RNZ TALL DONE IF_NO QVERFLOW

INR c TADD ONE TO THE HIGHEST ORDER

RNZ TRETURN IF NO OVEFLOW

MV C,200 TITHE NUMBER OVERFLOWED, SET NEW HIGH ORDER
INR 4 TUPDATE EXPONENT

RNZ JRETURN IF IT DID NOT OVERFLOW

FIT O10, FALL INTO OVERR

FOVERFLOW ERROR

MV E,ERROV FSET OVERFLOW ERROR CODE

MP ERROR yG0 TO IT1h

FADD (HLI42,1,0 TO C,D,E
#THIS CODE IS USED BY FADD, FOUT

NOV AyM HGET LOWEST ORDER

apd e yaDD_IN OTHER LOWEST ORDER
MOV EyA SAVE IT

INK H FUPOATE POINTER TO NEXT BYTE
mov aM FADO MIDDLE ORDERS

auc 0

Mov DyA

INx 4 JUPOATE POINTER TO HIGH ORDER
mov AM YADD HIGH ORDERS

AoC c

hoy Cha

RET FALL DONE

JNEGATE NUMBER IN C,0,E,6
THIS CODE 18 USED BY FADD, GINT
FALTERS &,B,C,D,E,L

uxt Hy PAC#L INEGATE FAC
MoV AM +GET SIGN

CHA TCOMPLEMENT IT
MOV Mea USAVE IT AGAIN

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/VAVIDOFF MACRO 47(113) 063

9 27AUGH75 PAGE 2n6

Fo Mac 23wAUGHO4 Oo7U8 FLOATING POINT ADDITION AND SUBTRACTION
495 00316" Bp1ve0 enoeST e7ave XRA N ZERO A
496 00317" eo10ee 800157 are2a mov ory HSAVE ZERO INL
497 Bons2u" Boleve aveeed 97040 SuB 8 JNEGATE LOWEST ORDER
498 00321" woleme goa107 27000 Mov cry HSAVE IT
499 900322" @plvee gua175 a7080 Moy Ark GET A ZERO
Seu 000323" Baived aoeess a7100 S88 E JNEGATE NEXT HIGHEST ORDER
301 000524" Belvee B0013T e720 Mov E,A SAVE IT
5@2 ouMs25" ea10e0 BB0175 07140 Mov Ark GET A ZERO
583 900520" eaio00 Bveese a7160 SBB 0 INEGATE NEXT HIGHEST ORDER
5@4 gavsert egieao gvo1e7 07160 Mov DyA TSAVE IT
5@5 @0n330" eaie00 oea175 e7200 Mov Ark 1GET ZERO BACK
506 000331" Bg1000 Boaest e72ee S68 c INEGATE HIGHEST ORDER
507 000332" eaieee avait? a7ede Mov CA SAVE IT
508 400335" agivee evasii o7200 RET TALL DONE
509
510
511 o7see SHIFT C,0,€ RIGHT
512 o734e VA = SHIFT COUNT
513 07360 FALTERS A,B,C,0,E,L
514 07580 JTHE IDEA (EXCEPT IW 4K) IS TO SHIFT RIGHT 6 PLACES AS MANY TIMES AS
515 e7aeo 7 POSSIBLE
516 @00334" aolove eaves a742@ © SHIFTR: MVI 8,0 FZERO OVERFLOW BYTE
S17 980335" Beoowo evecee
518 o744@ FE LENGTH, <
519 e7460 INR A> VADD ONE TO SHIFT COUNT
see 07480 IFN LENGTH, <
d21 000330" woluee Bvose6 97500 © SHFTRit SUT 10 TCAN WE SHIFT IT 6 RIGHT?
S22 00337" vpoove weav1e
523 0340" Go1eea aeos32 a75e0 uc SHFTR2 NO, SHIFT IT ONE PLACE AT A TIME

524 000341" Baoeee evess3*
525 00342" aadov0 80311"

526 27540 THIS LOOP SPEEUS THINGS UP BY SHIFTING 8 PLACES AT ONE TIME
527 000345" Bo1eea avalos a756e Mov BE VSHIFT NUMBER { BYTE RIGHT

526 020344" wolewe ovaise a75680 Mov E,0

529 0345" aoieen eooiet a7608 Mov b,c

530 000346" eoioue @eav1e a7e2e MVE co 1PUT @ IN HO

$31 00347" 0000 eoavaD

532 000350" Boleen ovasa3 area ne SHFTRI TRY TO SHIFT 8 RIGHT AGAIN

533 000351" Beov00 an0336°
534 90035e" weaaee Beusait

535 000355" e91002 Beasa6 @766@ © SHFTR2t ADI i> HCORRECT SHIFT COUNT

536 00354" Gaeaee avao1t

537 00355" vaieeD 400157 e768 Mov La VSAVE SHIFT COUNT

538 000356" Ba1ea0 ovaesT @7720 © SHFTR3: XRA ry FCLEAR CARRY

539 0035/7" eaiva0 ovawss o7tea ocr t TARE WE DONE SHIFTING?

544 ano3eu' ealeae avasid e774e RZ PRETURN IF WE ARE

541 a77ee = IFE LENGTH, <

sae @778@ © SHRADV} CALL — SHF TRO> JSHIFT THE NUMBER RIGHT ONE
543 a7aa@ TFN LENGTH, <

544 900361" waives eee171 a7e2e Mov Arc 1GET HO

545 vase" Boigea evaLs/ @784@ © SHRAOD? RAR VENTRY FROM FADO, SHIFT IT RIGHT
546 30v365" @aiae0 auaitT 07860 Mov cya SAVE IT

547 200364" eaiean ave17e 47880 Mov rv) SHIFT NEXT BYTE RIGHT

MATHPK FOR BASIC MCS B08@ GATES/ALLEN/DAVIVOFF MACRO 47(115) 06309 27AUGH75 PAGE 297
Fa mal

23eAUGR64 6108 FLOATING POINT ADDITION AND SUBTRACTION
548 00365" doves ab0037 27900 RAR
549 200366" oo1e00 oeo127 a79e0 Mov yA
350 00367" Yo1oee wBuaiTS 27940 Mov AYE TSHIFT LOW ORDER RIGHT
551 0370" Golvee oeovsT 27960 RAR
552 00571" Boleea Bu0137 27980 mov EA
553 00372" Yvivee vueiTo asoue Moy ArB FSHIFT OVERFLOW BYTE RIGHT
554 000373" goiees eva037 eeceo RAR
555 200374" Yolwee 2ve107 abode Moy By A>
556 000375" aaia09 000303 28060 IMP SHFTRS TSEE IF WE ARE DONE

557 000370" aoowes ae0356°
558 900377" aooean ge0s51°

559

560

Sot osi2e  IFE LENGTH, <

5e2 e614e TSHIFT C,D,E,8 RIGHT ONE

5e3 08160 THIS 18 USED BY SHIFTK, FMULT, FADD

Seq os1ee FALTERS A,B,C,0,E

5e5 8200  SHFTRO: MOV AWC GET THE HO

566 @622@ © SHFROA? RAR VSHIFT IT RIGHT, ENTRY FROM FMULT
567 asada MoV aay

568 os200 Mov Lv) TSHIFT THE MO RIGHT

569 os28e RAR

570 oe3see Mov DA

S71 o8320 Mov AYE SHIFT THE LO

S72 98340 RAR

573 28360 Mov EA

$74 ase MOV AB VSHIFT THE EXTRA LO BYTE
575 weave RAR

576 aeaeo Mov BA

S77 ae4aa RET> TALL DONE

578 08400 = PAGE

MATHPK FOR BASIC MCS B080 GATES/ALLEN/DAVIDOFF MACRO 47 (113) 06209 27"AUG=75 PAGE 3
Fa Mac 23nAUGro4 6108 NATURAL LOG FUNCTION

379 98480 © SUBTTL NATURAL LOG FUNCTION.
580 aeseo IFN EXTFNC,<«

581 eesee CALCULATION 18 By?

582 rer) 7 LN CPR2°N) 8 (NFLOG2 (F)) #LNC2)

583 08560 TAN APPROXIMATION POLYNOMIAL IS USED TO CALCULATE LOG2(F)

58a

585 a8ove CONSTANTS USED BY LOG

386 evv4av' oeoves avavno @8620 FONES 00 pet

587 o00401" Boecee aeavod abeue 08

588 epe4ae’ BaveeD avaLed 06669 00

589 200405" BaneAD avazer a668o 201

590 @v0404" goeede gvove3 as7ee 3 HDEGREESL

591 e@9405° voavaa avoese are ese 4 @,598978650

592 evo4ne" oavees cvaiz6 aa74e 126

593 ovaaa7’ aoeooa aveesi o87ee 31

594 eeaaier apaees seaezer 8780 200

595 8411? epeece a00361 98800 Sot 0, 961470632

59 eodie? dove aveude essed ae

597 820415" eoevse Bea166 - 98842 166

598 e8aa14 egand aveeae 08860 200

599 ais? Bowven auoras e880 105 2,88539129

622 evaater Banvoa avaese e89u0 ase NOTE? THE REFERENCE FOR THIS CONSTANT HAS 100 NOT 105
6@1 aena1/* Maeve geav70 es9a0 a70 IN THE LOW GROER BYTE,

2 ovaa2v’ vaeaa avaeve 28940 ave

603

604 00421" oe1000 e0ess7 ae98a FSIGN CHECK FOR A NEGATIVE OR ZERO ARGUMENT
6@5 evoaze’ vaio geasse evave PE FCERR IFAC LE, ©, BLOW HIM OUT OF THE WATER
606 Be0425" Bedvea eHounu®

607 avsaad* aaenna 900376"

608 e9e20 JFSIGN ONLY RETURNS 0,1 OR 377 IN A
609 29900 ITHE PARITY WILL BE EVEN IF A HAS @ OR 377
610 eeuaas? eee avevar ave6n Hy FAC GET POINTER TO EXPONENT

611 ova26’ avee0 eoees5«

612 eaa427* avons gvades?

615 e043" Goiged eu0176 09080 AM GET EXPONENT IN A

614 80431" Beloved goavar 9100 200,065,004,363 }GET SQR(,5)

615 evo4se’ Beoowe evaves

616 097433" Onova aoweed

617 09934" BaiveH Goovel

618 080435" verve e00s63

619 90436 aoeeen ovovad

620 Me043T* oicva avae2d REMOVE EXCESS 200

621 ee4ae* eeiov avaseS SAVE EXPONENT FOR LATER

622 eveaai’ vais gov160 SET EXP TO 200, RESULT IS NUM IN (,5)1)
623 eveaae? vaio aveses FSAVE SGR(,5)

624 0445" Balan av0305

625 o8ea4a? goigea ov—s15 CALCULATE (FeSGR(,5))/(F#SGR(,5))
626 eee44s’ Boaroo avoeas?

627 e@voa46" Baa Bvodeo"

628 e00a4/" veined avas01 1GET SQR(,5) BACK

629 ee0a5e’ weigea avosaL

630 900951" vaio avaved 1GET saR(2)

631 eavase’ veioee av0515 JWHERE P#NUMBER LEFT IN FAC

HPK FOR BASIC MCS 8084 GATES/ALLEN/OAVIDOFF MACRO 47(113) 06109 27"AUGR7S PAGE 31
Mac 23rAUGeO4 Bb1Bd WATURAL LOG FUNCTION

632 900455 doaees weoess*
633 @v0454" BoaneB avo4as*
634 99455" Baleae Buavad aszee Hy FONE TTHE CALCULATION 1S EGUIVALENT TO THE ABOVE,
635 e@ve4se* Beoa0e ano4ea"
636 evn4sT? ogveea aBoKss*
637 99460" Gaivaw gv0515 a93¢0 FSUBS 1 BUT DONE IN A DIFFERENT ORDER
636 Bv4e1" avve0 gvov11e
639 @vede2" Baneea ana456°
648 200465" waivae Guava a93e0 H,LoGcNa VEVALUATE APPROXIMATION POLYNOMIAL,
641 900464" Geveve goa4e4"
642 40465" epaeea ovodei"
643 929466" Be1g00 ava3s15 a934o PULYX
644 0467" wavered avebis*
645 a00470" aaveva Boa4ed?
646 ea0471" ea1eee woouer a93e0 200,200,000,008 1GET #1/2
647 evaTe? weveer Booeae
648 980475" Gaaean nedeou
649 owo474? aoiven eoovar
650 960475" BooPee aooved
651 00476" Bpoeae avovse
652 un477? Boleod eves15 o93ee CALL FADD FADD IN LAST CONSTANT
653 9easev’ ooveee gaoves?
654 90501" Boooue ovo467*
655 avn5ue" Beleen avaser a94e0 PoP PSW FRETRIEVE ORIGINAL EXPONENT
656 00505" weloao oo4en CALL = FINLOG FADD IT TO ORIGINAL NUMBER
657 000594" epeveo
658 a005a5" Bao000
659 8a5n6? Bo1200 09440 MULLN2? MOVRI 200,061, 162,030>7GET LN(2)
66a evesa7* woocer
661 200510" Baa000
662 900511" Galvee
663 0512" Hoover
664 900515" Boeean ave1oe
665 a94og PMULTIPLY BY LN(2)
a94ea

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/UAVIDOFF MACRO 47 (113) 06209 27-AUGe7S PAGE 4
Fa Mac 23mAUGro4 6108 FLOATING MULTIPLICATION AND DIVISION

667 99500 SUBTTL FLOATING MULTIPLICATION AND DIVISION

668 a9seo TMULTIPLICATION FACES ARGHFAC

669 99540 FALTERS A,B,C )D,E,HyL

670 @9500 IFE EXTFNC,<

674 09560 FMULTS: CALL MOVRM> ENTRY WITH POINTER TO ARG IN (HL)
672 a9600 IFN LENGTH=2,<

673 220514" 91000 eoow4d 99620 XW 100,041 7"LX1_ HM" AROUND NEXT 2 BYTES
674 99515" epivea evasat 99640 FMULTT: POPR> ENTRY IF ARGUMENT 18 ON THE STACK
675 ea0516" Goines ovaser

676 eOdSi7? Gp1e20 000357 09660 FULT? FSIGN JCHECK IF FAC IS ZERO

677 aa052u" aaicae evasie 09680 RZ IF IT 18, RESULT IS ZERO

678 00521" voices avonse 09700 Myr Lie VADD THE THO EXPONENTS, L IS A FLAG.
679 aee52e" Baeeds neocaa

68a 00525" waives 908315 a9720 CALL «= MULDIV iPIX UP THE EXPONENTS

681 ev0se4* weve gu1Ess®

682 a0a525* apeeda aoasua?

683 ag74a SAVE THE NUMBER IN THE REGISTERS SO WE CAN ADD IT FAST
684 avns2e" vaio guai7s 09760 MoV a,c GET HO

685 va5e/* Bailes Booeee 09780 STA FRULTASL FSTORE HO OF REGISTERS

686 20530" aeev— gvoeGe*

687 00531" Ba0ed0 goosear

688 0a532¢ BA1e00 B00555 a9eeo XCHG STORE THE TWO LO*S OF THE REGISTERS
689 900535 Baloea avavae a9e20 SHLD = FRULTB#1

690 200534" Baeees ovacait

691 090535" wadvee geesse*

692 880536" co1gae avout a9aae Lxr B, SCODE ZERO THE PRODUCT REGISTERS

693 000537" aaece aeavars

694 e0a5ae* Goenoa av—534"

695 eeu541" Bele ovai2d 29860 mov 0,8

69 evesaet Boieae avui3e a9a6e Mov E,8

697 900545" gaieea aveeas 09900 UxI Hy, NORMAL PUT ADDRESS OF NORMAL, WERE WE FINISH UP,
698 920544" aoeed eeoide’

699 @00545* geen 200537"

700 800546" Bo1ea9 av0s45 9920 PUSH OH 1 ON THE STACK

701 08547? aeiaee aoerar 29940 UxI HyFMULTe HPUT FMULT2 ON THE STACK TWICE, SO AFTER
72 308550" eovvee avess7*

703 990551" @eard goosadr

704 00552" Goie0s aeas4s 09960 PUSH oH } WE MULTIPLY BY THE LO BYTE, WE WILL
705 80555" epioee avesas 29980 PUSH oH J} MULTIPLY BY THE MO AND HO

706 @0u5S4* Oo100e goevaL 10000 LxI Hy FACLO JGET ADDRESS OF LO OF FAC

707 80555 eavea0 veoLTS*

708 08556" bas~ee Bea5Set

709 908557" auived ae176 1e@20 FMULT23 MOV ay GET BYTE TO MULTIPLY BY

718 @20560" Balcaa aov0ds 1oe4e INX x WMOVE POINTER TO NEXT BYTE

mL ieee IFN LENGTH, «

712 weasel? eal avoze? 10080 Ona

743 @00562" Beledo gvasi2 10108 wz FMULT3> FARE WE MULTIPLYING BY ZERO?

714 900565" eevee gueose?

745 008564" Ba0000 4vesss’

716 906565" ea1oee y0asa5 10120 PUSH SAVE POINTER

117 10140 LENGTH, «

718 10160 MVE Leto» 13ET UP A COUNT

119 10168 LENGTH, <

MATHPK FOR BASIC NCS 8086 GATES/ALLEN/VAVIDOFF MACRO 47(113) 06409 27"AUG=75 PAGE det
Fa Mac 23-AUG64 26108 FLOATING MULTIPLICATION AND DIVISTON

720 000566" baiveo 9003535 19200 XCHG GET LO*S IN CHL)
721 909567" Beiven guaese 1o2ee MVI E,1a> SET UP A COUNT
722 ovas7e* cova aeaeiu
723
724 10200 FTHE PRODUCT WILL BE FORMED IN Cy0,£,8, THIS WILL BE IN C,H,L,8 PART OF THE
725 10262 7 TIME IN ORDER TO USE THE "DAO" INSTRUCTION, AT FMULT2, WE GET THE NEXT
726 10300 BYTE OF THE MANTISSA IN THE FAC TO MULTIPLY BY, ((HL) POINTS TO IT)
7e7 10320 7 (THE FHULT2 SUBROUTINE PRESERVES (HL)) IN 8K, IF THE BYTE IS ZERO, ME JUST
128 10340 ;SHIFT THE PRODUCT 8 RIGHT, THIS BYTE 18 THEN SHIFTED RIGHT ANO SAVED IN D
7e9 10360 7 (H IN 4K), THE CARRY DETERMINES IF WE SHOULD ADD IN THE SECOND FACTOR
730 10380 IF WE DO, WE ADD IT TO C,H,L, B IS ONLY USED TO DETERMINE WHICH WAY WE
731 10400 FROUND, WE THEN SHIFT C,H,L,B (C,0,£,8) IN 4K RIGHT ONE TO GET READY FOR THE
132 4420 NEXT TIME THROUGH THE LOOP, NOTE THAT THE CARRY IS SHIFTED INTO THE MSB OF
133 10449 Cy & HAS A COUNT (L IN 4K) TO DETERMINE WHEN WE HAVE LOOKED AT ALL THE BITS
734 10468 }0F 0 CH IN 4K),
735 900571" @a10ee wooes7 10480 FNULTG: RAR FROTATE BYTE RIGHT
736 10500 IFE LENGTH, <
737 1w5ee Mov Hy A> SAVE THE COUNT
738 10540 IFN LENGTH, <
739 @ve572* atoen goareT 10560 Mov Dy A> SAVE IT
746 200575" G91000 Bo0171 10580 MOV AVC GET HO
741 900574" oie wvasee 19600 INC FULTS WDON*T ADD IN NUMBER IF BIT WAS ZERO
742 060575" Bound aeeeaT?
743 909576" BovA00 aeases*
744 10620 TFE LENGTH, <
745 10640 XCHG> 7PUT THE LO?S IN (HL)
746 000577" Ge1ve0 guases 10668 PUSH =D SAVE COUNTERS
147 000690" Golo anavar 10680 FMULTBs LXI 0, ScovE ET LO*S OF NUMBER TO ADD, THIS IS SET ABOVE
748 900601" GoeDa0 BoaDdST®
749 00602" Beeved gvasTSs*
750 @00603" o01¢90 4oaw31 10700 DAD 0 VADD THEM IN
151 @eve04* aoivee vouser 10720 Por 0 1GET COUNTERS BACK
7152 @@@605" Balvee o00516 10740 © FMULTA? ACI @ FADD IN HO, THIS IS SET UP ABOVE
753 909600" eoerae avavee
154 10760 IFE LENGTH, <
755 10760 XCHG JPUT THE LOfS BACK IN (DE)
156 10800 FMULTS? CALL — SHFROA HSHIFT THE RESULT RIGHT ONE
157 1e8eo L FARE WE DONE?
758 10840 AyH> GET NUMBER WE ARE MULTIPLYING BY
759 10860 IFN
760 @20607* BvIeBe BLeousT 10880 FMULTS: RAR PROTATE RESULT RIGHT ONE
761 00610" @91909 ge0I17 10980 cy A
762 2611" Bolaee Bve17d 10920 ' PROTATE NEXT BYTE
763 vee1e? eaivaa oua03T 19940
764 99613* Bo1eee aoa14a7 10960
7e5 00614" woleee ove17s 109628 TROTATE NEXT LOWER ORDER
766 00615" Galeee av00s7 11008
767 BBv610" Boleva gea157 11020
08617" Gatos eeai7e 11040 ROTATE LO
@eee2* aivae avaus7 11960
@u¥e21" Bo1a00 av—a1a7 11080
weee2e? dois avevss 11100 € FARE WE DONE?
wede2s* Baivao aeei7e 11120 GET NUMBER WE ARE MULTIPLYING BY

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 6209 27mAUG#75 PAGE de2
Fa Mac 23"AUGHO4 06108 FLOATING MULTIPLICATION AND OIVISION

173 O00624* Oo1000 ovasae 11140 INz FAULTS JMULTIPLY AGAIN IF WE ARE NOT DONE
774 geaeas? agecdo ees7it

175 @@0620" @pe0~e avaeai’

716 11100 IFN LENGTH, <

177 @na6aT* eatoae ovesss 11180 XCHG> GET LOFS IN (HL)

7178 920632" goiveo 00541 11200 POPHRT# POP 4 JGET POINTER TO NUMBER TO MULTIPLY BY
779 980631* B21 gv0311 11220 RET TALL DONE

18¢ 12a IFN LENGTH, <

781 004652" Op1e9e vores 11260 FMULTSs MOV BYE MULTIPLY BY ZEROS SHIFT EVERYTHING @ RIGHT
782 000635" Gaiedd weaise 11280 MOV E,0

783 ooe634* BoleBe Goater 11300 nov vc

784 900635" Yaiaea averi7 11320 Moy CA JSHIFT IN 8 ZEROS ON THE LEFT

785 4630" doiaad avosit 11340 RET> FALL DONE

786

787

788 11408 DIVIDE FAC BY 10

789 11420 FALTERS ,B,C,D,E,M,L

79@ 880637" Go1ged 00315 1144@ 0110s CALL PUSHF FSAVE NUMBER

791 deee4v? eaoeae Bv1205°

192 Goeedit oaeeeR Bvaeas?

793 11400 TFN LENGTHea,<

794 900642" Belve0 evever 11480 MOVRI 204,040,200,200 1LOAD CONSTANT *10* INTO REGISTERS
795 000645" Bveaae avovde

796 900644" Baedea aveens

797 080645" Gaieee avaver

798 e8v64e" Bovsea govLee

799 00647? Bagoes evaved

88@ 820652" Baleeo 200315 CALL «MOVER WMOVE THE CONSTANT TO THE FAC

8@1 220651* Qaeeda avie2s?

802 as6e52* eavded wooeae’

ees IFE LENGTH=2,<

8e4 uxt Hy PTEN GET POINTER TO THE CONSTANT fie"
Bes CALL «MOVE M> JMOVE TEN INTO THE FAC

806 oee65s* aoivee avesa1 FDIVTs POPR HGET NUMBER BACK IN REGISTERS

8u7 eHv6e54* eaieea oveser

808 FPALL INTO DIVIDE AND WE ARE DONE
809

610

en JOIVISION FACE BARG/FAC

12 FALTERS A,8,C,0,E,M,L

813 040655 Oe1000 200557 FSIGN CHECK FOR DIVISION BY ZERO

814 809656" Ooia0e evasie uz OVOERR HHE IS TRYING TO GET AWAY WITH IT
815 000657" Becaee evovoes

816 @eA66u" epee aoe6esi*

817 20661" ap1000 avause cles L,377 TSUBTRACT THE THO EXPONENTS, L IS A FLAG
818 ave662" apeea— 940577

819 4K605" Baid0—a 480515 CALL © MULDIY JFIX UP THE EXPONENTS AND THINGS

820 evo664* Breese Bv1Es5°

821 848665" weed BweosT

822 400666" Bric geaved INR " JADD 2 TO EXPONENT TO CORRECT SCALING
823 Gev667" Bwiean eHoved IWR c]

24 THERE WE SAVE THE FAC IN MEMORY SO WE CAN SUBTRACT IT FROM THE NUMBER
bes JIN THE REGISTERS QUICKLY,

MATHPK FOR BASIC NCS 8280 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06109 27=AUG=75 PAGE 4n3
F4 Mac 23rAUGHO4 B6108 FLOATING MULTIPLICATION ANO DIVISION

826 eea67e" aa1goo avoL53 11660 ocx H POINT TO HO
827 280671" Ca1av0 BveITE 11380 Mov Ayn HGET HO

828 920672" Ba100G weavee 11900 STA FOLVASL SAVE IT

829 889675" aaeved ava7s4°

83¢ @e674* daeva2 avebo4"

831 60675" anieoe avouss 11920 ocx 4 SAVE MIODLE ORDER

832 e20676* aaiced gv0176 11940 nav Ay

833 422677" Q91098 Booe6e 11960 STA FDLVB4s PUT IT WHERE NOTHING WILL HURT IT

834 ova7a0" aoacee evo730"

835 900701 Baedoe BoaETS*

836 evo7ee* eaicd9 eooEss 11980 ocx 4 FSAVE LO

837 vae705" Boivee ave17e 12000 mov AyM

838 800794" volsee BvevEe 1ee2e STA FOIVC+4

839 200705" eaec0a gva7es?

840 eva7a6* eoede0 eooTeL

eat

b4e THE NUMERATOR WILL BE KEPT IN ByHyLy THE GUOTIENT WILL BE FORMED IN C,D,Ey
843 70 GET A BIT OF THE GUOTIENT, WE FIRST SAVE 8, HyL ON THE STACK, THEN

84g SUBTRACT THE DENOMINATOR THAT HE SAVED IN MEMORY, THE CARRY INDICATES

845 WHETHER QR NOT B,H,L WAS BIGGER THAN THE DENOMINATOR, IF 8yH,L WAS BIGGER,
846 FTHE NEXT BIT OF THE GUOTIENT IS A ONE, TO GET THE OLD 8,H,L OFF THE STACK,
847 WE POP THEM INTO THE PSW, IF THE UENOMINATOR WAS BIGGER, THE NEXT BIT OF
e48 THE GUUTIENT IS ZERO, AND WE GET THE OLD B,H,L BACK BY POPPING IT OFF THE
849 FSTACK, WE HAVE TO KEEP AN EXTRA BIT OF THE QUOTIENT IN FDIVGe1 IN CASE THE
850 FOENOMINATOR WAS BIGGER, THEN ByHyL WILL GET SHIFTED LEFT, IF THE MSB OF
851 18 WAS ONE, IT HAS TO BE STORED SOMEWHERE, 80 WE STORE IT IN FDIVG+1, THEN
ase VTHE NEXT TIME THROUGH THE LOOP 8,H,L WILL LOOK BIGGER BECAUSE IT HAS AN
853 VEXTRA HO BIT IN FOIVG$1, WE ARE OONE DIVIDING KHEN THE NSB OF C IS A ONE,
654 THIS OCCURS WHEN WE HAVE CALCULATED 24 BITS OF THE QUOTIENT, WHEN WE JUMP
855 170 ROUND, THE 25TH 811 OF THE GUOTIENT DETERMINES WHETHER WE ROUND OR NOT,
856 FIT IS IN THE MSB OF A, IF INITIALLY THE DENOMINATOR IS BIGGER THAN THE
57 FNUMERATOR, THE FIRST BIT OF THE GUOTIENT WILL BE ZERO, THIS MEANS WE

658 FWILL GO THROUGH THE DIVIDE LOOP 26 TIMES, SINCE IT STOPS ON THE 25TH BIT
859 JAPTER THE FIRST NON@ZERO BIT OF THE EXPONENT, SO, THIS QUOTIENT WILL LOOK
Bee WSHIFTEO LEFT ONE FROM THE GUOTIENT OF TWO NUMBERS IN WHICH THE NUMERATOR IS
861 HBIGGER, THIS CAN ONLY OCCUR ON THE FIRST TIME THROUGH THE LOOP, SO C,0,E
862 PARE ALL ZERO, $0, IF WE FINISH THE LOOP AND C,D,€ ARE ALL ZERO, THEN WE
863 JMUST DECREMENT THE EXPONENT TO CORKECT FOR THIS,

864 200707" Be1000 avo1er Mov ByC GET NUMBER IN B,HyL

865 20710" Beld2e avosss XCHG

866 avu7iit eeieae gvaesT XRA a ZERO C,D,E AND HIGHEST ORDER

867 eerie? ainad 400117 Mov Cra

868 080715" Belave ev1e7 MOV yA

869 200714" valve ave137 HOV E,A

870 20715 BoIeen Beane STA FOIVG+1

871 Gee716" Beeaes 00737"

872 ave7ir* ooeved eva7as?

873 a00720" Baivad aees45 FOIvis PUSH SAVE LOfS OF NUMBER

874 00721" Ovieds 400505 PUSH #SAVE HO OF NUMBER

875 e0e72e* Bo1e00 e00175 Moy #SUBTRACT NUMBER THAT HAS IN FAC

876 0725" do1eeo Bv0326 Folves sur SUBTRACT LO

877 e0n724" acevo soevad

878 n725* BAivae e00157 mov ISAVE IT

MATHPK FOR BASIC MCS B08 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06329 27-AUGR75 PAGE Gag
F4 MAC 23PAUGHO4 O6408 FLOATING MULTIPLICATION ANO OLVISION

879 eva726" Beieee eval74 1e74e Mov Aah TSUBTRACT MIDDLE ORDER
888 eve7e7* eo1900 avus3s6 12768 FOIvB!. SBI C)
881 200730" eaeeee seovad
882 00731" B91000 ovo147 12780 Mov HA
883 900732" Ba1000 eveiTe 12800 Mov AyB TSUBTRACT HO
884 000733" vo1n98 00330 12820 FOIVA: SBI @
885 000734" woa0ee Bve0ae
886 000735" aa1000 gon107 12840 Mov BA
887 00736" waipad Boov7e 12860 © FOIVG? MVI Ae GET HIGHEST ORDER
888 900737" Beeeag Gasvae
889 900740" Bo1000 Buos3e 12880 Ser @ FSUBTRACT THE CARRY FROM IT
899 900741" Bo2eee avavae
891 00742" B91000 ovov77 12900 cue FSET CARRY TO CORESPOND TO NEXT QUOTIENT BIT
892 00743" aaicaa avasee 12920 INC Furve GET OLD NUMBER BACK IF WE SUBTRACTED TOO MUCH
893 va7a4" Bpgeee auaTSS*
894 300745* waeede ovarie*
895 a00746" Ba102e ovavee 12940 STA FUIVG+s FUPDATE HIGHEST ORDER
896 00747" e90000 oeeTs7*
897 @0u75e" Bacced oea744?
898 000751" O91000 ovaS64 e960 PW FTHE SUBTRACTION WAS GOOD
899 00752" ae1eea woase1 12960 Psw GET PREVIOUS NUMBER OFF STACK
980 0753" Beieee avevET 13000 FNEXT BIT IN QUOTIENT IS A ONE
901 090754" aoican aaasee 15020 1000, 322 FING" AROUND NEXT 2 BYTES
902 900755" aaicee 9ea3sa1 13040 8 JWE SUBTRACTED TOG MUCH
983 0756" Beiead 4oasai 13060 P GET OLD NUMBER BACK
904 900757" 201000 geai7i 13080 ec TARE WE DONE?
9@5 902760" eaid0a oaguTd 13100 SET SIGN FLAG WITHOUT AFFECTING CARRY
906 va761* Baieee ooae7S isi2o
927 00762" B2iee0 coos? 15140 PUT CARRY IN MSB
908 000765" eailuco ovasTe 13160 ROUNDS TWE ARE DONE
909 00764" aaeoee aovesa?
916 920765" O90000 ea7ar*
911 00766" @a1v00 aovee7 15180 JHE ARENT, GET OLD CARRY BACK
912 13200
15220 FROTATE EVERYTHING LEFT ONE
13240
ae076T* aaivoe 00173 13260 € PROTATE EVERYTHING LEFT ONE
@@0770" Yatvee oeaver 13280 PROTATE NEXT BIT OF QUOTIENT IN
900771¢ e100 0137 13320
Qv077e* egteee evaire 13320
280773" Beivoe avave7 13340
a00774" eaieee coaieT 15300
000775* doteeo avoi7d 13360
200776 BoleHe eeeveT 13400
900777" @aieeo ovo11T 15420 Cy A>
@21000" Boleee oeovst i34ao 4 FROTATE & ZERO INTO RIGHT END OF NUMBER
@01001* atoee ava170 15460 Ay HTHE HO BYTE, FINALLY]
@e1aee? eaioee avovar 15469
001903" doives eeaia7 13500 Cray
@e1004" aoieea ovav7e 13520 FOIVGeL FROTATE THE HIGHEST ORDER
001005" Gageee gua73sT’
@¢10¢6" eevee gva7es’
0e1007" doteva avoveT 13540

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) @6309 27*AUGR7S PAGE G=5
Mac

Fa 23eAUGH6G B6108 FLOATING MULTIPLICATION AND OLVISION
932 a01910" Be1920 ooaeee 13560 STA FOIvGeL

933 @aloit? egacee ove7s7*

934 @sto1e* eaevad ee1es?

935 @a1915" ao1000 avai7d 13580 FADD ONE TO EXPONENT IF THE FIRST SUBTRACTION
936 01014" doieda aoaese 15600 + DIO NOT WORK

937 901015" ae1ea9 cogees 13620

938 81016" ao102e ooasee 13600 ITHIS ISN*T THE CASE

939 @01017* agveee avareor

94@ avinev? eneoea ovie11*

941 Go1ea1" Baivan ooosas 15660 SAVE PART OF NUMBER

942 ovle2et Bolera gvovar 15680 1GET POINTER TO FAG

943 Goives* Ba0000 ooauaer

944 @oimed* eaedea verei7*

945 01925" ee1a0e ovoees 13700 FOECREMENT EXPONENT

946 Goia26" doles avasai 13720 }GET NUMBER BACK

947 Oe1027? Bo1eee svasee 15740 HDIVIDE MORE IF NO OVERFLOW OCCURED
948 091930" ageeea avareot

949 901031" Gaveed oe1vast

950 01032" ovie09 avasa3 15760 FOVERFLOWLE

951 001035" opeeea auoeETt

952 01034" apoved Be1E3v"

953

954

955 JCHECK SPECIAL CASES AND ADD EXPONENTS FOR FMULT, FDIV

956 ALTERS A,B,H,L

957 IFE LENGTH#a,<

958 MULOVS? MVE A,3TT TENTRY FROM DDIV, SUBTRACT EXPONENTS
989 XwD 1000,056 i"MVI LM" AROUND NEXT BYTE

90 MULDVA: XRA a VENTRY FROM DMULT, ADD EXPONENTS
gor LxT Hy ARGet 1GET POINTER TO SIGN AND HO OF ARG
962 ov cM VGET HO ANO SIGN FOR UNPACKING
963 INK H FINCREMENT POINTER TO EXPONENT

964 Mov BM GET EXPONENT FOR BELOW

965 Mov bra» FSAVE ADD OR SUBTRACT FLAG

966 001935" doleee goarTe MULOIV? MOV A,B VIS NUMBER IN REGISTERS ZERO?

967 041030" aoicea gvoeE7 ORA iy

968 01037" Belees gvesie rd MuLove JIT 18, ZERO FAC AND WE ARE DONE
969 @01040" aoveee oo1e77"

970 01041" Baeeoe Ba1o33"

971 ee1042" eB1000 ova175 Mov Auk GET ADU OR SUBTRACT FLAG

972 G01043* ep1000 eoacar xT Hy Fac GET POINTER TO EXPONENT

973 001044" oooeee av10as*

974 91045" Baveee ov1e4a

975 01046" Bo1eee oodese XRA 4 GET EXPONENT

976 41047" Balee0 evozoe Ago 8 FADD IN REGISTER EXPONENT

977 901050" Ge1eee 4vo1e7 mov Ba SAVE IY

978 901951" Boleee ovee37 RAR CHECK FOR OVERFLOW

979 gviuse? eolvee sooese 8 FOVERFLOW IF SIGN IS THE SAME AS CARRY
988 01955" Goioea oBo17o ArB GET SUM

981 01054" Oo1cee auase2 uP muULovS WWE HAVE OVERFLOW!)

982 901055" aggee0 aeiu7er

963 921056" opee2m avin4ar

984 01057" wxieee Bovsee aor 200 JPUT EXPONENT IN EXCESS 200

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) @6309 27*AUGe75 PAGE dno
Fa Mac 23rAUGH64 06408 FLOATING MULTIPLICATION AND OIVISION

985 ev1n60" eoeves wwacee
986 081061" Of1900 ape167 14300 Mov Mpa SAVE IT IN THE FAC
987 bo1062" 201000 ovasie 14320 Rr POPHRT HWE HAVE UNDEFLOWL! RETURN,
988 01063" BoeveG aueosu?
989 901064" aaen2e ou1E55°
99¢ 001865" doivag 900315 14340 CALL UNPACK HUNPACK THE ARGUMENTS
991 081066" Bove oviere?
992 001067" aae0e@ Boivest
993 @01070" ee1ce0 ava16E7 14360 Mov Mea TSAVE THE NEW SIGN
994 01071" Beleon ooavS3 14580 bex H POINT TO EXPONENT
995 eo107e* Beieee avas11 14400 Rey TALL DONE, LEAVE HO IN A
996 14420 IFN EXTFNC,<
997 901075" @o1000 ovessT 44440 © MLOVEX? FSIGN FENTRY FROM EXP, PICK UNDERFLOW IF NEGATIVE
998 901074 ag1e00 ovees7 14460 CMA PICK OVERFLOW IF POSITIVE
999 001075" ep100e ovOs41 14460 Por ne JDONfT SCREW UP STACK
1000 E1976" waleee BvoeET 14508 MULOVIz ORA iy 1S ERROR OVERFLOW OR UNDEFLOW?
1001 01877" Baleee gva5a1 14520 MULOVat POP Cl) GET OLD RETURN ADDRESS OFF STACK
1002 14540 IFE LENGTH, <
1003 14560 aM OVERR FOVERFLOW
1904 14580 FUNDERFLOW w= FALL INTO ZERO
1005 14600
1006 14620
10¢7 14640 FZERO FAC
1008 14660 ALTERS A ONLY
1009 14680 EXITS WITH AB@
oie 14700 XRA A ZERO A
101 14720 STA Fac ZERO FAC
ore 14740 RET> FALL DONE
101s
tora
1015 14800 LENGTH, <
1016 801108" Op1000 avasee 14820 ap ZERO TUNDERFLOW
1017 981101" aaeeea aeoi7s¢
1018 v11¢e" doevee ae1u66"
@01105¢ aateee coesos 14840 INP OVERR> FOVERFLOW
201194" Baa000 aveesTt
leet 21105" apoowe oBiiai?

1924 14900 FMULTIPLY FAC BY 10
1025 14920 ALTERS A,8,C,0,E,4,L
1026 001106 doteve evesis 14940 MULI@? CALL = MOVRF 1GET NUMBER IN REGISTERS
@elie7? eoeeve aeiesor
@@1110" ogeeae aeiiaar
$029 001111" Baio aeai7e 14960 mov GET EXPONENT
1030 081112" oate00 evoceT 19980 ORA TRESULT IS ZERO IF ARG IS ZERO
1031 001113" deteea vvasie 15000 RZ yIT Is
1032 1114" oataae ao0sa6 15020 AOI IMULTIPLY BY 4 BY ADDING 2 TO EXPONENT
1033 @1115¢ Geavee adavae
1034 01116" ea1e09 gues3se 15000 Je FOVERFLOWLL
1035 001117" @o000e vaeo7*
1936 901120¢ gagged aciio7"
@e1121* dai avatar 15068 mov FRESTORE EXPONENT

MATHPK FOR BASIC HCS BOB GATES/ALLEN/UAVIDQFF MACRO 47(113) 06409 27*AUG*75 PAGE 4n7
Fa mac 23rAUGHO4 B610R FLOATING MULTIPLICATION ANO DIVISION

1038 e112e" ap1000 avasi> 15080 CALL = FADD FADD IN ORIGINAL NUMBER TO GET 5 TIMES IT
1039 001125" Goeae9 wveves?

1040 001124" Bneooa ee1117° .

1041 901125 de1ve0 euoead 15100 Lxt Hy PAC FADO 1 TO EXPONENT TO MULTIPLY NUMBER BY
1042 061126" Boae00 aeiedar

1043 001127" gae@ooo aviies?

1044 201130 201000 aceved isi2e " 4 2 TO GET 10 TIMES ORIGINAL NUMBER
1045 901131¢ doieee svesou 15140 FALL DONE IF NO OVERFLOW

1046 1132" eaiewa avoses 15160 OVERR FOVERFLOWLI

1047 0011335 ooeaee aooeoT?

1048 001134" goeeee ao1ies*

1049 15180

MATHPK
Fa

1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1969
1078
1071
ore
1073
1074
1075
1076
1077

1080
1081
1062
1083

1086

MATHPK
Fa

1103
1104
1105
1106
1107
1108
1109
1110
tint
ite
1113
114
1115,
1116
4417
1116
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
41134
1132
41133
1134
1135
1136
1137

FOR BASIC MCS Bao

Mac

oo1135¢
@O1130°
ao1is7e
@aiide?
@oliaie
@ariaer
ooiiast
ooriaae
eaiias?
@a1146*

ov1a7e

8115)

oa11si¢
ae1iser
@o11ss¢
eo11s4?

@aii55¢
oe1156¢
oaiss7?
@e1160°
aoir6s®
Ovi16e*
@oi16s¢
90116:

aires?
aeiieo*

FOR BASIC
mac

@e1167?

@eii7a*

aoii7s?

oo117s?
oori74?

oo1175¢
aa117e¢
ea1i77*
eaizoer
oe1201"
oviaget
aaians?
paraaar

23rAUGHO4 6108

@o1000
T1VTT
eveceo
eo1200
eo1aeo
og1000

21000
ao1eeo
@oieao
aaieeo

eaieoo

201000
epov0e
eo1e0e
oaoveo
onocae

@a1900
eoaee0
eaeeae
@e1a0
ae1c00
eatoee
eeeeeo
ee1es0
oeieea
eaevae

MCS 8080

aeovre
T1T77T8
oo113s?
200576
geous?
aeovar
aeoes7
avosoo
avou74
ovosit

000357

evaves
avoeie
eeover
aeeogix
ae1i3e°

evoear
oeriaer
@o1153"
oeeii7
geoiee
oogoee
evaves
0ouas
eave
eovenw

23mAUGHOG 6108

ee1eoo
aa1e00
egenaa
Beoven

@o1eeo
oo1cea

ea1000
T1117
a00000
aa1e90
ao1eeo
aveven
@a1v00
@aio00

evavel
evasas

oeai4s"
ae11s6*

avess7
eaasee

aeowas
TITTTT*
ow1i7i
avoi7e
900356
aneeoe
ava167
avasit

SIGN,

15208
15220
1sea0
15260
15260
15300
15320
19340
15360
15360
15400
iogee
15440

15460
15480
15500
15520
19348
15560
15560

15640
15660
15680
15700
15720

15760
15600
15820

15840

15860

1s9e0
15940
15960

15980
16000
teoee

16040
16060

SIGN,

16080
16100

1616e
16162
loave
16220
rrr)
1o26e
16268
16300
1o320

16380
16400
teded
16440

16460
16480

16500
16520

16580
16600
16620
16640
16660
16680
16700
16720
16740
16760
16789
16800
16820
1684e
16860
16860
16908
16920
16940
1696
16960
17000
11020

GATES/ALLEN/DAVIDOFF MACRO 47(113) 06109 27-AUGe75 PAGE S

SGN, FLOAT, NEG AND AGS

SUBTTL

REPEAT
SIGNE

SIGNCE

FCOMPS:
ICOMPS:
SIGNS;

INRARTE

FLOATS

FLOATR:

SIGN, SGN; FLOAT, NEG AND ABS
PUT SIGN OF FAC IN A

FALTERS A ONLY

FLEAVES FAC ALONE

FNOTES TO TAKE ADVANTAGE OF THE RST INSTRUCTIONS TO SAVE BYTES,
IFSIGN I$ DEFINED TO BE AN RST, "FSIGN" IS EQUIVALENT TO "CALL SIGN”
THE FIRST FEW INSTRUCTIONS OF SIGN (THE ONES BEFORE SIGNC) ARE DONE
VIN THE 8 BYTES AT THE RST LOCATION,

a« TFSIGN 18 ALWAYS AN RST

Loa Fac FCHECK IF THE NUMBER IS ZERO

ora A

Rz> HIT 18, A IS ZERO

hua FACeL GET SIGN OF FAC, IT IS NON®ZERO

xWO 1000,376 H"CPI" AROUND NEXT BYTE

CMA JENTRY FROM FCOMP, COMPLEMENT SIGN

RAL VENTRY FROM ICOMP, PUT SIGN BIT IN CARRY
$88 JARO IF CARRY WAS @, ASS77_IF CARRY WAS
RNZ PRETURN IF NUMBER WAS NEGATIVE

INR YPUT ONE IN A IF NUMBER WAS POSITIVE
RET TALL DONE

}8GN FUNCTION

FALTERS A,8,C,D,E,4yL

LENGTH=a,<«

FSIGN> 1GET SIGN OF FAC IN A
FALL INTO FLOAT

TFLOAT THE SIGNED INTEGER IN A
FALTERS A,8,C,0,E, 4,
MvI 8,210 SET EXPONENT CORRECTLY

uxt 0, SCODE FZERO 0,E

FALL INTO FLOATR

JFLOAT THE SIGNED NUMBER IN 8,A,0,€
TALTERS &,8,C,0,E,H,L
Lar Wy FAC 1GET POINTER TO Fac

Mov ry yPuT HO IN C
Mov 4B }PUT EXPONENT IN THE FAC
NVI 8,8 TZERO OVERFLOW BYTE

INx 4 JPOINT TO SIGN
MVE M200 JASSUME A POSITIVE NUMBER

GATES/ALLEN/UAVIVOFF MACRO 47(115) 06409 27"AUGe7S PAGE Sat

SGN, FLOAT, NEG ANO ABS

ABS?
IFE

RAL PUT SIGN IN CARRY
IMP FADFLT 7G0 AND FLOAT THE NUMBER

FABSOLUTE VALUE OF FAC
ALTERS A,HyL

LENGTH#2,<
crI 2 HIS THE ARGUMENT AN INTEGER?
IZ TABS> YES, USE THE INTEGER ABSOLUTE VALUE
FSIGN JGET THE SIGN OF FAC
RP FALL DONE IF IT IS POSITIVE
TFALL INTO NEG

PNEGATE NUMBER IN THE FAC
PALTERS Ay My

SNOTE? THE NUMBER MUST BE PACKED

xT H,FAC#S GET POINTER TO SIGN

Mov aM GET SIGN
XRT 200 TCOMPLENENT SIGN BIT

Mov Mya SAVE IT
RET TALL DONE

LENGTHw2,<
JNEGATE ANY TYPE VALUE IN THE FAC

FALTERS &,8,C,0,€,H,L

Loa VALTYP }SEE WHAT KIND OF NUMBER WE HAVE

cPr 2

sz INEG JWE HAVE AN INTEGER, NEGATE IT THAT WAY
um TMERR 7BLOW UP ON STRINGS

np Nes }NEGATE SNG AND DBL THE SAME

SGN FUNCTION
FALTERS AyHyL

CALL VSIGN GET THE SIGN OF THE FAC IN A

Nov LA WPUT IT IN THE LO POSITION

RAL FEXTEND THE SIGN TO THE HO

$88 A

Mov HA

JP CONISS JRETURN THE RESULT AND SET VALTYP.

GET THE SIGN OF THE VALUE IN THE FAC IN A
ASSUMES A HAS THE VALTYP WHEN CALLED
FALTERS A, Hy

MATHPK FOR BASIC MCS 8080
23eAUGwod @

F4

1156
1157
1158
1159
1168
1161
1162
1163
1164

MATHPK
Fa

1165
1166
1167
1168
1169
1170
4171
1172
1173
1174
4175
1176
177
1178
4179
1160
1161
1182
41183
1184
1165
1186
1167
1188
1189
11968
1194
4192
1193
4194
1195
1196
4197
1198
1199
1200
1201
ewe
1203
1204
1205
1206
1207
1208
1209
1210
tett
tate
1213
214
1215
1216
1217

MAC

FOR BASIC MCS g080
M 23eAUGHOd 6108

@e1ag5¢
eetaaet

goreai?

oaie2eer
ooiaas?
@oiaeae

oei2ast
@ei2z2e"
oei2ait
aaiasoe
oeiasit
oo123e¢
ae123s¢
aoia3ae
ao1235¢
euiasoe
ov1asi?

aeiegat
Bet2aie
aeiager

@a1000
eateae
CC
aoaeeo
eaioea
@a1000
@a10a0
177777
a0000
ovivee
ea1900
eo1a00
eo10e0

oe1990
aoveao
@eevae

e91c00
eoivae
evevea
apace
891000
oniooo
aa1000
171177
eaeceo
@ai1eeo
agic00

aa1000
eaanee
wooweo

eoasss
ooouse
@v0555*
ee1i76"
aeasas
200545
aeaese
1111718
aetear?
evesas
avosas
aee@sss
aeesi1

000515
gvieas?
gorerar

900353
avovge
awiegrs
aeieas*
aeo14e
oeoist
aeowse
TITTTT#
ootear*
avesss
000511

geooas
ootearx
aeiesar

SIGN, SGN,

17040
17060
17060
17100
17120
17140
17160
17180
17e08

VSIGNG

FLOATING POINT

17220
17240
17260
17260
17300

17320
17300
17360

17380
17400
174ee
17440

17508
17520
17540
17560
17580

17600

17660
17680
17708
17720

47740
17760
17780

17800
17820

17880
17900
17920

17940

18000
16020

SUBTTL

PUSHFE

MOVEM?

MOVFRE

MOVRFS

GATES/ALLEN/DAVIDOFF MACRO 47(113) 06409 27=AUGeTS PAGE Sea
8 FLOAT, NEG AND ABS

crr 2 HIS THE ARGUMENT AN INTEGER?

INZ SIGN NO, SINGLE AND DOUBLE PREC, WORK THE SAME
LHLD = FACLO GET THE INTEGER ARGUMENT

mov ArH GET ITS SIGN

ORA L TCHECK IF THE NUMBER IS ZERO

RZ TIT IS, WE ARE DONE

Mov AH V1T ISN¢T, SIGN IS THE SIGN OF H

IMP ICOMPS> 1G0 SET A CORRECTLY

GATES/ALLEN/DAVIDOFF MACRO 47(113) 06169 27*AUG#75 PAGE 6

MOVENENT ROUTINES

FLOATING POINT MOVEMENT ROUTINES
}PUT FAC ON STACK

FALTERS D,E

XCHG FSAVE CHL)
LALO = FACLO GET Lors

XTHL SWITCH LOfS AND RET ADDR
PUSH oH PUT RET ADOR BACK ON STACK
LALO FACet GET HOS

XTHL FSWITCH HOfS AND RET ADOR
PUSH HPUT RET ADOR BACK ON STACK
XCHG GET OLD (HL) BACK

RET FALL DONE

FMOVE NUNBER FROM MEMORY C(HL)] TO FAC

FALTERS B,C, D,B, 4,

AT EXIT NUMBER IS IN 6,C,0,E

PAT EXIT (HL) #2 (HL) 44

CALL MOVRM }GET NUMBER IN REGISTERS

FALL INTO MOVFR ANO PUT IT IN FAC

IMOVE REGISTERS (8,C,D,£) TO FAC

FALTERS 0,E

XCHE WGET LO*S IN CHL)

SHLD —- FACLO }PUT THEM WHERE THEY BELONG

Mov HB HGET HOPS IN CHL)
Mov Lic
SHLD FACwi FPUT HOfS WHERE THEY BELONG

CHG 7GET OLD (HL) BACK
RET TALL DONE

HMOVE FAC TO REGISTERS (B,C,0,E)
TALTERS B,C,0,E,H)L

xr Hy FACLO 1GET POINTER TO FAC

FALL INTO NOVRM

1GET NUMBER IN REGISTERS (B,C,D,£) FROM MEMORY ((HL))
FALTERS B,C,0,€,H,L

MATHPK FOR BASIC NCS 8080 GATES/ALLEN/DAVIOOFF MAGRO 47(113) 06109 a7eAUGS7S PAGE bet
Fa Mac 23rAUGHO4 v FLOATING POINT MOVEMENT ROUTINES

te18 16040 Jat ExTT CHL) Y= CHL) 98
4219 81245" Betvea eva136 18060 © MOVRM. MOV om GET LO
1222 weleda voivas evovas 18080 INK A POINT TO MO
4221 81245" eoiaeo aeei2e 18100 Mov OnM GET MO
1222 61240 Beived aeevds 16120 INx 4 POINT TO HO
1223 ov1247" ooivee oov116 16140 Moy c,h 1GET HO
1224 921250" doieea oeaugs 18160 INx H FPOINT TO EXPONENT
1225 91251" Bateoa aeor—e 16160 Moy Bem GET EXPONENT
1226 1252" doieee Boouas 16200) INKHRT? INX ct) FING POINTER TO BEGINNING OF NEXT NUMBER
1227 901255¢ aaioen oea3sit 18220 RET TALL DONE
ieee
1229
1e30 e260 JMOVE NUMBER FROM FAC TO MEMORY [(HL))
1231 18300 TALTERS A,B,D,E,Hyk
1232 001254" wa1eee aooves 48320 MOVMFS «LXI O,FACLO GET POINTER TO FAC
1233 001255" Boveee aviedis
1234 901256" aasao geieait
1235 16340 FALL INTO MOVE
1236
1237
4238 18400 JMOVE NUMBER FROM (DE) TO CHL)
1239 18420 FALTERS A,B,0,E,H,\
1240 184ae FEXITS WITH (DE)#=(DE)#+d, (HL) $= (HL) 4G
1241 @e1257" vateee avoude 18460 MOVES «MV. 84 SET COUNTER
1242 001260" wovoe2 avevas
1245 18480 IFE LENGTH=2,<
1eag 16508 XwO 1000,076 THVT AM OVER NEXT BYTE
1245 18520 © MOVVF Ma XCHG> PMOVE NUMBERS INTO THE FAC
1246 1261" ovieee svowse 16540 = MOVEL? =LOAX =O GET WORD, ENTRY FROM VMOVMF
1247 ev126e" Bolvee auaie7 18560 Mov Crry JPUT IT WHERE IT BELONGS
12468 001263" eoleee aveves 16560 NX t) FINCREMENT POINTERS TO NEXT WORD
1249 @01264" ao1cee ooaw4s 16600 INK 4
1250 001265" aise seeuod 18620 ocr 8 SEE IF DONE
4251 081260" e100 vase 18640 INZ M
1252 081267" eave vieol*

@01270¢ geewe aviess*

@ei271* aioe evasit 18660 RET

18720 FUNPACK THE FAC AND THE REGISTERS
18740 FALTERS A,C)HyL
16760 JAHEN THE NUMBER IN THE FAC IS UNACKED, THE ASSUMED ONE IN THE
16760 FNANTISSA IS RESTORED, AND THE COMPLEMENT OF THE SIGN IS PLACED
16800 FIN FAC#L

ee1272* voleee avevar 18820 © UNPACKS LxI HyFACeS POINT TO HO AND SIGN

oo1e7S* 777777 «177777

@v1274* ooeeee aeie67"

901275" ao1000 aee176 18840 Mov AyM GET HO AND SIGN

Wele7e* Boiee@ Bvos6S 16868 PUSH PSH TSAVE SIGN

901277" waieee aves6o 16880 ORI 200 RESTORE THE HIDDEN ONE

281300" ooeae coaead

01301" Onteea gooieT 16900 mov Mya SAVE HO

@01302" aaieae aeas61 18920 POP PSW GET SIGN

FOK BASIC MCS @880 GATES/ALLEN/UAVIDOFF MACRO 47(113) 06409 27°AUGH7S PAGE On2
aC 23-AUGw64 B6r08 FLOATING POINT MOVEMENT ROUTINES

801303" ooigae aveese 18940 XRA 4 GET COMPLEMENT OF SIGN IN MSB
901304" oniee9 avougs 18960 INX }PQINT TQ TEMPORARY SIGN BYTE
901395" waieee auouas 16980 NX
@@1306" niece aueie? 19000 Mov }SAVE COMPLEMENT OF SIGN
01307" aa1eaa ova1Ts 19020 Mov 7GET HO AND SIGN OF THE REGISTERS
201310" Oo1000 200365 19940 PUSH TSAVE SIGN
981311" agives aves66 19860 ORT TRESTORE THE HIDDEN ONE
eeeeee vvoeoe
@e1ee0 gue11T 19080 Mov FSAVE THE HO
@eleee v00561 19108 PoP GET THE SIGN BACK
@91090 eeaeso 19120 RA ICOMPARE SIGN OF FAC AND SIGN OF REGISTERS
001316" aa10e0 avesit 19140 RET TALL DONE

19200 IFE LENGTH=2,<
19220 REPEAT 4, <« AVPUSHF WILL BE IN®LINE IN F3

19248 HPUT ANY TYPE VALUE ON THE STACK FROM THE FAC

19268 FSTRINGS ARE TREATED AS INTEGERS

19266 FALTERS A,B,C,H,L

19300 VPUSHFS LOA VALTYP HGET THE VALUE TYPE

19320 crr 4 FSET FLAGS ACCORDING TO VALTYP

19340 LxT H,FACLO HGET POINTER TO LO JN FAC

19368 PUSHM FPUSH FACLO#O,1 ON THE STACK

19380 aM VPUSHD JRETURN IF THE DATA WAS AN INTEGER OR A STRING
19400 Pusiit IPUSH FACw1,2 ON THE STACK

19420 Jz VPUSHD FRETURN IF WE HAD A SINGLE PRECISION NUMBER
19449 LXxI D,OFACLU HWE HAVE A DOUBLE PRECISON NUMBER
19400 PUsHM }PUSH ITS 4 LO BYTES ON THE STACK
19480 PUSHM

19508 VPUSHD3> FALL DONE

19520

19540

19560 #MOVE ANY TYPE VALUE FROM MEMORY (CHL)? TO FAC

19580 FALTERS A,B,0,E,HyL

19600 VMOVPFAS LXI H,ARGLO FENTRY FROM DADD, MOVE ARG TO FAC
19620 VMOVFM? LXI O,MOVVFN FGET ADORESS OF LOCATION THAT DUES
19640 JMP VMVVFM 7 AN "XCHG" AND FALLS INTO MOVEL
19660

19680

19760 FMOVE ANY TYPE VALUE FROM FAC TO MEMORY C(HL))

19720 FALTERS 4,8,0,E,H,u

19740 VMOVAFS LXI Hy ARGLO FENTRY FROM FIN, OMUL1@, DDIVIG
19768 MOVE FAC TO ARG

19780 YMOWMF? LXI O,MOVEL HGET ADORESS OF MOVE SUBROUTINE

19866 VMVWFMS PUSH o HSHOVE IT ON THE STACK

19820 Lar DO, FACLO GET FIRST ADDRESS FOR INT, SNG

19840 LOA VALTYP GET THE VALUE TYPE

19868 ANI 477 FSTRINGS LOOK LIKE REALS

19880 MOV BA FSET UP THE COUNT

19908 cPl 16 $00 WE HAVE DBL?

19920 RNZ WWE DO NOT, GO DO THE MOVE

19940 LxI D,DFACLO #WE 00, GET LO ADDR OF THE DBL NUMBER
19960 RET> 4G0 OO THE MOVE

MATHPK FOR BASIC MCS 6080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 96409 27*AUG=75 PAGE 693
Fa mac 23eAUGro4 YorUs FLOATING POINT MOVEMENT ROUTINES,

1sea 19960 © PAGE

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/UAVIDOFF MACRO 47(415) 06169 27RAUGR7S PAGE 7
F4 MAC 23wAUGHO4 96108 COMPARE TWO NUMBERS

1325 20900 © SUBTTL COMPARE THO NUMBERS
1526 20020 SCOMPARE TWO SINGLE PRECISION NUMBERS
1327 2ve4o fA81 1F ARG LT, FAC
1326 20068 ARQ IF ARGEFAC
1529 20080 Ate IF ARG GT, FAC
1330 20100 #DOREL DEPENDS UPON THE FACT THAT FCOMP RETURNS WITH CARRY ON
1331 2v1e0 FF A HAS 377
1332 2vi4e FALTERS Ay Hy
1333 901317" Go1eve 000170 2¢iea FCOMP: MOY a) CHECK IF ARG IS ZERO
1334 901320" oaieae eeaes7 an1eo ORA A
1335 901321¢ oaieee aeaste 20200 era SIGN
1536 081322" aageco avoveex
1337 001323¢ gga0e0 avie7s?
1338 001324¢ ga1008 evoudi aveee LxI Hy FCONPS WE JUMP TO FCOMPS WHEN WE ARE DONE.
1339 001329° deeeed oe1141¢
1340 91320" oaeoee eursee?
1341 901327¢ Bo1ee2 oees45 2vaaa PUT THE ADDRESS ON THE STACK
1342 021330" Baieee av0357 2260 CHECK IF FAC IS ZERO
1343 001331" @oiove avoi71 20280 HIF IT I8, RESULT IS MINUS THE SIGN OF ARG
1344 961332" Gaiovo 00510 20300 IT 18
1345 001335° @oio00 eeeas 2esee POINT TO SIGN OF FAC
1346 o01534¢ 777777 777777
1347 001333* Ogvoee ov1525°
1348 201336" @alee2 edeso 20340 4 SEE IF THE SIGNS ARE THE SAME
1349 001337" Ooieee avo171 20360 arc VIF THEY ARE DIFFERENT, RESULT IS SIGN OF ARG
1350 001340" Ooieve 00370 20380 THEY ARE DIFFERENT
1351 001341" doicee 200515 2va0e FCOMP2 CHECK THE REST OF THE NUMBER
1352 0134e" @aeo99 ev1347"
001343" oaeeaa eoLssar
@1344* oe1eaa geov37 20420 FCOMPDS {NUMBERS ARE DIFFERENT, CHANGE SIGN IF
1355 @01345° @otoee eeaesi 20440 C } BOTH NUMBERS ARE NEGATIVE
1356 @01346° @aivaa geosit angen #G0 SET UP A
1357
1358 001347" aoiego eeno4s 205e@@  FCOMPes #POINT TO EXPONENT
1359 @v135e* aotee0 0170 20520 GET EXPONENT OF ARG
021351" voices aoeeTe 20540 COMPARE THE THO
av135e" veteee vvaseu 20560 NUMBERS ARE DIFFERENT
1362 081355" ea1ee0 oevess 20500 POINT TO HO
1363 G01354* @o1oee ovai7i 20600 HGET HO OF ARG
1364 @81355* aaleee wvae7e aveeo M HCOMPARE WITH HO OF FAC
001356" vaicee avasas 20640 THEY ARE DIFFERENT
801357" gainee goevss 2660 POINT TO MO OF FAC
1367 021360" dvigeo avaiTe 20680 }GET MO OF ARG
@01361" OvieeD oveeTe 2070 HCOMPARE WITH MO OF FAC
01362" be1ee sva300 avrea FTHE NUMBERS ARE DIFFERENT
@1363" waisoe auowss 20740 ¢ HPOINT TO LO OF Fac
001364" ealca0 a0017s 20760 GET LO OF ARG
901365* eoievs avaeee 20780 HSUBTRACT LO OF FAC
@01360" apie e00see 20800 Zz TNUMBERS ARE DIFFERENT
01367" Baloo avesa1 20820 JNUMBERS ARE THE SAME, DON?T SCREW UP STACK
@21370° Boieoo evesar 20840
91371" algae easii 20860 TALL DONE

MATHPK FOR BASIC MCS 8080

Fa

1378
1379
1360
1381
1382
1383
1384
1385
1586
1387
1568
1389
1390
1394
1592
1393

1396
1397
1398
1399
1400
1404
14e2

Fa

1431
1432

GATES/ALLEN/DAVIUOFF MACRO 47(115) 06409 27=AUGH75 PAGE 7m1

Mac 2SeAUGHO4 6108 COMPARE TWO NUMBERS

20920
20940
20960
20980
21000
21020
21940
21060
21080
21100
21120
21142
21160
21160
21200
21220
21240
21260
21280
21300
aisee
21340
21300
21380
21400
21420
21440
21460
21480
21500
21520
21540
21560
21580
21600
21620
21640
21660
21660
21708
2i72a
2174
21760
21760
21608
21820
21840
21860
21eee
21900
21920
21948

TFE

ICOMPS

OCOMPD:

comes

OcomPis

LENGTHe2,<

COMPARE TWO INTEGERS

peat IF (DE) ghT, CHL)

gAsO IF (DE)*(HL)

Hase1 IF (OE) GT, CHL)

FALTERS A ONLY

MOV Ayo FARE THE SIGNS THE SAME?

xRA H

MOV AyH VIF NOT, ANSWER IS THE SIGN OF (HL)
aM ICOMPS FTHEY ARE DIFFERENT

CMP 0 ITHEY ARE THE SAME, COMPARE THE HOFS
INZ SIGNS 3GO SET UP A

MOV Ark FCOMPARE THE LOFS

sus E

INE SIGNS 41G0 SET UP A

RET TALL DONE, THEY ARE THE SAME

FCOMPARE TWO DOUBLE PRECISION NUMBERS
TASL TF ARG

Amt IF ARG ,GT, FAC

FALTERS A,B,C, 0, Ey Heb

xt Hy ARGLO TENTRY WITH POINTER TO ARG IN (OE.

MVI Lav) FSET UP COUNT TO MOVE DBL NUMBERS.

CALL MOVES TMOVE THE ARGUMENT INTO ARG

xt 0, ARG GET POINTER TO ARG

Loax =O FSEE IF ARGeO

Ora ry

Rd SIGN TARG=0, GO SET UP A

LxI HH, FCOMPS PUSH FCOMPS ON STACK SO WE WILL RETURN TO
PUSH oH 1 TO IT ANO SET UP A

FSIGN WSEE IF FaCeg

ex D) TPOINT TO SIGN OF ARG

Loax GET SIGN OF ARG

Mov cya HSAVE IT FOR LATER

RZ FFACRO, SIGN OF RESULT IS SIGN OF ARG
xr Hy PACS HPOINT TO SIGN OF FAC

RA ct) SEE IF THE SIGNS ARE THE SAME

Mov Ayc VIF THEY ARE, GET THE SIGN OF THE NUMBERS
RM JTHE SIGNS ARE DIFFERENT, GO SET A

Ink FPOINT BACK TO EXPONENT OF ARG

INK HPOINT TO EXPONENT OF FAC

MVE SET UP A COUNT

LOAx GET A BYTE FROM ARG

SUB JCOMPARE IT WITH THE FAC

JNZ HTHEY ARE DIFFERENT, GO SET UP A

cx }THEY ARE THE SAME, EXAMINE THE NEXT LOWER
bex 7} ORDER BYTES

OCR FARE WE DONE?

INZ NO, COMPARE THE NEXT BYTES

PoP TTHEY ARE THE SAME, GET PCOMPS OFF STACK

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIOOFF MACRO 47(115) 06309 27mAUGHTS PAGE 792
Mac

23eAUGHO4 6108 COMPARE TWO NUMBERS

21960
21960

PAGE

RET> PALL DONE

MATHPK FOR BASIC WCS 880 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06309 27-AUGe75 PAGE 8
Fa Mac 23WAUG9O4 6108 CONVERSION ROUTINES BETWEEN INTEGER, SINGLE AND DOUBLE PRECISION

1433 220U0 SUBTTL CONVERSION ROUTINES BETWEEN INTEGER, SINGLE AND DOUBLE PRECISION
1434 22020 FE LENGTH=a,<
1435 2eoa FORCE THE FAC TO BE AN INTEGER
1036 22060 FALTERS 4,8,C,D,€,HyL
1437 22080 © FRCINT? LDA VALTYP FSEE WHAT WE HAVE
1438 2e100 c 4
1439 2e120 Facto JGET FACLO*G,1 IN CASE WE HAVE AN INTEGER
1440 2140 WE HAVE AN INTEGER, ALL DONE
iaay 22160 TWERR WE HAVE A STRING, THAT 18 A "NO=NOP
iaae 22180 GUNSD TIF WE HAVE & DBL, CONVERT IT TO A SNG
1445 22200 Hy OVERR JPUT GVERR ON THE STACK SO WE WILL GET ERROR
1449 22220 1_IF NUMBER IS TOO BIG
1445, 2eauo JFALL INTO CONIS
1446 22200
4447 22280
1448 22300 CONVERT SINGLE PRECISION NUMBER TO INTEGER
1449 22320 FALTERS AyB,C,0,E,HyL
tase 22348 CONIS$ LOA FAC HGET THE EXPONENT
1451 22360 crt 2ee HSE IF IT IS TOO B16
1452 22580 INC CONrse FIT 1S, BUT IT MIGHT BE #32768
1453 22400 CALL = GINT JIT ISN*T, CONVERT IT TO AN INTEGER
1454 2eaa0 XCHG #PUT IT IN (HL)
1455 22440 CONTS1: POP. o GET ERROR ADDRESS OFF STACK
1456 2eaod ENTRY FROM SGN, FIN, LINPRT
1457 22480 CONISS+ SHLD = FACLO STORE THE NUMBER IN FACLO
1456 22500 MvT Aye SET VALTYP TO "INTEGER"
1459 22520 CONISO: STA VALTYP JENTRY FROM CONDS
1460 22540 RET TALL DONE
ider 22560 CUNIS21 MOVRI 220,200,000,000 JCHECK IF NUMBER IS =32768, ENTRY FROM FIN
idee 22560 CALL PCOMP
1463 22600 RNZ VERROR! IT CANfT BE CONVERTED TO AN INTEGER
1464 22620 mov H/C IT IS #32768, PUT IT IN CHL)
1465 22040 wov Lio
1466 22600 ump CONISI STORE IT IN THE FAC AND SET VALTYP.
22680
22700
ered JFORCE THE FAC TO BE A SINGLE PRECISION NUMBER
aerae FALTERS Ay B,C)D,E,HoL
22769 © FRCSNG? LOA VALTYP 1SEE WHAT KINO OF NUMBER WE HAVE
22768 cet 4
22800 R2 JWE ALREADY HAVE AN INTEGER, ALL DONE
2esee sc CUNSI WE HAVE AN INTEGER, CONVERT IT
2eaue am THERR TSTRINGS|| w= ERROR!
22860 OBL PREC w= FALL INTO CONSD
22880
22900
2a9e0 HCONVERT DOUBLE PRECISION NUMBER TO A SINGLE PRECISON ONE
22940 FALTERS A,B,C,0,E,4,L
2296 CONSDt CALL —HOVRF FGET THE HO*S IN THE REGISTERS
22980 MVE Aa FSET VALTYP TO "SINGLE PRECISON™
aseee STA VALTYP
2seee Mov AyB CHECK IF THE NUMBER IS ZERO
a3o40 ORA A

MATHPK FOR BASIC NCS 8G80 GATES/ALLEN/UAVIDOFF MACRO 47(115) 96309 27*AUGe75S PAGE Bmt
Fa MAC 23rAUGHO4 06108 CONVERSION ROUTINES BETWEEN INTEGER, SINGLE AND DOUBLE PRECISION

1486 asvoa Re HIF IT IS, WE ARE DONE
1487 2so8e CALL UNPACK FUNPACK THE NUMBER
1488 23100 UxI Hy FACLOmt HGET FIRST BYTE BELOW A SNG NUMBER
1489 asi20 MoV ByM PUT IT IN B FOR ROUND
1490 asiag ane ROUND FROUND THE DBL NUNBER UP AND WE ARE DONE
1491 asioo
1492 23180
1493 23200 ICONVERT AN INTEGER TO A SINGLE PRECISION NUMBER
1494 aseeo FALTERS A,B,C,D,2,AyL
1495 a3240 CONSIz LHLO FACLO HGET THE INTEGER
1496 23260 © CONSIHs MVI Ana FSET VALTYP TO "SINGLE PRECISION"
1497 23260 STA VALTYP
1498 25300 Mov Ay FSET UP REGISTERS FUR FLOATR
1499 23320 ov Or
1500 23340 MI Eo
1501 23360 MvI 8,220
1502 25380 IMP FLOATR G0 FLOAT THE NUMBER
41503 25400
1504 as4eo
15¢5 25440 FORCE THE FAC TO BE A DOUBLE PRECISION NUMBER
1506 23400 FALTERS A,B,C,D,E,4)L
1507 25480 FRCDBL? LOA VALTYP. #SEE WHAT KIND OF NUMBER WE HAVE
1508 23500 CPL 10
1509 23520 RZ WE ALREADY HAVE A OBL, WE ARE DONE
4510 23540 INC THERR GIVE AN ERROR IF WE HAVE A STRING
1541 23500 cl a SEE IF WE HAVE A SNG OR INT
1512 23580 ce CONST #CONVERT 10 SNG IF WE HAVE AN INT
1513 23600 HPALL INTO CONDS AND CONVERT TO DBL
1514 23620
1515 25640
1516 23660 CONVERT A SINGLE PRECISION NUMBER TO A DOUBLE PRECISION ONE
1517 asoee ALTERS Ay H,L
1516 23708 CONDSt Ux Hy SCODE VZERO HyL
1519 23720 SHLO - DFACLO FCLEAR THE FOUR LOWER BYTES IN THE DOUBLE
1520 2sT4 SHLD - DFACLO+2 i PRECISION NUMBER
1524 as7ee VE Aro SET VALTYP TO "DOUBLE PRECISION"
sez 23780 MP CUNISD> G0 TO IT

23800

MATHPK
Fa

1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1544
1542
1545
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1363
1564
1565
1566
4567
1568
1569
1578
1571
1572
1573
1574

MATHPK
Fa

1577
1578
1579
1580
1581
1582
1563
1584
1585
1586
1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
ove
leet
ove
1603
1604
1605
1006
1607
1606
1609
foto
foi
tote
1613
1e14
1615

FOR BASIC MCS Bese
23PAUG=o4 O

Mac

oo1srer
oo137s¢
oo1s7ae

eoisr7e

Bor4aet
@e14a1°
oeidee?
@uianse
vaiagae
@aiaas¢
@viago?
Baraare

oa143s¢

eoiasae

FOR BASIC MCS 8080

Mac
@a1a3s¢

wo14ser
oe14s7?
aar4ager
@e1gait
oo14ger

oaiagse

eaiagae

ao1aas?
Od1a4oF
oo1447"
eu14se?
ea14asit
oo14set

ao14ss?
oai4asae
@e14ss°
ev14se*

ourasre
@o1460°
wetaer?
oa14eet
ov14es?
oaiaear

eaides?
walgeo?
aides?
ae1470"

ow14a7i?

eoi1veo
@a1090
aeieee
eeiouo
aoi000
oeieoo

@o1290
eaicee
epoca
eorece
ao1e9eo
aeoeae
eeeaso
ae1eeo
Boi1eeo
voieoa
eoveae
aaevue
ea1coo
aaeceg
@aiooe

aaevee

de1vee

avoier
ovo117
aeoiar
000137
aveee?
ovesie

euasas
2@0315
Berean?
eoisaer
a@asi5
goia7er
avidoer
aeaese
eve147
900374
ov14ser
aordase
awav7e
aeoese
aoweee
000315
avossar
oerdier
eeai74
aeavaT
ovass4
eeoess’
aeraeae
Beavee
eeavee
900534
geosior
aides?

ovosay

23eAUG=64 26108

aaleoe

aaieoo
Ga1aee
@o1ave
@o1e00
e@aives

o100e

ee10e0

ba1000
eave00
ecevne
ag1e00
@a1000
eaveoe

ao1000
ogeeao
evovee
ap1000

ae1000
@eiego
eavoes
apeoed
eareoe
20000

aa1ouo
oe1000
ao1e0n
@o1eo

woieoe

avosi1

aeouss
eenite
aeoeas
evoura
evesau

eeouls

avasis

geowds
@@1156*
ee1ase?
aeai7e
geas7e
oenese

aevvre
Bo1eso*
201446"
eeosae

evai7e
oe9s15
av1ster
eei4sa?
aeeaeee
aoaese

aeai7s
200se5
e017)
aoavet

avasis

GREATEST INTEGER FUNCTION

aseeo
238d
25860
25880
23900
25920
23940
23900
23960
aagve
24oe0
24040

2aaeo
24190
2aree
24140
24160
24160
24200
24220
24240
24260
24280
24300

2asee

24340
24300
24360

2aa00

aageo
24aaa

244oo
24460
24500

2asee

24540

2456
24560

GREATEST
24600

24640
24668
24660
24700
2a7eo
24740
24760
24780
24aee
24aeo
24840
24860

24920
24940
24900
24980
aseoe
asaea
25040
25000
25080
25100

asiee
25140

25160
25160

25200
25220
asada
25200

25260

25300
asseo
2534
25360
25360
25400
25420
25440
2546
a5aee

SuaTTL

GREATEST INTEGER FUNC

GATES/ALLEN/DAVIDOFF MACRO 47(115) 06209 27*AUGe7S PAGE 9
8

TION

VQUICK GREATEST INTEGER FUNCTION

LEAVES INT(FAC) IN C
JASSUNES FAC yLT, 272
VASSUNES THE EXPONENT
JALTERS A,8,C,D,E

NOV yA

Nov CoA

mov Opa

nov E,A

ORA A

RZ

10,E (SIGNED)
38 8388008
OF FAC IS IN A

VZERO B,C,D,€ IN CASE THE NUMBER IS ZERO

SET CONDITION CODES
FIT 18 ZERO, WE ARE DONE

FTHE HARO CASE IN GINT IS NEGATIVE NONSINTEGERS, TO HANOLE THIS, IF THE
FNUMBER IS NEGATIVE, WE REGAR
TSUBTARCT ONE, THEN ALL THE
IMANTISSA RIGHT, THEN, IF TH
THAD A NEGATIVE INTEGER, ALL

FZERO,

SO THE NET EFFECT IS

D THE 3eBYTE MANTISSA AS A 3e6YTE INTEGER AND
FRACTIONAL BITS ARE SHIFTED OUT BY SHIFTING THE
E NUMBER WAS NEGATIVE, WE ADD ONE, $0, IF WE
THE 81TS TO THE RIGHT OF THE BINARY POINT WERE
WE HAVE THE ORIGINAL NUMBER IN C,0,E, IF THE

NUMBER WAS A NEGATIVE NON®INTEGER, THERE IS AT LEAST ONE NONWZERO BIT TO ThE
iRIGHT OF THE BINARY POINT,
AVALUE OF INTCPAC) IN C,0,E,
INEGATIVE $Q THE RESULT WILL BE SIGNED,

PUSH oH
CALL MOVRF

CALL UNPACK

XRA ”

Mov Hea

ch GINTA

MVE A230
8
SHIFTR
AyH

ROUNDA

INTEGER FUNCTION

IFE
INTFNCS

RET

ocx 0
Mov rv)
ANA G
INR ry
RNZ
LENGTH=2,<
ock c>
LENGTH=2,<
ocx B>

RET

IGREATEST INTEGER FUN
FALTERS A, B,C,0,E,MyL
LENGTHw2,«

cer 4

RC

NZ INT

CALL = CUNIS>

xr Hy FAC

Mov Aum
cri 230

EXTFNC,<
Loa FACLo>

RNC

EXTFNC,<

Mov AyM>
CALL GINT

MVE M230

EXTFNG,<
Mov ME
PUSH PSW>
Mov AYe

RAL

EXTFNC,<

ne FADFLT>
EXTFNC,<

CALL FADFLT

SO THE NET EFFECT IS THAT we GET THE ABSOLUTE
C,0,£ IS THEN NEGATED IF THE ORIGINAL NUMBER WAS

SAVE (HK)
GET NUMBER IN THE REGISTERS

JUNPACK THE NUMBER

GET SIGN OF NUMBER

FOON*T LOSE IT

TSUBTRACT 1 FROM LO IF NUMBER IS NEGATIVE
FSEE HOW MANY WE HAVE TO SHIFT TO CHANGE

1 NUMBER TO AN INTEGER

TSHIFT NUMBER TO GET RID OF FRACTIONAL 6ITS

GET SIGN

PUT SIGN IN CARRY SO IT WILL NOT BE CHANGED
VIF NUMBER WAS NEGATIVE, ADD ONE

JFORGET THE BITS WE SHIFTED OUT

JNEGATE NUMBER IF IT WAS NEGATIVE BECAUSE WE

1 WANT A SIGNED MANTISSA
HGET OLD (HL) BACK

GATES/ALLEN/DAVIDGFF MACRO 47(113) 0609 27*AUG®75 PAGE 91

FALL DONE

}SUBTRACT ONE FROM C,D,E

WE HAVE TO SUBTRACT ONE FROM C IF
} 0 AND E ARE BOTH ALL ONES

}SEE IF BOTH WERE =}

STHEY WERE NOT, WE ARE DONE

TTHEY WERE, SUBTRACT ONE FROM C

GTHIS IS FOR BILL, C WILL NEVER BE ZERO

1 (THE MSB WILL ALWAYS BE ONE) SO "OCX BM

1 AND "OCR CM! ARE FUNCTIONALLY EQUIVALENT
TALL DONE

CTION

FSEE WHAT KIND OF NUMBER WE HAVE

FIT IS AN INTEGER, ALL DONE

FCONVERT THE DOUBLE PRECISION NUMBER

FTRY TO CONVERT THE NUMBER TO AN INTEGER
VIF WE CANfT, WE WILL RETURN HERE TO GIVE A
7 SINGLE PRECISION RESULT

1GET EXPONENT

VSEE IF NUMBER HAS ANY FRACTIONAL BITS
THE ONLY GUY WHO NEEDS THIS DOESN*T CARE
J} ABOUT THE SIGN

HIT DOES NOT

1GET EXPONENT BACK

VIT DOES, SHIFT THEM OUT

}CHANGE EXPONENT SO IT WILL BE CORRECT
} AFTER NORMALIZATION

GET LO

FSAVE IT

FNEGATE NUMBER IF IT IS NEGATIVE

FPUT SIGN IN CARRY

TREFLOAT NUMBER

TREFLOAT NUMBER

MATHPK FOR BASIC MCS 808@ GATES/ALLEN/UAVIDOFF MACRO 47(113) 6429 27=AUG@75 PAGE 9=2
F4 MAC 23-AUGrO4 26508 GREATEST INTEGER FUNCTION

1632 41472" Booove evar4s?
1631 081475" aogoao ov14ei"
1632 001474" deivaa oveseL POPPRT? POP GET LO BACK
1633 901475" aoiove aeasii RET> TALL DONE
1634
1635
1636 | LENGTHe2,<
1637 JGREATEST INTEGER FUNCTION FOR DOUBLE PRECISION NUMBERS
1638 FALTERS A,B, C,O,E,Hyk
1639 LxI HyPAC #GET POINTER TO Fac
1o40 Mov AyM GET EXPONENT
1641 CPI 220 JCAN WE CONVERT IT TO AN INTEGER?
eae sc FRCINT THEN DO SO
1643 JNZ OINT2 }CHECK FOR 32768
1644 Mov CyA HSAVE EXPONENT IN C
1645 ocx ct 1GET POINTER TO SIGN AND HO
1646 mov AYN GET SIGN AND HO
1647 XRT 200 HCHECK IF IT IS 200
1648 MVE 8,6 VSET UP A COUNT TO CHECK IF THE REST OF
1649 DINTIs Cx 4 } THE NUMBER IS ZERO, POINT TO NEXT BYTE
1650 ORA 4 TIF ANY BITS ARE NON®ZERO, A WILL BE NON®ZERO
1654 ocr 8 FARE WE DONE?
INE OINTL INO, CHECK THE NEXT LOWER ORDER BYTE
ORA A VIS A NOW ZERO?
16054 xt Hy 2@@n400+SCODE 7GET 32768 JUST IN CASE
Jz CONISS TA 18 ZERO SO WE HAVE #52768
Mov Ay GET EXPONENT
1657 OINT2s CPI 270 FARE THERE ANY FRACTIONAL BITS?
1058 RNC NO, THE NUMBER IS ALREADY AN INTEGER
1659 DINTFO? PUSH PSH VENTRY FROM FOUT, CARRY IS ZERO IF WE COME
} HERE FROM FOUT
CALL MOVRF 1GET HOFS OF NUMBER IN REGISTERS FOR UNPACKING
loee CALL UNPACK JUNPACK IT
XRA M 1GET ITS SIGN BACK

ocx 4 SET THE EXPONENT TO NORMALIZE CORRECTLY
MVI M270

PsW SAVE THE SIGN
cm OINTA HSUBTRACT 1 FROM LO IF NUMBER IS NEGATIVE
Ay270 GET HOW MANY BITS WE HAVE TO SHIFT OUT
8

sus
CALL DSHFTR HSHIFT THEM OUT)!
Por Psu GET THE SIGN BACK
cM DROUNA TIF NUMBER WAS NEGATIVE, ADD ONE
A TPUT A ZERO IN THE EXTRA LO BYTE SO WHEN
STA OF ACLOm1 1 WE NORMALIZE, WE WILL SHIFT IN ZEROS
Por Pw HIF WE WERE CALLED FROM FOUT, DON?T NORMALIZE,
RNC 7 JUST RETURN
ONORML PRE®FLOAT THE INTEGER

INT H,OFACLO TSUBTRACT ONE FROM FAC, GET POINTER To LO
DINTALS aM 1GET A BYTE OF FAC

C) TSUBTRACT ONE FROM IT

A FCONTINUE ONLY IF THE BYTE USED TO BE ZERO

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(413) 06109 27@AUGeTS PAGE 993
F4 MAC 23rAUGR64 BOIO8 GREATEST INTEGER FUNCTION

1683 2esee INK 4" FINCREMENT POINTER TO NEXT BYTE
1684 26540 Jz DINTAL FCONTINUE IF NECESSARY

1685 26560 RET> PALL DONE

1686 26580

MATHPK FOR BASIC NCS 6080 GATES/ALLEN/DAVIDOFF MACKO 47(113) 06109 27-AUGH75 PAGE 10
Fa Mac 23eAUGHO4 O6108 INTEGER ARITHMETIC ROUTINES

1687 26602 © SUBTTL INTEGER ARITHMETIC ROUTINES
1668 20620 IFN MULDIM&<LENGTHwa>, <
1689 26640 iTWO BYTE UNSIGNED INTEGER MULTIPLY
1690 26660 1 (HL) 48 (BC) x (DE)
1691 2o080 FA,DsE,HyL ARE CHANGED
1692 1476" Bo1ove eeowar 2070 © OMULTS LxI My SCODE 1ZERO PRODUCT REGISTERS
1695 @@1477" anocaa av1155*
1694 941500" voeege Bvr47a?
1695 av15a1" @oiae aao17e 26720 nov An ACHECK IF (BC) 18 ZERO
1696 001522" eoieae avaees 20740 ORA c HIF SO, JUST RETURN, (HL) IS ALREADY ZERO
1097 001505¢ dolce avasio 26760 RZ STHIS IS DONE FOR SPEED
1698 901504" eaivoe vooLeTe 20780 MVE A,20 1SET UP A COUNT
1699 081505" eaevee avaveo
1708 901596" @aicaa auoesi 26608 © OMULTI# DAD cy PROTATE (HL) LEFT ONE
1701 02152/* oleae evosse e820 Jc BSERReH TCHECK FOR OVERFLOW, IF $0,
1702 001510" eaeces aeovaex
1703 981511 egeced wera77*
1704 91512" Goicea 90353 26840 XCHG 1 BAD SUBSCRIPT (BS) ERROR
1705 001515" eaievo ooesi 26860 bao PROTATE (DE) LEFT ONE
1706 021514" aaizea avo3ss 26880 XCH
1707 081515" aoiceo oeosee 26900 NC ADD IN (BC) IF HO WAS 1
4788 01516" saves aeisear
1709 @8151/* ag0eaB ovisie*
1710 981520" ao1oee eeoet 26920 ad
1711 001521" Ogieea ovos3e 26940 sc CHECK FOR OVERFLOW
1712 @e1sae* eoevea oo151e6
1713 o81525* evened visio’
1714 001529" ataa0 aeae7s 26960 ocr 1SEE IF DONE
1715 9@1525¢ @n1ee0 owasae 26980 NZ
1716 021520" agen ae15a6*
1717 @81527* @ovoes wersee*
001530" waives oeesi1 27080 RET> FALL DONE

27o60  IFE LENGTHe2,«
27080 COMMENT x
27108 INTEGER ARITHMETIC CONVENTIONS

27120

27140 INTEGER VARIABLES ARE 2 BYTE, SIGNED NUMBERS

27160 THE LO BYTE COMES FIRST IN MEMORY

27180

27200 CALLING CONVENTION

27220 FOR ONE ARGUMENT FUNCTIONS?

27eaa THE ARGUMENT IS IW (HL), THE RESULT IS LEFT IN (HL)

27260 FOR TWO ARGUMENT OPERATIONS?

27280 THE FIRST ARGUMENT IS IN (DE)

27300 THE SECOND ARGUMENT IS IN (RL)

27320 THE RESULT IS LEFT IN CHL)

27340 IF OVERFLOW OCCURS, THE ARGUMENTS ARE CONVERTED TO SINGLE PRECISION
27360 WHEN INTEGERS ARE STORED IN THE FAC, THEY ARE STORED AT FACLO+G,1
27380 VALTYP (INTEGER) #2

a7aeo x

27r4eo

ce)
e

MATHPK FOR BASIC MCS 6080 GATES/ALLEN/VAVIUOFF MACRO 47(113) 2609 27~AUG#75 PAGE 1061
F4 MAC 23rAUGwOd 6108 INTEGER ARITHMETIC ROUTINES

1740 a7aaa
1744 27460 FINTEGER SUBTRTACTION (HL) $#(DE)=(HL)
1742 27480 ALTERS A,B,C,0,E,Hyl,
1743 27500 Isubs MOV AH JEXTENO THE SIGN OF (HL) TO B
1744 27see RAL GET SIGN IN CARRY
1745 27540 386 a
1746 27560 mov ByA
1747 27580 CALL INEGHL PNEGATE (HL)
1748 27608 Mov ALC 1GET A ZERO
1749 27620 8B 8 JNEGATE SIGN
1750 27eay one Tao0s 1GO ADD THE NUMBERS
1754 27660
1752 27660
1753 27700 FINTEGER ADDITION CHL) = (DE) + CHL)
1754 277eo FALTERS A,B,C,D,E,AyL
1755 27740 Tabb MOV ArH FEXTEND THE SIGN OF (HL) TO B
1756 27760 RAL GET SIGN IN CARRY
1757 27780 SBB a
1758 27800 = TADDS: NOV 6A SAVE THE SIGN
1759 27820 PUSH oH SAVE THE SECOND ARGUMENT IN CASE OF OVERFLOW
1760 27840 Mov AyD FEXTEND THE SIGN OF (DE) TO A
1764 27860 RAL 1GET SIGN IN CARRY
1762 27860 S88
1763 27900 dao 0 FADD THE TWO LOFS
1764 27920 A0c 8 VADD THE EXTRA HO
1765 27940 RRC JIF THE LSB OF A IS DIFFERENT FROM THE HSB OF
1766 27960 XRA H 7-H) THEN OVERFLOW OCCURED
4767 27968 uP POPPRT NO OVERFLOW, GET OLD (HL) OFF STACK AND WE
1768 26000 7 ARE DONE
1769 28020 Push B TOVERFLOW ** SAVE EXTENDED SIGN OF (HL)
1770 26048 XCHG TGET (DE) IN (HL)
4774, 28068 CALL © CONSIH HFLOAT IT
177e 28080 PoP Pw TGET SIGN OF (HL) IN A
1773 26100 PoP H GET OLD (HL) BACK
41774 28120 CALL PUSHF TPUT FIRST ARGUMENT ON STACK
4775 28140 XCHG TPUT SECOND ARGUMENT IN (DE) FOR FLOATR
1776 26160 CALL INEGAD FLOAT IT
4777 28160 POPR 7GET FIRST ARGUMENT OFF STACK
1778 2a200 amr FADD FADD THE TWO NUMBERS USING SINGLE PRECISION
1779 2a2e0
2eean
28260 FINTEGER MULTIPLICATION CHL) #8 (DE) * (HL)
4762 2e260 FALTERS AyB,C,D,E,HyL
28300 = IMULT: PUSH =H VSAVE SECOND ARGUMENT IN CASE OF OVERFLOW
26320 PUSH oO FSAVE FIRST ARGUMENT
1785 28340 CALL = IMULOV FIX UP THE SIGNS
1786 28360 PUSH 8B HSAVE THE SIGN OF THE RESULT
1787 26300 Mov a) HCOPY SECOND ARGUMENT INTO (BC)
1788 2edoa Mov Crk
1789 aesee uxt Hy SCODE FZERO (HL), THAT IS WHERE THE PRODUCT GOES
1790 aeaay MT Ay 20 ¥SET UP A COUNT
1791, 28460 © IMULTI13 DAD 4 FROTATE PRODUCT LEFT ONE
2eaeu Je THULTS CHECK FOR OVERLFOW

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/UAVIOOFF MACRO 47 (113) 06109 27*AUG=75 PAGE 1262
F4 Mac 23-AUGH64 06208 INTEGER ARITHMETIC ROUTINES

1793 2eseo XCHG TROTATE FIRST ARGUMENT LEFT ONE TO SEE IF
1794 26520 DAD 4 1 WE ADD IN (BC) OR NOT
1795 28540 XCHG
1796 26560 JNC INULT2 JDON*T ADD _IN ANYTHING
1797 26580 DAD 6 FADD IN (BC)
1798 28600 wc IMULTS }CHECK FOR OVERLFOW
1799 26620 «= IMULT2t OCR A FARE WE DONE?
1800 26e40 INE INULTS INO, DO IT AGAIN
1601 28660 PoP 8 TWE ARE DONE, GET SIGN OF RESULT
1802 2eeee POR 0 GET ORIGINAL FIRST ARGUMENT
1603 28700 © IMLOIV: MoV Av FENTRY FROM IDIV, IS RESULT ,GE, 327687
1604 ae7ea ORA a
1805 26740 am TWULTS 1T IS, CHECK FOR SPECIAL CASE OF »32768
1866 28768 PoP ) FRESULT IS OK, GET SECOND ARGUMENT OFF STACK
1807 2e76e Mov AyB GET THE SIGN OF RESULT IN A
1608 26800 INP, INEGA INEGATE THE RESULT IF NECESSARY
1609 28820 © IMULT3 XRT 200 VIS RESULT 327687
1810 2eada OR ih #NOTES IF WE GET HERE FROM IDIV, THE RESULT
1814 28860 rd INULT4 } MUST BE 32768, IT CANNOT BE GREATER
1812 26880 XCHG IT IS ,GT, 32768, WE WAVE OVERFLOW
1813 28908 xuD 100,003 JULXT 8" OVER NEXT 2 BYTES
1814 28920 IMULTS: POP 8 GET SIGN OF RESULT OFF STACK
1815 28940 POP H GET THE ORIGINAL FIRST ARGUMENT
1816 26960 CALL CONSIH HFLOAT IT
1817 26980 PoP 4 GET THE ORIGINAL SECOND ARGUMENT
1818 29000 CALL PUSHF FSAVE FLOATED FIRST ARUMENT
1819 29020 CALL = CONSIW JFLOAT SECOND ARGUMENT
1820 290409 © FMULTT? POPR GET FIRST ARGUMENT OFF STACK, ENTRY FROM POLYX
1eat
29060 vnP FMULT JMULTIPLY THE ARGUMENTS USING SINGLE PRECISION
2908@ = IMULT4s MoV AB VIS RESULT #32768 OR #327687
1824 29100 ORA a GET ITS SIGN
1625 2viee POP 8 FOISCARD ORIGINAL SECOND ARGUMENT
1626 29140 RM FTHE RESULT SHOULD BE NEGATIVE, IT IS OK
1627 29100 PUSH =D FIT 18 POSITIVE, SAVE REMAINDER FOR MOD
1828 goyke CALL CONSIH }FLOAT #32768
1829 29200 Por r) 7GET MOD?S REMAINDER BACK
1830 2veee JMP NeG FNEGATE =32768 TO GET 32768, WE ARE DONE
1631 29240
1832 29260
29280 FINTEGER VIVISION CHL) § (DE) / CHL)
29300 JREMAINDER IS IN (DE), QUOTIENT IN (HL)
1635 29320 FALTERS A,8,C,0,£,H,L
1836 29340 Mov Ait HCHECK FOR DIVISION BY ZERO
1837 29360 ORA i
1838 29380 Jz DV@ERR FWE HAVE DIVISION BY ZERQU
agaoe CALL INULDV FIX UP THE SIGNS
29420 PUSH 6B SAVE THE SIGN OF THE RESULT
1604 29440 XCHG GET DENOMINATOR IN (HL)
29400 CALL INEGHL TNEGATE IT
29460 Mov BH SAVE NEGATED DENOMINATOR IN (BC)
29500 Mov Cok
29520 LxI H, SCODE VZERO WHERE WE DO THE SUBTRACTION

MATHPK FOR BASIC MCS 6080 GATES/ALLEN/UAVIDOFF MACRO 47(115) 6109 27-AUGR75 PAGE 10-3
F4 Mac 23nAUGHO4 O6408 INTEGER ARITHMETIC ROUTINES

1846 29540 MVE Arad 7SET UP A COUNT
1647 29560 PUSH PSH TSAVE IT
1846 29580 ORA Ly FCLEAR CARRY
1849 29600 IMP 1otv3 7G0 DIVIDE
1850 29620 IDIVis PUSH PS SAVE COUNT
1851 29640 PUSH oH SAVE (HL) I,€, CURRENT NUMERATOR
1852 29600 OAD 8 TSUBTRACT DENOMINATOR
1653 29680 INC rove TWE SUBTRACTED TOO MUCH, GET OLD (HL) BACK
1854 29700 PoP Pou THE SUBTRACTION WAS GOOD, DISCARD OLD (HL)
1855 29720 Sic NEXT BIT IN QUOTIENT IS A ONE
1856 29740 xu 1000,076 i"HVI AM OVER NEXT BYTE
1857 29760 = 1blvaz_ POP fo VIGNORE THE SUBTRACTION, WE COULON‘T DO IT
1858 29760 = IvIV3: MOY VSHIFT IN THE NEXT QUOTIENT BIT
1859 29800 Ral,
1860 29820 Mov
1661 29840 mov SHIFT THE HO
1662 29868 RAL
1863 29860 Mov
1864 29908 MOV VSHIFT IN THE NEXT BIT OF THE NUMERATOR
1865 29920 RAL
1666 29940 MOV
1667 29960 Mov 100 THE HO
1868 29980 RAL
1869 30000 MoV VSAVE THE HO
1870 30020 POP GET COUNT BACK
1871 30000 ocR TARE WE DONE?
1872 30060 INZ NO, DIVIDE AGAIN
1873 30080 XCHG #GET QUOTIENT IN (HL), REMAINDER IN (DE)
1874 30100 POP 1GET SIGN OF RESULT
1875 se120 PUSH TSAVE REMAINDER SO STACK WILL BE ALRIGHT
1876 30140 IMP IMLDIV VCHECK FOR SPECIAL CASE OF 32768
1877 30162
1678 30180
1879 see00 7GET READY TO MULTIPLY OR DIVIDE
1860 suze FALTERS A,B,C,0,€,H,L
1881 30240 IMULDV: NOV Abt GET SIGN OF RESULT
30260 XRA 0
30280 Mov Ba PSAVE IT IN B
1684 30300 CALL = INEGH INEGATE SECOND ARGUMENT IF NECESARY
30320 XCHG WUT (DE) IN (HL), FALL IN AND NEGATE FIRST
30340 J ARGUMENT IF NECESSARY
1687 30360
1868 30360
30400 INEGATE HyL,
30420 FALTERS &yCyHyL
30440 © INEGHs MOV AyH 1GET SIGN OF (HL)
3@460 INEGAs ORA A 7SET CONDITION CODES
30480 RP TWE DON*T HAVE TO NEGATE, IT IS POSITIVE
30500 © INEGHL: XRA FCLEAR A
3e5e0 Mov cya FSTORE A ZERO (WE USE THIS METHOD FOR IsuB)
30540 gus L NEGATE LO
30560 Mov Lea FSAVE IT
30580 Mov GET A ZERO BACK

MATHPK FOR BASIC NCS 808@ GATES/ALLEN/DAVIDOFF MACRO 47(115) 26309 27*AUGe7S PAGE 104
Fa Mac 23wAUGH64 B6108 INTEGER ARITHMETIC ROUTINES

1899 30600 $88 4 INEGATE HO
1980 30620 Mov HA HSAVE IT
1981 30640 ReT FALL DONE
1902 30660
1903 30680
1904 30700 FINTEGER ABSOLUTE VALUE
1905 30720 FALTERS &yB,C,0,E,H,L
1906 3074 1ABSt LDA FACLO+1 HGET SIGN OF INTEGER IN FAC
1907 30760 ORA A CHECK ITS SIGN
1908 30780 RP #17 18 POSITIVE, LEAVE IT ALONE
1909 30800 JFALL INTO INEG AND NEGATE IT
1910 30820
1941 3vaae
1912 30860 INTEGER NEGATION
19135 30880 FALTERS AyB,CyD,E,HyL
1910 30900 LHLO | FACLO GET THE INTEGER
1915 30920 CALL = INEGHL INEGATE 11
1916 30940 SHLD FACLO FSTORE IT BACK IN THE FAC
1917 30960 xRI 200 FCHECK FOR SPECIAL CASE OF 32768
1918 30980 ORA L
1919 31000 RNZ JIT DIO NOT OCCUR, EVERYTHING IS FINE
31020 XCHG WE HAVE IT, FLOAT 32766
31040 MVI aya TCHANGE VALTYP 10 "SINGLE PRECISION"
31060 STA VALTYP
3198 © INEGADS MVI 8,230 VENTRY FROM IADD, SET EXPONENT
31180 IMP FLOATR GO FLOAT ThE NUMBER
31120
31140
31160 SOD OPERATOR
31480 HCHL) $= (DE)™ (VE) / (HL) (HL), (OE) SQUOTIENT
31200 FALTERS A,B,C ,0,E,HyL
31220 PusH =O SAVE (DE) FOR ITS SIGN
31240 CAuL = OIDIV DIVIDE AND GET THE REMAINDER
31260 XCHG PUT REMAINDER IN (DE)
31280 VI Ara FSET VALTYP TO "INTEGER" IN CASE RESULT OF
31300 STA VALTYP f THE DIVISION WAS 32768
31320 PoP PSH 1GET THE SIGN OF (DE) BACK
31340 IMP INEGA> NEGATE THE REMAINDER IF NECESSARY
31300

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/UAVIDOFF MACRO 47(113) 06309 27=AUG#75 PAGE 11
Fa Mac 23-AUGe6d 46t08 DOUBLE PRECISION ARITHMETIC ROUTINES

1938 31380 © SUBTTL DOUBLE PRECISION ARITHMETIC ROUTINES
1939 31400 IFE LENGTH=2,¢
1940 31420 COMMENT %
1944 3144o DOUBLE PRECISION ARITHMETIC CONVENTIONS
1942 31460
1943 31480 DOUBLE PRECISION NUMBERS ARE 8 BYTE QUANTITIES
1944 31500 THE LAST 4 BYTES IN MEMORY ARE IN THE SAME FORMAT AS SINGLE PRECISION NUMBERS
1945 31520 THE FIRST 4 BYTES ARE 32 MORE LOM ORDER BITS OF PRECISION
1946 31540 THE LOWEST ORDER BYTE COMES FIRST IN MEMORY
1947 31500
1948 31560 CALLING CONVENTIONS:
1949 31600 FOR ONE ARGUMENT FUNCTIONSS
1950 31620 THE ARGUMENT 18 IN THE FAC, THE RESULT IS LEFT IN THE FAC
1951 31640 FOR TWO ARGUMENT OPERATIONS?
1952 31660 THE FIRST ARGUMENT IS IN ARGe7,6,5,4,3,2,)1,0 (NOTES ARGLOSARG=7)
1953 31660 THE SECOND ARGUMENT IS IN THE FAC
1954 31700 THE RESULT IS LEFT IN THE FAC
1955 31720  VALTYP (DOUBLE PRECISION) =1@ OCTAL
1956 31740 ok
1957 31760
1958 31760
1959 31800 FOOUBLE PRECISION SUBTRACTION FACSEARGRFAG
1960 31620 FALTERS ALL REGISTERS
1964 31840 CALL NEG }NEGATE THE SECOND ARGUMENT
1962 31860 FPALL INTO DADD
1963 31880
1964 31900
1965 3192 HDOUBLE PRECISION ADDITION FACS SARG+FAC
1966 31940 FALTERS ALL REGISTERS
1967 31960 x1 Hy ARS 1GET POINTER TO EXPONENT OF FIRST ARGUMENT
1968 31980 MOV AM WCHECK IF IT IS ZERO
1969 32000 ORA ry
1970 32020 RZ JIT 18, RESULT IS ALREADY IN FAC
1974 32040 mov ByA SAVE EXPONENT FOR UNPACKING
1972 32060 ocx ¥ #POINT TO HO AND SIGN
1973 32080 Mov CoM 7GET HO AND SIGN FOR UNPACKING
1974 32100 uxt FAC GET POINTER TO EXPONENT OF SECOND ARGUMENT
32120 LOAX oD GET EXPONENT
Seige ORA ry WSEE IF IT 18 ZERO
32160 Je VNOVFA FIT 18, MOVE ARG TO FAC AND WE ARE DONE
32180 suB 6 FSUBTRACT EXPONENTS TO GET SHIFT COUNT
seeve INC PUT THE SMALLER NUMBER IN FAC
See20 cha FNEGATE SHIFT COUNT
seaae INR
32260 PUSH $ FSAVE SHIFT COUNT
32280 PUSH FSAVE HO TO UNPACK LATER
52300 MVE a HSWITCH FAC AND ARG, SET UP A COUNT
Se3e0 INK FPOINT TO ARG
32340 © DADDIz LDA WGET A BYTE OF THE FAC
32360 mov 7GE1 A BYTE OF ARG
32360 ov TPUT THE FAC BYTE IN ARG
32400 Moy PUT THE ARG BYTE IN A
Seqad TPUT THE ARG BYTE IN FAC

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIOUFF NACRO 47(113) 96309 27=AUG#75 PAGE 1194
Fa MAC 23-AUG=64 06308 DOUBLE PRECISION ARITHMETIC ROUTINES

1991 32440 ocx POINT TO THE NEXT LO BYTE OF FAC

1992 32460 ocx HPOINT TO THE NEXT LO BYTE OF ARG

1993 32480 ocr TARE WE DONE?

1994 32500 INZ TNO, DO THE NEXT LO BYTE

1995 32520 PoP 8 GET THE HO BACK

1996 32540 Por GET THE SHIFT COUNT BACK

1997 3256a pAvvas CPI TARE WE WITHIN 56 BITS?

1998 3e5ee RNC HNO, ALL DONE

1999 32600 PUSH FSAVE SHIFT COUNT

2000 32620 CALL TUNPACK THE NUMBERS

2001 32640 Mov TSAVE SUBTRACTION FLAG

2002 $2600 mov FSAVE THE UNPACKED HO

2003 32080 STA

2004 32700 Por #GET SHIFT COUNT

2005 32720 CALL, z TSHIFT FAC RIGHT THE RIGHT NUMBER OF TIMES
2006 32740 ORM 8 1GET SUBTRACTION FLAG, HERE Aso

2007 32700 aP FSUBTRACT NUMBERS IF THEIR SIGNS ARE DIFFERENT
2008 32780 CALL JSIGNS ARE THE SAME, ADD THE NUMBERS

2009 32800 INC FROUND THE RESULT IF NO CARRY

2010 32820 INR 4 TWE HAVE OVERFLOW, ADD ONE TO THE EXPONENT
2011 Eriyy) rd }CHECK FOR OVERFLOW

2ai2 32862 vd HSHIFT NUNBER RIGHT ONE, SHIFT IN CARRY
2013 32080 CALL

2014 32900 Ria PROUND THE RESULT

2015 32920 © DADDS: xwD 1000,076 FOMVI AN, SUBTRACT THE NUMBERS

2016 32990 $68 M GET THE SUBTRACT INSTRUCTION IN A

2017 32960 CALL = DADUA HSUBTRACT THE NUMBERS

2018 32980 INX 4 POINT TO THE UNPACKED SIGN

2019 33000 mov AyM HCOMPLEMENT IT, SINCE THE FAC WAS SMALLER
2020 35020 CMA

2021 33040 Mov Mea

2022 33060 ce ONEGR JNEGATE THE RESULT IF IT WAS NEATIVE

2023 33080 TFALL INTO DNORML

aveq 33100

202s 35120

2026 33140 FNORMALIZE FAC
ever 33160 FALTERS A,B,C,0, Hy
2028 33180 © DNORMLE XRA A CLEAR SHIFT COUNT

2029 33208 © DNORMI: MOV ByA VSAVE SHIFT COUNT

2030 33220 Loa FaCet GET HO

2034 33240 ORA iy SEE IF WE CAN SHIFT 8 LEFT

2032 33260 JNZ DNORMS THE CAN*T, SEE IF NUMBER IS NORMALIZED.
2033 33260 UxI H,OFACLOe! JWE CAN, GET POINTER TO LO

2034 33300 MVI C10 SET UP A COUNT

2035 33320 © DNORMes MOV O,m GET A BYTE OF FAC

2036 33340 mov Mea JPUT IN BYTE FROM LAST LOCATION, THE FIRST
2037 33360 } TIME THROUGH A 18 ZERO

2038 33380 Mov AnD PUT THE CURRENT BYTE IN A FOR NEXT TIME
2039 33400 INX H FINCREMENT POINTER TO NEXT HIGHER ORDER
2e4e 33420 ocr c TARE WE DONE?

2oa1 33440 NZ 1NO, DO THE NEXT BYTE

2042 33460 Mov FSUBTRACT 8 FROM SHIFT COUNT

2003 33480 Sul

MATHPK FOR BASIC NCS 880 GATES/ALLEN/DAVIDOFF MACKO 47(113) 06309 27=AUGe7S PAGE 11-2
Fa MAC 23-AUGHO4 6108 DOUBLE PRECISION ARITHMETIC ROUTINES

2044 33500 cPr 300 HAVE WE SHIFTED ALL BYTES TO ZERO?
2045 33520 NZ ONORM NO, TRY TO SHIFT 8 MORE

2046 33540 MP ZERO JYES, THE NUMBER IS ZERO

2047 33568 © ONORM3: DCR 8 }OECREMENT SHIFT COUNT

2048 33580 xr H,OFACLO#} GET POINTER TO LO

2049 33600 CALL OSHFLE HSHIFT THE FAC LEFT

2050 33620 ORA A SEE IF NUMBER IS NORMALIZED

2051 35640 © ONORMS! JP. NORMS SHIFT FAC LEFT ONE IF IT IS NOT NORMALIZED
2use 33600 Nov An GET THE SHIFT COUNT

2053 33680 ORA A SEE IF NO SHIFTING WAS DONE

2054 33700 wz OROUND NONE WAS, PROCEED TO ROUND THE NUMBER
2055 35720 UxI HPFAC GET POINTER TO EXPONENT

2056 33740 40 i UPDATE IT

2057 33760 Mov Mer JSAVE UPDATED EXPONENT

2058 33760 INC ZERO JUNDERFLOW, THE RESULT IS ZERO

2059 33800 RL RESULT IS ALREADY ZERO, HE ARE DONE
2060 35820 JFALL INTG DROUND AND ROUND THE RESULT
aver 33840

2062 33860

2063 33880 PROUND FAC

2064 33900 FALTERS A,8,4,L

2065 33920 DROUNDS LOA OF ACLOm1 GET EXTRA BYTE TO SEE IF WE HAVE TO ROUND
2066 33942 OROUNBS ORA a TENTRY FROM DDIV

2ve7 33960 cw DROUNA FROUND UP IF NECESSARY

2008 35982 Lxt Hy PACH GET POINTER TO UNPACKED SIGN

2069 34000 MOV arn GET SIGN

2070 34020 ANI 200 FISOLATE SIGN BIT

2v7s 34040 ocx 4 POINT TO HO

aore s406e ocx H

2073 34280 XRA " PACK SIGN AND HO

2074 34100 mov WPUT PACKED SIGN AND HO IN FAC

2075 s4iee RET JWE ARE DONE

2076 34140

2077 34160

2078 34168 FSUBROUTINE FOR ROUND? ADD ONE TO FAC

2079 34200 DROUNAE LXI Hy DPACLO GET POINTER TO LO, ENTRY FROM DINT
2080 34220 MI By7 FSET UP A COUNT

206s 3424@  DRONAL? INR FINCREMENT & BYTE

2082 34260 RNZ RETURN IF THERE WAS NO CARRY

2063 34280 INx INCREMENT POINTER TO NEXT HIGHER OXDER
2084 34300 OCR SHAVE WE INCREMENTED ALL BYTES

2085 34320 INZ INO, TRY THE NEXT ONE

2086 34340 INR HYES, INCREMENT THE EXPONENT

2087 34360 Je CHECK FOR OVERFLOW

2088 34380 ocx J THE NUMBER OVERFLOWED ITS EXPONENT
2089 34400 MVI FPUT 200 IN HO

2v90 34420 RET FALL DONE

2091 34440

2092 34460

2093 34480 FADD OR SUBTRACT 2 DBL QUANTITIES

2094 345u0 FALTERS &,C,0,E,H)L

2095 34520 © OADDDS LEXI H/FBUFFRe"017 © FENTRY FROM DDIV

2096 54540 UxI Dy ARGLO VADD OR SUBTRACT FBUFFR4+17 AND ARG

MATHPK FOR BASIC MCS 8060 GATES/ALLEN/DAVIOOFF MACRO 47(113) 6109 27=AUG#7S PAGE 1193
Fa Mac 23"AUGH64 06208 DUUBLE PRECISION ARITHMETIC ROUTINES

2097 34560 one anus 700 THE OPERATION
2098 34580

2099 34602 DADDAAS xwO 1000,076 a"MVI AM, ENTRY FROM DADD, DMULT
2100 34620 ADC 4 FSETUP ADD INSTRUCTION FOR LOOP

ater 34640 DADOAS XT Hy ARGLO iGET POINTER 10 ARG, ENTRY FROM DADD
2ige 3466@ © DADUFOs LxI 0, DFACLO JGET POINTER TO FAC, ENTRY FROM FOUT
2103 3468@ © DADDSsMVI c,7 HSET UP A COUNT

2104 34700 STA DaDvor JSTORE THE ADD OR SUBTRACT INSTRUCTION
2105 34720 xRA A CLEAR CARRY

2106 34743 DADDL$ ~LbAX =D HGET A BYTE FROM RESULT NUMBER

2107 34762 © DADDOFs NOP {THIS 18 EITHER "ADC Mm" OR "SBB 4m
2108 34780 STAK 0 SAVE THE CHANGED BYTE

2109 34800 INx 0 FINCREMENT POINTERS TO NEXT HIGHER ORDER BYTE
2110 34820 INx H

ais 34800 OCR c TARE WE DUNE?

aie 34860 NZ 0 NO, DO THE NEXT HIGHER ORDER BYTE

aii 34880 RET FALL DONE

aiia 34900

ais 34920

2116 34940 NEGATE SIGNED NUMBER IN F.

aii7 34960 ITHIS IS USED BY DADD, DINT

aie 34980 FALTERS AyB,CyH,L

2119 35008 © ONEGR: HOV ayn FCOMPLEMENT SIGN OF FAC

2120 35020 CHA FUSE THE UNPACKED SIGN BYTE

tat 35040 mov MA HSAVE THE NEW SIGN

aiee 35060 UxI HpOFACLO*1 }GET POINTER TO LO

ates 35080 MvI 8,12 1SET UP A COUNT

2tea 35100 XRA A CLEAR CARRY AND GET A ZERO

ales 35120 nov HSAVE ZERO IN C

2126 35142 ONEGRI MOV HGET A ZERO

2127 35160 $88 FNEGATE THE BYTE OF FAC

2i28 3516¢ mov FUPDATE FAC

2ie9 35200 INx INCREMENT POINTER TO NEXT HIGHER ORDER BYTE
2130 s5ee0 ocr 8 TARE WE DONE?

2131 35240 JNz ONEGR1 NO, NEGATE THE NEXT BYTE

2132 35268 RET TALL DONE

2133 35280

2134 35300

2135 35320 SHIFT DBL FAC RIGHT ONE

2136 35340 JA @ SHIFT COUNT

2137 35360 FALTERS AyC,0,E,4)b

21368 35380 DSHFTR: LxI HyDFACLO®1 HGET POINTER TO LO

2139 35400 NVI Me PUT ZERO IN EXTRA LO ORDER BYTE

2140 35420 © OSHFRI3 SUT 1 HSEE IF WE CAN SHIFT 8 RIGHT

iat 35440 vc OSHFRS AWE CAN*T, CHECK IF WE ARE DONE

2i4e 35460 DSHFRM: LXI Hy PACH ENTRY FROM DMULT, GET POINTER TO HO
214s 35480 ME Ee SHIFT A ZERO INTO THE HO

214g 35500 AVI Drte SET UP & COUNT

2145 35520 DSHFRa? MOV Com TSAVE A BYTE OF FAC

2146 35540 Mov Me PUT THE LAST BYTE IN ITS PLACE

2147 35560 Mov E,C FSET UP _E FOR NEXT TIME THROUGH THE LOOP
2148 35580 ocx 4 POINT TO NEXT LOWER ORDER BYTE

2149 35000 OCR o TARE WE DONE?

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIOGFF MACRO 47(113) 06409 27eAUGeTS PAGE 1194
Fa Mac 23-AUGHO4 BbIER DOUBLE PRECISION ARITHMETIC ROUTINES

2150 35620 INZ DSHFRE #NO, 00 THE NEXT BYTE
2151 35640 MP OSHFRY YES, SEE IF WE CAN SHIFT OVER 8 MORE
2152 35660 © OSHFR3: ADI it FCORRECT SHIFT COUNT
2153 35680 Mov O,A SAVE SHIFT COUNT IN 0
2154 3570 © OSHFR4 KRA A CLEAR CARRY
2155 35720 ocr o FARE WE DONE?
2156 35742 RZ ives
2157 3576 OSHFRAS LXI HyFACeL NO, GET POINTER TO LO, ENTRY FROM DADD, DMULT
21568 35780 Mvd E10 JSET UP A COUNT, ROTATE FAC ONE LEFT
2159 35800 © OSHFRS? MOV Arlt iGET A BYTE OF THE FAC
2160 35620 RAR ROTATE IT LEFT
2161 35840 Mov Mea }PUT THE UPDATED BYTE BACK
2i62 35860 ocx 4 FDECREMENT POINTER TO NEXT LOWER ORDER BYTE
2163 35880 ocr e TARE WE DONE?
2164 35900 NZ OSHFRS 7NO, ROTATE THE NEXT LOWER ORDER BYTE
2165 35920 amp OSHFRA TYES, SEE IF WE ARE DONE SHIFTING
2166 35940
2167 35960
ates 35980 7ROTATE FAC LEFT ONE
2169 3e000 FALTERS A/C, HyL
aire 3ed20 © DSHFLCs MVI C16 #SET UP A COUNT
aim 3e04@ © OSHFTL MOV AN GET A BYTE OF FAC
aire 36060 RAL FROTATE IT LEFT ONE
2173 Sonee nov yA JUPOATE BYTE IN FAC
2174 3o100 INK H FINCREMENT POINTER TO NEXT HIGHER ORDER BYTE
ai7s Soiee CR c FARE WE DONE?
2176 So140 JNZ DSHFTL NO, ROTATE THE NEXT BYTE
2177 36160 RET FALL DONE
2176 30160
2179 3e200
2180 e220 FDOUBLE PRECISION MULTIPLICATION FACT SARGRFAC
2181 3oeag JALTERS ALL REGISTERS
30260 © OMULTs FSIGN FCHECK IF WE ARE MULTIPLYING BY
3o280 RZ YES, ALL DONE, THE FAC IS ZERO
2164 36300 CALL «= MULOVA FADD EXPONENTS AND TAKE CARE OF
30320 CALL © DMULOV 1ZERO FAC AND PUT FAC IN FBUFFR
30340 nov Nyc PUT UNPACKED HO IN ARG
36360 xT 0, ARGLO GET POINTER TO LO OF ARG
36380 AVI 8,7 SET UP A COUNT
3eaa0 bax GET THE BYTE OF ARG TO MULTIPLY BY
3eaea VINCREMENT POINTER TO NEXT HIGHER BYTE
3oaua CHECK IF WE ARE MULTIPLYING BY ZERO
3eaee SAVE POINTER TO ARG
36480 WE ARE
30500 FSET UP A COUNT
3e520 SAVE COUNTERS
30549 FROTATE MULTIPLIER RIGHT
30500 FSAVE IT
36580 FADD IN OLD FAC IF BIT OF MULTIPIER WAS ONE
30600 FROTATE PRODUCT RIGHT ONE
3e620
3040 FGET MULTIPLIER IN A
3o66e HGET COUNTERS BACK

MATHPK FOR BASIL MCS 6080 GATES/ALLEN/VAVIVOFF MACRO 47(115) 06309 27~AUGH7S PAGE 1195
Fq MAC 23eAUGrOG B6108 DOUBLE PRECISION ARITHMETIC ROUTINES

2203 36680 ocr c TARE WE OONE WITH THIS BYTE OF ARG?
eee 3e700 JNZ omuLTs NO, MULTIPLY BY THE NEXT BIT OF THE MULTIPLIER
2205

2206 3e720 © OMULT4s POP 0 YES, GET POINTER INTO ARG BACK

2207 36740 ocr 8 FARE WE DONE?

2208 36760 INZ oMULT2 INO, MULTIPLY BY NEXT HIGHER ORDER BY OF ARG
2209 30780 IMP NORMAL, FALL DONE, NORMALIZE AND ROUND RESULT
2e10 36800 © OMULTS$ CALL © DSHFRM }SHIFT PRODUCT RIGHT ONE BYTE, WE ARE
2ei1 30820 IMP OMULTS } MULTIPLYTING BY ZERO

2ete 36840

2213 368600

2e14 36860 HCONSTANT FOR DIV1@, DOIVIO

2215 30900 aoe 1 1000

2216 se9e0 eee

2217 30940 eee

2218 36960 vee

2219 30960 eee

2220 37000 ooo

2ea1 37020 040

2eee 37040 204

ees 37060

2ee4 37060 FDOUBLE PRECISION DIVIDE FAC BY 10

2ees 37100 ALTERS ALL REGISTERS

2e26 37420 DDIVies CALL —VNOVAF TSAVE THE FAC IN ARG

eee7 37140 uxt H,OTEN 1GET POINTER TO A DOUBLE PRECISION 10
2228 37168 CALL «= -VMOVFM WMOVE TEN INTO THE FAC

2229 37160 TALL INTO DOV AND DIVIDE BY TEN
2e30 37200

2234 37220

2e32 37240 FOOUBLE PRECISION DIVISION FACS EARG/FAC

2233 37260 VALTERS ALL REGISTERS

eas 37280 FSIGN ICHECK FOR DIVISION BY ZERO

2235 37300 wz DVGERR VOON?T LET HIM DO IT

2256 37320 CALL = MULOVS TSUBTRACT EXPONENTS AND CHECK SIGNS
2237 37340 INR 4 TADD THO TO EXPONENT TO CORRECT SCALING
2238 37360 INR M

2239 37380 CALL = DMULOV 7ZERO FAC AND PUT FAC IN FBUFFR

eeu 37408 xt Hy ARG 1GET POINTER TO THE EXTRA HO BYTE WE WILL USE
ae) 37420 mov Me HZERO IT

2242 37440 Mv Bye FZERO FLAG TO SEE WHEN WE START DIVIDING
2243 37460 © DDIVAE HD 1000,076 TUMVI AN, SUBTRACT FBUFFR FROM ARG
2244 37480 BB 4 GET SUBTRACT INSTRUCTION

2245 37500 CALL = DADDO. 100 THE SUBTRACTION

2e46 37520 Loax =D TSUBTRACT FROM EXTRA HO BYTE

2ea7 37549 S68 c THERE Cae

2248 37560 cme FCARRY#1 IF SUBTRACTION WAS GOOD
2209 37580 we borve PWAS TT OK?

2250 37600 Xn 1080,076 PYMVI AN NO, ADO FBUFFR BACK IN
2e51 37620 aoc 4 1GET ADD INSTRUCTION

2ese 37640 CALL = DADLD #00 THE ADDITION

2253 37660 XKA a FCLEAR CARRY

2e54 37660 XwD 100,332 WJC" OVER NEXT TWO BYTES

2255 37700 ©«Dbivas. STAK = FSTORE THE NEW HIGHEST ORDER BYTE.

MATHPK FOR BASIC NCS 8Q82 GATES/ALLEN/UVAVIDOFF MACRO 47(115) Q6309 27™AUGH75 PAGE 11-6
Fa Mac 23eAUGRb4 BOI06 DOUBLE PRECISION ARITHMETIC ROUTINES

2256 37720 INR 8 FINCREMENT FLAG TO SHOW WE COULD DIVIDE
2e57 37740 koa FACeL HCHECK IF WE ARE DONE DIVIDING

2258 37700 INR N SET SIGN FLAG WITHOUT AFFECTING CARRY
2259 37782 DCR A

2260 37800 RAR PUT CARRY IN MSB FOR OROUND

2261 37820 aK OKOUNG WHE ARE OONE, WE HAVE 57 BITS OF ACCURACY
2262 37800 RAL 1GET OLD CARRY BACK WHERE IT BELONGS
2263 37868 UxI Hy DFACLO #GET POINTER TO LO OF FAC

2264 37860 I Cy SET UP A COUNT, SHIFT FAC LEFT ONE

2265 37900 CALL OSHFTL HSHLFT IN THE NEXT BIT IN THE QUOTIENT
2266 37920 UxI Hy ARGLO #GET POINTER TO LO IN ARG

2207 37940 CALL -OSHFLC SHIFT DIVIVEND ONE LEFT

2268 37960 nov an HIS THIS THE FIRST TIME AND WAS THE

2269 37980 OKA A } SUBTRACTION NOT GOOD? (B WILL GET

2270 38000 INz ovivi } CHANGED ON THE FIRST OR SECOND SUBTRACTION)
2e71 30020 LxI Hy FAC FYES, SUBTRACT ONE FROM EXPONENT TO CORRECT
2e7e 38040 DCR M 7 SCALING

2e7s 38008 Nz oviva CONTINUE DIVIDING IF NO OVERFLOW

2e7e 38080 ane OVERR WE HAVE OVERFLOWS

2e75 38100

2e76 3e120

2e77 e142 }TRANSFER FAC 10 FBUFFR FOR DMULT ANO DOTY

2278 38100 FALTERS A,B,C,D,E,HyL

2e79 36180 nov Aye PUT UNPACKED HO BACK IN ARG

2280 3e200 sta ARGet

2281 38220 ocx H ;POINT TO HO OF FAC

2262 3e2de xr D,FOUFFRe*023 POINT TO END OF FBUFFR

2283 38260 cies 8,7 SET UP_A COUNT

2260 36260 NVI C18 HGET A ZERO TO FILL FAC WITH

2285 38300 MOV AM 1GET A BYTE FROM FAC

2286 36320 StAX PUT IT IN FBUFFR

2287 38340 Mov Mec PUT A ZERO IN FAC

2268 36360 ocx 0 POINT TO NEXT BYTE IN FBUFFR

2289 36360 ocx 4 POINT 10 NEXT LOWER ORDER BYTE IN FAC
2290 38400 CR 8 FARE WE DONE?

2294 seaee INZ OMLOVI JNO, TRANSFER THE NEXT BYTE

2292 36448 RET FALL DONE

2293 36460

2294 38480

2295 36500 HDOUBLE PRECISION MULTIPLY THE FAC BY 1¢

2296 30520 FALTERS ALL REGISTERS

2297 3654@ © OMUL1@3 CALL —-VMOVAF SAVE THE FAC IN ARG

2298 38560 JVMOVAF EXITS WITH (DE) @FAC#L

2299 38580 XCHG GET THE POINTER INTO THE FAC IN (HL)
2300 3e6ee ocx H POINT TO THE EXPONENT

2301 38620 Mov AM GET THE EXPONENT

e302 36640 ADI 2 TMULTIPLY FAC BY 4 BY ADDING 2 TO THE EXPONENT
2303 3eooe Je OVERR CHECK FOR OVERFLOW

2304 38680 mov Mya FSAVE THE NEW EXPONENT

2305 38700 PUSH SAVE POINTER TO FAC

2506 38720 CALL = DADD ADD IN THE ORIGINAL FAC TO GET 5 TIMES FAC
2307 38700 PoP 4 JGET THE POINTER TO FAC BACK

2308 38760 INR c) FADD ONE TO EXPONENT TO GET 1@ TIMES FAC

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/UAVIDOFF MACRO 47(415) B6429 27AUGR7S PAGE 1197
Fa Mac 23eAUGHOd 26108 DOUBLE PRECISION ARITHMETIC ROUTINES

2309 38760 RNZ TALL DONE IF OVERFLOW DID NOT OCCUR
sie 38800 amp OVERR> FIT DID, GIVE THE APPROPRIATE MESSAGE
asi 36820 © PAGE

MATHPK FOR BASIC MCS 808® GATES/ALLEN/OAVIDOFF MACRO 47(115) 26109 27mAUGeTS PAGE 12
Fa Mac 23rAUGRba Bess FLOATING POINT INPUT ROUTINE

ase 38840 © SUBTTL FLOATING POINT INPUT ROUTINE
2313 38800 FALTERS ALL REGISTERS
2514 36880 HTHE NUMBER IS LEFT IN FAC
asis 36900 JAT ENTRY, (HL) POINTS TO THE FIRST CHARACTER IN A TEXT BUFFER,
2316 se9ee FTHE FIRST CHARACTER IS ALSU IN A, WE PACK THE DIGITS INTO THE FAC
2317 38940 JAS AN INTEGER AND KEEP TRACK OF WHERE THE DECIMAL POINT IS,
2318 38960 3G 18 377 If WE HAVE NOT SEEN A DECIMAL POINT, @ IF WE HAVE,
2319 38960 78 18 THE NUMBER OF DIGITS AFTER THE DECIMAL POINT,
asee 39000 JAY THE ENO, 8 AND THE EXPONENT (IN E) ARE USED TO DETERMINE HOW MANY
2set 39020 JTIMES WE MULTIPLY OR DIVIDE BY TEN TO GET THE CORRECT NUMBER,
2322 ovissit 39000
2323 39060 STRING, <
asea 39080 IF WE ARE CALLED BY VAL, THE SIGNS MAY NOT BE CRUNCHED
2525 081531 doleee avas7o 39100 cri Men SEE IF NUMBER 18 NEGATIVE
2326 oe153e" woaeee 0005S
2527 201533 oviewe 900365 39120 PUSH PSW SAVE SIGN
2328 081534" aeieee avasie 39140 wz FING FIGNORE MINUS SIGN
2329 201535" seven avisast
2330 Bv153e" dadvo ae1seor
2331 001537" goieoe evus7e 39160 crr 4" FIGNORE A LEADING SIGN
221540" aurene aveuss
@81541¢ oaigoe Boosie 39160 Jz FIND>
2334 ov154e" Bodved ov1545°
2335 01543" eoveve 081535"
2336 01544" ea1eee ooovSsS 39200 ocx ct FSET CHARACTER POINTER BACK ONE
2337 o015ad¢ 39220
2338 s9e40 LENGTHe2,<
901545" Baieoe ovesis 39260 CALL ZERO TCLEAR FAC
@e1546" eeecee ovo175"
@@1547¢ Bovede avidae*
981550" eaicae eveiey7 39260 Mov BA FCLEAR FLAGS! BEDECINAL PLACE COUNT
981551" @gives weeiaT 39300 mov O,a JOSIGN OF EXPONENT
@e15se? eel vers? 39320 Mov Ea VESEXPONENT
@81553" aived Beees7 39340 cha
001554" aaicoa ee0117 39360 mov Cry TCEM." FLAG
39360 THERE TO GET THE NEXT DIGIT OF THE NUMBER, A DECIMAL POINT OR AN ME"
@a1555¢ aeivoe ovese7 39400 CHRGET 7GET A CHARACTER
@a1sse? Baieve wuosse 39420 Jc FINOIG 700 WE HAVE A DIGIT?
@v15S7? enevee ev17ee°
@o1seet aavvee E1546’
@a1S61" eaicee 200376 39449 Crd we FTEST FOR DECIMAL POINT
@o1see? Beecee seavse
@o15es" weivee vvasie 39400 rd FINOP
001564 Boeeae avie3ss?
@@1565% aeeeee ee1d57°
281566" eaigve oeasTe 39480 crr men VCHECK FOR BEGINNING OF EXPONENT
@81567" @covoe 2ee10s
@a157e? enivee evasoe 39500 INZ FINE }"NONE OF THE ABOVE" SO END OF NUMBER
@@1571" Bavese avioat
@ais72? eevee evisea’
39528 }HERE TO CHECK FOR THE SIGN OF THE EXPONENT
@81575* aeieeo eveseT 39540 CHRGET FCHECK FOR ITS SIGN
39560 STRING, <

MATHPK FOR BASIC MCS 6260 GATES/ALLEN/DAVIDOFF MACKO 47(113) @6309 27*AUGe75 PAGE 12=4
Fa mac 23eAUGRO4 B6108 FLOATING POINT INPUT ROUTINE

2365 01574" eoleuo eous4ad 39580 PUSH OH TSAVE TEXT POINTER
2366 Bu1S7>* @e10e0 soeead 39600 uxt Wy FINEC TPUT FINEC ON STACK SO WE CAN JUMP.
2367 001576" evovae ovi1eei*
2368 eeis77* eoeoee avis7i*
2369 dieav' eaivae gvesas 39620 XTHL> } TO IT IN LESS ByTES
2370 woteai? eeieae eveves 39640 ocr P) FSET SIGN OF EXPONENT FLAG
2371 Getege? aeieoe @vo3sTe 39660 CPI MINUTK TNEGATIVE EXPONENT?
2372 av1605" anvenn awovede
2373 39680 STRING, <
2374 39700 vz
2575 39720 STRING, <
2376 ov1604* eo10ee ovesie 39748 RL
2377 @o1605* eivee oves7 39760 CPI nen
2378 a01606" eoovpe wveuss
2379 @eteo7? eo1v0e evesie 39788 RZ>
2380 Bo1e10" eeivae oweved 39800 INR r) TNO, RESET FLAG
2381 39820 STRING, <
2362 wo1611* ea10ee wvosTe 39840 CPL men
2363 Go1612* aoover ovouss
2564 leis" Baieae avesie 39860 Rz>
2565 001614" wolcoe ovesTe 39860 CPI PLUSTK VIGNORE "+"
2366 41615" eaevee guovear
2387 39900 STRING, <
25668 39920 Jz
2389 39940 STRING, <
2390 Ga1o1et eo1000 avesie 39960 Re
2391 Gate17’ ee1900 ovaser 39980 Por Psw> GET FINEC OFF STACK
2392 oviead’ eoicas svauss 4eooe ocx tf) FCHECK IF LAST CHARACTER WAS & DIGIT
2393 4eaee FHERE TO GET THE NEXT DIGIT OF THE EXPONENT
2394 ov1621* aoieea ovose7 40040 FINECs CHRGET #GET NEXT CHARACTER
@e1622" Bleed Lees3e 40060 wc FINEDG HIS IT & DIGIT?
001625" oovves wei7ae?
2397 oe1624* eaevar weis7er
@o1625° B19 eaves 4ouee INR 0 NO, EXPONENT ALL IN
O@1626" vaieve wvosve ae1ee NZ FINE SET ITS SIGN
wele2/* Goveds aviedi?
0@1630" Boeeee avibes?
081631" aaiee avees7 ao1e0 XRA a
be163e" Bo1eve wLeees 4o14e SuB €
001635" ooieeo aveis7 aviee Mov EA
081634" enivoe avevid 4o18e INR G iMAKE SURE C IS NOT 377
4ezeo THERE TO CHECK IF WE HAVE SEEN 2 DECINAL POINTS AND SET THE DECIMAL
ae2eo 7 POINT FLAG
081635" oeivee eeavi4 ae2do INR c HDECIMAL POINTSI| w= SET FLAG
@8163e% weiooe ovesie av2ce Jz FINC FCONTINUE SCANNING CHARACTERS
We1e37* eageee ge1555°
81640" Baveae gvibeT*

FINEC>

FINEC>

aeaeo }ME DON?T WANT TWO SO ENO OF NUMBER
4e3see WHERE TO MULTIPLY OR DIVIDE BY 1@ THE CORRECT NUNBER OF TIMES,
4eseo JHE HAVE ALREADY READ IN ALL THE DIGITS,

e141" waives wuosad 40340 PUSH OH TSAVE POINTER FOR LATER

Qe1e4e? Buiove gvoiTS 4ese0 Mov ALE FEXPONENTSEXPONENTe# OF DECIMAL PLACES

@e164s* ooivoe aeoeer aesee sus 8

MATHPK FOR BASIC MCS 8060 CATES/ALLEN/UAVIUOFF MACRO 47(115) 06409 27AUGR75S PAGE 1202
MAC

Fa 25eAUGH64 Db1LS FLOATING POINT INPUT ROUTINE
2416 gvteda? eotaee 200564 4vave FINE CP FINMUL ;MULTIPLY BY TEN IF EXPONENT IS POSITIVE
2419 01649 ereee@ ete7e?

2420 ei646* epacee vvies7*

2421 eoiea7? eoteee avosee aaa vp FINES }OIVIDE BY TEN IF EXPONENT 18 NEGATIVE
2422 ev165u* enoeee werese?

2423 01651" ec0eea vied?

2424 guLese? eotvee LvO56d 4oaa0 PUSH PSH SAVE EXPONENT

2425 ae165s* ecivoe easis 40460 CALL oIV10 DIVIDE NUMBER BY TEN

2426 001654" epev20 ovoe37*

2427 01655" enoeee eerese®

2428 81656" ented ceoser 4oaeo PoP PW iGET EXPONENT

2429 as1657" erives evov7s 40500 INR A FINCREMENT IT

2430 euieov? eoteea eeasee 4esee INZ FINE? FDO AGAIN IF WE ARE NOT DONE

2431 avi661* epeeee eeregae

2432 eaieee? eovsve eviesa?

2433 4usae STRING, <

2434 4esee GET CHARACTER POINTER

2435 4nsee

2436 evtees? eniowe oeasar 4nove P 0 GET CHARACTER POINTER

2437 ee1e6ed? ecivee weeses 4ooee HGET SIGN

2438 Beier? enivee ovms14 40640 NEGATE IF NECESSARY

2439 01660" eeeowe we117>*

24be Bvtess? sevoue vureei?

2441 @01e7u* eviews wvesss 4veee XCHG> GET CHARACTER POINTER IN (HL)

2442 01671" BeiGve ovesii 4e68e RET> FALL DONE

2443 4e70e LENGTHe2,«

2400 aera XCHG SAVE THE TEXT POINTER IN (DE)

240s 4orae uxt 8, 377+SCODE }CLEAR FLAGS? BaDECIMAL PLACE COUNT
2046 40760 Ce,” FLAG

2447 4e78o mov Hye FZERO CHL)

2aae 4eave MOV Lic

2449 40820 CALL © CONZSS 1ZERO FAC, SET VALTYP TO "INTEGE

2450 acaue XCHG GET THE TEXT POINTER BACK IN (HL)

2451 4eaee #MERE TO CHECK FOR A DIGIT, A DECIMAL POINT, "E" OR "OM

2452 4eaee CHRGET HGET THE NEXT CHARACTER OF THE NUMBER
2453 4n9ee Je FINDIG WE HAVE A DIGIT

2450 4e9ee crr Ld FCHECK FOR & DECIMAL POINT

2455 4uoue uz FINOP TWE HAVE ONE, I GUESS

2456 4960 cer wen CHECK FOR A SINGLE PRECISION EXPONENT
2457 4e9ee Jz FINex WE HAVE A SINGLE PRECISION NUMBER

2458 4100@ crt pe ACHECK FOR A DOUBLE PRECISION EXPONENT
2459 41020 JNZ FINE AWE DON?T HAVE ONE, THE NUMBER 1S FINISHED
2460 4104e OKA A }DOUBLE PRECISIUN NUMBER *= TURN OFF ZERO FLAG
2461 4106@ FINEX CALL FINFRC FORCE THE FAC TO BE SNG OR DBL

2462 41060 PUSH oH HSAVE THE TEXT POINTER

2463 4i10@ xT Hy PINEC HGET ADDRESS TO JUMP TO, THIS IS TO SAVE BYTES
2460 aiiee XTAL #PUT IT ON STACK ANO GET TEXT POINTER
2465 41140 HERE TO CHECK FOR THE SIGN OF THE EXPONENT

2466 alte CHRGET iGET THE FIRST CHARACTER OF THE EXPONENT
2467 41160 0GR 0 SET SIGN OF EXPONENT TO MINUS

2466 41200 cPr MINUTK FCHECK IF THE EXPONENT IS NEGATIVE

2469 41220 RZ iit Is

2470 41240 cr me" FTHIS IS IN CASE WE ARE CALLED BY VAL

MATHPK FOR BASIC MCS 808A GATES/ALLEN/DAVIDOFF MACRO 47(113) 06409 27*AUG#75 PAGE 1293
Fa Mac 25 AUGRO4 DOrLd FLOATING POINT INPUT ROUTINE

2474 41200 RZ
2a72 41260 INR 0 VEXPONENT IS STILL POSITIVE, RESET FLAG
2073 a13ee cPr PLUSTK FIGNORE A LEADING PLUS SIGN
2474 41320 RZ
2475 41346 CPL nen
2476 41300 RZ
2477 41360 ocx H THE FIRST CHARACTER WAS NOT A SIGN, GO BACK
2476 41400 J AND CHECK FOR A OIGIT
2479 41420 Por Psa WPOP FINEC OFF THE STACK, WE NO LONGER NEED IT
ease 444g THERE TO GET THE NEXT DIGIT OF THE EXPONENT
2461 41460 CHRGET GET THE NEXT CHARATER
24be 41480 ye FINEDG FPACK THE NEXT DIGIT INTO THE EXPONENT
2483 41500 INR 0 TIT WAS NOT A DIGIT, PUT THE CORRECT SIGN ON
a4ea aisee INE FINE i} THE EXPONENT, IT IS POSITIVE
24es 41540 a FTHE EXPONENT IS NEGATIVE
2466 41560 € TNEGATE IT
2487 41560 E,A FSAVE IT AGAIN
2468 41600 TO FINISH UP THE NUMBER
2469 41620 VALTYP FINISH UP = WHAT KIND OF A NUMBER IS IT?
2490 a164e 2
249) 41668 FINEF FIT IS A FLOATING POINT ONE
2492 41660 TO FINISH UP AN INTEGER
2493 41700 PSW FIT 18 AN INTEGER, GET ITS SIGN
2494 ai7ee JSAVE THE TEXT POINTER IN (OE)
2495 4174 INEG FNEGATE IT IF NECESSARY
2096 41760 GET THE TEXT POINTER BACK IN (HL)
2497 a178e FALL DONE
2098 41800 TO FINISH UP A FLOATING POINT NUMBER
2499 41820 FINEFS f FSAVE THE TEXT POINTER
4184e Mov AYE FIND OUT HOW MANY TIMES WE HAVE TO MULTIPLY
41868 SUB 8 7 OR DIVIDE BY TEN
ase 41887 JHERE TO MULTIPLY OR DIVIDE BY TEN THE CORRECT NUMBER OF TIMES
2503 419¢@@ - FINEFas CP FINMUL FMULTIPLY IF WE HAVE TO
2504 41920 cH FINDIV HOIVIDE IF WE HAVE TO
2505 4194e NZ FINEFe TMULTIPLY OR DIVIDE AGAIN IF WE ARE NOT DONE
2506 41960 FHERE TO PUT THE CORRECT SIGN ON THE NUMBER
2507 41960 PoP C) GET THE TEXT POINTER
2508 4eaoo PUP Psw GET THE SIGN
4eoee cz NEG TNEGATE IF NECESSARY
a204e XCHE GET THE TEXT POINTER IN (HL)
25i1 42000 Loa VALTYP JWE WANT 32768 TO BE AN INT, BUT UNTIL NOW
42060 Crd 4 } IT WOULD BE A SNG
4e10e RNZ FIT IS NOT SNG, SO IT IS NOT »32768
asta 4eiee PUSH OH JWE HAVE A SNG, SAVE TEXT POINTER
2515 ae1ao Lx Hy) POPHRT GET ADDRESS THAT POP*S H OFF STACK BECAUSE
2516 42168 PUSH oH J} CONIS2 DOES FUNNY THINGS WITH THE STACK
42162 CALL = CUNIS2 }CHECK IF WE HAVE #32768
weave RET JHE DON?T, POPHRT IS STILL ON THE STACK SO
2519 4eeee 7 WE CAN JUST RETURN
4eaae
aezoe JHERE TO CHECK IF WE HAVE SEEN 2 DECIMAL POINTS AND SET THE DECIMAL
asee 4eese 1 POINT FLAG
42300 FINOPs INR CH FSET THE FLAG

MATHPK FOR BASIC MCS 6060 GATES/ALLEN/DAVIDOFF MACRO 47(115) 06209 27mAUG@7S PAGE 1204
Fa mac 23eAUGO4 6408 FLOATING POINT INPUT ROUTINE

ase4 aeseo JNz FINEF GWE HAD 2 DECIMAL POINTS, NOW WE ARE DONE
a5e5 4esae CALL FINFRO VTHIS IS THE FIRST ONE, CONVERT FAC TO SNG
2526 42360 IMP FING FCONTINUE LOOKING FOR DIGITS
2527 42380

asee 4eavo JFORCE THE FAC TO BE SNG OR DBL

2529 4eueo VIF TRE ZERO FLAG IS ON, THEN FORCE THE FAC TO BE SNG
2530 4eaae VIF ThE ZERO FLAG IS OFF, FORCE THE FAC TO BE DBL

2531 42400 FINFRC? PUSH FSAVE TEXT POINTER

2532 ae4ae PUSH =D TSAVE EXPONENT INFORMATION

2533 4eseo Push TSAVE DECIMAL POINT INFORMATION
2534 4eseo PUSH TSAVE WHAT WE WANT THE FAC TO BE
2535 4e54o cz FCONVERT TO SNG IF WE HAVE TO
2536 42500 PoP GET TYPE FLAG BACK

2537 4e5bo Nz HCONVERT TO DBL IF WE HAVE TO
2538 4eeno PoP GET DECIMAL POINT INFORMATION BACK
2539 42020 Por GET EXPONENT INFORMATION BACK
2540 a2e4e POP GET TEXT POINTER BACK

2541 4ze60e RET> TALL DONE

2542

2543 4e700 JTHIS SUBROUTINE MULIPLIES BY TEN ONCE,

2544 42720 JIT 18 A SUBROUTINE BECAUSE IT SAVES BYTES HEN WE CHECK IF A 18 ZERO
2545 oo16e7et eeieae ovesie 42740 RZ TRETURN IF EXPONENT IS ZERO, ENTRY FROM FOUT
2546 ee1675" Balone oeesed 42760 PUSH PS TSAVE EXPONENT, ENTRY FROM FOUT
2547 42780 LENGTHea,<

2548 81674" Belews ovos1d 42800 CALL MULI@> TMULTIPLY BY TEN

2549 21675" Bavere av11e6°

2558 e@ele76" woeuee Ae1e6ee

2551 aeseo LENGTHe2,<«

ase aeaao Loa VALTYP VSEE WHAT KIND OF NUMBER WE HAVE
2553 42600 cred 4

essa ae88e PUSH oP SW TSAVE THE TYPE

2555 4e9ee cz MULL WWE HAVE A SNG, MULTIPLY BY 10,0
2556 a29e0 POR PS GET THE TYPE BACK

2557 aeoae nz DMUL1 o> JWE HAVE A DBL, MULTIPLY BY 1000
2558 01677" Baicee evo3se1 aesen PoP Psw GET EXPONENT

2559 01700" Be1eee BveeT7S 42980 DCRART$ OCR A HDECREASE IT

2560 081721" aolewe ovasi1 43aee RET TALL DONE

2561

2562 12 LENGTH=2,«

2563 PUSH = PSw HWE HAVE TO DIVIDE = SAVE COUNT
2560 Loa VALTYP SEE WHAT KINO OF NUMBER WE HAVE
2565 cri 4

2566 PUSH POW VSAVE THE TYPE

2507 cz bivie FE HAVE A SNG NUMBER

2508 Por Pn #GET THE TYPE BACK

2569 nz ovrvie WE HAVE A DBL NUMBER

as7e Pop PSh GET COUNT BACK

asi INR A PUPDATE IT

as7e RET>

2s73

as74 WHERE TO PACK THE NEXT DIGIT OF THE NUMBER INTO THE FAC
2575 HWE MULTIPLY THE FAC 8Y TEN AND ADD IN THE NEXT DIGIT
2576 oe17aet as3ee

MATHPK FOR BASIC MCS 6062 GATES/ALLEN/OAVIUOFF MACRO 47 (113) 96409 27eAUGe7S PAGE 12-5
Fa Mac 23-AUGH64 Bb108 FLOATING POINT INPUT ROUTINE

2577 45340 IFN LENGTHee,<

2578 woi7ae? ea1eeo oooses 43360 PUSH oD FOIGITS$ SAVE EXPONENT INFORMATION
2579 @st7as* daisvo avaier 45380 mov DyA TPROTECT DIGIT FROM BELOW

2580 o41704° gaiceo eeo17e 43400 Mov Aye TINCREMENT DECIMAL PLACE COUNT
2581 ov1705* opie aeeeit 43420 aoc c IF PAST THE DECIMAL POINT

2582 01706" Oeivve seeie? 43aa0 Mov ByA

2583 oo17e7" eol1eae oveses 43460 PusH BB FSAVE NECESSARY DATA

2584 ea1710" va1eve ovas45 asaee PUSH

2585 ev1711" ealee0 cvoses 43500 PUSH =D SAVE DIGIT

2586 eei7ie? walcve avos15 43520 CALL MULL FMULTIPLY OLD NUMBER BY 10

2587 @e1715" Boeere avIiee?

2568 1714" opeene av16e75°

2589 e01715* Baicee BeOSe1 4ssae Por Psa GET NEXT DIGIT

2598 wei716’ eaieao ewosee 43560 Sur for HSUBTRACT OFF ASCII CODE

2591 ev1717" eaecee BvevEe

259g 43560 EXTFNC,<

2593 43600 CALL PUSHF PUT NUNBER ON STACK

2594 asoee FLOAT FCONVERT TO FLOATING POINT NUMBER
2595 43640

2596 43000 FADD> FADD IN NEXT DIGIT

2597 43080

2596 ou172u' eoivee oves1d 43700 FINLOG>

2599 ov1721" eeeeee ov1731°

2608 wvi7ee? eoeeve ev1713°

2081 oe1725* epicoe avosas 43720 TRECALL DATA

2602 a01724* eeinoe evosel a374e Por

2603 wo1725* eoi1eve easel 43760 PoP

2604 ao1726* Beieee ovOse5 43780 ig GET NEXT CHARACTER

2605 wv1727* aecvuo evidss?

2606 001730" aeaena ovi7ei*

2607 4sevo FE LENGTH=2,<

2608 43820 Push =D SAVE EXPONENT INFORMATION

2609 43840 Mov AB TINCREMENT DECIMAL PLACE COUNT IF WE ARE
210 43800 Abc c 7 PAST THE DECIMAL POINT

2e11 43860 Mov ByA

212 43900 PUSH B FSAVE DECIMAL POINT INFORMATION
2613 439e0 PUSH HSAVE TEXT POINTER

2614 43900 Mov Ay GET THE DIGIT

2015 45960 non HCONVERT IT TO ASCII

2016 43960 Pow FSAVE THE DIGIT

2017 4aooe VALTYP VSEE WHAT KIND OF A NUMBER WE HAVE
2018 agaeo 4

2619 4ao4e FINDGY JWE DO NOT HAVE AN INTEGER

2e20 a4ooo THERE TO PACK THE NEXT DIGIT OF AN INTEGER

2621 augee LhLD = FACLO JWE HAVE AN INTEGER, GET IT IN (HL)
2ee2 44100 uxt O,"03277+SCODE SEE IF WE WILL OVERFLOW

2623 gare COMPAR HCOMPAR RETURNS WITH CARRY ON IF
2e24 aaiae INC FINDG2 } CHL) 41, (DE), SO THE NUMBER IS TOO BIG
2625 44aieo MoV O,H FCOPY (HL) INTO (DE)

2626 aaiee Mov El

2627 44200 bap # FMULTIPLY CHL) BY 2

26268 aae2 DAD H FMULTIPLY (HL) BY 2) (HL) NOW IS 4 (DE)
2629 a4eao oan 0 FADD IN OLD (HL) TO GET 5x (DE)

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/VAVIOOFF MACRO 47(115) 96409 27*AUGR75 PAGE 1296
Fa Mac 23rAUGHO4 BOIER FLOATING POINT INPUT ROUTINE

2630 44260 bab H FMULTIPLY BY 2 TO GET TEN TIMES THE OLD (HL)
2631 4a28e POP PSW JGET THE DIGIT

2632 44300 mov CyA SAVE IT SO WE CAN USE DAD, B IS ALREADY ZERO
2633 4ase0 Dao 6 FADD IN THE NEXT DIGIT

2634 4a3a0 Mov Ain CHECK FOR OVERFLOW

2035 44360 ORA n FOVERFLOW OCCURED IF THE MSB 1S ON

2656 44360 gn FINOGL WE HAVE OVERFLOWL!

2637 4aace SHLD FACLO JEVERYTHING IS FINE, STORE THE NEW NUMBER
2638 44420 FINOGES POP H FALL DONE, GET TEXT POINTER BACK

2639 44g4o Pup 8 HGET DECIMAL POINT INFORMATION BACK

2640 44460 POP o HGET EXPONENT INFORMATION BACK

2644 44480 UMP FINC GET THE NEXT CHARACTER

2o4e 44500 THERE TO ANOLE $2768, 32769

2043 44520 FINDGI: MOV aye 1GET THE DIGIT

2044 44540 PUSH iPUT IT BACK ON THE STACK

2645 44560 TENE TO CONVERT THE INTEGER DIGITS TO SINGLE PRECISION DIGITS
2646 guste FiNDGey GALL CONSE ICONVERT THE INTEGER TO SINGLE PRECISION
2047 4u6oe XRA 300 NOT TAKE THE FOLLOWING JUMP

2048 44oee THERE YO DECIDE IF WE HAVE. A SINGLE. OR DOUBLE. PRECISION NUMBER
2049 44640 FINDGVs JNZ FINOGD JFALL THROUGH IF VALTYP WAS 4 I,E, SNG PREC
2650 44600 MOVRL 224, 164,048,000 1GET 10¢0000, DU KE HAVE 7 DIGITS ALREADY?
2051 44680 CALL FCOMP JIF SQ, FAC ,GE, 1oea00

ao5e 4a7ee JP FINOGS HWE 00, CONVERT TO DOUBLE PRECISION

2653 4a7ee PoP PSH HGET THE NEXT DIGIT

2654 4a740 CALL FINLOG HPACK IT INTO THE FAC

2655 44760 one FINOGE iGET FLAGS OFF STACK AND WE ARE DONE

2056 44762 ENERE TO CONVERT A 7 DIGIT SINGLE PRECISION NUNBER TO DOUBLE PRECISION
2657 44800 FINDG3: CALL —_CONDS CUNVERT SINGLE TO DOUBLE PRECISION

2658 4ageo FHERE TO PACK IN THE NEXT DIGIT OF A DOUBLE PRECISION NUMBER

2659 44849 FINDGO: CALL DMULIe HMULTIPLY THE FAC BY 10

2060 44860 CALL VMOVAF SAVE THE FAC IN ARG

2661 44880 PoP PSH HGET THE NEXT DIGIT

2oee 44900 CALL FLOAT HCONVERT THE DIGIT TO SINGLE PRECISION
2063 449e0 CALL CONDS iNOW, CONVERT THE DIGIT TO DOUBLE PRECISION
2004 44940 CALL DADO 7ADD IN THE DIGIT

2665 44960 ne FAINOGED JGET THE FLAGS OFF THE STACK AND WE ARE DONE
2666

2067 45oee IFN EXTFNC)<

2668 45020 {SUBROUTINE FOR FIN, LOG

2069 81731" ea1vee BvEs1d 45040 FINLOG: CALL PUSHF SAVE FAC ON STACK

2072 eei7se? eneeer ev1z05*

2071 001733" eagwee wviTeT’

2672 01734" eeieee eves1s 45068 CALL «FLOAT FCONVERT A TO A FLOATING POINT NUMBER

2673 001735" eodvee ov1150°

2674 21736" eneeae ov173er

2675 45080 LENGTHee,<

2676 ev17357" aeieve oLvesos 45100 IMP FaooT> yaoo 11 IN

2677 ev174e? agovea veEoveS?

2678 ww1741" Beevee ov1735°

2679 asiee LENGTHe2,<

2080 4514e POPR 4GET PREVIOUS NUMBER OFF STACK

2081 45160 NP FApD>> #00 IT IN

2obe

MATHPK FOR BASIC NCS BOB@ GATES/ALLEN/UAVIOOFF MACRO 47(115) 06109 27#AUGH75 PAGE 1297
Fa Mac 23wAUGHO4 Bb108 FLOATING POINT INPUT ROUTINE

2683 aseeo IMERE WE PACK IN THE NEXT DIGIT OF THE EXPONENT

2084 useee wE MUTIPLY THE OLO EXPONENT BY TEN AND ADD IN THE NEXT DIGIT
2065 as24o FNOTES EXPONENT OVERFLOW IS NOT CHECKED FOR

2¢66 wo17aet eeiveo wwo17S 45260 FINEOG? Mov AVE VEXPONENT DIGIT e= MULTIPLY EXPONENT BY 10
2087 01743" eaieod avaveT 45280 RLC HFIRST BY 4

2668 ov1744" eaieae geeveT 45300 RUC

2689 aat7as’ woicse gveeos 45320 avd FADD 1 TO MAKE 5

209% Gv1746" aaiene eeaveT 45340 RUC INOW OQUBLE TO GET 10

2691 aei7a7" eaieee svoevs 45360 AbD padu IT IN

2692 evi7se’ waived ovosee 45360 sur TSUBTRACT OFF ASCII CODE

2693 o01751° eoevee avovEe

2094 ev17Set @aieee ove137 45400 mov STORE EXPONENT

2095 001753" eoleee eoasa3 as420 JNe FCONTINUE

2696 81754" aavvea avieei?

2097 oa1759" eooeee ovr74e?

2698 asaae

MATHPK FOR BASIC MCS 8082 GATES/ALLEN/DAVIDOFF MACRO 47(115) 96209 27*AUGH7S PAGE 13
Fa Mac 23rAUGrOG G6108 FLOATING POINT OUTPUT ROUTINE

2099 4546¢ © SUBTTL FLOATING POINT OUTPUT ROUTINE
2700 45480 ENTRY TO LINPRT
2701 01756" Belews ovas4a5 45508 INPRT} PUSH =H TSAVE LINE NUNBER
2702 e@v1757* Beloee avavai 45520 LxI Hy INTXT## FPRINT MESSAGE
2703 aoi7ovt aedede weovaer
2704 81761" epeeee oe1754°
2705 er7ee? eaten ave3i5 45540 CALL = STROUT
2706 ev1765" apeeoY avaveds
2707 @01764* econGe aLI760"
2708 081765* eoteae suasai 45500 Pop FALL INTO LINPRT
2709
e710
anny 45620 SPRINT THE 2 BYTE NUMBER IN H,L
arte 45640 FALTERS ALL REGISTERS.
2713 ovi1766r 45660 LINPRT?
2714 45680 TFN LENGTH=2,<
2715 ev1766" euIeee easSS 45700 XCHG FSET UP REGISTERS FOR FLOATR
2716 dvi767" Colese eevesT 45720 xRA a
2717 @01770" Baices ovoene 45740 NVI 8,230
2718 @vi771" Beoeve avaeso
2719 oo1772* Beieoe vvos1> —+——_as760 CALL FLOATR® HCONVERT TO FLOATING POINT
2720 01773" eooeeH L1155°
2721 ev1774" woweoe E1763
aree pie fore — ne
27e3 JPUT THE LINE NUMBER IN THE FAC AS AN INTEGER
2724 XRA TSET FORMAT TO FREE FORMAT
2 CALL FOUINI® HSET_UP THE SIGN
@01775* de1vee evevar UXT Hy STROUT “FPUT PRINT STRING ADDRESS ON STACK SO WE WILL
01776" eaaeee aowaee
evi777" eeeees wes775°
eeeneer Galea avesas PUSH HD RETURN TO IT AND DO AN "INX HM
ITHIS GETS RID OF THE SPACE FOR THE SIGN AT
} THE BEGINNING OF A LINE NUMBER
JPALL INTO FOUT

LENGTHe2,< >

TELD-LE: (Au Four.
anP Sac end TPRINT THE NUMBER
ST ROUT HE

4eaea FLOATING OUTPUT OF FAC
4eoee FALTERS ALL REGISTERS
4e1eo HTHE ORIGINAL CONTENTS OF THE FAC IS LOST
4e1ed TFN LENGTH=2,<
we2aoi? woteve avovar 4e1ag  FouTs Lx Hh, PaUFFR 1GET BEGINING OF CHARACTER BUFFER
@e2aee" Baeeae avevoes
e293" waeeee Be1770"
@e2ea4" apices vases 4o16e PUSH PSAVE IT FOR WHEN WE RETURN
4o180 JPUT THE SIGN OF THE NUMBER IN THE BUFFER AND MAKE IT POSITIVE
@e2005* oaieee oeass7 ao2ae FSIGN GET SIGN OF NUMBER
ee2aee" eaieve weaves 4e2e0 MVE nn PPRINT SPACE IF POSITIVE
eeeaa7? weeeae cvovan
@a2a10? oaieve gvesee 4ease wp
e211" aeeeee evevis?

MATHPK
Fa

2752
2753
2754
2755
2756
2757
2758
2759
2760
aver
27ee
2763
2764
2765
e766
2767

FOR BASIC MCS 8080

MAC

eoenier
oveois?
eoeniae
oveais’
evenier
eeeai7?
evenev?
oweoai?
eeezneet
oveoes?
oezvaa?
eeeaas?
woenec’

23wAUGHOG 26308

eaeeee
@e1eee
eoeoee
eoreee
eaieeo
aovvve
eorece
eovees
eoeeee
eeiove
eeieee
eeenee
eooveo

avevoe*
averse
geoess
ovewas
aeoves
avaver
ovesie
owe2zoer
oe2uiit
aeasas
owes74
eeri75¢
evavert

FLOATING POINT OUTPUT ROUTINE

4e2ce

4o2se
4o3ee

aose0

4es4e
desea

MVE

Fouts:

THERE WE GET THE FAC IN THE RANGE 100000

My Men

4
Myton

Fours9

FAN INTEGER,

GATES/ALLEN/UAVIDOFF MACRO 47(113) 6309 27*AUGH75 PAGE 13e1

PRINT A NINUS SIGN IF NEGATIVE

HINCREMENT POINTER 10 NEXT CHRACTER POSITION
TPUT A ZERO IN BUFFER IN CASE NUMBERSQ

400 IT IF THE NUMBER IS ZERO

TSAVE BUFFER POINTER
INEGATE NUMBER IF NEGATIVE

sbE, FAC ,LE, 999999 AND ROUND IT TO

WE KEEP A COUNT OF HOW MANY TIMES WE MULTIPLY OR DIVIDE BY TEN

2768
2769
2770

80 WE KNOW WHAT THE EXPONENT WILL BE, THE FAC IS THEN CONVERTED TU AN
JINTEGER IN C,D,E, WE USE A TABLE OF POWERS OF TEN TO CALCULATE EACH DIGIT,

amma
2772
2773
2774
2775
2776
2777
2778
2779
2780
ares
2762
2783
27e4
2765
2786
2767
2768
2789
2790
2791
27928

2795
2796
2797
2798
2799
2800

eveoer?
evease?
eoeasi?
evenset
ovensst
eveasae
eveass?
ovease?
ovansrt
aveaaee
eoanat?
weeaae?
evauas?
eoagaae

@aenas?
@eevdor
eveoar?
eveoso
@v2asi?
genset
woenss?
oveasa?
oveoss’
@v2nset
oaeasre
eaenour
ooegei?
evease’
aeeaose
woeaear
oeeoes?
eeaeer
oveger*

eeieeo
oo1eee
eoiead
ooeced
eeoeue
aeieee
eecoae
ea0cee
Qeieoa
eovees
eovees
ea1eao
aav0ae
eaceaa

eo10ee
eoveee
egovee
@o1eee
@oicee
aaeoee
@avae0
ea1e0a
@ateea
eoveea
eoeeao
eo1cee
eoovee
eaeveo
vareee
poicve
eo1e00
@o1cee
ooewee

evoes7
eeas65
evesis
eve2e7ae
eeeves?
avovas
evoies
eeecet
evover
oves7e
evel
000515
oorsir?
eeeuser

ewosae
avev7i
ovecase
oveseL
eeesis
ae1e7s?
aeevaer
aea365
e0ases
ov2usar
ovauser
00315
ovoes7*
avevso*
ev05e1
aooeTa
90365
ewosis
weeerar

46580

4eove
4ee2o

4eo4o
46660

46680
46700

4oree

a674o
4e7ee
40780
40808

THIS ALGORITHM IS USED FOR SPEED,
ry

XRA
Push
CALL.

FOUT3: MOVRI

Jo

PoP
CALL

PUSH
gmp

FOUTS: CALL

PoP
INR

Push
CALL

Pow
FOUTCB

221,103,117,370 718 NUMBER ,LE, 99999,94997

FCOMP

Fouts

Psw
FINMLT

Psw
Fouts

o1vie

Ps
A

PsW
FOUTCB

1PUT TENS EXPONENT COUNT ON STACK.

SEE 1F NUMBER IS TOO BIG OR TOO SMALL

IT 18 TOO SMALL

SO THE

TFCOMP RETURNS 377, @ OR 1 IN Ay

PARITY WILL BE ODD IFF 1 IS RETURNED
1NQ, NUMBER IS IN RANGE

YES, MULTIPLY IT BY TEN TO GET

IT IN RANGE
VSEE IF NUMBER IS NOW IN RANGE

JNO) DIVIDE NUMBER BY TEN, IT IS TOO BIG
FADD ONE TO EXPONENT

F1S NUMBER ,LE, 999999,4997

MATHPK FOR BASIC MCS 8084 GATES/ALLEN/DAVIDOFF MACRO 47(115) @6309 27"AUGm75 PAGE 1502
Fa MAC 23rAUGROG B6I08 FLOATING POINT OUTPUT ROUTINE

2eus
286
2807
2008
2809
210
261
ete
2813
aed
2615
2816
2617
2818
2819
ase
28at
2822
2823
2624
abes
2826
2827
2a28
2829
2830
2631
2632
2833

eeen70" weaved

ae2or1e
eeeoTer
ev2a7s?
ovearae

eeears’
@eea7e?
eeearre
@verov
evetai?
oeaioe?

ooaras¢
eaaiaar
overost

ovaia6*

@eaier?
onerie?
@vattit
aeeriet
oeeis?
evari4e
oeeiis?
eoere?
eoerse
over2e"
avatar?
evaiee?
ewaias?

eoareae
@eerast
eearect

overare
eeei3or
ooaisit
ov2i3e"
ooei3st
eoeisae
ee2i35°
ev2ise¢
eeei37¢
eeergor
everaie

091000
egeove
eaveee
eeiooa

ee1eee
220000
eaved
@01000
aeooee
eaeoed

221000
avoces
eoaved

@a1000

e000
oa1cea
agovee
aeaved
earooe
agovee
Ba1vee
20000
eoevee
eo1000
221000
eo1000
eovoae

201000
001000
oeleve

eo1vee
aeoeeo
ooeeee
eaiooe
eotove
ea0ooe
ee1eee
aavoee
eevee
eo1ee0
eo1ove

weaver?

evosis
avovee’
evawer?
aeoers

euasis
oeis7er
wezere?
200515

eerees?
avewret

ovaver
aereeos
aeaiei’?

oveser

aoaeot
avasre
avaiaar
@oeigae
aeos7e
evova?
awasee
owalea?
geist
eeaeTs
ove1e7
2eav7e
owaver

evou7s
ovosas
aeeses

woover
avesier
aveiior
aeawes
eeoee6
evaose
awesis
aeiese?
oveise?
aveses
ovasas

4ea20
4oa4a

46860

4oaee
46900
4e9e0
46940
46960

46980

47000
47020

47090
47060

—}_—41080

a7iee

ariee

4a714e

47160
47180
47200

47eeo
a7aao
47268
47260
47300
47320

47340
47360
47360

474eo
47420

FOUTS! CALL

INR

CALL

CALL,

FADOH

GINT

MOVER

FYES, NUMBER IS IN PRINTING RANGE, I4E,
} ALL DIGITS TO BE PRINTED ARE THE INTEGER PART

FROUND NUMBER TO NEAREST INTEGER

JMAKE A NONwZERO, SINCE NUMBER IS POSITIVE
7 AND NONeZERO, ROUND WILL EXIT WITH THE HO
7 IN Ay SO THE NSB WILL ALWAYS BE ZERO AND
} ADDING ONE WILL NEVER CAUSE A TO BE ZERO
HGET INTEGER PART IN C,0,E

SAVE NUMBER IN FAC

JOECIOE IF THE NUMBER SHOULD BE PRINTED IN FIXED OR FLOATING NOTATION
B,2e400+6+SCODE FSET DECIMAL POINT COUNT FOR E NOTATION

am

cer

ING

Ine
Mov
MVI

DCR
por
Pusn

a
PsW

iC _® DIGIT COUNT

1GET EXPUNENT

19H NUMBER SMBYEBEBE PRINTED IN E NOTATION
HEV 7k,

1YES, IT 15 LT.

VYES, IT IS ,GT, 999999

#8 = DECIMAL POINT COUNT
SET FIXED POINT FLAG, THE EXPONENT IS ZERO

IF WE ARE USING FIXED POINT NOTATION
JE NOTATIONS ADD 5S TO ORIGINAL EXPONENT
JGET BUFFER POINTER FROM STACK

FSAVE EXPONENT FOR LATER

FCALCULATE THE DIGITS OF THE NUMBER.

UxI

ocr
MVI

cz

0, FOUTBL

‘,myM

INXHRT

HSTORE LOC OF LARGEST POWER OF TEN.

#SEE IF IT 18 TIME TO PRINT A DECIMAL POINT
HPUT A DECIMAL POINT IN THE BUFFER
FINCREMENT THE BUFFER POINTER IF IT IS TIME

SAVE FLAGS
FSAVE CHARACTER POINTER

MATHPK FOR BASIC MCS 8060 GATES/ALLEN/OAVIDOFF MACRO 47(115) 26309 27~AUG=7S PAGE 1353
Fa Mac 23-AUGwb4 G6208 FLOATING POINT GUTPUT ROUTINE

2858 ov214e* gzives aveses a744a PusH ob FSAVE POWER OF TEN POINTER

2859 oee14s* dives avesis a746o CALL = MOVRF TGET NUMBER IN C,D,E

2eee av2144" aeaas viedo?

2861 ov214s? agave aw2is6°

2862 averde opie veasar 47480 PoP H GET POWER OF TEN PUINTER

2863 oo2147* dni aoavas 47500 MI B 18 NEXT DIGIT TO BE PRINTED

2804 ava1se* doveea avous

2865 902151 9o1090 avavas 47529 FOUTIOE INR

2666 ea2152" asi aoaiTS 47540 Mov

2867 082155 gaives aveees 47560 su8

2868 ove154* eave av0137 47580 Mov

2669 002153 acivos veovas 47600 INx

287¢ 082156" vives oeaiTe 47620 Mov

2871 082157" aaivoa seeeso 47640 $88

2872 e82160" vaivea veoieT 47660 mov

2873 002161" oivea eeovgs 47680 INK

2874 gveteet aaivaa eoaiTh 47700 Mov

2875 802165" doivee aovese arted S68

2876 002164" dotene ooer1T 47740 Mov ary

2877 82165" eaioae aoauss 47760 ocx

2878 Be2166" eolaae ovouss 47780 ocx H

2679 @e2167" Golava avesee 47800 Inc FouTie }SUBTRACT AGAIN IF RESULT WAS POSITIVE

2880 Be2170" aoveve 02151"

2881 dv2171" andaee soaragar

2662 Geei7e? eaivee oves15 47820 CALL = FADDA F1T WASN*T, ADD POWER OF TEN BACK IN

2683 02173" aoevee ooaeT4?

2864 002174" agevea ovei7e"

2885 ee2175* eaieoe ovau4s 47840 Nx 4 VINCREMENT POINTER TO NEXT POWER OF TEN

2886 002176" doieve ouesis 47800 CALL MOVER SAVE C,0,€ IN FAC

2887 oe2177? aaeove eeiees?

2888 ovezge? agave avei7s?

2889 oeeee1" doivoo 200553 47880 XCHG #GET POWER OF TEN POINTER IN (OE

2890 e22ce? aoiveo avesai 47900 POR GET BUFFER POINTER

2891 os2aas? aaiave oveied 47920 Mov PUT CHARACTER IN BUFFER

2892 eueees* aaiooe ovev4as 47949 INK FINCRENENT BUFFER POINTER

2893 02205" eui0vd ovasel 47960 Por GET COUNTERS OFF STACK

2894 ee2206" ealede oBoee1S 47980 OCR WAS THAT THE LAST DIGIT?
ee2207" vaiove avesee 48000 INZ 700 MORE IF NOT
@e2210 ooeeoe verse?

2697 oe2aii? avon avei77?

2898 cveatet ealove voces 4soeo ocr 8 SEE IF DECIMAL POINT GOES AFTER LAST DIGIT
@ez215" Baieae ovasie 4eo4e cri Foursa JIT DOES, WE HAVE NO ZEROS TO SUPPRESS
@e2214* waeeee weeeset

2901 ev2215" ap0vea aveetor

2902 48060 FSUPPRESS THE TRAILING ZEROS

2903 voeato* ao1900 oeaess 4eoee = FouTi1: DCX 4 GO BACK TO LAST CHARACTER
@a22i7? ao1eee avar7e 48100 mov apm GET IT
Oaez2en* aaieov a00376 abieo cri no" TIGNORE TRAILING ZEROS

2906 oveeei* aovee averse
@eeae2e* oaieee ovosie 48140 Prd Foutit
oe22e3" aeevee aveeiot
ewe224" vaavea aveeidt

FADD ONE TO DIGIT
TSUBTRACT LO

IPOINT TO NEXT BYTE OF POWER OF TEN
FSUBTRACT MO

zozpxrmzre

FSUBTRACT HO

=

x

}POINT TO BEGINNING OF POWER OF TEN

48160 JSUPPRESS DECIMAL POINT IF WE HAVE AN INTEGER

MATHPK FOR BASIC MCS 8280 GATES/ALLEN/DAVIDOFF MACRO 47(113) 96109 27mAUGH75 PAGE 1304
Fa Mac 23rAUGHO4 6108 FLOATING POINT OUTPUT ROUTINE

2911 o92e25" eaivoa aons76 48180 crr c FIGNORE DECIMAL POINT BEFORE TRAILING ZEROS
2912 aveeeet apoove avouse

2913 dveael? aciane avesas 4eaco one INKHRT VIF NO OP, MOVE POINTER TO NEXT POSITION
2914 eo2ese* eosvae aereset

2915 a02231" Bneadd aveeas?

2916 weeese? Goines 200561 48220 FOUTIa: POP PW GET DECIMAL EXPONENT

2917 oveass* ooivea vvosie ae2ae Sra FouTt7 FRETURN IF NUMBER WAS IN FIXED POINT FORMAT
2918 02234" Beene avaeTi®

2919 02235" aaguae avaese?

eve 4e200 TFLOATING POINT NOTATION w= PUT AN "EM IN THE BUFFER

2921 eaz23e* aniveo avovee 4e280 MVE MMe" JPUT AN "E" IN THE BUFFER

2922 weee37? waoeee ovo1as

aces
2924
2925
2926
2927
2928
2929
2930
2931
2932
2933

oee24au? aaivaod

ee2eai? eorcoe
@aeage? saved
eve24s? aareao
eeeada? aovees
ee2245* aavooe
weee4e* aaivoa
@ezaa7? aaceco
ee2eso? aoivee
oveesi* esiave

ooeese? evievo
eo2ass* aoeosa
oo22s4? asieoo
@ee255¢ eaieea
averse’ aaveve
ae2esr? vaicoe
eve2ee" anve00
eve261" doveee
@a2ase? aotveo
eee2ss* eoavee

ae22e4* aoivao
ae2203* oaieeo
@ue20* vaivead
aae267? oviaod
ae227ae oaicoo
@e2za71* oatvea
aveaTe* aaicea
ea2275* oaieud

ave274* aaieao
eve2275* eaecas
@e2a7e* onvcee
ee2277* Boieaa
evesoet aaveeed
02301" eaeved
ee23ae* aoiove
282305" anova

ovovas

euevee
evaess
oeasee
aveeset
oveesar
ovaeee
@eoess
evous
evowra

avoves
ovoesT
aeaves
avases
varie
weasee
peaesar
ew2eaar
aeases
aeoure

aoavas
avoi6e
aeouas
eeaier
aeaeas
eeaiel
avesar
aeasit

avavar
aeaie4
aeoeas
eooeet
ease?
aeavas
aees15
woisire

48300
4eseo
48340

48300

4eseo

4400
48420
rrr)
48460

4eae0
46sea

48520

48540

48560
48580
48000
48620
a8ea0
48660
48080
4e7ee
4a720

4e760
48780

Fourtas

Fouts

Fourt9s

Fouts

NX
PUT IN
MVI

ap

Md

cha
INR

4

}PUT SIGN OF EXPONENT IN BUFFER

THE SIGN OF THE EXPONENT

My Nen

Fuuria

My tan

FCALCULATE THE

MVI

INR
sur

INC

Avr

B,"OMet

8
te

FouTis

namere

FA PLUS IF POSITIVE

HA MINUS IF NEGATIVE

FNEGATE EXPONENT

TAO OIGIT EXPONENT

FINITIALIZE TEN*S DIGIT COUNT

FINCREMENT DIGIT
FSUBTRACT TEN

700 IT AGAIN IF RESULT WAS POSITIVE

FADD BACK IN TEN AND CONVERT TO ASCII

JPUT THE EXPONENT IN THE BUFFER

INx
Mov
Nx
Mov
INK
mov
Por
RET

SEE IF
MOVRI

8
vA

1c

FAC GCE,
224,164,043, 307

FCOMP

WPUT TEN*S DIGIT OF EXPONENT IN BUFFER
THEN WE JUMP TO HERE, A IS ZERO

PUT ONE*S DIGIT IN BUFFER

FINCREMENT POINTER

#PUT ZERO AT END OF BUFFER

VEXLT WITH (HL) POINTING TO STRING
TALL DONE

999999,499

}COMPARE NUMBER WITH CONSTANT

MATHPK
Fa

2964
2965
2966
2967
2968
2969
2970
aon
age
2973
2974
2975
2976
2977
2978
2979
2980
298)
2962
2983
2984
aves
2966
2967
2968
2969
2990
2991
2992
2993
2994
2995
2996
2997
2998
2999
3008
3001
3002
3003
3004
3005
3006
3007
3008
3009
3e10
sain
Bote
3013
3014
3015
3016

MATHPK
Fa

3017
3u16
3019
3e20
30e1
3022
3023
3024
3025
3026
3027
30268
3029
3030
3031
3032
3033
3034
335
5036
3037
3038
3039
3040
304s
3o42
3043
3044
3045
3046
3047
3048
3049
3050
3054
3052
3053
3054
3055
3056
3057
30568
3059
suce
3ee1
3062
363
3000
3065
3066
3007
3068
3069

FOR BASIC
Mac

ovesaae
evesas¢
avesaee
oeesart
ovesio*
ova3ii¢

ovesier
ovasis?
ovasiar
ovesior

aaestor
evesirt
eoese0"
evasart
eoeseer
eoesast
evesaar
ouasas?
evesaor
eoasart
avessor
eoesai?
Ovesser
aoe335°
ooassar
2335
oe2sser
02337

FOR BASIC MCS 806e

MAC

MCS 8080

23eAUGrO4 D6108

eovese
eaiee0
ae1e00
eea0e0
aaevea
@aieea

eeeege
aoe0ee
eavvee
eevee

aao000
eooueo
aao00
eoacee
anovee
@acoee
eoaaee
ae000
eevee
eoe0e0
eneeeo
aac00
eeonee
800000
agou00
epevao
eeove0
aa0ee0

aezeou"
evosay
evasae
avaceo’
ovasas?
avesst

aeovee
aeovee
avouee
eeneae

eeoeao
eeaeos
aeovor
evaved
evovar
eeovee
200sse
ooavas
aeavee
ooo144
aevauee
ovovee
owoure
20006
avovee
ovaver
evaveo
avaue

23rAUGrod 06808

GATES/ALLEN/UAVIDOFF MACRO 47(115) 06109 27-AUGH7S PAGE 1345

FLOATING POINT OUTPUT ROUTINE

46820
4beao

48860

4aseo
48920
48940
48960
48980
49000
49020
49040
49060
49060
49100
49120
a91ae
49160
49180
49200
aveee
agaco
49260
ag2ee
49300
a93e0
49340
49500
49380
49400
ag4aea
49440
49460
a94ee
49500
49520
49540
49560

a9s8a
49600
49620
49640
49660
49680
49700
49720
49740
49760
49780

FRALFE

FOUTaLS

Por 1GET RETURN ADDRESS OFF STACK
JPO JNUMBER TOO BIG, DIVIDE BY TEN

POHL JNUMBER OK, RETURN.

FCONSTANTS FOR FOUT
eeo ase
eee FTHIS CONSTANT IS ALSO USED BY SOR, SIN, COS
eeo

200
TPOWER OF TEN TABLE

240 4 1o0e80

2ee

et

eo 1oove

a7

eee

350 1908

203

eee

144

geo

eo0

aie

eve

eve

eet

oo

@ea>

LENGTHea2,<

FOUTPUT THE VALUE IN THE FAC ACCORDING TO THE FORMAT SPECIFICATIONS
FIN A,B,C

GALL REGISTERS ARE ALTERED

JTHE ORIGINAL CONTENTS OF THE FAC IS LOST

THE FORMAT IS SPECIFIED IN A, 6 AND C AS FOLLOWSS
THE BITS OF A MEAN THE FOLLOWING?

@ MEANS FREE FORMAT OUTPUT, I,€, THE OTHER BITS OF A MUST BE ZERO,
TRAILING ZEROS ARE SUPPRESSED, A NUMBER IS PRINTED IN FIXED OR FLOATING

POINT NOTATION ACCORDING TO ITS MAGNITUDE, THE NUMBER IS LEFT
JUSTIFIED IN ITS FIELD, B AND C ARE IGNORED,
1 MEANS FIXED FORMAT OUTPUT, I,€, THE OTHER BITS OF A ARE CHECKED FOR
FORMATTING INFORMATION, THE NUMBER IS RIGHT JUSTIFIED IN ITS FIELD,
TRAILING ZEROS ARE NOT SUPPRESSED, THIS IS USED FOR PRINT USING,
1 MEANS GROUP THE OIGITS IN THE INTEGER PART OF THE NUMBER INTO GROUPS
OF THREE AND SEPARATE THE GROUPS BY COMMAS

MEANS DON?T PRINT THE NUMBER WITH COMMAS

MEANS FILL THE LEADING SPACES IN THE FIELD WITH ASTERISKS ("#")

MEANS OUTPUT THE NUMBER WITH A FLOATING DOLLAR SIGN ("S$")

MEANS PRINT THE SIGN OF A POSITIVE NUMBER AS A PLUS SIGN ("om")

GATES/ALLEN/DAVIDOFF NACRO 47 (115) 06309 27"AUGR75 PAGE 1386

FLOATING POINT OUTPUT ROUTINE

49800
49a20
49e4o
49860
49880
4990e
ag9ee
49940
49968
49980
5s0a08
500e0
Seade
seaee
Seoae
Se1ee
sei20
sei4a
Sei60
50188
Seago
S02e0
Seago
sw26o
sezee
Sesee
5e320
ses4e
Se300
Seseo
seaeo
Seaeo
Suada
Sudee
Su4ee
5ese0
5e5e0
50540
50560
50580
Seeae
Seeee
Seu
50660
5e68e
Sse7ee
se7ea
se74e
Sa76
50780
Sesee
S082
sea4a

,
BIT 2
wBIT 1
iBIT @
i
1
i

Fouts

PuFouTs

Fours:

Foutas

INSTEAD OF A SPACE

1 MEANS PRINT THE SIGN OF THE NUMBER AFTER THE NUMBER

UNUSED

4 MEANS PRINT THE NUMBER IN FLOATING POINT NOTATION I,£, "E NOTATION"
If THIS BIT IS ON, THE COMMA SPECIFICATION (BIT 6) IS IGNORED,

@ MEANS PRINT THE NUMBER IN FIXEO POINT NOTATION, NUMBER GE, 1616
CANNOT BE PRINTED IN FIXED POINT NOTATION,

#8 AND C TELL HOW BIG THE FIELO Iss

THE NUMBER OF PLACES IN THE FIELD TO THE LEFT OF THE DECIMAL POINT

(B 0OES NUT INCLUDE THE DECIMAL POINT)

THE NUMBER OF PLACES IN THE FIELD TO THE RIGHT OF THE DECIMAL POINT
(C INCLUDES THE DECIMAL POINT)

8 AND C DONUT INCLUDE THE 4 POSITIONS FOR THE EXPONENT IF BIT @ IS ON
JFOUT ASSUMES B¥C ,LE, 24 (DECIMAL)

ENTRY TO PRINT THE FAC IN FREE FORNAT

XRA A FSET FORMAT FLAGS TO FREE FORMATED OUTPUT

ENTRY TO PRINT THE FAC USING THE FORMAT SPECIFICATIONS IN A, B AND C

CALL = FOUINI JSAVE THE FORMAT SPECIFICATION IN A AND PUT
GA SPACE FOR POSITIVE NUMBERS IN THE BUFFER

PusH FSAVE THE FIELD LENGTH SPECIFICATIONS

ANI ICHECK IF POSITIVE NUMBERS GET A PLUS SIGN

Jz FTHEY DONET

ht THEY 00, PUT IN A PLUS SIGN

Loa VALTYP SEE WHAT KIND OF A VALUE WE HAVE

MOV ByA VSAVE IT

XCHG SAVE BUFFER POINTER

CALL VSIGN JGET THE SIGN OF THE FAC

XCHG PUT THE BUFFER POINTER BACK IN (HL.

MOV An JGET THE VALTYP BACK

JP Fouta IF WE HAVE A NEGATIVE NUMBER, NEGATE I

MVE Hy Ma J AND PUT A MINUS SIGN IN THE BUFFER

PUSH oH SAVE THE BUFFER POINTER

CALL VNEG NEGATE THE NUMBER

PoP 4 }GET THE BUFFER POINTER BACK

INK 4 #POINT TO WHERE THE NEXT CHARACTER GOES

toa TEMPS JGET THE FORMAT SPECIFICATION

NOV OFA HSAVE IT FOR LATER

RAL PUT THE FREE FORMAT OR NOT BIT IN THE CARRY

Loa VALTYP iGET THE VALTYP, VNEG COULD HAVE CHANGED THIS
} SINCE #32768 IS INT AND 32768 IS SNG,
4} SU B IS NOT ACCURATE

ve FouTFX THE HAN WANTS FIXED FORMATED OUTPUT

HERE TO PRINT NUMBERS IN FREE FORMAT

PoP 8 sWE CAN IGNORE THE OLO 8 AND C

NVI myno* FPUT A ZERO IN THE BUFFER IN CASE THE NUMBER

Jz FOUTZR IS ZERO, IT IS, FINISH IT UP

chy 4 DECIDE WHAT KIND OF A VALUE WE HAVE

INC FOUFRY IWE HAVE A SNG OR DBL

THERE TO PRINT AN INTEGER IN FREE FORNAT

uxt 8, SCODE SET THE DECIMAL POINT COUNT AND COMMA COUNT
1 TO ZERO

MATHPK FOR BASIC HCS 8082 GATES/ALLEN/DAVIDUFF MACRO 47(115) 86109 27AUGR75S PAGE 1397
Fa Mac 23eAUGH64 D638 FLOATING POINT OUTPUT ROUTINE

3070 50860 CALL = FOUTCI JCONVERT THE INTEGER TO DECIMAL
3071 Soaeu HFALL INTO FOUTZS AND ZERO SUPPRESS THE THING
3072 50900
3073 se9e0 FZERO SUPPRESS THE DIGITS IN FBUFFR
3074 50940 FASTERISK PILL AND ZERO SUPPRESS IF NECESSARY
3075 50960 SET UP B AND CONDITION CODES IF WE HAVE A TRAILING SIGN
3076 50980 © FOUTZS$ LXI Hy PBUFFRAY 4GET POINTER TO THE SIGN
3077 51000 Mov Bam FSAVE THE SIGN IN B
3078 Sided MI Cia }DEFAULT FILL CHARACTER TO A SPACE.
3079 51040 Loa TEMPS /GET FORMAT SPECS TO SEE IF WE HAVE TO
3080 51d60 Mov J} ASTERISK FILL, SAVE IT
3081 51980 ANT
3082 51100 Jz FE DONFT.
3083 51120 Mov WWE 00, SEE IF THE SIGN WAS A SPACE
3084 51140 CHP FZERO FLAG 18 SET IF IT WAS
3085 51160 MvI SET FILL CHARACTER TO AN ASTERISK.
3066 51160 INZ SET THE SIGN TO AN ASTERISK IF IT WAS A SPACE
3087 51200 Mov 4B HAS THE SIGN, C THE FILL CHARACTER
3088 51220 FOTZS1: HOV FPILL IN THE ZERO OR THE SIGN
3089 Si2ue CHRGET 1GET THE NEXT CHARACTER IN THE BUFFER
3090 51260 SINCE THERE ARE NO SPACES, "CHRGET" IS
3091 s1260 } EQUIVALENT TO MINX = HM/"MOV A,M*
3092 51300 300 WE HAVE A ZERO?
3093 51320 YES, SUPPRESS IT
3094 51340 1542"," 00 WE HAVE A COMMA?
3095 51360 $ YES, SUPPRESS 1T
3096 51360 TARE WE AT THE DECIMAL POINT?
3097 51400 NO, I GUESS NOT
3098 51420 YES, BACK UP AND PUT A ZERO BEFORE IT
3099 51440
3100 51460 FOTZS2 MOV GET THE FORMAT SPECS TO CHECK FOR A FLOATING
3101 51480 ANT a 1 DOLLAR SIGN
3102 51500 Jz HWE DONT HAVE ONE
3103 51520 ocx 4 JWE HAVE ONE, BACK UP AND PUT IN THE DOLLAR
3104 51540 “vd 1 SIGN
3105 51560 FOTZ$3: MOV 400 WE HAVE A TRAILING SIGN?
3106 51560 ANI 4
3107 51600 RN YES, RETURNS NOTE THE NON@ZERO FLAG IS SET
3108 51620 FOFXIS# OCx JNO, BACK UP ONE AND PUT THE SIGN BACK IN
3109 51640 #PEOPLE JUMP HERE WHO WANT A "OCKX WM AND
3110 51660 1 DON?T CARE ABOUT M
341 51680 Moy M8 HPUT IN THE SIGN
Bite 51700 ReT FALL DONE.
3113 51720
3114 51740 WHERE TO INITIALLY SET UP THE FORMAT SPECS AND PUT IN A SPACE FOR THE
3115 51760 SIGN OF A POSITIVE NUMBER
3116 51780 © FOUINI: STA TEMPS #SAVE THE FORMAT SPECIFICATION
3117 51600 x1 Hy FBUFFReL GET A POINTER INTO FBUFFR
31168 51820 MVI Urea HPUT IN A SPACE
3419 51840 RET FALL DONE
51860
51880 }HERE TO PRINT A SNG OR DBL IN FREE FORMAT
51900 FOUFRV: PUSH =H TSAVE THE BUFFER POINTER

MATHPK FOR BASIC NCS 8084 GATES/ALLEN/DAVIOOFF MACRO 47(115) 06409 27#AUG=75 PAGE 1398
Fa Mac 23rAUG964 06108 FLOATING POINT OUTPUT ROUTINE

3123 51920 era FOUFRS HWE HAVE A SNG
3124 51940 FHERE TO SET UP THE FLAG TO PRINT A DBL IN FREE FORMAT
3125 51960 MI b,20 HWE HAVE A OBL, SET THE DIGIT COUNT
3126 51980 XW 100,001 P/LXT BY OVER THE NEXT TWO BYTES.
31a7 52000 WHERE TO SET UP THE FLAG TO PRINT A SNG IN FREE FORMAT
3128 52020 FOUFRS: MI 0,6 SET THE DIGIT COUNT
3129 52040 CALL = FOUTNY INORMALIZE THE FAC SO ALL SIGNIFICANT DIGITS
3130 Sedeo 1 ARE IN THE INTEGER PART
3131 saabo xr B,2n4ee+SCOLE 78 ® DECIMAL POINT COUNT
$132 Saiao 1C_= COMMA COUNT
3133 seize #SET COMMA COUNT TO ZERO AND DECIMAL POINT
3134 sei4o 7} COUNT FOR E NOTATION
3135 S216 avo 0 SEE IF NUMBER SHOULD BE PRINTED IN E NOTATION
3136 52160 am FOFRSY FIT SHOULD, IT 8 gbT,
3137 Seaea INR p) HCHECK IF IT 18 TOO BG
3138 Seeee cor py)
3139 Sseeao INC FOFRSS HIT IS TOO BIG, IT 1S ,GT, 10704
3140 Seaeo INR A 11 IS OK FOR FIXED POINT NOTATION
3144 52260 Mov ByA VSET DECIMAL POINT COUNT
3142 52su0 MVE Ad SET FIXED POINT FLAG, THE EXPONENT IS ZERO
3143 Seseo 1 IF WE ARE USING FIXED POINT NOTATION
3144 S2s4@  FOFRS11 OGR a HE NOTATIONS ADD Del TO ORIGINAL EXPONENT
3145 e360 POR H JGET THE BUFFER POINTER BACK
3146 52360 PUSH PSH FSAVE THE EXPONENT FOR LATER
52400 CALL FoUTCY TCONVERT THE NUMBER TO DECIMAL DIGITS
S2aeo THERE TO SUPPRESS THE TRAILING ZEROS
52449 FOFRS2? OCx 4 JMOVE BACK TO THE LAST CHARACTER
seaoo MOV Aat GET IT AND SEE IF 1T WAS ZERO
se480 CPL non
Ssesee Jz FOPRS2 FIT WAS, CONTINUE SUPPRESSING
52520 cPr Lik) THAVE WE SUPPRESSED ALL THE FRACTIONAL DIGITS?
ses4a nz INAHRT YES, IGNORE THE DECIMAL POINT ALSO
Se5e0 Pop PSH GET THE EXPONENT BACK
Bra FOUTON THE ARE DONE IF HE ARE IN FIXED POINT NOTATION
FALL IN AND PUT THE EXPONENT IN THE BUFFER

THERE TO PUT THE EXPONENT AND "E" OR "D" IN THE BUFFER
FTHE EXPONENT IS IN A
FOFLONS MOV ByA TSAVE THE EXPONENT
Loa VALTYP *GET THE VALTYP TO DEIDE IF WE PRINT AN "
cer 4 7 OK A "pM
mov A,B GET THE EXPONENT BACK
Jz FOUCEE WWE HAVE TO PRINT AN "E™
Mv M,for +GET THE "0"
xWO 1000,001 FULT BY OVER THE NEXT TWO BYTES
FOUCEE: MVI ny mem iGET AN "Ee"
INK 4 HPUT SIGN OF EXPONENT IN BUFFER
iPUT IN THE SIGN a EXPONENT
NVI Hyon 7A PLUS IF POSITIVE
uP Foucet
mvd 4, ton TA MINUS IF NEGATIVE
CMA HNEGATE EXPONENT
INR a

MATHPK
Fa

3176
3177
3178
3179
3160
3181
3182
3163
3184
3185
3166
3187
3168
3189
3190
3191
3192
3193
3194
3195
3196
3197
3198
3199
3200
3201
se0e
3203
3204
3205
3206
3207
3208
3209
3210
Bett
Sete
3213
3e14
3215
$216
3e17

3e20
seat

3224

3227

MATHPK
Fa

3229
3230
3231
$232
3233
3234
3235
3236
3237
3238
3239
3240
34,
3242
3243
3244
3245
3246
3247
3248
3249
3250
3254
3252
3253
3254
3255
3256

FOR BASIC MCS 680 GATES/ALLEN/UAVIDOFF MACRO 47(115) 06129 27*AUGA7S PAGE 13-9
Mac 23eAUGRb4 06408 FLOATING POINT GUTPUT ROUTINE

52980
55000
53020
53040
530600
53060
55100
53120
53140
53160
55180
s3200
Sseee
sse40
53200
55280
53300
53320
53340
53500
55360
53400
Ssaeo
53440
53460
53480
53500
53520
53540
555608
55580
Sse00
53620
53640
53000
53680
53700
ss720
53740
53760
53780
53800
55820
S3640
53800
53880
53900
53920
53940
53960
53980
54a00
s4aa0

FOUCEL:
Fouceet

FOUTZR:

FOUTON:

FouTcc?
FOUICCS

FOUTFX:

EARLE TE THE TWO DIGIT EXPONENT

MVI Named FINITIALIZE TEN*S OIGIT COUNT

INR oe FINCREMENT DIGIT

sul 12 FSUBTRACT TEN

INC Foucee 400 IT AGAIN IF RESULT WAS POSITIVE

ADL noneie FADD BACK IN TEN AND CONVERT TO ASCII

PUT THE EXPONENT IN THE BUFFER

INK

Mov 7PUT TENS DIGIT OF EXPUNENT IN BUFFER

INK cs JWHEN WE JUMP TO HERE, A IS ZERO

Mov PUT ONES OIGIT IN BUFFER

INx ct] FINCREMENT POINTER, HERE TO FINISH UP PRINTING
1A FREE FORMAT ZERO

MVE PUT A ZERO AT THE END OF THE NUMBER

XCHG SAVE THE POINTER TO THE END OF THE NUMBER
1 IN (DE) FOR FFXFLY

xt Hy POUFFReL GET A POINTER TO THE BEGINNING

RET FALL DONE

WHERE TO FUT A POSSIBLE COMMA COUNT IN C, AND ZERO C IF WE ARE NOT
JUSING THE COMMA SPECIFICATION

Mov Cra TSAVE 4 POSSIBLE COMMA COUNT

Loa TEMPS GET THE FORMAT SPECS

ANE 100 }LOOK AT THE COMMA BIT

RNZ TWE ARE USING COMMAS, JUST RETURN

MOV CyA WE AREN'T, ZERO THE COMMA COUNT

RET TALL DONE

THERE TO PRINT A NUMBER IN FIXED FORMAT
crt 4 TCHECK WHAT KIND OF VALUE WE HAVE
Mov Tr) GET THE FORMAT SPECS
INC FOUFXY JHE HAVE A SNG OR A DBL
AHERE TO PRENT AN INTEGER 3N FIXED FORMAT
JCHECK IF WE HAVE TO PRINT IT IN FLOATING
ic FRXIFL i} POINT NOTATION
JRERE TO PRINT AN INTEGER IN FIXED FORMAT#FIXED POINT NOTATION
xr 8,6x400+3+SCODE JSET DECIMAL POINT COUNT TO 6 AND
1 COMMA COUNT TO 3
CALL «= FUICC HCHECK IF WE DONfT HAVE TO USE THE COMMAS
PoP 0 GET THE FIELD LENGTHS
MOV AyD SEE IF WE HAVE TO PRINT EXTRA SPACES BECAUSE
sul 5 1 THE FIELD IS TOO BIG
cr FOTZER WWE DO, PUT IN ZEROS, THEY WILL LATER BE
J} CONVERTED TO SPACES OK ASTERISKS BY FOUTZS
PUSH =D TSAVE THE FIELD LENGTHS AGAIN
CALL = FouTcL HCONVERT THE NUMBER TO DECIMAL DIGITS
Por 0 GET THE FIELD LENGTHS BACK
ORA € 400 WE NEED A DECIMAL POINT? HERE Azo
cz FOFXIS HWE DON'T, GACKSPACE OVER IT, AT FOFXIS,
i WE DON?T CARE ABOUT B, WE ONLY WANT THE
# "OCX HM", LATER ON WE WILL DO A *MVI M,o"
AND COVER UP WHAT WAS IN By
TFOFXIS PRESERVES THE CONDITION CODES

FOR BASIL NCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06109 27=AUGH75 PAGE 13910
ma 23eAUG64 B6s08 FLOATING POINT OUTPUT ROUTINE

S4o4a
54000
S4eee
S4100
S4ieo
54140
54160
54180
54200
S42e0
s4aa0
S4260
54260
54300
Saseo
54340
54360
54360
54400
S4a4ea
5444g
54400
54460
54500
54520
54540
54560
54580
54600
54620
54640
54600
54680
54700
54720
s47ae
54760
S478
S480
S4ge0
54840
548d
54860
54900
54920
54940
54900
54980
55000
55020
55040

55260

FOUTTS$

FRXIXI?

Fouser:
FOUBES:

Fousea:

TIF WE DO HAVE DECIMAL PLACES, FILL THEM UP
7 WITH ZEROS
FALL IN AND FINISH UP THE NUMBER

;MERE TO FINISH UP A FIXED FORMAT NUMBER

PUSH oH HSAVE BUFFER POINTER

CALL FOUTZS }ZERO SUPPRESS THE NUMBER

PoP H GET THE BUFFER POINTER BACK

JZ FRXIX1 }CHECK IF WE HAVE A TRAILING SIGN
Mov MB HWE 00, PUT THE SIGN IN THE BUFFER
INx H TINCREMENT THE BUFFER POINTER

MVE Mo PUT A ZERO AT THE END OF THE NUMBER

JHERE TO CHECK IF A FIXED FORMAT#FIXED POINT NUMBER OVERFLOWED ITS
VPTELD LENGTH
10 = THE B IN THE FORMAT SPECIFICATION
ITHIS ASSUMES THE LOCATION OF THE DECIMAL POINT IS IN TEMP2
LxI Hy PBUFFR GET A POINTER TO THE BEGINNING
INK 4 FINCREMENT POINTER TO THE NEXT CHARACTER
Loa TEMP2 GET THE LOCATION OF THE DECIMAL POINT
sua L JFIGURE OUT HOW MUCH SPACE WE ARE TAKING
sus 0 TIS THIS THE RIGHT AMOUNT OF SPACE TO TAKE?
RZ JYES, WE ARE DONE, RETURN FROM FOUT
Mov Ay TNO, WE MUST HAVE TOO MUCH SINCE WE STARTED
1 CHECKING FROM THE BEGINNING OF THE BUFFER
7 AND THE FIELD MUST BE SMALL ENOUGH TO FIT
J} THE BUFFER, GET THE NEXT CHARACTER IN
7 THE BUFFER
La) VIF 11 IS A SPACE OR AN ASTERISK, WE CAN
FouBe1 J IGNORE IT AND MAKE THE FIELD SHORTER WITH
ra) V NO ILL EFFECTS
FOUBEL
4 HMOVE THE POINTER BACK ONE TO READ THE
1 CHARACTER WITH CHRGET
HSAVE THE POINTER

THERE WE SEE IF WE CAN IGNORE THE LEADING ZERO BEFORE A DECIMAL POINT,
FTHIS OCCURS IF WE SEE THE FOLLOWINGS (IN ORDER)
7 A SIGN (EITHER "=" OR "eM) (OPTIONAL)
i A DOLLAR SIGN (OPTIONAL)
; & ZERO (MANDATORY)
i A DECIMAL POINT (MANDATORY)
f ANOTHER OIGIT (MANDATORY)
IF YOU SEE A LEADING ZERO, IT MUST BE THE ONE BEFORE A DECIMAL POINT
FOR ELSE FOUTZS WOULD HAVE SUPPRESSED 11, SO WE CAN JUST "INX HM"
FOVER THE CHARACTER FOLLOWING THE ZERO, AND NOT CHECK FOR THE
SDECIMAL POINT EXPLICITLY,
PUSH = PSW TPUT THE LAST CHARACTER ON THE STACK, THE
7 ZERO FLAG IS SET, THE FIRST TIME THE ZERO
i ZERO FLAG IS NOT SET,
xr 8, FOUBEe GET THE ADDRESS WE GO TO IF WE SEE A CHARACTER

PUSH BB 7 WE ARE LOOKING FOR

MATHPK FOR BASIC MCS 8480 GATES/ALLEN/DAVIDOFF MACRO 47(115) 26309 27-AUGH7S PAGE 13=11
Fa Mac 23mAUGHOd BESCE FLOATING POINT OUTPUT ROUTINE

3262 55080 CHRGET HGET THE NEXT CHARACTER
3285 55100 cry wen SAVE IT AND GET THE NEXT CHARACTER IF IT IS
$264 55120 RE J A MINUS SIGN, A PLUS SIGN OR A DOLLAR SIGN
3265 55140 CPI men
3286 55160 RZ
3287 55180 Crd us"
3268 55200 RZ
3289 55220 Por 8 FIT ISNT, GET THE ADDRESS OFF THE STACK
3290 sseae crr non V18 IT A ZERO?
3291 55200 INZ FOUBES NO, WE CAN NOT GET RID OF ANOTHER CHARACTER
3292 55260 INx " HSKIP OVER THE DECIMAL POINT
3293 55300 CHRGET HGET THE NEXT CHARACTER
3294 55320 INC FOUBES IT IS NOT A DIGIT, WE CAN‘T SHORTEN THE FIELO
3295 55340 ocx " HWE CANS] POINT TO THE DECIMAL POINT
32% 55360 xnav 1000, 001 IYLXT BY OVER THE NEXT 2 BYTES
3297 55380 FOUBE3s OCx i) POINT BACK ONE CHARACTER
3298 55400 MOV MA TPUT THE CHARACTER BACK
3299 55420
3300 55440 HIF WE CAN GET RID OF THE ZERO, WE PUT THE CHARACTERS ON THE STACK
3301 55460 BACK INTO THE BUFFER ONE POSITION IN FRONT OF WHERE THEY ORIGINALLY
3302 55480 WERE, NOTE THAT THE MAXIMUM NUMBER OF STACK LEVELS THIS USES IS
3303 55500 TTHREE *= ONE FOR THE LAST ENTRY FLAG, ONE FOR A POSSIBLE SIGN,
3304 55520 JAND ONE FOR A POSSIBLE DOLLAR SIGN, WE DON?T HAVE TO WORRY ABOUT
3305 55540 THE FIRST CHARACTER BEING IN THE BUFFER TWICE BECAUSE THE POINTER
3506 55560 FAHEN FOUT EXITS WILL BE POINTING TO THE SECOND OCCURANCE,
3307 35560 PoP PSH HGET THE CHARACTER UFF THE STACK
3308 55600 wz FOUBES PUT IT BACK IN THE BUFFER IF IT IS NOT THE
3309 55620 1 LAST ONE
3310 55640 Por 8 }GET THE BUFFER POINTER OFF THE STACK
3311 55660 InP FUUBES #SEE IF THE FIELD I8 NOW SMALL ENOUGH
3312 55680 HERE IF THE NUMBER I$ TOO BIG FOR THE FIELD
3313 55700 © FOUBE4s POR PSH JGET THE CHARACTERS OFF THE STACK
3314 55720 FOUBES LEAVE THE NUMBER IN THE BUFFER ALONE
3315 55740 H HGET THE POINTER TO THE BEGINNING OF THE
3316 55760 NUMBER MINUS 1
3517 55780 mene JPUT_IN A PERCENT SIGN TO INDICATE THE NUMBER
3318 55800 7 WAS TOO LARGE FOR THE FIELD
55820 FALL DONE == RETURN FROM FOUT
55640
55860 HERE TO PRINT & SNG OR DBL IN FIXED FORMAT
55880 FOUFXVE PUSH =H SAVE THE BUFFER POINTER
55900 RAR HGET FIXED OR FLOATING NOTATION FLAG IN CARRY
55920 JC FRXFLY PRINT THE NUMBER IN EwNOTATION
55940 vz FRXSFX WE HAVE A SNG
55960 THERE TO PRINT A OBL IN FIXED FORMATw=#FIXED POINT NOTATION
55980 Uxr 0, FFXOXM 1GET POINTER TO 1016
Seo00 CALL = DCOMPD JWE CANT PRINT A NUMBER GE, 10"16 IN FIXED
Seoee J POINT NOTATION
Seoue xT 0,16#400+SCODE SET D ® NUMBER OF DIGITS TO PRINT FOR A OBL
Seve iC # 0 FOR DBL (THIS 18 FOR COMMAS)
5easa qm Frxsoc JIF THE FAC WAS SMALL ENOUGH, GO PRINT IT
Se1ea JHERE TO PRINT IN FREE FORMAT WITH A PERCENT SIGN A NUMBER GE, 10%16
S120 FFXSDO XRA SET THE FORMAT SPECS TO FREE FORMAT

MATHPK FOR BASIC MCS 8082 GATES/ALLEN/DAVIDOFF MACRO 47(115) 06329 27*AUGOT7S PAGE 13-12
Fa MAC 23eAUGHbG W610 FLOATING POINT OUTPUT ROUTINE

3335 Se14e STA TEMPS

3336 So160 PoP w 1GET THE BUFFER POINTER

3337 Se16e ocx LJ FSET IT.UP TO JUMP BACK INTO FOUT

3336 Se200 FNOW CHL) SFBUFFReS

3339 S220 CALL Fouts PRINT THE NUMBER IN FREE FORMAT, THE SIGN
3340 Se24e 1 18 ALREADY IN THE BUFFER

3541 $6260 OcK " POINT IN FRONT OF THE NUMBER

3342 Se2be MVE Le de PUT IN THE PERCENT SIGN

3343 56300 RET TALL DONE*=RETURN FROM FOUT

334q Seseu MERE TO PRINT A SNG IN FIXED FORMAT*=FIXED POINT NOTATION

3345 Sos4e FRKSFXS MOVRI 226,016,033,312 GET 1616, CHECK IF THE NUMBER 1S TOO BIG
3346 56360 CALL FCOMP

3347 36386 uP FrxSOO FIT IS, PRINT IT IN FREE FORMAT WITH A X% SIGN
3348 Se4aee xT Dp Ox4udea2+SCODE FSET UP FLAGS FOR SNG o=

3349 Souea 1D © NUMBER OF DIGITS TO PRINT IN A SNG

3350 5e440 4C_® 2 (THIS I8 FOR THE COMMAS)

3351 Segoe MERE TO ACTUALLY PRINT A SNG OR OBL IN E NOTATION

3352 Se4bo FFXSOC3 FSIGN 7SEE IF WE HAVE ZERO

3353 50500 CNz FOUTNY TIF NOT, NORMALIZE THE NUMBER SO ALL DIGITS TO
3354 56520 1 BE PRINTED ARE IN THE INTEGER PART

3355 Sesao POP 4 1GET THE BUFFER POINTER

3356 Se560 POP 8 #GET THE FIELD LENGTH SPECS

3357 —}—se580 aM FEXXVS D0 DIFFERENT STUFF IF SMMREXPONENT IS NEGATIVE
3358

3359 Se600 FHERE TO PRINT A NUMBER WITH NO FRACTIONAL DIGITS

3560 Seeed PUSH FSAVE THE FIELO LENGTH SPECS AGAIN

3301 50640 OV LY PSAVE THE EXPONENT

3362 So6ee mov 8 WWE HAVE TO PRINT LEADING ZEROS IF THE FIELD
3363 90660 suB F WAS MORE CHARACTERS THAN THERE ARE DIGITS IN
3304 Se7eo sue + THE NUMBER

3365 Se7Teo ce OTZER WFOUTZS WILL LATER SUPPRESS THEM

3306 Se74a MOV , FSET UP THE COMMA COUNT

3307 S760 ADD

3368 50760 MOV ec WE NO LONGER NEED THE NUMBER WE SETUP IN E
3369 Se8ee FRxxvit SUI PREVUCE A MOD 3

337e Sobe0 INC

3371 50840 ADT FADD 3 BACK AND ADD IN 2 MORE FOR SCALING
3372 So8ou CALL FCHECK IF WE HAVE TO USE COMMAS AT ALL

3373 56860 MOV HSETUP THE DECIMAL POINT COUNT

3374 56900 Add

3375 56928 INR

3376 56940 nov HIT GOES IN 8

3377 36960 PUSH TSAVE SNG OR OBL AND EXPONENT INFORMATION
3378 50980 CALL FCONVERT THE NUMBER TO DECIMAL OIGITS

3379 571208 POP HGET THE SNG OR DBL AND EXPONENT INFO BACK
3380 S7eee ORA E PUT IN OIGITS AFTER THE NUMBER IF IT

3381 S7040 1 18 BIG ENOUGH, HERE Aad

3582 57260 CNZ id C THERE CAN BE COMMAS IN THESE ZEROS

3363 57080 PUP oO HGET THE FIELD LENGTH SPECS

3364 S7T10e ORA THERE Awd

3365 STi2e0 CNZ TPRINT A DECIMAL POINT IF NECESSARY

‘3386 S714e oOcR a HSEE IF WE SHOULD PRINT SOME ZEROS TO FILL IN
3387 Slee cr 1 THE DECIMAL PLACES

MATHPK FOR BASIC MCS 6080

Fa

MA
Fa

3368
3389
3390
3391
3392
3393
3394
3395
3396
3397
3398
3399
3400
3401
3402
3403
3404
3405
3486
3407
3408
3409
3a1e
3444
3412
3413
3444
3415
3416
3417
3418
3419
3420
3421
3422
3423
3424
3425
3426
3427
3428
3429

THPK

3441
sage
3443
344g
3445
3446
3447
3448
3449
3450
3451
3452
3455
3454
3455
3456
3457
3458
3459
3460
3461
3462
3463
3464
3405
3466
3467
3468
3469
3470
3471
3472
3473
3474
3475
3476
3477
3478
3479
3480
3481
3482
3483
3484
3485
3486
3487
3488
3489
3498
3491
3492
3493

Mac 23rAUGmoa Bi

FOR BASIC MCS B80
AC 23-AUGR64 O

GATES/ALLEN/DAVIDOFF MACRO 47(115) 26109 27=AUGe75 PAGE 13013
ree FLOATING POINT OUTPUT ROUTINE

S7160
57200
sreeo
57240
57260
57260
57308
57320
57340
57360
57380
57400
57420
57440
57460
57480
57500
57520
57540
57560
57580
57600
sTeee
57640
57660
57680
57708
s17eo
57740
57760
57780
57800
57820
37840
57860
57880
57900
57920
57940
57960
57980
58000
Sea20
Sead
Seaee
58060
58100
56120
58140
Se1ee
58182
sezeo
Sezee

FRXXVS?

FEXXVad

FRXXV3$

FRXXVGs

FFKXVS?

FFXXVOs

IMP FOUTS GO CHECK THE SIZE, ZERO SUPPRESS, ETC, AND
i FINISH THE NUMBER

THERE TO PRINT A SNG OR OBL THAT HAS FRACTIONAL DIGITS

Mov EyA SAVE THE EXPONENT, WE DON?T NEED WHAT 1S IN E

Mov Ac JOIVIDE BY TEN THE RIGHT NUMBER OF TINES SO

ORA a } THE RESULT WILL BE ROUNDED CORRECTLY AND

cNz OGRART } HAVE THE CORRECT NUMBER OF SIGNIFICANT

Apo é ¥ DIGITS

PUSH PSH SAVE THIS NUMBER FOR LATER

cn FINOLV ITHIS IS THE DIVIDE LOOP

aM FRxxve

Mov AE JWE HAVE THO CASES DEPENDING ON WHETHER THE

A0D 0 } THE NUMBER IS ,LT, 91 OR NOT

Moy Av

an FRXXVS

HERE TO PRINT NUMBERS ,GEy 41

sus t) PRINT SOME LEADING ZEROS IF THE FIELD IS

sus E } BIGGER THAN THE NUMBER OF DIGITS WE WILL

cr FOTZER 7 PRINT

Pop PSH JWE DON?T NEED THE NUMBER WE SAVED BEFORE

Mov Bye HGET ALL THE PERTINENT INFO IN B,C

Push TSAVE THE EXPONENT ANO "CH IN FIELO SPEC

Mov Me SET UP THE DECIMAL POINT COUNT

Apo D

INR A

Mov ByA

tov ) FSET UP THE COMMA CUUNT

ANT 2 THESE 2 INSTRUCTIONS MAP 6 TO 4

Aor 2 HAND 46 TO 2

() €

CauL = FouTce CHECK IF WE HAVE TO DO THE COMMA THING

ane FRXXV6 CONVERT THE DIGITS AND DO THE TRIMMING UP

PMERE TO PRINT A NUMBER 4LT, gt

CALL FOTZER PUT ALL ZEROS BEFORE THE DECIMAL POINT

Mov arc iSAVE C

CALL = FoUTOP PUT _IN A DECIMAL POINT

mov CA TRESTORE C

POP PSH GET THE NUMBER ME SAVED

un FRXXVa }OECIDE HOW MANY ZEROS TO PRINT BETWEEN THE

xRA A ) QECIMAL POINT ANO THE FIRST DIGIT WE WILL

sub € 7 PRINT, HERE THE FIELD IS BIG ENOUGH TO

sua 0 1 HOLD ALL THE OIGITS

MP FRXXVS G0 PRINT THEM

mov Aye THERE WE HAD TO DIVIDE BY TEN SO THE FIELD

sua t) 7-18 SMALLER THAN ALL SIGNIFICANT DIGITS IN

DCR A 3 THE NUMBER

CALL FOTZER FPRINT THE ZEROS

mov BYE SAVE THE EXPONENT IN B

PUSH B VSAVE EXPONENT AND THE "C¥ IN THE FIELD SPEC

nov ByA ZERO THE DECIMAL PLACE COUNT

Nov CyA 7ZERO THE COMMA COUNT

CALL FoUTCY }CONVERT THE NUMBER TO DECIMAL DIGITS

PoP 0 GET THE EXPONENT ANO FIELD SPEC BACK

GATES/ALLEN/DAVIDOFF MACRO 47(115) 96409 27*AUG#75 PAGE 13-14
8 FLOATING POINT OUTPUT ROUTINE

seaae
Se200
saeeo
58300
58320
58340
58360
5a380
58400
Seaaa
58440
58460
5a4aa
Sosa
38520
56540
58560
56580
56600
56620
58640
38660
58080
58700
58720
56740
56760
58780
5600
58820
Seago
58860
56880
58900
56920
58940
58968
56968
59000
59020
59040
59060
59080
59100
59120
59140
59160
59180
59200
59220
59240
59260
59280

FEXXVTt

FRXIFLS

FRXPLV?

FRXSFLE

FRXUVLE

OKA E JCHECK IF WE HAVE TO PRINT ANY ZEROS AFTER
1 THE LAST OIGIT

Jt FRXXVT JCHECK IF THERE WERE ANY DECIMAL PLACES AT ALL

avd o JPRINT SOME MORE TRAILING ZEROS

ock A

cr FOTZER

one FOUTTS FINISH UP THE NUMBER

FTHERE WERE NO DECIMAL PLACES, IGNORE ALL DIGITS AFTER THE DECIMAL

POINT

LALO TEMP2 VTHE END OF THE NUMBER IS WHERE THE OP IS

dine FOUTTS }PINISH UP THE NUMBER

FHERE TO PRINT AN INTEGER IN FIXED FORMAT==FLOATING POING NOTATION

PUSH oH HSAVE THE BUFFER POINTER

PUSH =O FSAVE THE FORMAT SPECS

CALL © CONST HCONVERT THE INTEGER TO A SNG

POP C) GET THE FORMAT SPECS BACK

Pup 4 GET THE BUFFER POINTER BACK

XRA A WSET FLAGS TO PRINT THE NUMBER AS A SNG
FFALL INTO FPXPLY

JERE TO PRINT A SNG OR OBL IN FIXED FORMAT®FLOTATING POINT NOTATION
rd pexsec TIF WE HAVE A SNG, SET THE RIGHT FLAGS
wd E,20 TNE HAVE A DBL, GET HOW MANY DIGITS WE HAVE
HD 1008, 001 TYLXT 8" OVER THE NEXT TWO BYTES.
MV E,6 WWE HAVE A OBL, GET HOW MANY DIGITS WE PRINT
FSIGN SEE IF WE HAVE ZERO
Nz FOUTNY VIF NOT, NORMALIZE THE NUMBER SO ALL DIGITS TO
+ BE PRINTED ARE IN THE INTEGER PART
Por h GET THE BUFFER POINTER BACK
PoP 8 VGET THE FIELD LENGTH SPECS
PUSH SAVE THE EXPONENT
Mov Arc HCALCULATE HOW MANY SIGNIFICANT DIGITS WE MUST
ORA A } PRINT
PUSH W TSAVE THE "C" FIELD SPEC FOR LATER
CNz
A00
Mov
Mov GET THE FIELD SPEC
SEE IF THE SIGN IS A TRAILING SIGN
SET CARRY IF A IS ZERO
388 SET 080 IF WE HAVE A TRAILING SIGN,
vA 1 08377 IF WE DO NOT
Apo

Mov CyA SET CBNUMBER OF SIGNIFICANT DIGITS TO PRINT
sua € VIF WE HAVE LESS THAN E, THEN WE MUST GET RID
cH FINUIV } OF SOME BY DIVIDING BY TEN ANU ROUNDING
JM FRXLVL

8 VSAVE THE "6" FIELD SPEC AND # OF SIG DIGITS
Mov A,B FSET THE DECIMAL PLACE COUNT

ry

) HTAKE INTO ACCOUNT IF THE SIGN IS TRAILING

ByA

MATHPK FOK BASIC MCS 8080 GATES/ALLEN/UAVIDOFF MACRO 47(115) 06309 27-AUG=75 PAGE 13615
F4 MAC 23eAUGHO4 Ob108 FLOATING POINT GUTPUT ROUTINE

3494 59308 WI ca JSET COMMA COUNT TO ZERO, THE COMMA SPEC IS
3495 59520 PUSH oD } IGNORED, SAVE TRAILING SIGN INFO

3496 59340 CALL = FouTCV FCONVERT THE NUMBER TO DECIMAL DIGITS

3497 59300 PoP 0 HGET THE TRAILING SIGN INFO BACK

3498 59580 POP 1GET @ OF SIG DIGITS AND "8" FIELD SPEC BACK
3499 59400 moy arc PRINT TRAILING ZEROS IF THE FIELD LENGTH IS
3500 —sya20 sus € } LONGER THAN THBBENUNBER OF DIGITS WE CAN PRINT
3501

3502 39440 cP FOTZRC THE DECIMAL POINT COULD COME OUT IN HERE
3503 59400 PoP PSH iGET THE "C™ FIELD SPEC BACK

3504 59480 cz FOFXIS GIF CeO, THE LAST THING WAS A DECIMAL POINT,
3505 39500 1 SO_IGNORE IT, ALL WE CARE ABOUT 18 THE
3506 89520 7 "OCK H® AND NOT THE "MOV MB" AT FOFXIS
3507 59540 PoP PsW 1GET THE EXPONENT BACK

3508 59560 apo E FSCALE IT CORRECTLY

3509 59580 sus 6

3510 59600 sus 0

3518 59620 as SAVE THE "8" FIELD SPEC

3512 59600 FOFLON PUT THE EXPONENT IN THE BUFFER

3513 59660 NGET THE POINTER TO THE END IN (HL)

3514 59680 JIN CASE WE HAVE A TRAILING SIGN

3515 — 449700 PoP ° GET THE "B" FIELD SPEC IN Dy PUT ON wSRQSSEBEE
3516

3517 —+— 59720 ump FouTTS J ARAILING SIGN AND WE ARE DONE

3518 59740 Poss 1B

3519 59760 INORMALIZE THE NUMBER IN THE FAC SO ALL THE DIGITS ARE IN THE INTEGER
3520 59762 PART, RETURN THE BASE 10 EXPONENT IN A

3521 59800 30,E ARE LEFT UNALTERED

3522 59820 FOUTNV! PUSH =O FSAVE (DE)

3523 59840 Loa VALTYP JGET WHAT KIND OF VALUE WE HAVE

3524 59860 cer 4

3525 59860 INZ FouTND WE HAVE A DBL

3526 59900 {NORMALIZE A SNG
3527 59920 XRA A ZERO THE EXPONENT

3528 59940 PUSH PS HSAVE IT

3529 59960 CALL FOUNSC I$ THE FAC TOO BIG OR TOO SMALL?

3530 59960 FOUNSis HOVRI 221,103,117,370 1GET 99999,9499 TO SEE IF THE FAC IS BIG
3534 oaoee CALL = FCOMP 1 ENOUGH YET

3532 evaze JPO FUUNSS JIT 18, WE ARE DONE

3533 6vo4da PoP PSW FIT ISN*T, MULTIPLY BY TEN

3534 ouaee CALL © FINMLT

3535 ove8e PUSH SAVE THE EXPONENT AGAIN

3536 6e108 MP INOW SEE IF IT 18 BIG ENOUGH

3537 60120 FOUNSa: POP ITHE FAC IS TOO BIG, GET THE EXPONENT

3538 60140 CALL VOIVIDE IT BY TEN

3539 oe1ee PUSH SAVE THE EXPONENT AGAIN

3540 60180 CALL SEE IF THE FAC IS SMALL ENOUGH

3544 60200  FOUNS33 POR HWE ARE DONE, GET THE EXPONENT BACK

3542 eveee POP 1GET (DE) BACK

3543 eeaaa RET PALL DONE

3544 60260 HERE TO SEE IF THE FAC IS SMALL ENOUGH YET

3548 6262 FOUNSC) MOVRI 224, 164,043,367 }GET 999999,499 TO SEE IF THE FAC IS TOO BIG
3546 60300 CALL FCOMP.

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDGFF MACRO 47(115) 6109 27*AUG*75 PAGE 13916
Fa NAG 23rAUGHO4 B6208 FLOATING POINT OUTPUT ROUTINE

3547 6e320 por 4 GET THE RETURN ADRESS OFF THE STACK
3548 eo3s4u JPo Founsa JIT IS TOO BIG, MAKE IT SMALLER
3549 60360 PCHL JIT 18 SMALL ENOUGH, RETURN

3550 60see WHERE TO NORMALIZE A DBL NUMBER

3551 evan

3552 eo4eo

MATHPK FOR BASIG MCS 8082 GATES/ALLEN/DAVIUOFF MACRO 47(115) 06409 27*AUG=7S PAGE 14
Fa Mac 23"AUGR64 BerEs EXPONENTIATION AND THE SQUARE ROOT FUNCTION

3553 60440 © SUBTTL EXPONENTIATION AND THE SQUARE ROOT FUNCTION
3554 6v4ea FE EXTFNC,<

3555 oo4ee FSQUARE ROOT FUNCTION #2= X=SQR(A)

3556 oesee FHE FIRST SCALE THE ARGUMENT TO BETWEEN ,5 AND 2 8Y LOOKING AT THE
3557 e5e0 VEXPONENT AND USING SGR(Mx2"(2eN)) #2°NKSQR(M), THEN NEWTON'S METHOD
3558 eesae FIS USED TO COMPUTE SQR(M), THE EXPONENT IS SAVED TO SCALE THE
3559 60560 PRESULT AT THE ENO,

3560 ousee FNEWTON?S METHOD FOR SQUARE ROOTS

3561 60600 P x(@) aA

3562 oveee TX CNL) BOK ON) #AZKOND I 72

3565 60640 FCHECK FOR ERROR CONDITION

3564 bu6e0 FCERR TCAN?T TAKE SQR OF NEGATIVE NUMBER
3565 60660 7 ossar(e)

3566 60700 Hy FAC }SCALE ARGUMENT TO BETWEEN ,5 AND 2
3567 ooree Aa GET EXPONENT

3568 60740 GET EXPONENT OF SCALE FACTOR

3569 oe7ed JUSE  SQR(MR2"(2aN)) S27 NASOR(M)
3570 60780 PSW SAVE IT

3571 ovsea 4 VSAVE POINTER TO EXPONENT

3572 ovseo MVE Ay Loe FSET EXPONENT OF SCALED DOWN NUMBER.
3573 6vada RAL

3574 60860 MOV Mea REPLACE IT

3575 oueee xT Hy FBUFFR SAVE A

3576 60900 CALL MOVMF

3577 60920 MVI Ana SET ITERATION COUNT

3578 6294e PUSH PSW SAVE COUNT

3579 60960 CALL PUSHF SAVE X(N)

3560 60980 xt Hy PRUFFR TCOMPUTE A/X(N)

3581 61000 CALL HOVRI GET A IN THE REGISTERS

3582 61020 CALL FDIV

3563 61040 POPR

3564 61069 CALL = FADD FADU_IN X(N)

3585 61080 xt Hy PHALF HOIVIDE BY 2

3566 61100 CALL FMULTS.

3587 61120 PoP Psw GET GOUNT

3568 61140 ocr A PARE WE DONE?

35869 b1160 NZ SURI INO, DO MORE ITERATIONS

3590 61180 PoP H YES, SET EXPONENT OF ANSWER

3594 o1200 pup Psw 1GET SCALE FACTOR

3592 61220 Aor 300 TCONVERT TO AN EXPONENT

3593 61240 avo 4 TADD EXPONENT IN

3594 61260 mov Mea TREPLACE EXPONENT

3595 61280 RET> TALL DONE

3596

3397

3598 6134¢ IFN EXTFNC,<

3599 61360 TSUBROUTINE FOR FPWR, ATN

3600 982340" oie voovar 61380 © PSHNEG? LxI Hy NEG GET THE ADDRESS OF NEG

3601 oves4i* gods ov11TS*

3ee2 ae2sae? opoava av2sar?

3003 002543" Yoieos ovosas 61400 XTHL FSWITCH RET ADDR AND ADDR OF NEG
3604 ev2344* dived ovassi o14eo PCHL JRETURN, THE ADDRESS OF NEG IS ON THE STACK

MATHPK FOR BASIC MCS 6080 GATES/ALLEN/DAVIDOFF MACRO 47(115) 66309 27*AUGH75 PAGE 14m1
Fa Mac 23nAUGHb4 06108 EXPONENTIATION ANO THE SQUARE ROOT FUNCTION

3606

3007 61480 SQUARE ROOT FUNCTION

3008 61500 GmE USE SUR(X)8X7,3

3689 we2s4>* Boioaa awesis 61520 CALL PUSHF FSAVE ARG

3e1@ 082346" vowove veieds?

So11 evasar? wngeee vasa?

Soi2 @vesse? eelese weevar e1sa0 xT Hy PHALF HGET 172

$13 082351" ovdowa oeasiet

3614 gee3se* Bonvan geesao?

3615 av2355* Bovey 4eosid 61560 CALL = MOVE PF SOR(K) EX", 5

3616 4a2354* Bavees v1eze?

3017 ove355¢ aoeeen avessi*

3018 weesse* Boies Bveser 61560 FPWRT: PUPR HGET ARG IN REGISTERS, ENTRY TO FPWR IF
3019 082357" Balvee Bves21

3020 61608 } ARGUMENT IS ON STACK, FALL INTO FPHR
Seat

Seee

Sees 61660 FEXPONENTIATION em xy

3e24 61680 INy8, 7034

3ees e17ee FIRST WE CHECK IF Ys0, IF SO, THE RESULT IS 1,

3626 1720 NEXT, WE CHECK IF x=0, IF SQ, THE RESULT I3 Oy

3627 1740 THEN WE CHECK IF X IS POSITIVE, IF NOT, WE CHECK THAT Y IS A
3028 61700 NEGATIVE INTEGER, ANO WHETHER IT IS EVEN OK ODD, IF Y IS A NEGATIVE
3029 61780 INTEGER, WE NEGATE X, IF NOT, LOG WILL GIVE AN FC ERROR WHEN WE CALL
3630 61808 i1T, IF X IS NEGATIVE AND Y IS ODD, WE PUSH THE ADDRESS OF NEG ON THE
3031 o1eee HSTACK SO WE WILL RETURN TO IT AND GET A NEGATIVE RESULT, TO COMPUTE
3032 61840 THE RESULT WE USE X™YSEXP(Y#LOG(X)

3633 oe2s6u' eolvee 300357 61860 FSIGN SEE IF Y IS ZERO

3634 082561" Bolgoe ovosie 61880 wz exe TIT 8, RESULT I8 ONE

3635 ea2362* Badve0 Bvedse?

So3o we2565" Goavve avessa”

3637 082564" waives ovsiTe 61908 mov Ay 1SEE IF x 18 ZERO

3038 202365¢ anigee avee67 61920 ORA A

3039 Qu23e6" Boiees avesi2 61940 sz ZEROe FIT IS, RESULT IS ZERO

3o40 2367" Bodevo avai74*

3041 av2370" Caeser guasoet

Bede wves7i’ aeivee oveses 61960 PUSHR SAVE X ON STACK

3043 a82372" aaieas avesas

3004 942375? Galooe avei7i 61980 Moy Ayc CHECK THE SIGN OF x

3045 482574" Ba1E2® 200566 seoue ORT 177 ITURN THE ZERO FLAG OFF

3046 062375 geeaae oeei77

3o47 eves7o* eaioee 302515 saved CALL MOVRF HGET Y IN THE REGISTERS

3048 e237" dagoeo seiedut

3049 aa2ane? aeauoa svaser?

3e5e ee24ai’ aoieoe evesce uP FRARt NO PROBLEMS IF X IS POSITIVE

3651 ae2svet aoovee eeaee?

So52@ av2a05’ oeaeds avast’

3053 aveaad? goieve aveses SAVE Y

3054 av24a" daivee eves05

3055 @e2age? aeicwe avesi>d SEE IF Y IS AN INTEGER

3056 aa2aa7’ aeaeee ev14as?

3057 eeeaiet aeves se2dae?

3658 ee2a11" Caieee eveser #GET Y BACK

MATHPK FOR BASIC MCS 808@ GATES/ALLEN/DAVIOOFF MACRO 47(115) 06309 27*AUG@TS PAGE 1492
Fa MAC 23eAUGROd B6108 EXPONENTIATION AND THE SQUARE ROOT FUNCTION

3059 oa2a12" aoieaa ovoser
3608 eve4i5" aoives gves6s 62120 PUSH PSW }SAVE LO OF INT FOR EVEN AND ODD INFORMATION
3661 @eices ovesid 62140 CALL FCOMP. SEE IF WE HAVE AN INTEGER
3o62 @oevoe ov1si7*
3003 @eeves vedor?
3eea @aiees evesat o2i6e Por H GET EVEN®ODD INFORMATION
3065 weleas ovei7a o2i1ag Moy Ay JPUT EVENrODD FLAG IN CARRY
3666 @eleee avous7 e2ane RAR
3067 Be1eee avos4i 62220 FPWRIs POP 4 GET X BACK IN FAC
3668 * goieen eeovae e2aaa SHLD FAG#d STORE HO*S
3669 TTVTTT TUTTI TN
307e egecee evaais?
eT. @aleee ovesas e220 POF 4 GET LO'S OFF STACK
@e12ea ovavde o2280 SHLO —- FACLO HSTORE THEM IN FAC
@oeeee Bo1asas
3674 * ape0ee oveaaat
3075 @oieae geass e2300 ce PSHNEG FNEGATE NUMBER AT END IF Y WAS ODD.
3e76 eoevee svesaot
@avees wvease?
eeieee oeasia 62320 cz Nes FNEGATE THE NEGATIVE NUMBER
@eeeee ouii7s?
eevees wveass’
@o1e0e aoesed 62340 FPWR2t PUSHR TSAVE Y AGAIN
@aieae ovese5
@g1e00 300515 62360 CALL FCOMPUTE EXP(Y*LOG(X)
eoveee avedeit
eaveee goede?
@o1eee avaser oeseo POPR VIF X WAS NEGATIVE AND Y NOT AN INTEGER THEN
Be1eee avoser
goreee 300515 o2aaa CALL FMULT> 7 LOG WILL BLOW HIM OUT OF THE WATER
@a0uee avari7’
@veasi* Bavee0 avadast
oeqao 7 Me exP
eea4e

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIOOFF MACRO 47 (113) 06429 27*AUGe7S PAGE 15
Fa Mac 23rAUGwOd Bots EXPONENTIAL FUNCTON

3693 62460 © SUBTTL EXPONENTIAL FUNCTON.
3694 62480 IFN EXTFNC, <

3695 62500 fWE FIRST SAVE THE ORIGINAL ARGUMENT ANO MULTIPLY THE FAC BY LOG2(E
3696 62520 THE RESULT IS USED TO DETERMINE IF WE WILL GET OVERFLOW SINCE
3097 62540 FEXP(X) 827 (X#L0G2(E)) WHERE LOG2(E)#LOG(E) BASE 2, THEN WE SAVE THE
3698 62560 FINTEGER PART OF THIS TO SCALE THE ANSWER AT THE END, SINCE
3699 62560 j2"Ye27INT(Y) m27CY*INT(Y)) AND 2"INT(Y) IS EASY TO COMPUTE, SO WE
3700 b2oue #NOW COMPUTE 2° (XsL0G2(E)@INT(X*LOG2(E))) BY

3701 eoee FP (LN(2) *CINT(X#L0G2(E))+1)"X) WHERE P IS AN APPROXIMATION
3702 62640 POLYNOMIAL, THE RESULT IS THEN SCALED BY THE POWER OF 2 WE
3703 62660 7PREVIOUSLY SAVED,

3704 vzaset veiva ovasis beoue CALL PUSHF TSAVE ARGUMENT

3705 @e2a55" ovease cviees?

3706 ove2a54* wovovs avease

3707 @veass* gaicge eeoeei 62700 MOVRI 201,@70,252,073 1GET LOG(E) BASE 2, CACULATE

3788 v24se" avenae veav7d

3709 @a24s7* Boevee ovaew

3710 ee2460" aeicee ovoval

3711 Ge24e1" voeees ovav7s

3712 vege? wovevs wesese

3713 82465" e1Gee 4easis FAULT INTCARG/UN(2)) 8 INTCARG#LOG2 (E)
3714 @e24e4* Besood veasir?

STIS @82a65* Beaoe Bved53"

S716 oeea60" waivee aeuere FAC }CARRY8G IF FAC IS T00 BIG

STAT @ve4OT? BOBeeD BU1446®

3716 002470" aaeeee wwedoa?

3719 uea7i? eotede aves76 210 1 1,E, IF ABS(FAC) ,GE, 128

3720 av247e’ Bogade eueetd

S721 v247s? Boleea evasee NLDVEX HIT 18 100 BIG

312e ge2a74* aocwen av107s¢

3723 gv2475* deeved owaaort

3724 ee476" Bo1oes g0e515 INT IS ARGUMENT TOO BIG?

3725 owea7? eoecee oviaas?

3726 eeesae’ aaecoe awea74?

3727 oveseit doles ave306 200 CHECK FOR OVERFLOW

3728 deesve? eeecee gedead

3729 ea5es" Bo1ea8 eveseo 2

3732 82504" agveve eevee

3731 082505" Beivaa svesse MLOVEX WE HAVE OVERFLOWS)

3732 @v2500" Beers Be1e7s°

3733 oa25e7* Gageee avesTi*

3734 we2sie? Beieee voeses PSH JSAVE SCALE FACTOR

3735 ov25i1" e100 avaval Hy FONE JADU ONE TO THE NUMBER

3736 weesie’ aavave wvasae?

3737 v2515" eaaven avaseo”

3738 902514" Baivea 900519 Faous

3739 @02515¢ eoee0e oeves?

3749 @v2516" dagued ovesie’

3741 282517" Beteea 000515 MULLN2 PMULTIPLY BY LNC2

3742 geesea’ goeese avesee?

3743 oe2s2i* esenee ewesis*

3744 Quesee’ Aaivee aves) 6 PSH GET SCALE FACTOR OFF STACK

3745 082525" 21002 ave501 JGET ARGUMENT

MATHPK FOR BASIC CS 8080 GATES/ALLEN/UAVIDOFF MACRO 47(115) 06409 27*AUG=7S PAGE 1561
Fa Mac 2SeAUGHO4 W610 EXPONENTIAL FUNCTON

3746 82524" Bo10ee avosai
3747 e82525" waivee aves6d 63000 PusH PUT SCALE FACTOR BACK ON STACK
3748 vwes2e? doieoe geasis 63020 CALL FSUBTRACT ORIGINAL ARG
3749 02527" apovee eeov17*
3750 ove53e* vnevee avedeu
3751 082531" gaieae oves15 63040 CALL.
3752 ov2532" Gagoeo ae1175°
3753 002533" apeeae aveda7’
3754 902534" doiges ovevai 65060 Hy EXPCON FEVALUATE THE APPROXIMATION POLYNOMIAL
3755 002535" doeeee ovasset
3756 802530" Bovoee avesse
3757 042537" Boleee Bves15 63060 POLY
3758 ov2540* vaowee co2eser
3759 982541" ogoeee Guedss*
3760 eve54e* aoivee soover 63100 0, SCODE FMULTIPLY BY 2 7 (Bei) INSTEAD OF JUST
3761 092543 Boooe0 Bv1477%
3762 902544" dose wvedae’
@a2545* oo1eee av0s01 3120 8 } ADDING IT TO THE EXPONENT SQ FMULT
@a2540" waiaea ovdiie 65140 7) FP WILL CHECK FOR EXPONENT OVERFLOW:
3765 oves4a7* eo1goo weeses 65160 FULT
3766 guesse’ aovoee oeesi7*
3767 82551" aoowee av2d43°
3768
3769 osave ICONSTANTS FOR EXP
3176 @ve5se? Qvoved Boavie @322@ EXPCONs 10 FDEGREE
3771 002553" gagece soaree 65240 100 7 =,0001413161
3772 082554" doovee g0005e 63260 as6
3773 922555" ageeee avaees 63280 2e4
@e255e* eoeeee avei6d 65300 164
9v2557* aneoee availed 63320 168 1001329882
3776 42568" aoeee— ova117 63340 417
3777 a02561* aooeee o0e056 63360 056
3778 @e2Se2" Go000a 00167 63380 167
@e2565* Booeve 200156 63400 156 00830136
ev25e4* ogevee aoovse 63420 oe
3781 82563" aoveee oooe1e os4ae 210
3762 002566" doaeee Bvai7e 63460 ire
ee2567* apecse vve346 63480 346 924465735
wees7e* vageee oveeao 63500 240
ge2571¢ aoeese oveese 63520 ose
@ees7e* eoavee av0174 63540 4174
ee2575* woeeee avoiee 63500 120 11666653
aw2574" egovee wvoese 63560 252
982575* peace aveese 65600 252
@e257e* vaaeee avei76 63620 176
ae2577* neeee 900377 63640 377 14999999
@e2e0" woveve eve377 63600 377
@e2eo1" ooeea oeai77? 63680 77
Be2eae* Ooawed ove177 65700 417
Be2ea5" vaavee suebou osTee ovo
W22004" Baaeee avovoe 63740 evo
@e2605" voeeae ovoeoe 63760 200
@a2en6" eageve ouaear 63780 201

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06209 27*AUGH75 PAGE 1592
Fa MAC 23rAUGROd BETES EXPONENTIAL FUNCTON

31799 #82607" Boaver voovow 65800 eae 11,0
3800 4e2610" doaeea guavad 6580 ace

3801 292611 aav008 avavod 63840 eae

3802 Aveeiet aa0000 oveent 65860 21>

3803 63880

MATHPK FOR BASIC MCS BG84 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06209 27-AUGe75 PAGE 16
Fa mac 23eAUGeO4 BOT08 POLYNOMIAL EVALUATOR AND THE KANDOM NUMBER GENERATOR

3e04 65900 © SUBTTL. POLYNOMIAL EVALUATOR AND THE RANDOM NUMBER GENERATOR
3805 63920 IFN EXTFNC,<
3806 63940 FEVALUATE P(x™2) ax
3807 63960 HPOINTER TO DEGREE#1 IS IN (HL)
3608 63960 FTHE CONSTANTS FOLLOW THE DEGREE
3809 oaaee FCONSTANTS SHOULD BE STORED IN REVERSE URDER, FAC HAS X
3610 64ge0 FE COMPUTES
seit o4a4e f COAXSCLRX*S4CORX"S4CSAX*744 440 (N) AX*(2HNOL)
3812 82615" Baieae oves15 64060 «= POLYXs =CALL «= PUSHF TSAV!
3613 ow2614* aoevao avieds*
$814 vee1s’ Bavees wvedset
3615 e261" Baives svover 64080 LxI D,FMULTT }PUT ADDRESS OF FMULTT ON STACK SO WHEN WE
3616 @02617" Boeae avesis*
3817 oee622" aoease aveoiar
$818 wv2621" Woigue guasas e400 0 7 RETURN WE WILL MULTIPLY BY Xx
3819 oe2622" Boiove ovesas 64120 4 1SAVE CONSTANT POINTER
3820 ov2625* Goieos 900315 64140 MOVRE FSGUARE X
3821 ov2624* oooove eviedue
3822 oweeas* vacuo avee17"
3823 ov2e26" voices oeesis 64160 FAULT
3824 ve2e27* aooeee avesi7*
3825 002630" anewes evecedt
3826 ooe631* asiees evosar 64180 1GET CONSTANT POINTER
3827 e4zeo HFALL INTO POLY
3828
3829
3830 o42oe JPOLYNOMIAL EVALUATOR
3631 eaeeg TPOINTER 10 DEGREE*1 IS IN (HL), IT IS UPDATED
3032 64300 THE CONSTANTS FOLLOW THE DEGREE
3035 o4useo HCONSTANTS SHOULD BE STORED IN REVERSE ORDER, FAC HAS X
3634 64340 WE COMPUTES
64360 1 CO#CA aX#CanX*26C 34K" 34,4 4+C(Ne1) AX (NeL) #0 (N) AXTN
@e2ese? waives avasis 64380 «POLY; «CALL = PUSHF SAVE X
3637 002633" Boeoae e1eas?
3838 002634" ag000 eveceT?
@e2635* voivos eeo176 64geo Mov AM GET DEGREE
022636 Goieos cvovas e4aeo INX 4 FINCREMENT POINTER TO FIRST CONSTANT
3841 042637" aieoa coosis baaae CALL = MOVFM IMOVE FIRST CONSTANT TO FAC
ev264e" Bpevee voteeet
@v2e41" aoeeee av263s*
weee4e? vaieoe avavve o44eo xwo 1000, 006 TYHVI — B* OVER NEXT BYTE
@v2e45* waives oves61 64480 © POLY1: POP PSW GET DEGREE
@02644" Bo1eee Boose 64500 POPR GET X
@e2649" wolves gvaser
@veede? Bo1eee svov7S 6aseo ocr TARE WE DONE?
@e2ea7? waiceo avasie 64540 RZ TYES, RETURN
we2ese’ oaieeo vases 64560 PUSHR NO, SAVE x
@v2651" Belear Boose>d
@veese? Baieve aveses ousbe PUSH SAVE DEGREE
w02655" waieee vvasas o4eue PUSH SAVE CONSTANT POINTER
Ove2es4? waleay 900515 64620 CALL VEVALUATE THE POLY, MULTIPLY BY x
@02655* Baeaee Beosi7*
@ve2e56" eveeer avecde

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACKO 47(113) 6309 27AUGR7S PAGE 16m1
mac

Fa 23rAUGR64 BO408 PULYNUMIAL EVALUATOR AND THE RANQOM NUMBER GENERATOR

3857 082657" BeluAa HbOS41 64640 PoP LJ HGET LOCATION OF CONSTANTS

$858 uze6u? ooicun ovasis 64600 CALL = MOVRM HGET CONSTANT

3659 @82661" Be2n00 Bb1e4s*

3860 02662" BoavOY Bu265S*

3861 64669 PUSH w TSTORE LOCATION OF CONSTANTS SO FADD AND FMULT
3862 Bv266S* BelveH BeaS4S

3863 02664" Baluee weeSIS e470o CALL Faou FP WILL NOT SCREW THEM UP, ADD IN CONSTANT
3664 802665 @gee0e Bvove5*

3865 G2666" AP2G2B Bv2061"

3866 602667" Be1eeB BH0S4) 64720 PoP MOVE CONSTANT POINTER TO NEXT CONSTANT
3867 002670" 491000 200305 64748 JmPr HSEE IF DONE

3868 942671" Be0Be0 Bw2645"

3809 O02672* GoBeae Be2668"

3870

3871

3072 FPSUEDVOeRANDOM NUMBER GENERATOR

3873 GIF ARG#Q, THE LAST RANOOM NUMBER GENERATED IS RETURNED

3874 HIF ARG 4LT, @, A NEW SEQUENCE OF RANDOM NUMBERS IS STARTED
3875 7 USING THE ARGUMENT

3876 #TO FORM THE NEXT RANDOM NUMBER IN THE SEQUENCE, WE MULTIPLY THE
3877 PREVIOUS RANDOM NUMBER BY A RANDOM CONSTANT, AND ADD IN ANOTHER
3878 FRANQOM CONSTANT, THEN THE HO AND LO BYTES ARE SWITCHED, THE
3879 FEXPONENT IS PUT WHERE IT WILL BE SHIFTED IN BY NORMAL, AND THE
3860 FEXPONENT IN THE FAC SET TO 20@ SO THE RESULT WILL BE LESS THAN 1,
3881 THIS IS THEN NORMALIZED AND SAVED FOR THE NEXT TIME,

3862 7THE HO AND LO BYTES WERE SWITCHED $0 WE HAVE A RANDOM CHANCE OF
‘3883 FGETTING A NUMBER LESS THAN OR GREATER THAN ,5

3884 @u2675*

3885 LENGTHe2,<

3886 av2675" Yeleod owoss7 FSTGN> 1GET SIGN OF ARG

3887 LENGTH=2,<

3888 CALL VSIGN HGET THE SIGN OF THE ARG

3889 PUSH PSH HSAVE THE SIGN

3898 cH FRCSNG HIF IT IS NEGATIVE, FORCE IT TO BE A SNG
394 MVE Ana F SINCE WE WILL USE IT

3892 STA VALTYP TMAKE SURE THE RESULT IS "SINGLE PRECISION"
3893 POP PSW> HGET THE SIGN BACK

3894 02674" OG1008 BeeSsTe vn RNOL ISTART NEW SEGUENCE IF NEGATIVE

3895 @02675' e008 ee27e5°

3896 402676" B98G80 Be2671"

3897 O8267T" Baieea B6eu4a1 65268 LxI Hy RNOX #GET LAST NUMBER GENERATED

3898 @v27eU" BOBGBe B0275e"

3899 @92701* Baeeee Be2e75°

5900 62702" Ba10e8 b8O515 65260 MOVEM

3901 9v2705" apava0 ovteeet

39e2 ae2724* aeeee Bera’

3905 Gb2705" BaleBe wBeOSsI1e 65500 FRETURN LAST NUMBER GENERATED IF ZERO
3904 65320

39e5 5340 ;MULTIPLY BY CONSTANT A

3906 65368

3907 42700" Be1eee® BHO315 65380

3968 Q82707" Gee008 Be1e4s*

5909 BveT1e* Baeeee BweTOS*

MATHPK

Fa

Ma
Fa

3910
3944
3912
$913
3914
3915
5916
3917
3918
3919
3920
3921
3922
3923
3924
3925
3926
3927
3926
3929
3930
3931
3932
3933
3934

3937
3938
3939

3942

THPK

3954
3955
3956
3957
3958
3959
3960
3961
3962
3963
5964
3965
5966
3967
3968
3969
3970
3971
3972
3973
3974
3975
3976
3977
3978
3979
3980
3981
3982
5983
3984
3985
3986
3987
3968
3989
3990
5991
3992
5993
5994
3995
3996
3997
3998
3999
4oeo
one.
auee
4003
aoe
ees
4006

FOR BASIC
MAC

overt?
everier
overts?
overiar
eve715°
eae716°
events’
eve7evt
everar?
everee?
eueras?
averaa?
eoe7es?
eue7e?
everar’
eve7see
ove731°
ove7ser
aue73s¢
woersae
eve735¢
ave7so*
eue7sre
ove7aer
oneraie
overae?
eoe7as?
ove7aar
eoa74s*
ove74er
eoe7a7?
ave7sar
eve7si*

goe7set
eue75s*
eve7sa?
av2755°
ove756°
eee757°
eve7eu"
eee7e1"

FOR BASIL MCS age

MAC

overeat
eo2765*
eve7ear
everest
oue76er
eve767"

eearrer

mcs 8080

23-AUGwoa Bere

vp1eeo
epoved
eoveen
eo1eve
eoevee
eaovee
eo1eee
aeevee
eoeveo
@aieeo
eoeeoe
eneveo
ve1eee
evevee
oooeee
eosooe
aereee
Beteoo
Qe100e
eeoced
aeieeo
CTT
eeteve
eoveee
Qo100e
evoooe
eoocee
eo1e00
eoeove
ooevee
eo1eee
aageoo
aooeee

aoveoe
ooovee
agooee
ao0000
aoveee
aoeved
waovae
eaeoea

evesis
ovesi7?
oeerer*
ovover
ovouse
avoise
ovover
oveiae
ovezel
esis
evaves’?
averie?
00315
eerequt
ewe7es?
ewai7s
aveisi
oveii7
eevee
oeeeoe
evoess
weeia6
auaveo
evgeos
evesis
Oueigor
eoe7aot
ovoear
averse
oaraet
avases
woresat
eoerast

overee
ovasa7
euoii7y
evoeou
avai7e
ovoied
avaves
auaesu

B3wAUGHO4 Bb108

eeicoe
aeevoe
eeevaa
@o1008
eoeeeo
eacved

ae1e00
eoveea

* aooeve

woerrar
eve77o?
aoeTTo*
ever7it

Be1vee
eneoee
eooeea
vo1eoe
aovove
eneuve

* eotov0

eoseze*
oosaes?

eoneae
2oeoee
@a1000
ao1eeo
woleee
eneven
vooven
aei1ea0
eaeege
eevee
Be1e00
evaded
eovede
wotoue
earove
@eiveo
eedeeo
aeoaee

ouewas
aesu7ut
owe7se*
eves15

avoves’
averos?

evesis
aereos?
22766"
aveoes
oweisi
auoeas
avowed
avesss
ovevir
avasi>
eo1ees
ove7ri’
avesar
evasar
@uosis
e0o6ss*
weswuer
ovesi5
oei2as¢
ousvaT?
@vasi5
eui4ase
weseier
ovesar
avesat
avosi>
ooewi7?
@o3uis*

GATES/ALLEN/DAVIUOFF MACRO 47(115) 0609 27—AUGe7S PAGE 16n2

POLYNOMIAL EVALUATOR AND THE RANDOM NUMBER GENERATOR

esque

65420

65468

65480
65500
65520
65540

65560
65580
65600

65620

65640

65660

65700
65720
65740
65760
65780
65800
65820
65840
65860
65880

RNOLE

RNOXS

CALL FMULT>

MOVRT —158,@50,261,1@6 FADD IN CONSTANT OF ORDER 2™(w24)

Fano
MOVRE HSWITCH HO AND LO BYTES,

ALE 4GET LO
Ec PUT HO IN LO BYTE
yA yPUT LOIN HO BYTE
200 TAKE RESULT POSITIVE

4 GET POINTER TO EXPONENT
8am FPUT EXPONENT IN OVERFLOW POSITION
4,200 SET EXP SO RESULT WILL BE BETWEEN @ AND

NORMAL WNORMALIZE THE RESULT
Hy RNOX SAVE RANDOM NUMBER GENERATED FOR NEXT

MOVAF 1 TIME

HCONSTANTS AND STORAGE FOR RND
see TLAST RANDOM NUMBER GENERATED, BETWEEN @ AND 4
307

117

200

172 TRANDOM NUMBER OF ORDER 2724

104

265

250

GATES/ALLEN/UAVIDOFF MACRO 47(413) 6809 27"AUGR75 PAGE 1

SINE, COSINE AND TANGENT FUNCTIONS

65900
65920
65940
65960
65980

be0ve

6oa20

eea8o
60100
beled
be1ao
be16g
6180
e200
bezee

oe24a

be2e0

e260

66300

oo3se0

66340

66360

66380

eeune
beaeo
66440
6e4ee
60480

SUBTTL
TFN

cost

81

SINE, COSINE AND TANGENT FUNCTIONS.
EXTFNC,<

FCOSINE FUNCTION

FIDEAS USE COS(X) sSIN(x#PI/2)

xt HyPI2 FADD PI72 TO FAC

CALL = FADDS>

FALL INTO SIN

#SINE FUNCTION

FIDEAS USE IDENTITIES TO GET FAC IN QUADRANTS I OR IV

THE FAC 18 DIVIDED BY 2aPI AND THE INTEGER PART IS IGNOREO BECAUSE
HSIN(X+2P1) 8S1N(X), THEN THE ARGUMENT CAN BE COMPARED WITH PI/2 BY
HCOMPARING THE RESULT OF THE DIVISION WITH PI/2/(2sPI) 81/4,
HIDENTITIES ARE THEN USED TO GET THE RESULT IN QUADRANTS I OR IV,
JAN APPROXIMATION POLYNOMIAL IS THEN USED TO COMPUTE SIN(X),

CALL PUSH TOIVIDE FAC BY 2xPt

MOVRI 203,111,017,333 JAFTER DIVIDING By 2xPI, RESULT 1S

CALL 1 BETWEEN @ AND 4

PUPK

CALL

CALL JOISREGARD INTEGER PART SINCE SIN

CALL 4 18 PERIODIC WITH PERIOD 2aP1

POPR

CALL

EXTFNG,<
UxI B,177*404SCOLE FGET 174
Mov Orc

Mov E,c

CALL FouB>

MATHPK FOR BASIC HCS 8082 GATES/ALLEN/VAVIOUFF MACRO 47(115) 26409 27*AUGR7S PAGE 1791
Fa Mac 23rAUGeod Or08 SINE, COSINE AND TANGENT FUNCTIONS

407 6e5ea IFN EXTFNC,<
4268 oese24* aoieeo avevas 66520 xT HyePRO FSEE WHAT QUADRANT WE ARE IN
4009 e63025" apes ause74?
4010 G03026* aoeeae ausvee*
4011 oesa27* veivee avosis 6os4e CALL = FSUBS>
4e12 ov3a30" a2e009 evevii?
4015 043031" vaso eesves*
4014 a03032" Be1eee Bv0557 665g FSIGN
4815 863035" goivoa aeeve7 60560 STC FSET QUADRANT I FLAG
4216 ov3034" aoieea ouasee rrr) JP SINI IFIRST QUADRANT, GET BACK ORIGINAL X
4017 003033" avooee av3va4"
4018 003030" dodoae 25030"
4419 003037" voteus evesis obee0 CALL = FADDA FADD 172
4220 dv3e40" sooeeo avoveet
4021 005041" eoveee vesess*
4e22 Buse4e" Bvieoe evessT 66640 FSIGN
4823 203043" coved eeeeoT 66660 ORA FCLEAR CARRY
4v24 003244" BoieMe avos65 66682 = SINI3 PUSH SAVE QUADRANT FLAG
4025 u3045" aaivee eased 66708 cP NEGATE IF IN QUADRANTS I, II OR IIT
4e2e 03046" eadeas Bw1175¢
4v27 005047" Caeva— ve30ae"
aves 6o72e EXTFNG,<
4oe9 66740 UxI By177*GOsSCODE FGET 174
4030 66768 Mov D.C
4031 66780 Mov E,c
432 6o8ue CALL = FADD>
4033 66820 EXTFNC,<
4034 003058" Cole evavar 66840 UxI HyFRO FADD 1/4, IN QUADRANTS II, IIT
9035 203051" aa0080 3074"
4036 ons052" ages avso4e*
4037 66860 1 USE THE IDENTITY SIN(PImX) SIN(X)
4038 6o88e FIN QUADRANT IV, USE THE IDENTITY?
4039 803055 oe1o00 oves15 6o9ee CALL «= FADDS> SIN (Xw2@ePI) 8SIN(X)
4040 03054" ao0000 avovas?
4041 003055" goeveo avsusit
@e3e5e" aves evos61 66920 PoP PSH GET QUADRANT FLAG
003057" agivae ovesad 66940 enc NEG NEGATE IF IN QUADRANTS II, III OR IV
@¥3960" vaewee ao1175¢
@e3e61" asevee oususat
66960 IFE EXTFNG,< JEVALUATE APPROXIMATION POLYNOMIAL,
66980 CALL PUSHF SAVE X
67000 CALL MOVRF FSGUARE X
67020 CALL FMULT
67040 CALL PUSHF VSAVE x2
67060 xT H, SINCON
67080 CALL MOVE }MOVE FIRST CONSTANT INTO FAC
67102 PUPR GET x72
67120 MVE ard 1GET DEGREE
6714@ = POLY1$ PUSH PSH SAVE DEGREE
67160 PUSHR SAVE xP
67180 PUSH oh SAVE CONSTANT POINTER
67200 CALL FMULT JEVALUATE THE POLY, MULTIPLY BY x72
b7eeo PoP 4 GET POINTER TO CONSTANTS

MATHPK FOR BASIC MCS 8060 GATES/ALLEN/QAVIUOFF MACRO 47(11$) 06309 27*AUGe7S PAGE 4792
08

F4 Mac 2SrAUGrOd O SINE, COSINE AND TANGENT FUNCTIONS.
avon o724e CALL © MOVRI 1GET CONSTANT
4ee1 67260 PusH oH FSAVE POINTER
4eo2 67280 CALL «FADD FADD IN CONSTANT
463 67300 PoP 4 JNOVE POINTER TO NEXT CONSTANT
4004 67320 POPR GET x72

465 67340 POP Psw 1GET DEGREE

4066 67360 OCR A HSEE IF DONE

4067 67382 INZ PoLyt #NO, DO NEXT TERM
4068 e740 la FRULTT> PMULTIPLY BY X AND WE ARE DONE
4069 e74e0 EXTFNC,<

4v7n wosee2* Ooiveo aeovar 67440 uxt Hy SINCON FCALCULATE THE SIN BY EVALUATING
4071 403065 aodoas ee3iau"

4e72 w03e64" Baca ee3u60"

4073 883265" oiaea Bvoses 67400 IMP POLYX> } THE APPROXIMATION POLYNOMIAL
4074 03060" Ap0000 oveois?

4875 03067" eoeree Ba3Le5*

4276 67480 FCONSTANTS FOR SIN, COS

4er7 67500 EXTFNC,«

4278 B3Se7v" Bavvee Bve333 67520 333 yPLse

4979 303071" aneoea wuaeiT 67540 17

4080 e3a72" apeeeo aeai1t 67560 ait

4@81 003075" aoane9 avoead 67580 201

4082 Bv3074" eacsee BegvoL 67600 eae

4263 03075" Apo0ee avoved 67620 eve

4084 Bv3076" Hooda aeeEdD e764e ao

4085 803077" aged aveiT7 67660 ATT>

4886 903100" 67688

4ee7 67700 EXTFNC,<

4066 dv3104" soavee veovas 671728 5>

4089 003101 eoveee veveTe 67740 272

4090 dv319e" G90008 9v0327 67760 327

4091 3105" aaeeae Beavse 67780 @36

4092 283104 aeoesa guaeoe 67800 206

4093 003105" aoveee 802144 67820 144 i 976,57498

4294 003106" @ad080 BoeLae 67640 o46

4095 wusieT? oeoves eveesi 67860 asi

4096 803110" Badoea oeeeoT 67880 207

4097 803111" Gae02 ae0130 67900 130 + 81,60223

4898 203112" aeeeee aoevEd 67920 64

4@99 003115" eovee avevas 67948 43

4100 205114 aaggee avoeoT 67960 207

4161 803115* gaaaaa o00S4e 67980 340 4 941,34168

4102 003116" o¢oeoa 200135 ouaee 135

4103 0511/" evevae oveeds ese 245

4104 03120" e9a7e0 aBeaeee rr 206

41@5 003121 Gaovae ouasse 68060 332 i} 6.283185

4166 03122" dnevee oeovi7 oease ei7

4407 003125" aeadae availi 68100 ait

41e8 203124" ena0ea aooeas 68120 203

4109

4110

aun 68180 EXTFNG,<

aise 68200 FTANGENT FUNCTION

MATHPK
Fa

aus
aia
ais
4116
aui7
4116
a119
aieo
ater
aiee
aes
aie4
aies
4126
ayer
ai28
a1e9
4130
4131
4132
4133
4134
4135

MATHPK
Fa

4136
4137
4138
4139
4140
4144
aie
414s
414g
4145
4146
4ia7
4148
4149
4150
4151
4ibe
4153
4ais4
4155
4156
ai57
4156
4159
4160
164
aiee
416s
4164
4165
4166
4107
4168
4169
4170
amt
aire
417s
ai7a
as
4176
ai77
ai7e
4179
4168
4161
4162
416s
4184
4165
4166
4187
4188

FOR BASIL NCS 8080

Mac

@o3ias°
@e3120°
eesia7*
005130"
oe3i3it
oes13e"
o0313s°
003134"
003135"
203130"
oesi37e
@asi40"
Oesi4it
we3i4er
@esi4st
oosia4e
aes14s¢
oosi4e*
oosi47*
@0315e¢
oo3i5i¢

FOR BASIC
Mac

a0315e"
@e3153¢
aa3154*
@03153°
@03150*
ev3157¢
003160"
203161"
003162"
005165"
oosi6e4"
@03165¢
045160"
Ba3167"
vesi70"
a03171°
wosi7er
oe3175¢
oosi74e
@03173°
9@3170°
oosi7it
wesaae*
aeseeit
waszeer
aes2as¢
easeedr
oesees*
ee3sz2ee"
oesear?
oeseiet
oosaiit
oeseier
aasaise
eosai4e
weseis?
wosarer

eesai7?
eeseav?
ooseai*
@o3ezer
eos2ast
ooseea?
aese2>"
oe3z2o"
@eseart
aesese"

23rAUGRO4 Bb106

@eivee oasis
@gaeee aviees’
eaaven Besvoot
eeivee ooesis
ooewee averrer
@aevee oesies’
Oo1ve8 evoser
Goivee avesai
@o1eee 900515
@oaee0 avieas?
@neven 3131"
Boga avesss
@p1ee0 eva315
@oovea eerees?
@90000 9u3136"
Qoieee av0sis
@aseea oveToe’
aoevee evsi4e*
ese aveses
@oee00 eeaes3*
@edee0 ee3145¢
MCS B08

23AUG=64 B6408

eotoae
ea1000
eaoeea
eaoved
@eieee
eoeeee
eeeues
eeivea
eoec00
eoeeae
@a1c00
egooaa
eoreee
eoevae
ooneve
eo1eee
eove0e
evacve
go1800
a10¢0
@e1000
aooede
evecee
ao1vee
eavece
eaoeee
@aieoe
eeioue
eooeee
evovee
eeiveo
eaoeea
evovee
eeioee
eevee
eoovee
eo1e00

eooece
aoee0ee
Bee2ae
aoauee
aaavee
@eaceo
eaeeae
ageoee
aeevea
eevee

ovoss7
900374
av2saet
@osiset
00374
oo117:
wosisat
aooure
ovaders
oosis7t
ovasTe
aegeai
evasse
eo3seas?
oesi6e"
eeovel
1004008
oesi67*
owoiel
@ee131
oeas1>
eeaess’
aesi7et
eeaeat
ooouist
oesi77¢
900349
eeoeas
owsei7?
aesee?
eeasis
oveois?
aeseee"
avgeas
ae3u7er
aeseii?
ooosit

eeoeit
oearte
evoser
avoe7s
aeoi7e
oeevoe
90156
aegeos
eeoi7s
20as7e

oseew
osede

ob26e

os2ee
68see
rrert)

68s4e
66300

68380

oe4ao

os4eo

TANS

PAGE

GATES/ALLEN/DAVIDOFF MACRO 47(115) @

GATES/ALLEN/DAVIDUFF MACRO 47 (113) 06309 27*AUG#TS PAGE 1703
SINE, COSINE AND

TANGENT FUNCTIONS

TTAN(X) BSIN(X) /C0S (X)

CALL PUSHF FSAVE ARG

CALL SIN FTAN(X) BSIN(X) /CUS (x

PoP 8 GET X OFF STACK

PoP H TPUSHF SMASHES (DE)

CALL PUSHF

XCHG GET LO*S WHERE THEY BELONG
CALL MOVER

CALL «CUS

gn FOIVT>

9 2T@AUG*7S PAGE 18

ARCTANGENT FUNCTION

6844a
68468
rr)
68500
6652
6654

68568

68580

o8oue

68622

oboe

68668
68680
68700

o87ae

68748
68760

66788

68802

ovsee

66800
6b88e
68900
68928
66940
68960
68980
69aee
69020
69040
69060

SUBTTL
TFN

ATNG

ATNat

ATNCONS

ARCTANGENT FUNCTION

EXTFNC,<

FIDEA? USE IDENTITIES TO GET ARG BETWEEN @ AND 1 AND THEN USE AN
TAPPROXIMATION POLYNOMIAL TO COMPUTE ARCTAN(X)

FSIGN WSEE IF ARG IS NEGATIVE
cm PSHNEG VIF ARG IS NEGATIVE, USES

ce NEG 1 ARCTAN(X) SRARCTAN(#X)

Loa Fac FSEE IF FAC ,GT,

cer 201

ve ATNe

xr &,2@1*400+SCODE 7GET THE CONSTANT 1

Mov o,c

Mov ec FCOMPUTE RECIPROCAL TO USE THE LOENTITY?

CALL OFDIV }ARCTAN(X) #PI/2eARCTAN(1/X)

UxI Hy Fsues }PUT FSUBS ON THE STACK SO WE WILL RETURN
PUSH OH 7 TO 1T AND SUBTRACT THE REULT FROM PI/2

uxt Hy ATNCON TEVALUATE APPROXIMATION POLYNOMZAL

CALL POLYX

xr HyPI2 #GET POINTER TO PI/2 IN CASE WE HAVE TO
eT 7 SUBTRACT THE RESULT FROM PIv2
JCONSTANTS FOR ATN

Mt FDEGREE

112 } ,wo28662260

3a?

73

178

ova } 01616574

156

204

175

376 + ,o4290901

MATHPK FOR BASIC NCS 828 GATES/ALLEN/UAVIDUFF MACRO 4/(113) 06429 27°AUGH7S PAGE 1691
Fa mac 23rAUGrog 26108 AKCTANGENT FUNCTION

4189 203231" on0e00 veser 69060 304

4190 oo3e3e" enevee 98a0S7 69100 as7

4191 003235" eeoeee ova17d 69120 174

4192 ov3234" eaoeee avo1Ed 69140 164 707528964
4193 003235" Bee0e0 voovEl 69160 eet

4194 ou3230" aoeeeo vooese 69180 232

4195 0e3237* eoeveo ooe17d 69200 175

4196 gv3eae" agvved aveen4d 69220 204 11065626
4197 ea3eai" ageeee svov7d e924e a7s

4198 ov32ae" apoeee ovarse 69268 132

4199 05243" apecea ao0i7s 69280 475

4200 803294" a90000 avesie 69300 310 7.142089
4201 oa32a5* enecea ovoi77 69se0 177

4eve ov3aqe* aoeeee weoees 69300 eet

4203 a03247* Bneaee avB176 69560 176

4204 o03250" eoevee voosaa 69380 344 91999355
4205 o03251" eo0000 ooveTs 69400 273

4206 wos25e" eedeee ovo1i4d o94ew 114

4207 003255" eoeeee 400176 69440 176

4206 903254" apeeee aveis4 69460 184 =, 3333315
4209 003253" wed000 avaese 69480 ase

4210 203256" aovase eoaese 69500 ase

4211 003257" eaeeae avait! 69520 177

4212 03260" eaecee avavee 69540 20a

4213 ao3261" eeeaee eeoved 69560 eee

4214 B0Sa6e" eaeeee avovoe 69580 ooo

4215 003263" aeevee gvveor 69600 21>

a2ie 69620

MATHPK FOR BASIC HCS 8080 GATES/ALLEN/DAVIDOFF MACKO 47(115) 26309 27=AUGe7S PAGE 19
Fa mac 23nAUGmO4 C6108 SYSTEM INITIALIZATION CODE

4ai7 69640 © SUBTTL SYSTEM INITIALIZATION CODE
4aie 69660 RADIX 10 FIN ALL NON®MATH PACKAGE CODE
4219 69680 THIS IS THE SYSTEM INITIALIZATION CODE

4eeo 69700 717 SHOULD BE LOADED AT THE END OF THE BASIC

aeet 69720 FINTERPRETER

geee

4ee3 69768 INTERNAL INIT

4224

4ees 698¢0 © EXTERNAL CROO,LINGET, QINLIN, READY, SCRTCH, STROUT, REASON, BUF
4226 69820 EXTERNAL SNERR, OMERR, ILLFUN

4ee7

4eee 14seae 69860  FUNIO==<"D256#"0312>4"O4a+SCODE

4229 ao3264" 69862 © INITSA: BLOCK 10

4a3@ ov3276* eareee ovevai 69909 © INITAT? LXI Hy AUTTXT

4231 ev3a77* cedvee ee4es:

4232 903308" eooeve ovseiat

4233 003301" Ga10e@ 000315 69920 CALL STROUT

4234 Ge33ee eoovee ovt7oss

4235 03305" e2edee 00527

4236 ves3a4" 69942 INITS

4237 69960 IFN REALIO,<

4238 003304" doiede av0s35 69960 IN 1 IGNORE GARBAGE CHAKACTER IN INTERFACE
4239 083305" aadeve avevel

240 205300" Boteve aeusss 7¢000 IN mass FSEE WHAT KIND OF 1/0 HE IS
4241 003307" eodeed aves77

4242 003310" eaves aeasae 7020 ANI 20100 HIS HE FUNNY TTY?
4243 03311" voowea everee

4eaa eossie? aives avasie 70040 vt NOTSIO

4205 003315" oreoee ov3345"

4246 005314" geooee avsseet

4207 003315* Beleee aveo4s 70008 Hy FUNIO

4248 003310" oeaoee 145040»

4249 905317! Codoeo 003315"

4250 025320" Galedo avevse 70060 CNLCA2#H +2

4251 3321" vaeeas vevees

4252 05322" godoeo eussiet

4253 905325" daivae avev4e Te10e H, 70310

4254 003324" eeoeee ovosie

4255 003325¢ Getvoe evavde 7e1ee SHLO CLC AS#u42

4250 0vs320" vodeee avaveds

4257 905327* Gogoee av3sseit

4258 7e14@ LENGTH, <

4259 023330" agieee svevse Teted wv Hy "0304 FSUBSTITUE "CNZ"
4260 203331" saves avased

4261 u5332" Boteee Beavae e180 SHLO —- CNLCAG## 42>

4262 203333" ooovde avavees

4263 243384" eevee av3S20°

4aea 14500e 7@200  FUNIO==SCODE+<"D2564"0312>02

4265 43333" wolves ovev4as reeea Uxr Hy FUNIO

4266 003330" oder 1450024

4267 003337" Gooove 03333"

4268 83398" Boleee vevde Te2aa ShLO — CNLCAL #942

4269 @u3341* aeevea Beaveer

MATHPK FOR BASIC MCS 88 GATES/ALLEN/UAVIDOFF MACRO 47(113) @6429 27*AUG=75 PAGE 1991
Fa mac 23eAUGebG AeTO8 SYSTEM INITIALIZATION CODE

4270 003342" eoae00 au3536"
4271 03345" weleoe owos3ss 10262 NOTSIOs IN 7255

4272 003344" oceeaa evas77

4273 005345" aa1e0e ovasae 710260 ANT "040

4274 003346" Brecon ovavae

4275 403347" Gaiden oeosi2 70300 vz NOTPIO

4276 20335e" ereees wus4out

4277 003351" oo009@ wo3541°

4278 145002 70328 FUNIO®=SCODE+<"0256a70312>42
4279 003352" doivee avoeas 70340 L Hy FUNIO
4280 003355" eacove 14S¥ee

4261 003354" an0000 003350"

4282 005355" eo1e00 soavde 70360 SHLD CNLCAasa
4283 003356" an¢cen aoevees

4264 003557" apeeeo ov3355"

4285 003360" eaicoo guavae 70380 MVE 470310
4266 003361" eoeeee ovesio

4287 003362" en1000 aoov4e 70400 SHLD CNLCAS¥2.
4288 003363" ao0aee aeavoes

4289 003364" Baad 43356"

4290 T0420 LENGTH, <

4291 03369" eo1ove oveLde 79948 MVI H,70304

4292 005360" voveee voesed

4295 ov3367" va1oo9 soavae 70460 SHLD CNLCAG#a>
9294 003370" a90080 eeaedex

4295 403371" Boogee Qv33505"

4296 145001 7046 FUNIO®=SCODE+<"va56e7031a>e1
4297 003372" eo1eea aeoLdd 70500 uxt Hy PUNTO
4298 03375" On00eo 145¥e1%

4299 05374" eoveed 4v3370"

4306 003373" valove soevae 7esee SHLD CNLCAL ea.
4301 003370" aoeved weaveer

4302 003377" eooves av3ss7s*

4503 evsqoer 70540 NOTP103>

4304 043490" ae1000 wvauat 70560 xr H, SCODE+"065535,
4305 003401" ap0e00 177777%

4306 dvSae2" woveas ouss7e*

4307 005405" aoieue guovde 70580 CURLING® FIN CASE OF ERROR MESSAGE
4308 0v3ae4" aooved avava0"

4309 005905" eoooed wvs4er?

451@ ooSae0" aoicaa ovaeai 70600 uxt Hy TSTACK SET UP TEMP STACK
4311 03407" Boveee oe4315¢

4312 003410" Boeeed av3uuar

4313 03411" ep1ee0 avas7i Te6e0 SPHL

4314 esate? evieee evovae 70640 SHLD —- STKTOP##
4315 003415" Bveeee Goovees

4316 Said" aeeeee avsag7®

4517 7@660 IFN CONTRM,

4316 03415" B91000 ovoesT 7@680 XRA

4319 ov3a16" ealeee wvovee 70700 STA CNTWFL#e>
4320 003417" aov0eo govevads

4321 003420" ages oos4is*

4322 vS4a1" Goines anas15 T0720 CALL = cRDO TYPE A CR

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/UAVIDOFF MACRO 47(115) 26409 27AUGHTS PAGE 1982
Fa mac 23wAUGwOd 26408 SYSTER INITIALIZATION CODE

4323 003422" epee veevoLs

4324 903425" Opes Bu3417"

ages 70740 STRING, <
4326 ov3a24" aoioas avavas T0760 UxI H TEMPST#®
4327 ov3aa5* enceda avaveds

4328 03426" ogovue eusazet

4529 003427" e91000 eeoude 70780 SHLD TEMPPT##>
4330 003430 eo0e0 vevads

4531 003451" Boe aB34a5?

4532 7e8ee REALIO,<
4333 05432" @01000 avevar Tobe xt
4334 003433" ogd00 eedeas?

4535 003434" vecove 03430"

4556 003455" ea10e9 000315 7e840 CALL STROUT FCALL THE STRING PRINTER
4337 003436" aad0Ge ov3s0ex

4338 03437" aovoee oo3435°

4539 o3a4e" ao102e wvasid 70860 CALL == @INLIN GET A LINE OF INPUT

4340 003441" Gove aeevcer

4341 oesa4e" aga 203436"

4542 03445" aeieve oveseT 70680 CHRGET GET A CHAR

4303 803404" aaicae auesTe 72900 cer man

434g @eavee oveier

4345 @o1080 peesie 70920 Bri INITAT

4346 Qo0000 ewseTo?

4sa7 Bevvee gusaait

4548 Oerees oveee7 70940 ORA ry

4349 @alveo avesee 70968 NZ USEDES NON ZERO, DONT USE DEFAULT
4350 eoovee ov3sse1?

4351 003454" eneved ou3447"

4552 903459 ao1vee evevas 70980 uxt HyLASTWR

4353 03456" Booed audesT®

4354 803457" Beeeee Bes45s"

4555 vS460" waleee avoeas 71008 © LOOPMM: INX 4

4356 @ @a1eee svev7e 71020 MVI ArBaL

4357 @eoeee avoae7

4358 waives eveie7 71040 Mov MA

4359 203464" ealaee sese7e 71068 CHP ”

4500 003463" Op1ved eeesee 71080 INZ USEDEF

43e1 203466" Boos 03515"

4362 05467" epeeed eusaser

4563 003470" Ba1eee evoeTd T1100 vcr Ly

4364 da3a71* Gelnaa wearer 71120 Mov MA

4365 oa3407e" Beloee wweeTe i148 che 4

4366 003473" ealeee ovesie T1168 rd Loopan

4367 003474" e200 Bo34ee"

4368 003475" aavoee avsdoo*

4569 05476" Boleed sB0305 T1166 amp USEDEF

4372 @e3477* Boecoe av3515°

4371 BoS5e0" BeeeDe ovSa74r

4372 evsse1" ae1ooe avavar 71200 USEDE9: 4, BUF

4373 083522" ea0000 oveveds

4374 003505" eoevee owsarTt

4375 003504" @a1uee 900515 712e0 LINGET GET DECIMAL AMQUNT OF MEMORY IN [D,E)

H, MEMORY TASK HOW MUCH MEMORY AVAILABLE

MATHPK FOR BASIC MCS 8084 GATES/ALLEN/DAVIDOFF MACRO 47 (115) @6489 27#AUGR75 PAGE 1963
Fa mac 2SwAUGHO4 B6808 SYSTEM INITIALIZATION COLE

4376 003505¢ Bpe2—e BveLdos
4377 v35e6* eecwve ausseet
4378 003507" ea1vee voeee7 Tia4e ORA A
4379 @ei1vee gvasee 71260 NZ SNERR JMAKE SURE HE HAS A TERMINATOR
4380 eeevee avovaes
4584 eaeea av3ses’
see @o190e evesss 71260 XCHG
4363 @oiese woowss T1300 ocx h
4364 203515" eateve gva0ss 71320 USEDEFS Cx >
4385 T134@ FE REALIO,¢
4386 71360 x1 Hy SCOUE+16190>
4387 @03516" Bo1ed evos4s 7138 PUSH oH FALSO SAVE FOR LATER
4388 003517" Be1cea avaedd T1400) TTYwS LXI Hy TTYWIO
4389 03520" ereveD so4aiaT?
4392 03521" eeveee av3sii*
4391 ee3s2e* eaivee oeasis 71420 CALL © STROUT
4392 003523" eaouee Be343b%
4393 @asse4* eoveee ovssac?
4394 05523" Belvo aves15 71440 CALL GINLIN
4395 03526¢ aeeveo oosdais
4396 05527" Bo0vee aus5es°
4397 003530" oa1vee veose? T1460 CHRGET
4398 003531" ovle~ee aveee? 71480 ORA A
4599 003532¢ a91000 aoosie T15e@ ra OFLENT
4400 003535* enoeee Besba4"
4401 005534" eaeoos oo35e6*
4402 003535¢ evivee aoovas 71520 xT 4, BUF
4403 003536" oedv0g av3saex
4 003537" ogee av3935"
@0354e* Galea 400315 71540 LINGET
003541" aver aussas*
003542" waeeee avssse?
003543 wolves ovoi7e 71560 )
203544¢ aoiceo aooes7 7158@ 4
003543" eaieoa seasee T1680 TTYW
203540" avecee au3siT?
003547" aodeee avssaie
003550" woleue veoi7s T1620 AE
003551" Ocivee avesTe 71640 16
Qv35Se* Badcua coovad
003555* ao1ceo evosse 71660 se TTYW
023554" Boeeea v3517°
@85555* weaved aessaer
003550" ao1eea avovee 71680 STA LaNPTiae POECLARE LINPT1 EXTERNAL
03557" ooveee aoavers
@e5560" Qoeeea usrsa?
T1768 LENGTH, <
03561 volcan evovee T1720 STA LINPT2##>
@u3562" Caeeve aeavEeex
@83565" woeeaa vsss7?
T1740 STRING, <
@v3564" Ba1ees eu0v6e T1760 STA LINPTS#e>
03565" veeoes acaveus

MATHPK FOR BASIC NCS B08 GATES/ALLEN/VAVIDOFF MACRO 47(113) 06109 27*AUGRTS PAGE 1994
Mac

Fa 235eAUGHb4 Bores SYSTEM INITIALIZATION CODE
4429 0550" eooeee wessee®

4430 @oieea eases 71788 NORGPS$ SUI 14

4a34 @oeeee eoavie

4aase @aieao avasee T180¢ INC MORCPS

4433 @edove 003567"

4434 @oevee ovsses?

4035 ee1ee2 ovesae 71820 Aor 26

4436 @ovvee avevsa

4437 @aivve weous7 71640

4430 @e1eee evav7d 71860 INR A

4439 eoieae evsees 71868 Apo e

44a @aieve ovavee 71900 LINPTOs®

rr sy @nevee eeavevs

4aae eoeeee avssTe?

4aas 719282 © OFLENTs

4444 71948 LEN STRING, < JSET UP DEFAULT STRING SPACE
4045 4v3e09" eo1eea avever 71968 UxI Dy SCOVE+*D65536="05001

4446 ovsen3* doveee 177717%

4447 203606" weeeve Bvseae?

4448 euseaT? Coleee evas41 71980 PoP x

4449 Gv3e1¥" BoI200 oBOeGE T2000 SHLD MEMSIZ## SAVE IN REAL MEMORY SIZE

445@ 003611" B2v00n weoveoe

4451 036128" Bogeue woseed?

4452 005615* eevee eeavae Teeeo SHLD FRETOP#® STRINGS START FROM HERE DOWN
4453 03614" Ba@eeD avaveE®

4454 @oeees esos?

4055 @oivea eousi 72040 Dap 0 CALC STRBOT BY SUBTRACTING 202 FROM STKTOP
4456 Selec aeosee Tee6d INC OMERR MUST BE POSITIVE

4457 0? eaveee ovavoer

44568 epeeee veso14?

4459 Osives eevovss 7Tee8e ocx 4 FONE LOWER IS STKTOP

4460 03625" eetere ovesas Te1ee PUSH > FSAVE IT ON STACK

age ei2d  IFE EXTFNC,<

ace Te14o

4463 Te16e FUNCTION DELETION ROUTINE FOR 4K MACHINE

4460 72180 TO ADD A NEW FUNCTION JUST UPOATE T8LDO

4465 Teaee

4466 Teeeo LxI 4, TeLDO START OF FUNCTION TABLE

4467 Tee4o PUSHH PUT ON CANDIDATE FOR START OF FREE NEMORY
4968 Ta26e uxt D, TADASK DONE ASKING?

4469 72280 COMPAR

4are 72300 ve FINFUN FYES, GET FIRST FREE MEM LOC
aa7h Tesee FINTO [0,€1 AND QUIT

4are 72340 PUSHM PUT ON MESSAGE LOCATION

4473 72300 XTHL F(H)L) SMESSAGE POINTER

4a7a 72380 POINTER INTO TBLOO GOES ON THE STACK
4475 Te4oo CALL «= STROUT PRINT THE MESSAGE

4a76 Teaee CALL GINLIN SEE WHAT HE HAS TO SAY

4aa77 72443 VSEE WHAT THE FIRST CHARACTER OF INPUT WAS.
4478 Teaee # POP OFF POINTER INTO TBLUO
4479 Tease c myn

4aee 72500 © FINFUNS o JPOP OFF CANOIDATE FOR START OF
4461 72520 FREE MEMORY

MATHPK FOR BASIC NCS B52 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06409 27-AUG#75 PAGE 1995
Fa Mac 25eAUGHO4 6108 SYSTEM INITIALIZATION CODE

auee 72540 dz HAVENS. JHE WANTS IT SO WE ARE DONE
4463 72500 crr man VIF A BAD ANSWER

4464 72588 Ing, ASKAGN IMAKE HIM START OVER

4485 T2600 PUSHN 7PUSH ON FUNCTION CALL

4486 T2620 TLOCATION THAT WE FIX UP
4467 72648 XTHL 1 (H)L) 2FIXUP PLACE

4488 72660 HPOINTER INTO TBLDO GOES ON THE STACK
449 72680 Gxt 0, TLLFUN HTHIS 18 WHAT WE STORE

449u 7eT00 MoV ME

4491 Tetee INK 4

aage 72740 mov MoD

4493 72760 POP 4 1GET TBLOO POINTER

4494 72780 Pilg LOPASK> }GQ ASK AGAIN FOR ANOTHER FUNCTION
4495 72808 IFN EXTFNG,<

4496 05624" Bolvae veovar 72820 ASKAGN: LxI HyFNS. TASK IF WANTS SIN, COS, ATN,
4497 a03625* Beeeee avaoior

4498 203626" eeeees vese2e’

4499 003627" B91000 aves15 T2640 CALL STROUT FINE STRING

4502 003630" BeenVa ovS>25*

4501 003631° Beever av3625¢

45@2 ovSese" Beieea avos15 72860 CALL GANLIN

4303 003633" Bo0ov0 Buss2o%

4504 805634" eaene0 gu3e3s0°

4505 005635" @aivoe BveseT 72660 CHRGET
4506 003636" Gv1000 BveS76 72900 crt
4307 003637" woveee vva131

4508 003640" @olvee seovel 72920 uxt D,INITSA TASSUME NOT DELETE ANY FNS
4509 003641" eveeBe Buseo4"

4510 G0364e" woeeee 4vsess*

4511 005645" wo1eve avesia 72940 Bra HAVENS. YUP,

4512 03644" apenae o037iet

4513 03645" woveaD ausb4i"

4314 005646" eo10en Bvas7e 72968 cPr man

4515 Gus647" wpeved eooiel

4516 005650" Beleon ovosie 72980 rd OKCHAR

4517 03651" aoeeew aesoeu!

4518 05052" Gawews av3ba4u"

4519 003655" Balvee ovesTo 73000 crr Ne

4520 005654" en0ee0 ave116

4521 03655" @a1000 ovasee 73020 ASKAGN

4522 05056" Baeeee vesbeat

4523 05657" Boveue 2e3651°

4324 05060" Golvee Beana1 73048 OKCHAR? Hy ILLFUN TMAKE SURE BOMBS IF TRIES TO CALL THEM
4325 003661" eaevee soove0r

4526 o03e6e" Beeeee 003650"

4327 003665" Ge1vee ovevel 15060 Dy, ATN

4528 003664" eaevce av3si5et

4529 003665" BoevVe av35661°

4530 03666" Oaieae deov4e 73080 AINFIX##

4931 003067" ogeees eeauau»

4532 5674" Boevee dvSo6a"

4933 003671" Go1eea 00376 73100 I man JOELETE ATN BUT NOT SIN, COS?
4534 3672" vaeee vee1al

nye

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(115) 96309 27-AUGe7S PAGE 1996
Fa mac 23nAUGrod O6108 SYSTEM INITIALIZATION CODE

4535 003675" Balvoe ovos12 73120 Jz HAVENS: TEST
4536 @eevee avsiiet

4537 Bereea Bv3667"

4538 @aieee evovae 73140 CUSFIX##

4539 @ee090 guaveex

4s4o eaeeee ouse7at

4544 @eieas aeavge 73160 TANF Ix##

4542 2* B9ea00 evevel

4543 @eveee avseT7*

454g @e1eeo avovge 75180 SINFIX##

4545 @eveee avovovx

4546 Qeevea avs7ae?

4547 eg1e20 evever 73200 D,Cos>

4548 eoeeee avaTeet

4549 @gevee avs7e5"

4550 73220 HAVENS? TEXT ALWAYS PRECEDED BY ZERO
4551 Ge1ve8 ovesss T3240 XCHG 7PUT BOTTOM OF MEMORY IN (Hy Ld
ase Gaieee svovee 73260 NVI m0 FSTORE IT

4553 Gageer aeovee

4554 @a1eee evovas 13260 Nx 4 FINCREMENT POINTER
4555 @o1eee avovae 73300 SHLD TXTTABRH TSAVE BOTTON OF MEMORY
4556 @oeeee svoveur

4557 @govee aesri0*

4558 @a1eee avosas 73320 XTHL

4559 eareee evovei 75340 uxr 0, TSTACK

ase eeeven wvasidot

4504 @eevee avs7i7®

asee eo1eee svosa7 75360 COMPAR

4563 @eieee evasse 73360 Je

ase @aevwn wvseevs

4565 @aevoe wusre

4566 @eivee gooser 75406 Por °

457 @o10e0 ees7) 713428 SPHL

4568 @aioer evevse 73440 SHLD STKTOP

4569 Qa0e00 ev3415"

asa @ovoee av3s7e7*

amt @e1eee eeosss 75460 XCHG

as72 eoigee avesid 75482 CALL = - REASON

4573 Baeeee evavae%

4574 @eaeee v3734°

4575 05742" Beieee BooITS 73500 Mov AYE TSUBRACT VARTAB FROM STKTOP
4576 25745" aelada Bueeed 713320 3uB r FLOW PART

4577 003744" eeia00 Bea1s7 735408 mov ary D

4578 03745" Oaivvo BeoITe 73568 mov ayo THIGH PART

4579 003746" @oi1092 ovaes4 73580 SsbB 4 }

4560 063747" @e1ave vid? 73600 mov Hea JLEAVE IN (B,C)
4581 005750" Bolvee eveva 73620 xt 5, SCOLE+65520

4582 003751" Bpeaee 1177608

4565 45752" Bpeeee weSs74avt

4584 v3755* eaiees avovti 73640 bao 6

4585 03754" @o1eow guesis 75608 CALL = CROO HTYPE CRLF

4586 003755" apeev9 ousdeer

4567 03756" eoeeve ae3751°

MATHPK
Fa

4588
4569
as9e
4591
aso
4593
4994
4595
4596
4597
4598
4599
aeee
4eo1
dove
4eus
4o0a
4ees
4600
4607
4008
4609
4e10
rrset
gore
4613
Gora
4615
4616
4617
4618
4619
aeee
deer
deee
does
4eed
4ees
426
4ee7
4ee8
4629
4o30
4631
4632
4633
4634
4635
4036
4637
4638
4639
aeae

FOR BASIC MCS Ba6e

MAC

ae3757*
ee376u"
ees761"
aus7ee?
o03765°
ousTo4at
oes76a¢
ee3760"
003767"
wes770¢
ves77i¢
oos77er
003775"
ees774¢
ees77s¢
@e3770°
eos777¢
wadoov?

ooapai?
oedouet
ee4avase

aeaouae
aeagas?
@o4gaer
eeapare

23-AUGeo4 BorUa

en1000
oeeved
oversee
eo1oee
eo2000
eoeeoe
eo1vee
evoere
eoeven
eo1e0
eaeven
eaveen
@o1ceo
eoeven
eeovao
ee1eao
eoevee
eaeaso

@o10e0
eevee
enecaa

oo1eeo
oooeee
eoevee
eo1eee

oeosis
evrsoet
eus7ss"
eeavay
oe4iges
wes7ea"
000515
ee 3e30%
aes7es?
ovavat
OU3766%
903760"
eeooude
ovovels
eos77it
@vesis
opovaor
ous774*

eeowas
ovavaos
oesr77¢

evavae
oeaveas
oe4quae?
evessi

SYSTEM ANITIALIZATION CODE

73680

73700

1sTe0

73740

73760

T3780

73800
13820
73840
75860
73880
73980
73920

75948
73960
73980

74000

74048
74060
74080
74100
Ta1e0
T4140
74160
74180
74200
T4220
74a24e
74260
74260
74300
74320
74340
74368
74360
74400

IFE
TeLoo8

TBOASK?
FNSS

FNsat
FNSSE

IFN

CALL LANPRT

Gxt hy WORDS
STROUT
xr Hy STROUT

SHLD -REPINI##4

CALL SCRTCH

LPTSW,<
VI Ad

our 2

xRA ry

STA PRIFLG#S
STA LPTPOS##>
CONSSW, <LXT

CONSSW,<
Lxt H, CONSDO##>
SHLO —- SCODE+2

PCHL.

EXTFNC,<
ADRCINITSA)
AOR (FNS)
ADR (SINFIX)
ADR (SIN)
AOR (FNS2)
ADR (RNDFIX)
ADR (RND)
ADR (FNS3)
ADR (SWRFIX)
ADR (S@R)

DCMWANT SIN"
@

DCMWANT RNOY
C)
DCMWANT SUR

a>
EXTFNC,<

H,READY>

GATES/ALLEN/DAVIOOFF MACRO 47(113) 6109 27-AUGH75 PAGE 1997

JPRINT # OF BYTES FREE

FTYPE THE HEADING

FALTAIR BASIC VERSION®

TNOW SET UP EVERYTHING ELSE

FCLEAR THE LPT

FEND OF ASK TABLE

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDUOFF MACRO 47(115) 06409 27*AUGR7S PAGE 19-8
Fa Mac 2SwAUGmO4 bI0S SYSTEM INITIALIZATION CODE

4eat
aoae
aoas
4oaa
4645
4646
4047
4048
4049
4050
ob
4o52
4e53
4054
4655
4656
4057
4058
4659
4oo0
goer
ae62
4663
4664
465
4666
4667
4068
4669
aero
4o71
ae7e
4073
4074
4075
4o76
4e77
4078
4079
4e80
4681
aobe
468s
4084
46685
4686
4687
4688
4689
4690
4691
4692
4095

@o4a10" wooooe
904911" aoo0ee
eeaaie? dooove
@e4015* aoeoue
go4n14" Boaoue
ga4915* oavoee
Bo4g1ef Baaeee
ev4e17? wavoes
@e4avee’ aovove
ee4nai’ Bbavove
Bodeee? ugovee
aedeas? apovad
evaaad? anooso
eudaas’ eooeae
eeda20e* aov0ee
eo4ueT* vooov~e
Bodn3e Baoods
evausi? aaocee
dodese? enoove
204035" onaveo
904035" epavca
eo4us4* eovode
004035" opevee
ae4ese* ooevve
we4as7? oavee
eeag4o? aavoee
Bedeai? eoovee
@edede? oaavee
ee4e4as? ooeose
ae4e44* oeoee
ae4e4s? enevee
aedode* enaven
Be4ga7? opovee
ae4g5e? woeeoe
2e4n51* Boeeeo
evdeser ogoooe
064055 Boeeeo
weaes4? aovead
ee4ass? booeve
@eae56 ono000
eaaas7? ooooee
@e4veu" agdove
ee4e61" eoveve
eo4g6e? enovee
@e4265" eavvee
ee4ae4" eaaove
@e4965* Bovvo0
@e4a06" aoevee
@a4e67" ooeveo
204070" weaves
wedu7i’ eovous
Beaa7e? anovee
oe4o7s? ooovee

aeoier
eeoies
eerie
weeied
eeavae
aeoias
overt
@eai16e
eegess
oveies
eels
evaies
eveess
gevred
eeoial
oae116
oeaess
pveier
oeoiad
eeoite
oonsie
avovee
aveu1d
evavie
eoovie
gooie7
evaiee
oveiii
eoeied
eeoied
eueies
eoai16
ovoede
ovaige
oveis1
eeaeae
eveiee
oval
geeii4
oveiid
aeoude
evoie7
avoier
eoored
aeaies
aeeias
avovge
evevde
oeauae
overee
eveier
gored
oveii4

74420 FNSt DC"WANT SINwCUS@TAN@ATN"

74440 a>
74460 AUTTXT! ACRLF

74480
74500

"010
DC"WRITTEN BY BILL GATES & PAUL ALLEN & MONTE DAVIDOFF,”

MATHPK FOR BASIC MCS BBG GATES/ALLEN/UAVIDOFF MACRO 47(115) 06309 27-AUGH75 PAGE 1909
Fa mac 23eAUGrOd 46108 SYSTEM INITIALIZATION CODE

4094 4oao74* eoveae ovavan
4695 ge4a75* ended wvarer
4096 woda7e’ eneose aoeir4
4097 04077" woooee wosi14d
4695 Godioe" eoeeve wveies
4099 e4101" vaBeve vuelto
4700 ea419e" epacae aeevae
4701 04105" eevee avavas
a7e2 04104" Bpeeee Buovae
4703 04105" Bpoeee Bve115
4704 a04106" eaeved guaitT
4705 oo4ia7? eaevee evaiie
4766 oe4114" eaBdee goerad
4707 @b4111" BaBveD woo105
4708 wvsiter aaveen ovevae
4709 @04113" eaeved ove1e4d
4710 004114" Bodeee o1e1
4711 804115" Beevee wooi2e
4712 641106" eevee veri1
4713 evaii7? waveee oveies
4714 vdieo? BpoveR avoi17
4715 oe4121" eoeavD Bveie6e
4746 eo4122" eveveD BoO1e6
4717 04125" Beeese BveoSe
4718 o04125" wpeeey evoeso
4719 oaa12d" a9even ave01s 74520
4720 Bo41a5* BevoeD wooUIE
4721 04126" Beeven avevae 74540 @
4722
4723 oos127* Bav000 ova1ed 74560 TTYWID? DC"TERMINAL WIDTH"
4724 004130" eoeoee veiled
4725 04131" eooean souree
4726 004132" Goode vues
004135" apevad valid
904134 Boweve ovel16
064135" Booey Beeler
084136" eaves weoi14d
404137* eaves evevae
oe4i4e apeooe avarer
@o4i41" wevows veoiit
wediaet Boovy veied
004145" Boos evored
Ov4i44* booowe evei1e
@e4144" ooooMe 00510
ev4145* wavsde weaves T4600 )
@edide* eevee avavae 74620 WORDS? DC” BYTES FREE"
ee4147* aaeoee evoive
904150" opeeee ove151
904151" BoBvee Beoled
@e415e" Bove aveids
904155" aoo0ee weoles
904154" aoQvee evevge
@04155* Boovee eue1de

MATHPK FOR BASIC MCS 8060 GATES/ALLEN/DAVIDOFF MACKO 47(115) 6109 27"AUGR7S PAGE 19-10
Fa Mac 23rAUGRO4 06108 SYSTEN INITIALIZATION CODE

4747 004156" Beov0n over12e
4748 04157" Beooee Bve105

4749 gvai6%" Boodve Bvel—as

4750 ov4i6e" eons ovesas

4751 o04161" eoB0ee BeueIs ACRLF
4752 Bosi6et ened aoewie

4753 004165" Goovde oo015 ACRLF
4754 004164" eonee Boerie

4755 04165" anvees eee1aL OC"ALTAIR BASIC VERSION 3,0"
4756 004166" dgov9e woo114

4757 004167" @oe0a8 ave12d

4758 04170" Bove veaIeL

4759 004171" Boe oveI1L

4760 wvdi7e’ Bove veeiee

4761 04175" BpevVe wBoBLdO

4762 04174" Bases evoide

4763 004175" gavvoe eveied

4764 Be4176" Booees aveies

4765 804177" Goavo— eoaitt

4766 evd2a0* Bespon avoias

4767 ae4aai* Baoevs evevge

4768 wedage? aeevea ovs1ee

4769 04205" wovevd eowiad

a77@ 84204" eaeean oue1ee

4771 04205" BaBeae oeoies

4772 avsage* eevee Bee111

4773 04ae7t eooeed ovei1/

4774 @e4a1e* BaBeee BeB116

4775 geda11" Gaveee ovevae

4776 Ba4aie* Beever wuovESs

4777 edais? Beever Beavse

4778 4214? BoeoBe YoovEd

4779 we4ar4* weaves auseow

478@ Bodais* eperee wuev1s 74700 ACRLF
4781 de4216" apeod0 avoute

aree 74720 IFE LENGTH, <DG" (FOUR®K VERSION) ">
4783 04217" @pveee 000135 74740 TFE LENGTHm1,<OC"(E1GHT#K VERSION) ">
4764 evdeev? eoeeae ove1aS

4785 oo4e21" epeAaa wve111

4786 gvdaze’ wnevan evaieT

4787 ae4a2s* apeone BeallY

4788 wedead? apevoe wooied

4789 @b4ee5" eoveee Boee55

4798 wedaee’ eovere euo11s

4791 aodee7* eoovee vevay

4792 04230" Bpevee wuai26e

4793 Bed231" BaeeeD avoled

4794 eedase? weeved eevi2e

4795 04253" Booves BoBies

4796 04234" apeese eei1i

4797 0e4235* Bga009 auo117

4798 4a30" eoeLBD Buo1le

4799 084237" ape0ee gue135

MATHPK FORK BASIC NCS 8060 GATES/ALLEN/UAVIDUFF MACRO 47(113) @6809 27AUGH7S PAGE 19911
Fa Mac 23rAUGeO4 B6108 SYSTEM INITIALIZATION CODE

4800 44237" ByeQBy 400335
4ee1 T4760 TFE LENGTHm2,<0C"(61G VERSION) ">
4ev2 Bedaau? eaeeee dvov1d 74780 ACRLF

4803 vedaai? eoeeve ovevie

Weed Beaade? agaven BeaLne 74800 C)

4ees

4eeo 4245" eoevee vve11> 74848 MEMORY! DC"MEMORY SIZE"

4807 gu4244* apoeae oveies

4808 vodaas? epeeee ove11d

4809 Bedaae* epveee Bve11T

4810 04247" apovee vooiee

9811 oa425u° epveae ov0151

4812 oa4a51" egeeee avovay

4813 oo4ase* epeees ovoies

4814 gu4ass* egoved aveiit

4815 oeda54* weered auaise

4816 004255" apveee aue10s

4817 woaass? eoevee avesas

4818 4256" Bneeee soaved o

4819 a04as7* LASTWREE }LAST WORD OF SYSTEM CODE*!
4b20 ooaas7? BLOCK *v3¢ SPACE FOR TEMP STACK
4821 ooasis° TSTACKEE

4e22 Ire LENGTH, <

aes BLOCK "v1 s000>

abe IFN LENGTH, <

4625 goasio¢ BLOCK "v1 eaee>

4826 ovaves® 102283 ,P

a6e7 END

NO ERRORS DETECTED
PROGRAM BREAK Is 927735

9K CORE USED

MATHPK FOR BASIC MCS 8080 GATES/ALLEN/UAVIDUFF MACRO 47(115) 06109 27*AUGR7S PAGE 20
F Mac 23mAUGmO4 B6I08 SYMBOL TABLE

e00ee7 oMULT 081476" INT FRULTS aoveset
001173" INT OMULTS a015a6" FRULT4 eoes71¢
000105 OmuLTe oeiseqe FMULTS eavea7*
@ase2at DSKFUN @eeod0 SPD FMULTA @eoees*?
oosi5e* DVERK oeaes7* EXT FMULTB Cr
weseas? E eo0a03 FMULTT @o0515°
eosei7? ERROR ooae7a? ExT FNS eo4aoie?
@asee7? ERROV ovae7e? ExT FONE eoauee?
004035" EXP INT FouT ooevei?
ego000 EXPCON 2 FouTt oeeois?
@o1see? EXTFNC SPO FuuTia oo215i¢
203536" Fac ExT Fouris oe22ie*
eovver FACLO Ext Foutie eeeese"
eeoves FADD Fouti4 eveeser
voovee Fago1 . FuUTI5 eveesa*
eovvee FaoD3 FOuTI7 @eee7i*
eoeoee FADDA FOUTI9 ea22ee"
ooovee FADDH Fouts eo2e34e
eosai7? FAaobs FOUTS oo2e71"
aeov0ee FAovT Fouts eoei24"
eooees FADFLT FOUTS euei3e"
aoe7eat FOUFFR Fouts eeeeea"
@o3077" FCERR Q FOUTBL ee2si6r
@03755° FCOMP. FOUTCB ovze7at
Bosugar FCOMP2 FPWR oe2sea"
eovere FCOMPD FPRWRL ovedeet
ee17c0" FCOMPS FPwRe oe2aaar
@aseuar FOLV FPWRT oo235e"
@00037° FoIys @ Fra oa3074"
Foive FRETOP Basera?
FOIVA FsuB oeei7"
FoIve FSUBS eaeei1"
FOIVC FSuBT Ce
FOLVG FUNIO 145001
FOIVT 4 eoeea4
FHALP. HAVENS, oe3712¢
FIN ICOHPS weiiaar
FING TLLFUN @a3ee1" ExT
FING INIT 03304" INT
FINDIG INITAT 205276"
FLNOP INITSA eoseour
FINE INPRT 001756" INT
FINE? INRART go1145* INT
FINES INT oo144s? INT
FINE INTXT @01760" EXT
FINEDG INXHRT geese" INT
FINO’
FINMLT
FINMUL
Float
FLOATK
FMULT
FMULTe avess7*

MATHPK FOR BASIC MCS BUSA GATES/ALLEN/DAVIDOFF MACRO 47(113) 06309 27*AUGH75 PAGE 2001
Fa mac 23eAUGHo4 BOrws SYMBOL TABLE

tc eeveas OKCHAK euseoo? SHIFTR ova3s34"
LaSTHR ee4es7* INT OMERR aosra7? SHRADD ooasee"
LENGTH @oe001 sro OVERR eeeee7* S16N oo1seet
LINGET @a3saie ExT Pre ee307a" SIGNC @a1135¢
CINPRT @a1766° INT PLUSTK ee1615¢ SIGNS oo1143t
LINPTS @o35s7¢ ExT POLY oe2e32° SIN ee2770°
LINPT2 803562" ExT POLYa oe2ease SINt evsadae
LINPTS @a3505" ExT PULYX ae2e13¢ SINCON ee3100°
LINPTA @aseae" ExT PUPHRT eeeesa" SINFIX 0e3705°
Los eeo4er? INT PUPPRT aeiarar SNERR eessiit
LoGcna ao0404" PSHNEG oe2sao" Sur eaes4st
LooPnn @p3460" PSH aeceee STKTOP o03734°
LPTSh @govea srD PUSHF oer1aes? STRING eeoees
4 epewe6 srD QINLIN ause33° STROUL 201776"
MEMORY @o4east GINT eeis7er STROUT ee3771°
MEMSIZ @ase1i1* EXT QINTA TAN oa3125¢
MINUTK @e1ees? EXT READY TANF IX ee37ee"
MLOVEX 001073" REALIU TEMPPT 203430"
MORCPS 095567" REASON TENPST easaas?
MOVE @e1e57* INT REPINL TSTACK a43is¢
MOVES we1eei? RND TTYW e03517°
MOVEM @eteee’ RNDL . TTYWIO ooaiert
MOVER @a1ees? RNOX TXTTAB @osri7?
MOVHF eo1esae ROUND UNPACK earerer
MOVRE epiedor RUUNDA USEDED eessai?
MOVRM @a1e43? ROUNDB USEDEF eo35i5¢
MULLe @e11¥6" SCRTCH WORDS Boa146F
MULOI eooees SGN ZERO e0i73"
MULOIV 001035° SHFTRI ZERO @ooi7a?
MULOVS @e1a76" SHFTRE SCODE eoasas
MULDVe ae1e77° SHFTRS 200356" ca eodees?
MULLNA eeasee" +P ea4oes’
NEG @e1175¢

NEGR 000510"

NORMS @eaisi’

NORM2 Beeeea?

NORMS ooeeiat

NORMAL, oa014e"

NOTPIO @as4eu"

ASKAGN
ATN
ATNE
ATNCON
ATNFIX
AUTTXT
8

CASSh
CNLCAL
CNLCAe
CNLCAS

CNL CAS
CNTWFL
CONSSh
CONTRW
cos
CosFix
cROO
CURLIN
0

DCRART
OFLENT
olvie
DMULT
OMULTS
OMULT2
DSKFUN
OVOERR
i

ERROR
ERROV
exP
EXPCON
EXTFNC

Fac

FACLO
FaoD
Fao01
FADD3
FADDA
FADOH
Faops
FaooT
FADFLT
FBUFFR
FCERR
FCOMP
FcomPa
FCOMPD
FCONPS
FOIy
FOIva
Folve

FRETOP

ee4e
ean
BT oe
eaT#
8vo#
eg7ew
aseen
2334,
eae
esTow
2408e
24o0
2434
24308
23940
208o#
2599
2791
2545#
10638
10938
76H
709%
781%
174
7608
7528
1478
o74e
aeaie
S8o#
eraee
27550
2880
2908
29168
29354
e941
295s
29488
2795
28098
2836
209
2967
29778
2804
30538
3oo7e

Sore
4e35
4453

qusex

308
eas
918

2380

3659

4445

3766

352
629
920

2398

3681

4455

3824

3855

3944

a

HAVENS
ICOMPS
TLUFUN
INIT

INITAT
INITSA

LASTHR
LENGTH

LINGET
LINPRT
LINPTS
LINPT2
LINPTS

MEMORY
MEMSIZ
MINUTK
MLOVEX
MORCPS
MOVE,
MOVE.
MOVEM
MOVER
MOVMF
MOVRF
MOVRN
MULIe
MULOIM
MULOIV
MULOVS
MuLove
MULLNe
NEG
NEGR
NORMS
NORMe
NORMS
NORMAL.
NOTPIO
NOTSIO
OKCHAR
OMERR

RNOL
RNOX
ROUND
ROUNDA

4ove
4164

4200
269
489
178
999

1249

1559

2701

2877

3664

3930

4259

4384

die

11958

3648
3859

2620

eat
3908

2687 3984

3923

3752 Gaze

1276
2793

3837

4ia7

4044

1280
2800

3975

4145

1623
2002

3992

1632
2627

4415

2327
2645

aes

2391
2916

ROUNDB
SCRTCH
SGN
SHFTRA
SHFTR2
SHFTRS
SHIFTR
SHRADO
SIGN
SIGNC
SIGNS
SIN
SIN1
SINCON
SINFIX
SNERR
SOR
STKTOP
STRING

STROUI
STROUT
TAN

TANF IX
TEMPPT
TEMPST
TSTACK
TTYW

TTYWID
TXTTAB
UNPACK
USEDES
USEDEF
WORDS
ZERO

ZERO®
SCODE

ce
A

ass
4761

4392

2340

1695

1858
asoe
2818
see
43ie
boise
6554
7048
Bos4
89548
9508
10198
1065¢
11908

a37s
4803

45e0

2824

187
239
266
389
467
627
658
708
B16
897
952
oat
4087
41198

2381

4595

3764

1888
24oe
2678
3908
aoee
o2be
6594
7098
e178
a9ee
95308
yoeew
10868
11998

2387

4598

4156

194
250
294
396
494
633
682
15
eat
910
970
1028
1095
1203

2389 2435

4264

202
255
297
399
525
636
687
743
630
930
974
1036
1106
tate

2435 4ses

4296

ai7
ent
317
404
534
639
691
749
835
934
983
1040
1125
1234

4426

4305

2168
a7ee
3188
4ase
5354
b4e
e9ew
7508
8308
9356
9848
1oaie
11268
asse

PUSHFM
PUSHM
PUSHR
RAL
RAR
RET

RLC
RM

RNG
RNZ

RST
RZ

see
Ser
SHLO

SPHL
STA
STC
sua
Sul
SYNCHK
XCHG

XRI
XTHL

SPOOLER RUNTIME 14 SECONDS,
*RENDH® USER HITS.

WREND OH

RENDER

wREND EDN

REND A

RENDER

wREND EH

SAEND#®

wAEND#®

HREND#®

AREND#®

RRENDE®

wRENDE®

wREND#®

AREND A

avaoes

240
451
1116
604
4o2e
ai4
3905
303
eau
689
4314
4315
373
900
220
35/
398
ase
2884
299
eae
ater
1172

tere
453

676
4140
405

307
884
1196
4329
4567
685
4015
sau
et

236
aes

2716

aa77

81s
as4e
540

gut

a9
1201
4449

828

497
676

688
asee

ste
2771

2369

USER MITS o002,6000)
USER HITS (6000, 6000)
USER MITS [600¢,6000)
USER MITS (6ee0,6000)
USER HITS (6000, 6000)
USER MITS [6aee,6000)
USER MITS (6000, 6000)
USER MITS (6008, 6000)
USER MITS (6008,6000)
USER MITS [6400,6000)
USER MITS (6008, 6000)
USER HITS [6008,6000)
USER MITS (6008, 6000)
USER MITS (6000, 6000)
sand vausaacaoooouauaed

459

997
4391
err

5068
ase

ass

e20
2590

rae
4551
426
4318

3008

44 KCS, 462
lewd, evo) Fa

308

yo 4

Joa Fa

Jos F4

1045
1077
4505
1031

EVEy

sere
4530

1s7e
2092

171

47h
495

4558

1069
1115
4562
1344

506

4aso
4538

1561
2938

865

538

DISK READS, 3

SEO, 205

SEQ, 205

SEQ, 205

SéQ, 205

SEQ, 205

SEG, 205

SEG, 205

SEQ, 205

SEO, 205

SeG, 205

Sea, 205

SEQ, 205

SEQ, 205

Sea, 205

SEQ, 205

DATE

DATE

DATE

DATE

bDaATE

DATE

DATE

DATE

DATE

DATE

DATE

DATE

DATE

vaATE

DATE

gaauagngaaaze:

1361
sae
1535
1068

4255
asat

895

240s
4430

1168

866

DISK WRITES,

1365 1369
2348 ©2368
1697-2376
2am 2675
4264 42668
4544 ©4555
93204319
2417 2667
4179 1195
975 979
118 PAGES

27*AUG@75 07236123 MONITOR

27*AUGATS

27*AUGeTS

27 °AUGe75

27 *AUG=7S

27-AUG*75

27 eAUG 75

27m AUGH7S

27 #AUGe75

27#AUG#75

27-AUGe7S

27°AUGH75

27*AUGe75

27°AUG®75S

27*AUG975

a7s3e123

a7tser23

orss6123

a7 36123

o7 836125

o7 36123

O7336123

O73 36123

O7 336323

o78ser23

o73 36123

07836323

07336323

O78 36823

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

MONITOR

HONTTOR

MONITOR

MONITOR

MONITOR

MONITOR

-vuoasaveseaueganss

1375 1583
23940747
23792384
4579
4262-4267
4568 = 4600
4419 gaa
4576

1204 1704
1e71 1281
ALBUGUERGUE

ALBUQUERQUE S|

ALBUQUERQUE

ALBUQUERQUE SI

ALBUQUERQUE S|

ALBUQUERQUE

ALBUQUERQUE 51

ALBUQUERQUE 5!

ALBUQUERQUE 51

ALBUQUERGUE SI

ALBUQUERQUE SI

ALBUQUERQUE SI

ALBUQUERQUE S|

ALBUQUERQUE S|

ALBUGUERGUE S$

oovogoaaaiiit

3633
2390

4293
4e17

4427

1706

1348

SCHOOLS 507A

CHOOLS SO7A

SCHOOLS SO7A

CHOOLS 527A

CHOOLS 507A

SCHOOLS 507A

CHOOLS 507A

CHOOLS SO7A

CHOOLS 507A

CHOOLS S@7A

CHOOLS SOTA

CHOOLS 507A

CHOOLS SO7A

CHOOLS 507A

CHOOLS SO7A

3886

2545

4300

aaao

2gay

1355

REND WH

#HEND#®

#HENDE

#HEND ER

#RENDE®

AREND#®

#RENDE®

wREND WH

wHENDO®

aEND ER

aRENDO®

#RENDH®

#RENDO®

#REND#®

*REND EH

SEUUEECESSHSSRESENUCCEETE

4ei4

3849

4307

271s

1954

